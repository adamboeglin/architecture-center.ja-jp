---
title: 適切なデータ ストアの選択
titleSuffix: Azure Application Architecture Guide
description: Azure でのデータ ストアの選択の概要。
author: MikeWasson
ms.date: 06/01/2018
ms.topic: guide
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: seojan19
ms.openlocfilehash: 91a551025ae697d5828fc1e398b204d2901d17f6
ms.sourcegitcommit: c053e6edb429299a0ad9b327888d596c48859d4a
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/20/2019
ms.locfileid: "58242023"
---
# <a name="choose-the-right-data-store"></a>適切なデータ ストアの選択

現代のビジネス システムで管理するデータの量は急速に増加しています。 データは、外部サービスから取り込まれたり、システム自体によって生成されたり、またはユーザーによって作成されたりする場合があります。 これらのデータ セットは、きわめて多様な特性や処理要件を持つことがあります。 企業は、データを使用して、傾向を評価したり、ビジネス プロセスをトリガーしたり、経営を監査したり、顧客の行動を分析したり、他のさまざまなことを行ったりします。

この多様性は、単一のデータ ストアがいつも最善のアプローチであることを意味しません。 代わりに、異なる種類のデータを、それぞれ特定のワークロードや使用パターンに重点を置いた異なるデータ ストアに格納する方が適切です。 *ポリグロット パーシステンス*という用語は、さまざまなデータ ストア テクノロジを組み合わせて使用するソリューションを表すために使われます。

要件に応じた正しいデータ ストアを選択することは、重要な設計上の意思決定です。 SQL および NoSQL データベースの文字通り何百もの実装の中から選択することになります。 データ ストアは、多くの場合、データの構造とサポートする操作の種類によって分類されます。 この記事では、最も一般的ないくつかのストレージ モデルについて説明します。 特定のデータ ストア テクノロジで、複数のストレージ モデルをサポートしていることがあるので注意してください。 たとえば、リレーショナル データベース管理システム (RDBMS) では、キー/値のストレージやグラフ ストレージもサポートしていることがあります。 実際に、1 つのデータベース システムで複数のモデルをサポートする、いわゆる*マルチモデル* サポートに対する一般的な傾向があります。 ただし、概要的にさまざまなモデルを理解しておくことも役に立ちます。

特定のカテゴリのすべてのデータ ストアが、同じ機能セットを提供するとは限りません。 ほとんどのデータ ストアは、データをクエリして処理するサーバー側機能を提供します。 この機能は、データ ストレージ エンジンに組み込まれている場合があります。 他の例では、データのストレージ機能と処理機能が分離され、処理と分析のための複数のオプションがある場合もあります。 データ ストアは、さまざまなプログラムおよび管理インターフェイスもサポートします。

一般に、要件に最適なストレージ モデルを検討することから始める必要があります。 次に、機能セット、コスト、および管理しやすさなどの要因に基づいて、そのカテゴリ内の特定のデータ ストアを検討します。

## <a name="relational-database-management-systems"></a>リレーショナル データベース管理システム

リレーショナル データベースでは、行と列がある一連の 2 次元テーブルとしてデータを編成します。 各テーブルには固有の列があり、テーブルのすべての行に同じ列のセットがあります。 このモデルは、数学上のベースとなり、ほとんどのベンダーが、データを取得し、管理するために Structured Query Language (SQL) の言語を提供しています。 RDBMS は一般に、情報の更新用に、ACID (原子性、一貫性、独立性、永続性) モデルに準拠する、トランザクションの一貫性があるメカニズムを実装します。

RDBMS は一般に、データ構造が事前定義されている Schema on Write モデルをサポートしており、すべての読み取りまたは書き込み操作でそのスキーマを使用する必要があります。 これは、ほとんどの NoSQL データ ストア (特にキー/値タイプ) とは対照的です。このデータ ストアでは、Schema On Read モデルで、クライアントがデータベースから取得するデータに、独自の解釈型スキーマを強制することを前提とし、書き込まれるデータ形式に依存しません。

強力な一貫性の保証が重要な場合、RDBMS はきわめて有益です。RDBMS では、すべての変更がアトミックで、トランザクションは常にデータを一貫性のある状態のままにします。 ただし、基になる構造はストレージを分散し、コンピューター全体で処理することによるスケール アウトには適していません。 また、RDBMS に格納された情報は、正規化プロセスに従って、リレーショナル構造に配置する必要があります。 このプロセスは十分に解明されていますが、論理エンティティを個々のテーブル内の行に逆アセンブルし、次にクエリの実行時に、データを再アセンブルする必要があるため、非効率性につながる可能性があります。

関連 Azure サービス:

- [Azure SQL Database][sql-db]
- [Azure Database for MySQL][mysql]
- [Azure Database for PostgreSQL][postgres]

## <a name="keyvalue-stores"></a>キー/値のストア

キー/値のストアは、本質的に大規模なハッシュ テーブルです。 各データ値を一意のキーに関連付けると、キー/値のストアがこのキーを使用し、適切なハッシュ関数を使用してデータを格納します。 ハッシュ関数は、データ ストレージ間でハッシュされたキーを均等に分散するために選択されます。

ほとんどのキー/値のストアは、簡単なクエリ、挿入、および削除操作のみをサポートしています。 (部分的または完全に) 値を変更するには、アプリケーションで値全体の既存のデータを上書きする必要があります。 ほとんどの実装で、1 つの値の読み取りや書き込みは、アトミック操作です。 値が大きい場合、書き込みにいくらか時間がかかることがあります。

一部のキー/値のストアでは値の最大サイズに制限を課すものがありますが、アプリケーションは、一連の値として任意のデータを格納できます。 格納された値は、ストレージ システム ソフトウェアに非透過的です。 すべてのスキーマ情報が提供され、アプリケーションによって解釈される必要があります。 基本的に、値は BLOB で、キー/値のストアは単純にキーによって、値を取得または格納します。

![キー/値のストアの図](./images/key-value.png)

キー/値のストアは、単純なルックアップを実行するアプリケーション用に高度に最適化されていますが、さまざまなキー/値のストア間でデータをクエリする必要があるシステムにはあまり適していません。 さらに、キー/値のストアは、キーのみに基づいてルックアップを実行するよりも値によるクエリが重要なシナリオ用に最適化されていません。 たとえば、リレーショナル データベースでは、WHERE 句を使用してレコードを見つけることができますが、キー/値のストアには通常、この種類の値のルックアップ機能がありません。

1 つのキー/値のストアでは、個々のコンピューター上の複数のノード間でデータを簡単に分散できるため、きわめてスケーラブルにすることができます。

関連 Azure サービス:

- [Cosmos DB][cosmosdb]
- [Azure Redis Cache][redis-cache]

## <a name="document-databases"></a>ドキュメント データベース

ドキュメント データベースは、概念的にキー/値のストアに似ていますが、名前付きフィールドとデータのコレクション (ドキュメントと呼ばれる) を格納する点が異なります。各データは単純なスカラー項目か、リストや子コレクションなどの複合要素などです。 ドキュメントのフィールド内のデータは、XML、YAML、JSON、BSON などのさまざまな方法でエンコードしたり、またはプレーン テキストとして格納することもできます。 キー/値のストアとは異なり、ドキュメント内のフィールドは、ストレージ管理システムに公開されるため、アプリケーションで、これらのフィールドの値を使用して データをクエリおよびフィルターできます。

一般に、ドキュメントには、エンティティのデータ全体が含まれます。 エンティティを構成する項目は、アプリケーション固有です。 たとえば、エンティティに、顧客、注文、または両方の組み合わせの詳細を格納できます。 RDBMS 内の複数のリレーショナル テーブル間に分散されている情報を 1 つのドキュメントに格納できます。

ドキュメント ストアでは、すべてのドキュメントが同じ構造をしている必要はありません。 この自由形式のアプローチにより、大幅な柔軟性を提供します。 アプリケーションは、ビジネス要件の変更に応じて、さまざまなデータをドキュメントに格納できます。

![ドキュメント ストアの図](./images/document.png)

アプリケーションは、ドキュメント キーを使用してドキュメントを取得できます。 これはドキュメントの一意の識別子で、多くの場合にハッシュされ、データを均等に分散するのに役立ちます。 一部のドキュメント データベースは、ドキュメント キーを自動的に作成します。 他は、ユーザーがキーとして使用するドキュメントの属性を指定できます。 アプリケーションは、1 つまたは複数のフィールドの値に基づいて、ドキュメントをクエリすることもできます。 一部のドキュメント データベースでは、インデックスをサポートし、1 つまたは複数のインデックス付きフィールドに基づいたドキュメントの高速のルックアップを容易にします。

多くのドキュメント データベースで、インプレース更新をサポートしているため、アプリケーションは、ドキュメント全体を書き直すことなく、ドキュメント内の特定のフィールドの値を変更できます。 1 つのドキュメントの複数のフィールドに対する読み取りおよび書き込み操作は、通常アトミックです。

関連 Azure サービス:[Cosmos DB][cosmosdb]

## <a name="graph-databases"></a>グラフ データベース

グラフ データベースは、ノードとエッジの 2 種類の情報を格納します。 ノードはエンティティと考えることができます。 エッジはノード間のリレーションシップを指定します。 ノードもエッジも、そのノードやエッジに関する情報を提供するプロパティを持つことができ、テーブルの列に似ています。 エッジは、リレーションシップの性質を示す方向を持つこともできます。

グラフ データベースの目的は、アプリケーションが、ノードとエッジのネットワークを通過するクエリを効率的に実行して、エンティティ間のリレーションシップを分析できるようにすることです。 次の図にグラフとして構築された組織の職員のデータベースを示します。 エンティティは従業員や部門で、エッジは社内の直属の上下関係と従業員が勤務する部署を示しています。 このグラフでは、エッジの矢印は、上下関係の方向を示しています。

![ドキュメント データベースの図](./images/graph.png)

この構造により、"Sarah に直接または間接的に報告するすべての従業員を見つける" または "John と同じ部門で働いている人" などのクエリの実行が簡単になります。 大量のエンティティとリレーションシップを含む大規模なグラフでは、きわめて複雑な分析をすばやく実行できます。 多くのグラフ データベースは、リレーションシップのネットワークを効率的に走査するために使用できるクエリ言語を提供しています。

関連 Azure サービス:[Cosmos DB][cosmosdb]

## <a name="column-family-databases"></a>列ファミリのデータベース

列ファミリのデータベースは、データを行と列に編成します。 列ファミリのデータベースは、その最も単純な形式では、少なくとも概念的にリレーショナル データベースによく似ています。 列ファミリのデータベースの真の能力は、スパース データの構築のための非正規化されたアプローチにあります。

列ファミリのデータベースは、行と列を含む表形式データを保持するものと考えることができますが、列は*列ファミリ*と呼ばれるグループに分類されます。 各列のファミリは論理的に相互に関連する列のセットを保持し、一般にユニットとして取得または操作されます。 個別にアクセスされるその他のデータは、個別の列ファミリに格納できます。 列ファミリ内では、新しい列を動的に追加することができ、行をスパースにする (つまり、行のすべての列に値を持つ必要がない) ことができます。

次の図は、`Identity` と `Contact Info` の 2 つの列ファミリのある例を示しています。 単一のエンティティのデータは、各列ファミリに同じ行キーを持ちます。 列ファミリ内の任意の特定のオブジェクトの行を動的に変えることができるこの構造は、列ファミリ アプローチの重要な利点であり、この形式のデータ ストアが、構造化された揮発性データの格納に最適とされます。

![列ファミリ データベースの図](./images/column-family.png)

キー/値のストアまたはドキュメント データベースとは異なり、ほとんどの列ファミリのデータベースは、ハッシュを計算するのではなく、キー順序でデータを格納します。 多くの実装で、列ファミリ内の特定の列に対してインデックスを作成できます。 インデックスを使用すると、行キーではなく、列値によってデータを取得できます。

一部の実装では、複数の列ファミリにまたがる行全体で原子性を提供するものもありますが、行の読み取りと書き込みの操作は通常、単一の列ファミリでアトミックです。

関連 Azure サービス:[HDInsight の HBase][hbase]

## <a name="data-analytics"></a>データ分析

データ分析ストアは、データの取り込み、保存、および分析のための大規模な並列ソリューションを提供します。 このデータは、シェアード ナッシング アーキテクチャを使用して、複数のサーバー間で分散され、スケーラビリティを最大化し、依存関係を最小にします。 データは静的である可能性は低いため、これらのストアでは、新しいクエリの処理を続行しながら、複数のストリームから多様な形式で到着する大量の情報を処理できる必要があります。

関連 Azure サービス:

- [SQL Data Warehouse][sql-dw]
- [Azure Data Lake][data-lake]

## <a name="search-engine-databases"></a>検索エンジンのデータベース  

検索エンジンのデータベースは、外部データ ストアおよびサービスで保持されている情報を検索する機能をサポートします。 検索エンジンのデータベースを使用して、膨大な量のデータのインデックスを作成し、これらのインデックスへのほぼリアルタイムのアクセスを提供できます。 検索エンジンのデータベースは一般に Web と同義として考えられますが、多くの大規模なシステムではそれらを使用して、独自のデータベース上に構造化されたアドホック検索機能を提供します。

検索エンジンのデータベースの主な特性は、情報をきわめて迅速に格納して、インデックス作成し、検索要求に対して高速の応答時間を実現する機能です。 インデックスは、多次元にすることができ、大量のテキスト データ間でフリーテキスト検索をサポートできます。 インデックス作成は、検索エンジンのデータベースによってトリガーされるプルモデルを使用するか、外部のアプリケーション コードによって開始されるプッシュ モデルを使用して実行できます。

検索は、完全でもあいまいでも可能です。 あいまい検索では、一連の用語に一致するドキュメントを検索し、それらがどの程度一致しているかを計算します。 一部の検索エンジンは、シノニム、ジャンル拡張 (たとえば、`dogs` を `pets` に一致させる)、およびステミング (同じ語幹を持つ単語を照合する) に基づいて一致を返すことができる言語分析もサポートします。

関連 Azure サービス:[Azure Search][search]

## <a name="time-series-databases"></a>タイム シリーズ データベース

タイム シリーズ データは時間によって編成された一連の値であり、タイム シリーズ データベースは、この種類のデータに最適化されたデータベースです。 タイム シリーズのデータベースは、通常多数のソースからリアルタイムで大量のデータを収集するため、きわめて大量の書き込みをサポートする必要があります。 更新はまれであり、削除は多くの場合に一括操作として行われます。 タイム シリーズのデータベースに書き込まれるレコードは通常小さいですが、多くの場合にレコード数が多く、合計データ サイズが急速に増大する可能性があります。

タイム シリーズのデータベースは、テレメトリ データの格納に適しています。 シナリオには、IoT センサーやアプリケーション/システム カウンターが含まれます。

関連 Azure サービス:[Time Series Insights][time-series]

## <a name="object-storage"></a>オブジェクト ストレージ  

オブジェクト ストレージは、大規模なバイナリ オブジェクト (イメージ、ファイル、ビデオおよびオーディオ ストリーム、大規模なアプリケーション データ オブジェクトおよびドキュメント、仮想マシン ディスク イメージ) の格納と取得に最適です。 これらのストアの種類のオブジェクトは、格納されたデータ、いくつかのメタデータ、およびオブジェクトにアクセスするための一意の ID で構成されます。 オブジェクト ストアは、著しく大量の非構造化データの管理を可能にします。

関連 Azure サービス:[Blob Storage][blob]

## <a name="shared-files"></a>共有ファイル

場合によっては、単純なフラット ファイルを使用することが、情報の格納と取得の最も効率的な手段である可能性があります。 ファイル共有を使用すると、ネットワーク経由でファイルにアクセスできます。 適切なセキュリティおよび同時実行アクセス制御メカニズムがあれば、この方法でデータを共有することにより、分散型サービスが可能になり、単純な読み取りおよび書き込み要求などの基本的な低レベルの操作のための高度にスケーラブルなデータ アクセスを提供します。

関連 Azure サービス:[File Storage][file-storage]

<!-- links -->

[blob]: https://azure.microsoft.com/services/storage/blobs/
[cosmosdb]: https://azure.microsoft.com/services/cosmos-db/
[data-lake]: https://azure.microsoft.com/solutions/data-lake/
[file-storage]: https://azure.microsoft.com/services/storage/files/
[hbase]: /azure/hdinsight/hdinsight-hbase-overview
[mysql]: https://azure.microsoft.com/services/mysql/
[postgres]: https://azure.microsoft.com/services/postgresql/
[redis-cache]: https://azure.microsoft.com/services/cache/
[search]: https://azure.microsoft.com/services/search/
[sql-db]: https://azure.microsoft.com/services/sql-database
[sql-dw]: https://azure.microsoft.com/services/sql-data-warehouse/
[time-series]: https://azure.microsoft.com/services/time-series-insights/
