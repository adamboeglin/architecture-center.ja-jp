---
title: すべてを冗長化
titleSuffix: Azure Application Architecture Guide
description: 冗長性をアプリケーションに組み込むことで、単一障害点をなくします。
author: MikeWasson
ms.date: 08/30/2018
ms.topic: guide
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: seojan19
ms.openlocfilehash: c8722250b5b5357c9ffcf65eced95b4f2b487c72
ms.sourcegitcommit: c053e6edb429299a0ad9b327888d596c48859d4a
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/20/2019
ms.locfileid: "58241723"
---
# <a name="make-all-things-redundant"></a><span data-ttu-id="f406b-103">すべてを冗長化</span><span class="sxs-lookup"><span data-stu-id="f406b-103">Make all things redundant</span></span>

## <a name="build-redundancy-into-your-application-to-avoid-having-single-points-of-failure"></a><span data-ttu-id="f406b-104">単一障害点をなくすために、冗長性をアプリケーションに組み込みます</span><span class="sxs-lookup"><span data-stu-id="f406b-104">Build redundancy into your application, to avoid having single points of failure</span></span>

<span data-ttu-id="f406b-105">耐障害性のあるアプリケーションでは障害が回避されます。</span><span class="sxs-lookup"><span data-stu-id="f406b-105">A resilient application routes around failure.</span></span> <span data-ttu-id="f406b-106">アプリケーションのクリティカル パスを特定してください。</span><span class="sxs-lookup"><span data-stu-id="f406b-106">Identify the critical paths in your application.</span></span> <span data-ttu-id="f406b-107">パスの各ポイントに冗長性が確保されていますか。</span><span class="sxs-lookup"><span data-stu-id="f406b-107">Is there redundancy at each point in the path?</span></span> <span data-ttu-id="f406b-108">サブシステムで障害が発生した場合に、アプリケーションは他にフェールオーバーしますか。</span><span class="sxs-lookup"><span data-stu-id="f406b-108">If a subsystem fails, will the application fail over to something else?</span></span>

## <a name="recommendations"></a><span data-ttu-id="f406b-109">Recommendations</span><span class="sxs-lookup"><span data-stu-id="f406b-109">Recommendations</span></span>

<span data-ttu-id="f406b-110">**ビジネス要件を考慮する**。</span><span class="sxs-lookup"><span data-stu-id="f406b-110">**Consider business requirements**.</span></span> <span data-ttu-id="f406b-111">システムにどのくらいの冗長性を組み込むかは、コストと複雑さの両方に影響します。</span><span class="sxs-lookup"><span data-stu-id="f406b-111">The amount of redundancy built into a system can affect both cost and complexity.</span></span> <span data-ttu-id="f406b-112">アーキテクチャには、目標復旧時間 (RTO) などのビジネス要件の情報が必要です。</span><span class="sxs-lookup"><span data-stu-id="f406b-112">Your architecture should be informed by your business requirements, such as recovery time objective (RTO).</span></span> <span data-ttu-id="f406b-113">たとえば、複数リージョンのデプロイは、単一リージョンのデプロイよりもコストがかかり、管理も複雑です。</span><span class="sxs-lookup"><span data-stu-id="f406b-113">For example, a multi-region deployment is more expensive than a single-region deployment, and is more complicated to manage.</span></span> <span data-ttu-id="f406b-114">フェールオーバーとフェールバックを処理するための操作手順が必要になります。</span><span class="sxs-lookup"><span data-stu-id="f406b-114">You will need operational procedures to handle failover and failback.</span></span> <span data-ttu-id="f406b-115">追加コストと複雑さが理にかなっているかどうかは、ビジネス シナリオによって異なります。</span><span class="sxs-lookup"><span data-stu-id="f406b-115">The additional cost and complexity might be justified for some business scenarios and not others.</span></span>

<span data-ttu-id="f406b-116">**VM をロード バランサーの内側に配置する**。</span><span class="sxs-lookup"><span data-stu-id="f406b-116">**Place VMs behind a load balancer**.</span></span> <span data-ttu-id="f406b-117">ミッション クリティカルなワークロードには、単一 VM を使用しないでください。</span><span class="sxs-lookup"><span data-stu-id="f406b-117">Don't use a single VM for mission-critical workloads.</span></span> <span data-ttu-id="f406b-118">代わりに、複数の VM をロード バランサーの内側に配置します。</span><span class="sxs-lookup"><span data-stu-id="f406b-118">Instead, place multiple VMs behind a load balancer.</span></span> <span data-ttu-id="f406b-119">VM が使用できなくなると、ロード バランサーは、残りの正常な VM にトラフィックを分散します。</span><span class="sxs-lookup"><span data-stu-id="f406b-119">If any VM becomes unavailable, the load balancer distributes traffic to the remaining healthy VMs.</span></span> <span data-ttu-id="f406b-120">この構成をデプロイする方法については、[スケーラビリティと可用性のための複数の VM][multi-vm-blueprint] に関するページをご覧ください。</span><span class="sxs-lookup"><span data-stu-id="f406b-120">To learn how to deploy this configuration, see [Multiple VMs for scalability and availability][multi-vm-blueprint].</span></span>

![負荷分散された VM の図](./images/load-balancing.svg)

<span data-ttu-id="f406b-122">**データベースをレプリケートする**。</span><span class="sxs-lookup"><span data-stu-id="f406b-122">**Replicate databases**.</span></span> <span data-ttu-id="f406b-123">Azure SQL Database と Cosmos DB を使用すると、リージョン内でデータが自動的にレプリケートされ、リージョン間では geo レプリケーションを有効にできます。</span><span class="sxs-lookup"><span data-stu-id="f406b-123">Azure SQL Database and Cosmos DB automatically replicate the data within a region, and you can enable geo-replication across regions.</span></span> <span data-ttu-id="f406b-124">IaaS データベース ソリューションを使用している場合は、[SQL Server Always On 可用性グループ][sql-always-on]など、レプリケーションとフェールオーバーをサポートするものを選択します。</span><span class="sxs-lookup"><span data-stu-id="f406b-124">If you are using an IaaS database solution, choose one that supports replication and failover, such as [SQL Server Always On Availability Groups][sql-always-on].</span></span>

<span data-ttu-id="f406b-125">**geo レプリケーションを有効にする**。</span><span class="sxs-lookup"><span data-stu-id="f406b-125">**Enable geo-replication**.</span></span> <span data-ttu-id="f406b-126">[Azure SQL Database][sql-geo-replication] と [Cosmos DB][cosmosdb-geo-replication] の geo レプリケーションにより、1 つ以上のセカンダリ リージョンにデータの読み取り可能セカンダリ レプリカが作成されます。</span><span class="sxs-lookup"><span data-stu-id="f406b-126">Geo-replication for [Azure SQL Database][sql-geo-replication] and [Cosmos DB][cosmosdb-geo-replication] creates secondary readable replicas of your data in one or more secondary regions.</span></span> <span data-ttu-id="f406b-127">障害発生時、データベースは書き込みのためにセカンダリ リージョンにフェールオーバーできます。</span><span class="sxs-lookup"><span data-stu-id="f406b-127">In the event of an outage, the database can fail over to the secondary region for writes.</span></span>

<span data-ttu-id="f406b-128">**可用性のためにパーティション分割する**。</span><span class="sxs-lookup"><span data-stu-id="f406b-128">**Partition for availability**.</span></span> <span data-ttu-id="f406b-129">データベース パーティション分割は、通常、スケーラビリティ向上のために使用されますが、可用性を向上させることもできます。</span><span class="sxs-lookup"><span data-stu-id="f406b-129">Database partitioning is often used to improve scalability, but it can also improve availability.</span></span> <span data-ttu-id="f406b-130">あるシャードがダウンしても、それ以外のシャードには引き続きアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="f406b-130">If one shard goes down, the other shards can still be reached.</span></span> <span data-ttu-id="f406b-131">あるシャードで発生した障害によって中断されるのは、トランザクション全体のサブセットのみです。</span><span class="sxs-lookup"><span data-stu-id="f406b-131">A failure in one shard will only disrupt a subset of the total transactions.</span></span>

<span data-ttu-id="f406b-132">**複数のリージョンにデプロイする**。</span><span class="sxs-lookup"><span data-stu-id="f406b-132">**Deploy to more than one region**.</span></span> <span data-ttu-id="f406b-133">最大の高可用性を実現するために、アプリケーションを複数のリージョンにデプロイします。</span><span class="sxs-lookup"><span data-stu-id="f406b-133">For the highest availability, deploy the application to more than one region.</span></span> <span data-ttu-id="f406b-134">これにより、まれではありますが、問題がリージョン全体に影響を及ぼす場合に、アプリケーションを別のリージョンにフェールオーバーできます。</span><span class="sxs-lookup"><span data-stu-id="f406b-134">That way, in the rare case when a problem affects an entire region, the application can fail over to another region.</span></span> <span data-ttu-id="f406b-135">次の図は、Azure Traffic Manager を使用してフェールオーバーを処理する複数リージョン アプリケーションを示しています。</span><span class="sxs-lookup"><span data-stu-id="f406b-135">The following diagram shows a multi-region application that uses Azure Traffic Manager to handle failover.</span></span>

![Azure Traffic Manager を使用したフェールオーバーの処理を示す図](./images/failover.svg)

<span data-ttu-id="f406b-137">**フロントエンドおよびバックエンドのフェールオーバーを同期する**。</span><span class="sxs-lookup"><span data-stu-id="f406b-137">**Synchronize front and backend failover**.</span></span> <span data-ttu-id="f406b-138">Azure Traffic Manager を使用して、フロントエンドにフェールオーバーします。</span><span class="sxs-lookup"><span data-stu-id="f406b-138">Use Azure Traffic Manager to fail over the front end.</span></span> <span data-ttu-id="f406b-139">あるリージョンでフロントエンドにアクセスできなくなると、Traffic Manager は、新しい要求をセカンダリ リージョンにルーティングします。</span><span class="sxs-lookup"><span data-stu-id="f406b-139">If the front end becomes unreachable in one region, Traffic Manager will route new requests to the secondary region.</span></span> <span data-ttu-id="f406b-140">データベース ソリューションによっては、データベースのフェールオーバーの調整が必要になる場合があります。</span><span class="sxs-lookup"><span data-stu-id="f406b-140">Depending on your database solution, you may need to coordinate failing over the database.</span></span>

<span data-ttu-id="f406b-141">**自動フェールオーバーを使用するが、フェールバックは手動で行う**。</span><span class="sxs-lookup"><span data-stu-id="f406b-141">**Use automatic failover but manual failback**.</span></span> <span data-ttu-id="f406b-142">Traffic Manager は自動フェールオーバーに使用し、自動フェールバックには使用しないでください。</span><span class="sxs-lookup"><span data-stu-id="f406b-142">Use Traffic Manager for automatic failover, but not for automatic failback.</span></span> <span data-ttu-id="f406b-143">自動フェールバックには、完全に正常な状態に戻る前に、プライマリ リージョンに切り替えられてしまうリスクがあります。</span><span class="sxs-lookup"><span data-stu-id="f406b-143">Automatic failback carries a risk that you might switch to the primary region before the region is completely healthy.</span></span> <span data-ttu-id="f406b-144">そうではなく、手動でフェールバックする前に、すべてのアプリケーション サブシステムが正常であることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="f406b-144">Instead, verify that all application subsystems are healthy before manually failing back.</span></span> <span data-ttu-id="f406b-145">また、データベースによっては、フェールバックの前に、データの一貫性チェックが必要になる場合があります。</span><span class="sxs-lookup"><span data-stu-id="f406b-145">Also, depending on the database, you might need to check data consistency before failing back.</span></span>

<span data-ttu-id="f406b-146">**Traffic Manager の冗長性を確保する**。</span><span class="sxs-lookup"><span data-stu-id="f406b-146">**Include redundancy for Traffic Manager**.</span></span> <span data-ttu-id="f406b-147">Traffic Manager が障害ポイントになる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="f406b-147">Traffic Manager is a possible failure point.</span></span> <span data-ttu-id="f406b-148">Traffic Manager の SLA を確認し、Traffic Manager を使用するだけで、高可用性のビジネス要件を満たすかどうかを確かめてください。</span><span class="sxs-lookup"><span data-stu-id="f406b-148">Review the Traffic Manager SLA, and determine whether using Traffic Manager alone meets your business requirements for high availability.</span></span> <span data-ttu-id="f406b-149">満たさない場合は、代替システムとして他のトラフィック管理ソリューションを追加することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="f406b-149">If not, consider adding another traffic management solution as a failback.</span></span> <span data-ttu-id="f406b-150">Azure Traffic Manager サービスで障害が発生した場合は、他のトラフィック管理サービスを参照するように、DNS の CNAME レコードを変更します。</span><span class="sxs-lookup"><span data-stu-id="f406b-150">If the Azure Traffic Manager service fails, change your CNAME records in DNS to point to the other traffic management service.</span></span>

<!-- links -->

[multi-vm-blueprint]: ../../reference-architectures/virtual-machines-windows/multi-vm.md

[cassandra]: https://cassandra.apache.org/
[cosmosdb-geo-replication]: /azure/cosmos-db/distribute-data-globally
[sql-always-on]: https://msdn.microsoft.com/library/hh510230.aspx
[sql-geo-replication]: /azure/sql-database/sql-database-geo-replication-overview
