# <a name="using-tactical-ddd-to-design-microservices"></a><span data-ttu-id="aafc0-101">戦術的 DDD を使用したマイクロサービスの設計</span><span class="sxs-lookup"><span data-stu-id="aafc0-101">Using tactical DDD to design microservices</span></span>

<span data-ttu-id="aafc0-102">DDD の戦略フェーズでは、ビジネス用ドメインを策定し、ドメイン モデルの境界付けられたコンテキストを定義します。</span><span class="sxs-lookup"><span data-stu-id="aafc0-102">During the strategic phase of DDD, you are mapping out the business domain and defining bounded contexts for your domain models.</span></span> <span data-ttu-id="aafc0-103">戦術的 DDD では、ドメイン モデルをより正確に定義します。</span><span class="sxs-lookup"><span data-stu-id="aafc0-103">Tactical DDD is when you define your domain models with more precision.</span></span> <span data-ttu-id="aafc0-104">戦術的パターンは、1 つの境界付けられたコンテキスト内で適用されます。</span><span class="sxs-lookup"><span data-stu-id="aafc0-104">The tactical patterns are applied within a single bounded context.</span></span> <span data-ttu-id="aafc0-105">マイクロサービスのアーキテクチャで特に興味深いのは、エンティティと集約のパターンです。</span><span class="sxs-lookup"><span data-stu-id="aafc0-105">In a microservices architecture, we are particularly interested in the entity and aggregate patterns.</span></span> <span data-ttu-id="aafc0-106">これらのパターンを適用すると、アプリケーション内のサービスの自然な境界を識別できます (このシリーズの[次の記事](./microservice-boundaries.md)を参照)。</span><span class="sxs-lookup"><span data-stu-id="aafc0-106">Applying these patterns will help us to identify natural boundaries for the services in our application (see the [next article](./microservice-boundaries.md) in this series).</span></span> <span data-ttu-id="aafc0-107">原則として、マイクロサービスは集約よりは大きく、境界付けられたコンテキストよりは小さくする必要があります。</span><span class="sxs-lookup"><span data-stu-id="aafc0-107">As a general principle, a microservice should be no smaller than an aggregate, and no larger than a bounded context.</span></span> <span data-ttu-id="aafc0-108">最初に、戦術的パターンを確認します。</span><span class="sxs-lookup"><span data-stu-id="aafc0-108">First, we'll review the tactical patterns.</span></span> <span data-ttu-id="aafc0-109">次に、ドローン配送アプリケーションの境界付けられたコンテキスト "出荷" にそのパターンを適用します。</span><span class="sxs-lookup"><span data-stu-id="aafc0-109">Then we'll apply them to the Shipping bounded context in the Drone Delivery application.</span></span>

## <a name="overview-of-the-tactical-patterns"></a><span data-ttu-id="aafc0-110">戦術的パターンの概要</span><span class="sxs-lookup"><span data-stu-id="aafc0-110">Overview of the tactical patterns</span></span>

<span data-ttu-id="aafc0-111">ここでは、戦術的 DDD パターンの概要を示します。DDD について既に詳しくご存じの場合は、このセクションをスキップしてもかまいません。</span><span class="sxs-lookup"><span data-stu-id="aafc0-111">This section provides a brief summary of the tactical DDD patterns, so if you are already familiar with DDD, you can probably skip this section.</span></span> <span data-ttu-id="aafc0-112">各パターンについて詳しくは、Eric Evans 氏の著書の第 5 章と第 6 章、および Vaughn Vernon 氏の著書『*Implementing Domain-Driven Design*』をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="aafc0-112">The patterns are described in more detail in chapters 5 &ndash; 6 of Eric Evans' book, and in *Implementing Domain-Driven Design* by Vaughn Vernon.</span></span>

![ドメイン駆動設計の戦術的パターンの図](../images/ddd-patterns.png)

<span data-ttu-id="aafc0-114">**エンティティ**: </span><span class="sxs-lookup"><span data-stu-id="aafc0-114">**Entities**.</span></span> <span data-ttu-id="aafc0-115">エンティティは、時間の経過に関係なく保持される一意の ID を持つオブジェクトです。</span><span class="sxs-lookup"><span data-stu-id="aafc0-115">An entity is an object with a unique identity that persists over time.</span></span> <span data-ttu-id="aafc0-116">たとえば、銀行取引アプリケーションでは、顧客と口座がエンティティになります。</span><span class="sxs-lookup"><span data-stu-id="aafc0-116">For example, in a banking application, customers and accounts would be entities.</span></span>

- <span data-ttu-id="aafc0-117">システムでは、エンティティに一意識別子が割り当てられており、エンティティの検索や取得に使うことができます。</span><span class="sxs-lookup"><span data-stu-id="aafc0-117">An entity has a unique identifier in the system, which can be used to look up or retrieve the entity.</span></span> <span data-ttu-id="aafc0-118">この識別子は必ずユーザーに対して直接公開されているわけではありません。</span><span class="sxs-lookup"><span data-stu-id="aafc0-118">That doesn't mean the identifier is always exposed directly to users.</span></span> <span data-ttu-id="aafc0-119">データベースの GUID や主キーがこれに該当します。</span><span class="sxs-lookup"><span data-stu-id="aafc0-119">It could be a GUID or a primary key in a database.</span></span>
- <span data-ttu-id="aafc0-120">ID は複数の境界付けられたコンテキストにまたがり、アプリケーションの有効期間を越えて存続する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="aafc0-120">An identity may span multiple bounded contexts, and may endure beyond the lifetime of the application.</span></span> <span data-ttu-id="aafc0-121">たとえば、銀行口座番号や政府発行の ID が特定のアプリケーションの有効期間に関連付けられることはありません。</span><span class="sxs-lookup"><span data-stu-id="aafc0-121">For example, bank account numbers or government-issued IDs are not tied to the lifetime of a particular application.</span></span>
- <span data-ttu-id="aafc0-122">エンティティの属性は時間の経過と共に変わる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="aafc0-122">The attributes of an entity may change over time.</span></span> <span data-ttu-id="aafc0-123">たとえば、個人名や住所は変わる可能性がありますが、個人は同じ人物のままです。</span><span class="sxs-lookup"><span data-stu-id="aafc0-123">For example, a person's name or address might change, but they are still the same person.</span></span>
- <span data-ttu-id="aafc0-124">エンティティは他のエンティティへの参照を保持できます。</span><span class="sxs-lookup"><span data-stu-id="aafc0-124">An entity can hold references to other entities.</span></span>

<span data-ttu-id="aafc0-125">**値オブジェクト**: </span><span class="sxs-lookup"><span data-stu-id="aafc0-125">**Value objects**.</span></span> <span data-ttu-id="aafc0-126">値オブジェクトには ID がありません。</span><span class="sxs-lookup"><span data-stu-id="aafc0-126">A value object has no identity.</span></span> <span data-ttu-id="aafc0-127">このオブジェクトは属性の値でのみ定義されます。</span><span class="sxs-lookup"><span data-stu-id="aafc0-127">It is defined only by the values of its attributes.</span></span> <span data-ttu-id="aafc0-128">値オブジェクトも変更できません。</span><span class="sxs-lookup"><span data-stu-id="aafc0-128">Value objects are also immutable.</span></span> <span data-ttu-id="aafc0-129">値オブジェクトを更新するには、必ず新しいインスタンスを作成して、古いインスタンスを置き換えます。</span><span class="sxs-lookup"><span data-stu-id="aafc0-129">To update a value object, you always create a new instance to replace the old one.</span></span> <span data-ttu-id="aafc0-130">値オブジェクトにはドメイン ロジックをカプセル化する方法が用意されていますが、これらの方法がオブジェクトの状態に対して副次的な影響を及ぼしてはなりません。</span><span class="sxs-lookup"><span data-stu-id="aafc0-130">Value objects can have methods that encapsulate domain logic, but those methods should have no side-effects on the object's state.</span></span> <span data-ttu-id="aafc0-131">値オブジェクトの一般的な例として、色、日付と時刻、通貨の値が挙げられます。</span><span class="sxs-lookup"><span data-stu-id="aafc0-131">Typical examples of value objects include colors, dates and times, and currency values.</span></span>

<span data-ttu-id="aafc0-132">**集約**: </span><span class="sxs-lookup"><span data-stu-id="aafc0-132">**Aggregates**.</span></span> <span data-ttu-id="aafc0-133">集約では、1 つ以上のエンティティを囲む一貫性の境界を定義します。</span><span class="sxs-lookup"><span data-stu-id="aafc0-133">An aggregate defines a consistency boundary around one or more entities.</span></span> <span data-ttu-id="aafc0-134">集約内の 1 つのエンティティはルートです。</span><span class="sxs-lookup"><span data-stu-id="aafc0-134">Exactly one entity in an aggregate is the root.</span></span> <span data-ttu-id="aafc0-135">ルート エンティティの識別子を使って、検索が行われます。</span><span class="sxs-lookup"><span data-stu-id="aafc0-135">Lookup is done using the root entity's identifier.</span></span> <span data-ttu-id="aafc0-136">集約内のその他のエンティティはルートの子であり、ルートからのポインターをたどることによって参照されます。</span><span class="sxs-lookup"><span data-stu-id="aafc0-136">Any other entities in the aggregate are children of the root, and are referenced by following pointers from the root.</span></span>

<span data-ttu-id="aafc0-137">集約の目的は、トランザクションのインバリアントをモデル化することです。</span><span class="sxs-lookup"><span data-stu-id="aafc0-137">The purpose of an aggregate is to model transactional invariants.</span></span> <span data-ttu-id="aafc0-138">現実世界のものには複雑な関係があります。</span><span class="sxs-lookup"><span data-stu-id="aafc0-138">Things in the real world have complex webs of relationships.</span></span> <span data-ttu-id="aafc0-139">たとえば、顧客が注文を作成し、注文には商品が含まれ、商品には供給業者が存在する、などの関係です。</span><span class="sxs-lookup"><span data-stu-id="aafc0-139">Customers create orders, orders contain products, products have suppliers, and so on.</span></span> <span data-ttu-id="aafc0-140">アプリケーションがいくつかの関連オブジェクトを変更する場合は、どのように一貫性を保証するのでしょうか。</span><span class="sxs-lookup"><span data-stu-id="aafc0-140">If the application modifies several related objects, how does it guarantee consistency?</span></span> <span data-ttu-id="aafc0-141">また、インバリアントを追跡して実現するにはどうすればよいでしょうか。</span><span class="sxs-lookup"><span data-stu-id="aafc0-141">How do we keep track of invariants and enforce them?</span></span>  

<span data-ttu-id="aafc0-142">従来のアプリケーションでは、多くの場合、データベース トランザクションを使って一貫性を実現します。</span><span class="sxs-lookup"><span data-stu-id="aafc0-142">Traditional applications have often used database transactions to enforce consistency.</span></span> <span data-ttu-id="aafc0-143">しかし、分散アプリケーションでは、多くの場合、これを実現できません。</span><span class="sxs-lookup"><span data-stu-id="aafc0-143">In a distributed application, however, that's often not feasible.</span></span> <span data-ttu-id="aafc0-144">1 つのビジネス トランザクションが複数のデータ ストアにまたがる場合、トランザクションの実行時間が長い場合、またはトランザクションにサード パーティのサービスが関与する場合があります。</span><span class="sxs-lookup"><span data-stu-id="aafc0-144">A single business transaction may span multiple data stores, or may be long running, or may involve third-party services.</span></span> <span data-ttu-id="aafc0-145">最終的に、ドメインに必要なインバリアントの実現は、データ レイヤーではなくアプリケーションに依存します。</span><span class="sxs-lookup"><span data-stu-id="aafc0-145">Ultimately it's up to the application, not the data layer, to enforce the invariants required for the domain.</span></span> <span data-ttu-id="aafc0-146">それが集約によってモデル化されるものです。</span><span class="sxs-lookup"><span data-stu-id="aafc0-146">That's what aggregates are meant to model.</span></span>

> [!NOTE]
> <span data-ttu-id="aafc0-147">集約は 1 つのエンティティで構成され、子エンティティはありません。</span><span class="sxs-lookup"><span data-stu-id="aafc0-147">An aggregate might consist of a single entity, without child entities.</span></span> <span data-ttu-id="aafc0-148">エンティティが集約になるために必要なのはトランザクション境界です。</span><span class="sxs-lookup"><span data-stu-id="aafc0-148">What makes it an aggregate is the transactional boundary.</span></span>

<span data-ttu-id="aafc0-149">**ドメイン サービスとアプリケーション サービス**: </span><span class="sxs-lookup"><span data-stu-id="aafc0-149">**Domain and application services**.</span></span> <span data-ttu-id="aafc0-150">DDD の用語では、サービスとは、状態を保持せずにいくつかのロジックを実装するオブジェクトです。</span><span class="sxs-lookup"><span data-stu-id="aafc0-150">In DDD terminology, a service is an object that implements some logic without holding any state.</span></span> <span data-ttu-id="aafc0-151">Evans 氏は、ドメイン ロジックをカプセル化する*ドメイン サービス*と、技術的な機能 (ユーザー認証や SMS メッセージの送信など) を提供する*アプリケーション サービス*を区別しています。</span><span class="sxs-lookup"><span data-stu-id="aafc0-151">Evans distinguishes between *domain services*, which encapsulate domain logic, and *application services*, which provide technical functionality, such as user authentication or sending an SMS message.</span></span> <span data-ttu-id="aafc0-152">ドメイン サービスは、多くの場合、複数のエンティティにまたがる動作のモデル化に使われます。</span><span class="sxs-lookup"><span data-stu-id="aafc0-152">Domain services are often used to model behavior that spans multiple entities.</span></span>

> [!NOTE]
> <span data-ttu-id="aafc0-153">ソフトウェア開発においては、*サービス*という用語に過剰な負荷がかかっています。</span><span class="sxs-lookup"><span data-stu-id="aafc0-153">The term *service* is overloaded in software development.</span></span> <span data-ttu-id="aafc0-154">ここでの定義はマイクロサービスに直接関連しません。</span><span class="sxs-lookup"><span data-stu-id="aafc0-154">The definition here is not directly related to microservices.</span></span>

<span data-ttu-id="aafc0-155">**ドメイン イベント**: </span><span class="sxs-lookup"><span data-stu-id="aafc0-155">**Domain events**.</span></span> <span data-ttu-id="aafc0-156">ドメイン イベントを使うと、何かが発生したときにシステムの他の部分に通知できます。</span><span class="sxs-lookup"><span data-stu-id="aafc0-156">Domain events can be used to notify other parts of the system when something happens.</span></span> <span data-ttu-id="aafc0-157">その名前が示すように、ドメイン イベントはドメイン内で発生するイベントです。</span><span class="sxs-lookup"><span data-stu-id="aafc0-157">As the name suggests, domain events should mean something within the domain.</span></span> <span data-ttu-id="aafc0-158">たとえば、"レコードがテーブルに挿入された" ことはドメイン イベントではありません。</span><span class="sxs-lookup"><span data-stu-id="aafc0-158">For example, "a record was inserted into a table" is not a domain event.</span></span> <span data-ttu-id="aafc0-159">"配送がキャンセルされた" ことはドメイン イベントです。</span><span class="sxs-lookup"><span data-stu-id="aafc0-159">"A delivery was cancelled" is a domain event.</span></span> <span data-ttu-id="aafc0-160">ドメイン イベントはマイクロサービスのアーキテクチャに特に関連します。</span><span class="sxs-lookup"><span data-stu-id="aafc0-160">Domain events are especially relevant in a microservices architecture.</span></span> <span data-ttu-id="aafc0-161">マイクロサービスは分散型であり、データ ストアを共有しないので、ドメイン イベントはマイクロサービスが互いに連携するための方法を提供します。</span><span class="sxs-lookup"><span data-stu-id="aafc0-161">Because microservices are distributed and don't share data stores, domain events provide a way for microservices to coordinate with each other.</span></span> <span data-ttu-id="aafc0-162">[サービス間の通信](../design/interservice-communication.md)に関する記事では、非同期メッセージングについて詳しく説明します。</span><span class="sxs-lookup"><span data-stu-id="aafc0-162">The article [Interservice communication](../design/interservice-communication.md) discusses asynchronous messaging in more detail.</span></span>

<span data-ttu-id="aafc0-163">ここで説明していない DDD パターンは他にもいくつかあります (ファクトリ、リポジトリ、モジュールなど)。</span><span class="sxs-lookup"><span data-stu-id="aafc0-163">There are a few other DDD patterns not listed here, including factories, repositories, and modules.</span></span> <span data-ttu-id="aafc0-164">これらはマイクロサービスの実装時に役立つパターンですが、マイクロサービス間の境界の設計にはあまり関連しません。</span><span class="sxs-lookup"><span data-stu-id="aafc0-164">These can be useful patterns for when you are implementing a microservice, but they are less relevant when designing the boundaries between microservice.</span></span>

## <a name="drone-delivery-applying-the-patterns"></a><span data-ttu-id="aafc0-165">ドローン配送:パターンの適用</span><span class="sxs-lookup"><span data-stu-id="aafc0-165">Drone delivery: Applying the patterns</span></span>

<span data-ttu-id="aafc0-166">最初に、境界付けられたコンテキスト "出荷" が処理する必要のあるシナリオを見てみましょう。</span><span class="sxs-lookup"><span data-stu-id="aafc0-166">We start with the scenarios that the Shipping bounded context must handle.</span></span>

- <span data-ttu-id="aafc0-167">顧客は、ドローン配送サービスに登録された企業からドローンで商品を集荷するよう依頼できます。</span><span class="sxs-lookup"><span data-stu-id="aafc0-167">A customer can request a drone to pick up goods from a business that is registered with the drone delivery service.</span></span>
- <span data-ttu-id="aafc0-168">荷送人は、タグ (バーコードまたは RFID) を生成して荷物に取り付けます。</span><span class="sxs-lookup"><span data-stu-id="aafc0-168">The sender generates a tag (barcode or RFID) to put on the package.</span></span>
- <span data-ttu-id="aafc0-169">ドローンが集荷先から荷物を集荷して、配送先に届けます。</span><span class="sxs-lookup"><span data-stu-id="aafc0-169">A drone will pick up and deliver a package from the source location to the destination location.</span></span>
- <span data-ttu-id="aafc0-170">顧客が配送をスケジュールするときに、システムはルート情報、気象条件、履歴データに基づいて ETA を提供します。</span><span class="sxs-lookup"><span data-stu-id="aafc0-170">When a customer schedules a delivery, the system provides an ETA based on route information, weather conditions, and historical data.</span></span>
- <span data-ttu-id="aafc0-171">ドローンの飛行中、ユーザーは現在地と最新の ETA を追跡できます。</span><span class="sxs-lookup"><span data-stu-id="aafc0-171">When the drone is in flight, a user can track the current location and the latest ETA.</span></span>
- <span data-ttu-id="aafc0-172">ドローンによる荷物の集荷が完了するまで、顧客は配送をキャンセルできます。</span><span class="sxs-lookup"><span data-stu-id="aafc0-172">Until a drone has picked up the package, the customer can cancel a delivery.</span></span>
- <span data-ttu-id="aafc0-173">配送が完了すると、顧客に通知が送信されます。</span><span class="sxs-lookup"><span data-stu-id="aafc0-173">The customer is notified when the delivery is completed.</span></span>
- <span data-ttu-id="aafc0-174">荷送人は、署名またはフィンガープリントの形式で顧客から配送の確認を要求できます。</span><span class="sxs-lookup"><span data-stu-id="aafc0-174">The sender can request delivery confirmation from the customer, in the form of a signature or finger print.</span></span>
- <span data-ttu-id="aafc0-175">ユーザーは、完了した配送の履歴を検索できます。</span><span class="sxs-lookup"><span data-stu-id="aafc0-175">Users can look up the history of a completed delivery.</span></span>

<span data-ttu-id="aafc0-176">これらのシナリオから、開発チームは以下の**エンティティ**を識別しました。</span><span class="sxs-lookup"><span data-stu-id="aafc0-176">From these scenarios, the development team identified the following **entities**.</span></span>

- <span data-ttu-id="aafc0-177">配送</span><span class="sxs-lookup"><span data-stu-id="aafc0-177">Delivery</span></span>
- <span data-ttu-id="aafc0-178">Package</span><span class="sxs-lookup"><span data-stu-id="aafc0-178">Package</span></span>
- <span data-ttu-id="aafc0-179">ドローン</span><span class="sxs-lookup"><span data-stu-id="aafc0-179">Drone</span></span>
- <span data-ttu-id="aafc0-180">Account</span><span class="sxs-lookup"><span data-stu-id="aafc0-180">Account</span></span>
- <span data-ttu-id="aafc0-181">確認</span><span class="sxs-lookup"><span data-stu-id="aafc0-181">Confirmation</span></span>
- <span data-ttu-id="aafc0-182">通知</span><span class="sxs-lookup"><span data-stu-id="aafc0-182">Notification</span></span>
- <span data-ttu-id="aafc0-183">タグ</span><span class="sxs-lookup"><span data-stu-id="aafc0-183">Tag</span></span>

<span data-ttu-id="aafc0-184">最初の 4 つ (配送、荷物、ドローン、アカウント) はすべて、トランザクションの一貫性の境界を表す**集約**です。</span><span class="sxs-lookup"><span data-stu-id="aafc0-184">The first four, Delivery, Package, Drone, and Account, are all **aggregates** that represent transactional consistency boundaries.</span></span> <span data-ttu-id="aafc0-185">"確認" と "通知" は "配送" の子エンティティです。"タグ" は "荷物" の子エンティティです。</span><span class="sxs-lookup"><span data-stu-id="aafc0-185">Confirmations and Notifications are child entities of Deliveries, and Tags are child entities of Packages.</span></span>

<span data-ttu-id="aafc0-186">この設計の**値オブジェクト**には Location、ETA、PackageWeight、および PackageSize があります。</span><span class="sxs-lookup"><span data-stu-id="aafc0-186">The **value objects** in this design include Location, ETA, PackageWeight, and PackageSize.</span></span>

<span data-ttu-id="aafc0-187">"配送" 集約の UML 図を次に示します。</span><span class="sxs-lookup"><span data-stu-id="aafc0-187">To illustrate, here is a UML diagram of the Delivery aggregate.</span></span> <span data-ttu-id="aafc0-188">この集約は、他の集約 (アカウント、荷物、ドローン) への参照を保持します。</span><span class="sxs-lookup"><span data-stu-id="aafc0-188">Notice that it holds references to other aggregates, including Account, Package, and Drone.</span></span>

![配送集約の UML 図](../images/delivery-entity.png)

<span data-ttu-id="aafc0-190">次の 2 つのドメイン イベントがあります。</span><span class="sxs-lookup"><span data-stu-id="aafc0-190">There are two domain events:</span></span>

- <span data-ttu-id="aafc0-191">ドローンの飛行中、"ドローン" エンティティはドローンの場所と状態 (飛行中、着陸) を示す DroneStatus イベントを送信します。</span><span class="sxs-lookup"><span data-stu-id="aafc0-191">While a drone is in flight, the Drone entity sends DroneStatus events that describe the drone's location and status (in-flight, landed).</span></span>

- <span data-ttu-id="aafc0-192">"配送" エンティティは、配送の段階が変わるたびに DeliveryTracking イベントを送信します。</span><span class="sxs-lookup"><span data-stu-id="aafc0-192">The Delivery entity sends DeliveryTracking events whenever the stage of a delivery changes.</span></span> <span data-ttu-id="aafc0-193">これらには、DeliveryCreated、DeliveryRescheduled、DeliveryHeadedToDropoff、DeliveryCompleted があります。</span><span class="sxs-lookup"><span data-stu-id="aafc0-193">These include DeliveryCreated, DeliveryRescheduled, DeliveryHeadedToDropoff, and DeliveryCompleted.</span></span>

<span data-ttu-id="aafc0-194">これらのイベントは、ドメイン モデル内で意味のある内容を示しています。</span><span class="sxs-lookup"><span data-stu-id="aafc0-194">Notice that these events describe things that are meaningful within the domain model.</span></span> <span data-ttu-id="aafc0-195">これらはドメインに関する情報を示すものであり、特定のプログラミング言語コンストラクトに関連付けられません。</span><span class="sxs-lookup"><span data-stu-id="aafc0-195">They describe something about the domain, and aren't tied to a particular programming language construct.</span></span>

<span data-ttu-id="aafc0-196">開発チームは、これまでに記述されたどのエンティティにも当てはまらないもう 1 つの機能分野を識別しました。</span><span class="sxs-lookup"><span data-stu-id="aafc0-196">The development team identified one more area of functionality, which doesn't fit neatly into any of the entities described so far.</span></span> <span data-ttu-id="aafc0-197">システムの一部では、配送のスケジューリングまたは更新に関連するすべての手順を調整する必要があります。</span><span class="sxs-lookup"><span data-stu-id="aafc0-197">Some part of the system must coordinate all of the steps involved in scheduling or updating a delivery.</span></span> <span data-ttu-id="aafc0-198">そのため、開発チームは、2 つの**ドメイン サービス** (手順を調整する *Scheduler*、および各手順の状態を監視する *Supervisor*) を設計に追加し、いずれかの手順が失敗またはタイムアウトしたかどうかを検出するようにしました。これは [Scheduler Agent Supervisor パターン](../../patterns/scheduler-agent-supervisor.md)のバリエーションです。</span><span class="sxs-lookup"><span data-stu-id="aafc0-198">Therefore, the development team added two **domain services** to the design: a *Scheduler* that coordinates the steps, and a *Supervisor* that monitors the status of each step, in order to detect whether any steps have failed or timed out. This is a variation of the [Scheduler Agent Supervisor pattern](../../patterns/scheduler-agent-supervisor.md).</span></span>

![変更後のドメイン モデルの図](../images/drone-ddd.png)

## <a name="next-steps"></a><span data-ttu-id="aafc0-200">次の手順</span><span class="sxs-lookup"><span data-stu-id="aafc0-200">Next steps</span></span>

<span data-ttu-id="aafc0-201">次の手順では、各マイクロサービスの境界を定義します。</span><span class="sxs-lookup"><span data-stu-id="aafc0-201">The next step is to define the boundaries for each microservice.</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="aafc0-202">マイクロサービス境界の特定</span><span class="sxs-lookup"><span data-stu-id="aafc0-202">Identify microservice boundaries</span></span>](./microservice-boundaries.md)