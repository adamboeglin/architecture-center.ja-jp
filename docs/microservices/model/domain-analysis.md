---
title: マイクロサービスのドメイン分析
description: マイクロサービスのドメイン分析。
author: MikeWasson
ms.date: 02/25/2019
ms.topic: guide
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: microservices
ms.openlocfilehash: 7f3ce8bb7d1e03d59670cc4685589ec76738d95c
ms.sourcegitcommit: c053e6edb429299a0ad9b327888d596c48859d4a
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/20/2019
ms.locfileid: "58243973"
---
# <a name="using-domain-analysis-to-model-microservices"></a><span data-ttu-id="7a70f-103">ドメイン分析を使用したマイクロサービスのモデル化</span><span class="sxs-lookup"><span data-stu-id="7a70f-103">Using domain analysis to model microservices</span></span>

<span data-ttu-id="7a70f-104">マイクロサービスの最大の課題の 1 つは、個々のサービスの境界の定義です。</span><span class="sxs-lookup"><span data-stu-id="7a70f-104">One of the biggest challenges of microservices is to define the boundaries of individual services.</span></span> <span data-ttu-id="7a70f-105">原則として 1 つのサービスは "1 つのこと" を行う必要がありますが、その実現のためには慎重な検討が必要です。</span><span class="sxs-lookup"><span data-stu-id="7a70f-105">The general rule is that a service should do "one thing" &mdash; but putting that rule into practice requires careful thought.</span></span> <span data-ttu-id="7a70f-106">"適切" な設計を作り出す機械的なプロセスはありません。</span><span class="sxs-lookup"><span data-stu-id="7a70f-106">There is no mechanical process that will produce the "right" design.</span></span> <span data-ttu-id="7a70f-107">ビジネス用ドメイン、要件、および目的についてよく考える必要があります。</span><span class="sxs-lookup"><span data-stu-id="7a70f-107">You have to think deeply about your business domain, requirements, and goals.</span></span> <span data-ttu-id="7a70f-108">そうしないと、好ましくない特徴 (サービス間の非表示の依存関係、密結合、不完全なデザインのインターフェイスなど) を持つ場当たり的な設計になる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="7a70f-108">Otherwise, you can end up with a haphazard design that exhibits some undesirable characteristics, such as hidden dependencies between services, tight coupling, or poorly designed interfaces.</span></span> <span data-ttu-id="7a70f-109">この記事では、マイクロサービスを設計するためのドメイン駆動のアプローチについて説明します。</span><span class="sxs-lookup"><span data-stu-id="7a70f-109">This article shows a domain-driven approach to designing microservices.</span></span>

<span data-ttu-id="7a70f-110">この記事では、継続的な例としてドローン配送サービスを使用します。</span><span class="sxs-lookup"><span data-stu-id="7a70f-110">This article uses a drone delivery service as a running example.</span></span> <span data-ttu-id="7a70f-111">シナリオおよび対応する参照実装の詳細については、[こちら](../design/index.md)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="7a70f-111">You can read more about the scenario and the corresponding reference implementation [here](../design/index.md).</span></span>

## <a name="introduction"></a><span data-ttu-id="7a70f-112">はじめに</span><span class="sxs-lookup"><span data-stu-id="7a70f-112">Introduction</span></span>

<span data-ttu-id="7a70f-113">マイクロサービスは、データ アクセスやメッセージングなどの水平レイヤーではなく、ビジネス機能に基づいて設計する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7a70f-113">Microservices should be designed around business capabilities, not horizontal layers such as data access or messaging.</span></span> <span data-ttu-id="7a70f-114">また、マイクロサービスには疎結合と機能の高い凝集度が必要です。</span><span class="sxs-lookup"><span data-stu-id="7a70f-114">In addition, they should have loose coupling and high functional cohesion.</span></span> <span data-ttu-id="7a70f-115">他のサービスを同時に更新せずにサービスを変更できる場合、マイクロサービス同士は*ゆるやかに結び付いて*います。</span><span class="sxs-lookup"><span data-stu-id="7a70f-115">Microservices are *loosely coupled* if you can change one service without requiring other services to be updated at the same time.</span></span> <span data-ttu-id="7a70f-116">明確に定義された 1 つの目的 (ユーザー アカウントの管理、配送履歴の追跡など) を持つマイクロサービスは*高凝集*です。</span><span class="sxs-lookup"><span data-stu-id="7a70f-116">A microservice is *cohesive* if it has a single, well-defined purpose, such as managing user accounts or tracking delivery history.</span></span> <span data-ttu-id="7a70f-117">サービスはドメイン ナレッジをカプセル化し、クライアントからそのナレッジを抽象化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7a70f-117">A service should encapsulate domain knowledge and abstract that knowledge from clients.</span></span> <span data-ttu-id="7a70f-118">たとえば、クライアントは、スケジューリング アルゴリズムの詳細やドローン フリートの管理方法を知らなくてもドローンのスケジュールを設定できる必要があります。</span><span class="sxs-lookup"><span data-stu-id="7a70f-118">For example, a client should be able to schedule a drone without knowing the details of the scheduling algorithm or how the drone fleet is managed.</span></span>

<span data-ttu-id="7a70f-119">ドメイン駆動設計 (DDD) は、適切に設計された一連のマイクロサービスを作り出すためのフレームワークを提供します。</span><span class="sxs-lookup"><span data-stu-id="7a70f-119">Domain-driven design (DDD) provides a framework that can get you most of the way to a set of well-designed microservices.</span></span> <span data-ttu-id="7a70f-120">DDD には 2 つの異なるフェーズ (戦略と戦術) があります。</span><span class="sxs-lookup"><span data-stu-id="7a70f-120">DDD has two distinct phases, strategic and tactical.</span></span> <span data-ttu-id="7a70f-121">戦略的 DDD では、システムの大規模な構造を定義します。</span><span class="sxs-lookup"><span data-stu-id="7a70f-121">In strategic DDD, you are defining the large-scale structure of the system.</span></span> <span data-ttu-id="7a70f-122">戦略的 DDD は、アーキテクチャがビジネス機能に焦点を当てた状態を維持するために役立ちます。</span><span class="sxs-lookup"><span data-stu-id="7a70f-122">Strategic DDD helps to ensure that your architecture remains focused on business capabilities.</span></span> <span data-ttu-id="7a70f-123">戦術的 DDD は、ドメイン モデルの作成に使うことのできる一連の設計パターンを提供します。</span><span class="sxs-lookup"><span data-stu-id="7a70f-123">Tactical DDD provides a set of design patterns that you can use to create the domain model.</span></span> <span data-ttu-id="7a70f-124">これらのパターンには、エンティティ、集約、およびドメイン サービスがあります。</span><span class="sxs-lookup"><span data-stu-id="7a70f-124">These patterns include entities, aggregates, and domain services.</span></span> <span data-ttu-id="7a70f-125">このような戦術的パターンを使うと、疎結合および高凝集のマイクロサービスを設計できます。</span><span class="sxs-lookup"><span data-stu-id="7a70f-125">These tactical patterns will help you to design microservices that are both loosely coupled and cohesive.</span></span>

![ドメイン駆動設計 (DDD) プロセスの図](../images/ddd-process.png)

<span data-ttu-id="7a70f-127">この記事と次の記事では、以下の手順について説明し、それらをドローン配送アプリケーションに適用します。</span><span class="sxs-lookup"><span data-stu-id="7a70f-127">In this article and the next, we'll walk through the following steps, applying them to the Drone Delivery application:</span></span>

1. <span data-ttu-id="7a70f-128">最初にビジネス用ドメインを分析し、アプリケーションの機能的な要件を理解します。</span><span class="sxs-lookup"><span data-stu-id="7a70f-128">Start by analyzing the business domain to understand the application's functional requirements.</span></span> <span data-ttu-id="7a70f-129">この手順により、正式でないドメインの記述が生成されます。この記述をより正式なドメイン モデルのセットに作り替えることができます。</span><span class="sxs-lookup"><span data-stu-id="7a70f-129">The output of this step is an informal description of the domain, which can be refined into a more formal set of domain models.</span></span>

2. <span data-ttu-id="7a70f-130">次に、ドメインの*境界付けられたコンテキスト*を定義します。</span><span class="sxs-lookup"><span data-stu-id="7a70f-130">Next, define the *bounded contexts* of the domain.</span></span> <span data-ttu-id="7a70f-131">境界付けられた各コンテキストには、大規模なアプリケーションの特定のサブドメインを表すドメイン モデルが含まれています。</span><span class="sxs-lookup"><span data-stu-id="7a70f-131">Each bounded context contains a domain model that represents a particular subdomain of the larger application.</span></span>

3. <span data-ttu-id="7a70f-132">境界付けられたコンテキスト内で、戦術的 DDD パターンを適用して、エンティティ、集約、およびドメイン サービスを定義します。</span><span class="sxs-lookup"><span data-stu-id="7a70f-132">Within a bounded context, apply tactical DDD patterns to define entities, aggregates, and domain services.</span></span>

4. <span data-ttu-id="7a70f-133">前の手順の結果を使って、アプリケーションのマイクロサービスを識別します。</span><span class="sxs-lookup"><span data-stu-id="7a70f-133">Use the results from the previous step to identify the microservices in your application.</span></span>

<span data-ttu-id="7a70f-134">この記事では、DDD と主に関連のある最初の 3 つの手順について説明します。</span><span class="sxs-lookup"><span data-stu-id="7a70f-134">In this article, we cover the first three steps, which are primarily concerned with DDD.</span></span> <span data-ttu-id="7a70f-135">マイクロサービスの識別は次の記事で行います。</span><span class="sxs-lookup"><span data-stu-id="7a70f-135">In the next article, we'll identify the microservices.</span></span> <span data-ttu-id="7a70f-136">ただし、DDD は反復的かつ継続的なプロセスであることを覚えておいてください。</span><span class="sxs-lookup"><span data-stu-id="7a70f-136">However, it's important to remember that DDD is an iterative, ongoing process.</span></span> <span data-ttu-id="7a70f-137">サービスの境界は固定されていません。</span><span class="sxs-lookup"><span data-stu-id="7a70f-137">Service boundaries aren't fixed in stone.</span></span> <span data-ttu-id="7a70f-138">アプリケーションの進化に伴って、1 つのサービスを複数の小さなサービスに分割することができます。</span><span class="sxs-lookup"><span data-stu-id="7a70f-138">As an application evolves, you may decide to break apart a service into several smaller services.</span></span>

> [!NOTE]
> <span data-ttu-id="7a70f-139">この記事では、ドメインの完全かつ包括的な分析については説明しません。</span><span class="sxs-lookup"><span data-stu-id="7a70f-139">This article doesn't show a complete and comprehensive domain analysis.</span></span> <span data-ttu-id="7a70f-140">主要なポイントを示すために、あえて簡単な例を取り上げています。</span><span class="sxs-lookup"><span data-stu-id="7a70f-140">We deliberately kept the example brief, to illustrate the main points.</span></span> <span data-ttu-id="7a70f-141">DDD の詳しい背景情報については、この用語を最初に紹介した Eric Evans 氏の著書『*Domain-Driven Design*』をお読みになることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="7a70f-141">For more background on DDD, we recommend Eric Evans' *Domain-Driven Design*, the book that first introduced the term.</span></span> <span data-ttu-id="7a70f-142">その他の参考資料としては、Vaughn Vernon 氏の著書『*Implementing Domain-Driven Design*』があります。</span><span class="sxs-lookup"><span data-stu-id="7a70f-142">Another good reference is *Implementing Domain-Driven Design* by Vaughn Vernon.</span></span>

## <a name="scenario-drone-delivery"></a><span data-ttu-id="7a70f-143">シナリオ: ドローン配送</span><span class="sxs-lookup"><span data-stu-id="7a70f-143">Scenario: Drone delivery</span></span>

<span data-ttu-id="7a70f-144">Fabrikam, Inc. は、ドローン配送サービスを開始しようとしています。</span><span class="sxs-lookup"><span data-stu-id="7a70f-144">Fabrikam, Inc. is starting a drone delivery service.</span></span> <span data-ttu-id="7a70f-145">同社は、ドローン機団を管理しています。</span><span class="sxs-lookup"><span data-stu-id="7a70f-145">The company manages a fleet of drone aircraft.</span></span> <span data-ttu-id="7a70f-146">企業がサービスに登録すると、ユーザーは、ドローンで商品を集荷して配送するように依頼できます。</span><span class="sxs-lookup"><span data-stu-id="7a70f-146">Businesses register with the service, and users can request a drone to pick up goods for delivery.</span></span> <span data-ttu-id="7a70f-147">顧客が集荷のスケジュールを設定すると、バックエンド システムによってドローンが割り当てられ、推定配送時刻がユーザーに通知されます。</span><span class="sxs-lookup"><span data-stu-id="7a70f-147">When a customer schedules a pickup, a backend system assigns a drone and notifies the user with an estimated delivery time.</span></span> <span data-ttu-id="7a70f-148">配送中、ETA は常時更新され、顧客はドローンの場所を追跡できます。</span><span class="sxs-lookup"><span data-stu-id="7a70f-148">While the delivery is in progress, the customer can track the location of the drone, with a continuously updated ETA.</span></span>

<span data-ttu-id="7a70f-149">このシナリオには、かなり複雑なドメインが含まれます。</span><span class="sxs-lookup"><span data-stu-id="7a70f-149">This scenario involves a fairly complicated domain.</span></span> <span data-ttu-id="7a70f-150">ビジネスに関する懸念事項には、ドローンのスケジュール設定、荷物の追跡、ユーザー アカウントの管理、履歴データの保存と分析などもあります。</span><span class="sxs-lookup"><span data-stu-id="7a70f-150">Some of the business concerns include scheduling drones, tracking packages, managing user accounts, and storing and analyzing historical data.</span></span> <span data-ttu-id="7a70f-151">さらに、Fabrikam が求めているのは、迅速に市場に出し、迅速に反復して、新機能を追加することです。</span><span class="sxs-lookup"><span data-stu-id="7a70f-151">Moreover, Fabrikam wants to get to market quickly and then iterate quickly, adding new functionality and capabilities.</span></span> <span data-ttu-id="7a70f-152">アプリケーションは、高いサービス レベル目標 (SLO) に基づいてクラウド スケールで動作する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7a70f-152">The application needs to operate at cloud scale, with a high service level objective (SLO).</span></span> <span data-ttu-id="7a70f-153">また、Fabrikam は、システムの部分ごとに、データ ストレージとクエリの要件がまったく異なることを予期しています。</span><span class="sxs-lookup"><span data-stu-id="7a70f-153">Fabrikam also expects that different parts of the system will have very different requirements for data storage and querying.</span></span> <span data-ttu-id="7a70f-154">Fabrikam はこれらをすべて考慮した結果、ドローン配送アプリケーションにマイクロサービス アーキテクチャを選択します。</span><span class="sxs-lookup"><span data-stu-id="7a70f-154">All of these considerations lead Fabrikam to choose a microservices architecture for the Drone Delivery application.</span></span>

## <a name="analyze-the-domain"></a><span data-ttu-id="7a70f-155">ドメインを分析する</span><span class="sxs-lookup"><span data-stu-id="7a70f-155">Analyze the domain</span></span>

<span data-ttu-id="7a70f-156">DDD アプローチを使うと、各サービスがビジネスの機能的な要件に適合するようなマイクロサービスを設計できます。</span><span class="sxs-lookup"><span data-stu-id="7a70f-156">Using a DDD approach will help you to design microservices so that every service forms a natural fit to a functional business requirement.</span></span> <span data-ttu-id="7a70f-157">また、組織の境界やテクノロジの選択が設計に影響するというトラップを回避できます。</span><span class="sxs-lookup"><span data-stu-id="7a70f-157">It can help you to avoid the trap of letting organizational boundaries or technology choices dictate your design.</span></span>

<span data-ttu-id="7a70f-158">コードを記述する前に、作成するシステムを俯瞰する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7a70f-158">Before writing any code, you need a bird's eye view of the system that you are creating.</span></span> <span data-ttu-id="7a70f-159">DDD では、最初にビジネス用ドメインをモデリングして、*ドメイン モデル*を作成します。</span><span class="sxs-lookup"><span data-stu-id="7a70f-159">DDD starts by modeling the business domain and creating a *domain model*.</span></span> <span data-ttu-id="7a70f-160">ドメイン モデルはビジネス用ドメインの抽象化モデルです。</span><span class="sxs-lookup"><span data-stu-id="7a70f-160">The domain model is an abstract model of the business domain.</span></span> <span data-ttu-id="7a70f-161">このモデルはドメイン ナレッジを抽出して整理し、開発者やドメイン エキスパートに共通の言語を提供します。</span><span class="sxs-lookup"><span data-stu-id="7a70f-161">It distills and organizes domain knowledge, and provides a common language for developers and domain experts.</span></span>

<span data-ttu-id="7a70f-162">最初に、すべてのビジネス機能とその関係をマッピングします。</span><span class="sxs-lookup"><span data-stu-id="7a70f-162">Start by mapping all of the business functions and their connections.</span></span> <span data-ttu-id="7a70f-163">これは、ドメイン エキスパート、ソフトウェア アーキテクト、およびその他の関係者が関与する共同作業になる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="7a70f-163">This will likely be a collaborative effort that involves domain experts, software architects, and other stakeholders.</span></span> <span data-ttu-id="7a70f-164">特定の形式を使う必要はありません。</span><span class="sxs-lookup"><span data-stu-id="7a70f-164">You don't need to use any particular formalism.</span></span>  <span data-ttu-id="7a70f-165">図をスケッチするか、ホワイトボードに描画します。</span><span class="sxs-lookup"><span data-stu-id="7a70f-165">Sketch a diagram or draw on whiteboard.</span></span>

<span data-ttu-id="7a70f-166">図を描画したら、個別のサブドメインの識別を開始できます。</span><span class="sxs-lookup"><span data-stu-id="7a70f-166">As you fill in the diagram, you may start to identify discrete subdomains.</span></span> <span data-ttu-id="7a70f-167">密接に関連している機能はどれか、</span><span class="sxs-lookup"><span data-stu-id="7a70f-167">Which functions are closely related?</span></span> <span data-ttu-id="7a70f-168">ビジネスの中核となる機能はどれか、付帯的なサービスを提供する機能はどれか、</span><span class="sxs-lookup"><span data-stu-id="7a70f-168">Which functions are core to the business, and which provide ancillary services?</span></span> <span data-ttu-id="7a70f-169">依存関係グラフとは何かを確認します。</span><span class="sxs-lookup"><span data-stu-id="7a70f-169">What is the dependency graph?</span></span> <span data-ttu-id="7a70f-170">この最初のフェーズでは、テクノロジや実装の詳細を気にすることはありません。</span><span class="sxs-lookup"><span data-stu-id="7a70f-170">During this initial phase, you aren't concerned with technologies or implementation details.</span></span> <span data-ttu-id="7a70f-171">とは言え、アプリケーションを外部システム (CRM、支払い処理、請求システムなど) と統合する必要のある場所について注意する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7a70f-171">That said, you should note the place where the application will need to integrate with external systems, such as CRM, payment processing, or billing systems.</span></span>

## <a name="example-drone-delivery-application"></a><span data-ttu-id="7a70f-172">例:ドローン配送アプリケーション</span><span class="sxs-lookup"><span data-stu-id="7a70f-172">Example: Drone delivery application</span></span>

<span data-ttu-id="7a70f-173">最初のいくつかのドメイン分析の完了後、Fabrikam のチームはドローン配送ドメインを示すおおまかなスケッチを作成しました。</span><span class="sxs-lookup"><span data-stu-id="7a70f-173">After some initial domain analysis, the Fabrikam team came up with a rough sketch that depicts the Drone Delivery domain.</span></span>

![ドローン配送ドメインの図](../images/ddd1.svg)

- <span data-ttu-id="7a70f-175">**出荷**はビジネスの中核であるため、図の中央に配置します。</span><span class="sxs-lookup"><span data-stu-id="7a70f-175">**Shipping** is placed in the center of the diagram, because it's core to the business.</span></span> <span data-ttu-id="7a70f-176">図のそれ以外の要素は、この機能を実現するために存在します。</span><span class="sxs-lookup"><span data-stu-id="7a70f-176">Everything else in the diagram exists to enable this functionality.</span></span>
- <span data-ttu-id="7a70f-177">**ドローンの管理**もビジネスの中核です。</span><span class="sxs-lookup"><span data-stu-id="7a70f-177">**Drone management** is also core to the business.</span></span> <span data-ttu-id="7a70f-178">ドローン管理と密接に関連する機能には、**ドローンの修理**、および**予測分析**によるドローンの付帯サービスとメンテナンスが必要な時期の予測があります。</span><span class="sxs-lookup"><span data-stu-id="7a70f-178">Functionality that is closely related to drone management includes **drone repair** and using **predictive analysis** to predict when drones need servicing and maintenance.</span></span>
- <span data-ttu-id="7a70f-179">**ETA 分析**は集配の時間を見積もります。</span><span class="sxs-lookup"><span data-stu-id="7a70f-179">**ETA analysis** provides time estimates for pickup and delivery.</span></span>
- <span data-ttu-id="7a70f-180">**サード パーティの輸送**では、荷物をドローンで出荷できない場合の代替輸送方法をアプリケーションでスケジュールできます。</span><span class="sxs-lookup"><span data-stu-id="7a70f-180">**Third-party transportation** will enable the application to schedule alternative transportation methods if a package cannot be shipped entirely by drone.</span></span>
- <span data-ttu-id="7a70f-181">**ドローンの共有**は、コア ビジネスを拡張するものです。</span><span class="sxs-lookup"><span data-stu-id="7a70f-181">**Drone sharing** is a possible extension of the core business.</span></span> <span data-ttu-id="7a70f-182">企業では、ドローンが空きがある期間に、使われていないドローンを貸し出すことができます。</span><span class="sxs-lookup"><span data-stu-id="7a70f-182">The company may have excess drone capacity during certain hours, and could rent out drones that would otherwise be idle.</span></span> <span data-ttu-id="7a70f-183">この機能は、初期リリースには含まれていません。</span><span class="sxs-lookup"><span data-stu-id="7a70f-183">This feature will not be in the initial release.</span></span>
- <span data-ttu-id="7a70f-184">**ビデオ監視**は、企業が後から展開する可能性のあるもう 1 つの分野です。</span><span class="sxs-lookup"><span data-stu-id="7a70f-184">**Video surveillance** is another area that the company might expand into later.</span></span>
- <span data-ttu-id="7a70f-185">**ユーザー アカウント**、**請求**、および**コール センター**は、コア ビジネスをサポートするサブドメインです。</span><span class="sxs-lookup"><span data-stu-id="7a70f-185">**User accounts**, **Invoicing**, and **Call center** are subdomains that support the core business.</span></span>

<span data-ttu-id="7a70f-186">プロセスのこの時点では、実装やテクノロジに関する決定を行っていません。</span><span class="sxs-lookup"><span data-stu-id="7a70f-186">Notice that at this point in the process, we haven't made any decisions about implementation or technologies.</span></span> <span data-ttu-id="7a70f-187">一部のサブシステムには、外部のソフトウェア システムやサード パーティのサービスが含まれている可能性があります。</span><span class="sxs-lookup"><span data-stu-id="7a70f-187">Some of the subsystems may involve external software systems or third-party services.</span></span> <span data-ttu-id="7a70f-188">その場合でも、アプリケーションはこれらのシステムやサービスとやり取りする必要があるため、ドメイン モデルにシステムやサービスを追加することが重要です。</span><span class="sxs-lookup"><span data-stu-id="7a70f-188">Even so, the application needs to interact with these systems and services, so it's important to include them in the domain model.</span></span>

> [!NOTE]
> <span data-ttu-id="7a70f-189">アプリケーションが外部システムに依存する場合は、外部システムのデータ スキーマや API がアプリケーションに漏えいし、最終的にアーキテクチャの設計が損なわれるというリスクがあります。</span><span class="sxs-lookup"><span data-stu-id="7a70f-189">When an application depends on an external system, there is a risk that the external system's data schema or API will leak into your application, ultimately compromising the architectural design.</span></span> <span data-ttu-id="7a70f-190">これは、最新のベスト プラクティスに従っていない、および複雑なデータ スキーマや古い API を使っている従来のシステムに特に当てはまります。</span><span class="sxs-lookup"><span data-stu-id="7a70f-190">This is particularly true with legacy systems that may not follow modern best practices, and may use convoluted data schemas or obsolete APIs.</span></span> <span data-ttu-id="7a70f-191">その場合は、これらの外部システムとアプリケーション間の境界を明確に定義することが重要です。</span><span class="sxs-lookup"><span data-stu-id="7a70f-191">In that case, it's important to have a well-defined boundary between these external systems and the application.</span></span> <span data-ttu-id="7a70f-192">そのためには、[ストラングラー パターン](../../patterns/strangler.md)または[破損対策レイヤー パターン](../../patterns/anti-corruption-layer.md)の使用を検討してください。</span><span class="sxs-lookup"><span data-stu-id="7a70f-192">Consider using the [Strangler pattern](../../patterns/strangler.md) or the [Anti-Corruption Layer pattern](../../patterns/anti-corruption-layer.md) for this purpose.</span></span>

## <a name="define-bounded-contexts"></a><span data-ttu-id="7a70f-193">境界付けられたコンテキストを定義する</span><span class="sxs-lookup"><span data-stu-id="7a70f-193">Define bounded contexts</span></span>

<span data-ttu-id="7a70f-194">ドメイン モデルには、世界中に存在する実際のもの (ユーザー、ドローン、荷物など) の表現が含まれます。</span><span class="sxs-lookup"><span data-stu-id="7a70f-194">The domain model will include representations of real things in the world &mdash; users, drones, packages, and so forth.</span></span> <span data-ttu-id="7a70f-195">ただし、同じものについてシステム全体で同じ表現を使わなければならないというわけではありません。</span><span class="sxs-lookup"><span data-stu-id="7a70f-195">But that doesn't mean that every part of the system needs to use the same representations for the same things.</span></span>

<span data-ttu-id="7a70f-196">たとえば、ドローンの修理と予測分析を扱うサブシステムでは、ドローンの多くの物理的特性 (メンテナンス履歴、マイレージ、年数、モデル番号、性能の特徴など) を表す必要があります。</span><span class="sxs-lookup"><span data-stu-id="7a70f-196">For example, subsystems that handle drone repair and predictive analysis will need to represent many physical characteristics drones, such as their maintenance history, mileage, age, model number, performance characteristics, and so on.</span></span> <span data-ttu-id="7a70f-197">しかし、配送をスケジュールするときは、それらについて考慮しません。</span><span class="sxs-lookup"><span data-stu-id="7a70f-197">But when it's time to schedule a delivery, we don't care about those things.</span></span> <span data-ttu-id="7a70f-198">スケジューリング サブシステムでは、ドローンが使用可能か、および集配の ETA だけを把握する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7a70f-198">The scheduling subsystem only needs to know whether a drone is available, and the ETA for pickup and delivery.</span></span>

<span data-ttu-id="7a70f-199">これらの 2 つのサブシステムに対して 1 つのモデルを作成しようとすると、不必要に複雑なモデルになります。</span><span class="sxs-lookup"><span data-stu-id="7a70f-199">If we tried to create a single model for both of these subsystems, it would be unnecessarily complex.</span></span> <span data-ttu-id="7a70f-200">また、変更を行う場合に複数のチームが個々のサブシステムに対して作業を行う必要があるため、時間の経過と共にモデルの進化が難しくなります。</span><span class="sxs-lookup"><span data-stu-id="7a70f-200">It would also become harder for the model to evolve over time, because any changes will need to satisfy multiple teams working on separate subsystems.</span></span> <span data-ttu-id="7a70f-201">そのため、多くの場合、現実世界のエンティティ (ここではドローン) を 2 つの異なるコンテキストで表す個別のモデルを設計することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="7a70f-201">Therefore, it's often better to design separate models that represent the same real-world entity (in this case, a drone) in two different contexts.</span></span> <span data-ttu-id="7a70f-202">各モデルには、特定のコンテキスト内に関連する機能と属性だけが含まれます。</span><span class="sxs-lookup"><span data-stu-id="7a70f-202">Each model contains only the features and attributes that are relevant within its particular context.</span></span>

<span data-ttu-id="7a70f-203">ここで、*境界付けられたコンテキスト*という DDD の概念が作用します。</span><span class="sxs-lookup"><span data-stu-id="7a70f-203">This is where the DDD concept of *bounded contexts* comes into play.</span></span> <span data-ttu-id="7a70f-204">境界付けられたコンテキストは、特定のドメイン モデルが適用されるドメイン内の単なる境界です。</span><span class="sxs-lookup"><span data-stu-id="7a70f-204">A bounded context is simply the boundary within a domain where a particular domain model applies.</span></span> <span data-ttu-id="7a70f-205">前述の図では、さまざまな機能が 1 つのドメイン モデルを共有するかどうかに従って機能をグループ化できます。</span><span class="sxs-lookup"><span data-stu-id="7a70f-205">Looking at the previous diagram, we can group functionality according to whether various functions will share a single domain model.</span></span>

![境界付けられたコンテキストの図](../images/ddd2.svg)

<span data-ttu-id="7a70f-207">境界付けられたコンテキストは、必ずしも互いに分離された状態である必要はありません。</span><span class="sxs-lookup"><span data-stu-id="7a70f-207">Bounded contexts are not necessarily isolated from one another.</span></span> <span data-ttu-id="7a70f-208">この図では、境界付けられたコンテキストを結ぶ実線は、2 つの境界付けられたコンテキストがやり取りする場所を表します。</span><span class="sxs-lookup"><span data-stu-id="7a70f-208">In this diagram, the solid lines connecting the bounded contexts represent places where two bounded contexts interact.</span></span> <span data-ttu-id="7a70f-209">たとえば、"出荷" は顧客の情報を取得するために "ユーザー アカウント" に依存し、フリートのドローンをスケジュールするために "ドローン管理" に依存します。</span><span class="sxs-lookup"><span data-stu-id="7a70f-209">For example, Shipping depends on User Accounts to get information about customers, and on Drone Management to schedule drones from the fleet.</span></span>

<span data-ttu-id="7a70f-210">Eric Evans 氏は、著書『*Domain Driven Design*』で、別の境界付けられたコンテキストとやり取りする際にドメイン モデルの整合性を維持するための複数のパターンについて説明しています。</span><span class="sxs-lookup"><span data-stu-id="7a70f-210">In the book *Domain Driven Design*, Eric Evans describes several patterns for maintaining the integrity of a domain model when it interacts with another bounded context.</span></span> <span data-ttu-id="7a70f-211">マイクロサービスの主要な原則の 1 つは、明確に定義された API を通じてサービスがやり取りするということです。</span><span class="sxs-lookup"><span data-stu-id="7a70f-211">One of the main principles of microservices is that services communicate through well-defined APIs.</span></span> <span data-ttu-id="7a70f-212">このアプローチは、Evans 氏が Open Host Service および Published Language と呼ぶ 2 つのパターンに対応します。</span><span class="sxs-lookup"><span data-stu-id="7a70f-212">This approach corresponds to two patterns that Evans calls Open Host Service and Published Language.</span></span> <span data-ttu-id="7a70f-213">Open Host Service では、サブシステムが他のサブシステムとやり取りするための正式なプロトコル (API) を定義します。</span><span class="sxs-lookup"><span data-stu-id="7a70f-213">The idea of Open Host Service is that a subsystem defines a formal protocol (API) for other subsystems to communicate with it.</span></span> <span data-ttu-id="7a70f-214">Published Language は、他のチームがクライアントを記述するために使うことのできる形式で API を発行することにより、この考え方を拡張したものです。</span><span class="sxs-lookup"><span data-stu-id="7a70f-214">Published Language extends this idea by publishing the API in a form that other teams can use to write clients.</span></span> <span data-ttu-id="7a70f-215">「[Designing APIs for microservices](../design/api-design.md)」(マイクロサービス用 API の設計) の記事では、[OpenAPI 仕様](https://www.openapis.org/specification/repo) (旧称 Swagger) を使って、JSON または YAML 形式で表現された、REST API 用の言語に依存しないインターフェイスの記述を定義する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="7a70f-215">In the article [Designing APIs for microservices](../design/api-design.md), we discuss using [OpenAPI Specification](https://www.openapis.org/specification/repo) (formerly known as Swagger) to define language-agnostic interface descriptions for REST APIs, expressed in JSON or YAML format.</span></span>

<span data-ttu-id="7a70f-216">この記事の以降の部分では、境界付けられたコンテキスト "出荷" について重点的に説明します。</span><span class="sxs-lookup"><span data-stu-id="7a70f-216">For the rest of this journey, we will focus on the Shipping bounded context.</span></span>

## <a name="next-steps"></a><span data-ttu-id="7a70f-217">次の手順</span><span class="sxs-lookup"><span data-stu-id="7a70f-217">Next steps</span></span>

<span data-ttu-id="7a70f-218">ドメイン分析の完了後、次の手順では戦術的 DDD を適用して、より高い精度でドメイン モデルを定義します。</span><span class="sxs-lookup"><span data-stu-id="7a70f-218">After completing a domain analysis, the next step is to apply tactical DDD, to define your domain models with more precision.</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="7a70f-219">戦術的 DDD</span><span class="sxs-lookup"><span data-stu-id="7a70f-219">Tactical DDD</span></span>](./tactical-ddd.md)
