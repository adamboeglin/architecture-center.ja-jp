---
title: マイクロサービス境界の識別
description: マイクロサービス境界の識別。
author: MikeWasson
ms.date: 02/25/2019
ms.topic: guide
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: microservices
ms.openlocfilehash: 69213701b87f052811a1f032c056f05be7097c14
ms.sourcegitcommit: c053e6edb429299a0ad9b327888d596c48859d4a
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/20/2019
ms.locfileid: "58244563"
---
# <a name="identifying-microservice-boundaries"></a><span data-ttu-id="839fe-103">マイクロサービス境界の識別</span><span class="sxs-lookup"><span data-stu-id="839fe-103">Identifying microservice boundaries</span></span>

<span data-ttu-id="839fe-104">マイクロサービスの適切なサイズとは何でしょうか。</span><span class="sxs-lookup"><span data-stu-id="839fe-104">What is the right size for a microservice?</span></span> <span data-ttu-id="839fe-105">"大きすぎず小さすぎず" といったことをよく耳にします。確かにそのとおりですが、実際にはほとんど役に立ちません。</span><span class="sxs-lookup"><span data-stu-id="839fe-105">You often hear something to the effect of, "not too big and not too small" &mdash; and while that's certainly correct, it's not very helpful in practice.</span></span> <span data-ttu-id="839fe-106">しかし、慎重に設計されたドメイン モデルから始めると、マイクロサービスについてずっと簡単に類推できます。</span><span class="sxs-lookup"><span data-stu-id="839fe-106">But if you start from a carefully designed domain model, it's much easier to reason about microservices.</span></span>

![境界付けられたコンテキストの図](../images/bounded-contexts.png)

<span data-ttu-id="839fe-108">この記事では、継続的な例としてドローン配送サービスを使用します。</span><span class="sxs-lookup"><span data-stu-id="839fe-108">This article uses a drone delivery service as a running example.</span></span> <span data-ttu-id="839fe-109">シナリオおよび対応する参照実装の詳細については、[こちら](../design/index.md)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="839fe-109">You can read more about the scenario and the corresponding reference implementation [here](../design/index.md).</span></span>

## <a name="from-domain-model-to-microservices"></a><span data-ttu-id="839fe-110">ドメイン モデルからマイクロサービスに</span><span class="sxs-lookup"><span data-stu-id="839fe-110">From domain model to microservices</span></span>

<span data-ttu-id="839fe-111">[前の記事](./domain-analysis.md)では、ドローン配送アプリケーションの境界付けられたコンテキストのセットを定義しました。</span><span class="sxs-lookup"><span data-stu-id="839fe-111">In the [previous article](./domain-analysis.md), we defined a set of bounded contexts for a Drone Delivery application.</span></span> <span data-ttu-id="839fe-112">それから、これらの境界付けられたコンテキストの 1 つである "出荷" 境界付けられたコンテキストを詳しく調べて、その境界付けられたコンテキストのエンティティ、集計、ドメイン サービスのセットを明らかにしました。</span><span class="sxs-lookup"><span data-stu-id="839fe-112">Then we looked more closely at one of these bounded contexts, the Shipping bounded context, and identified a set of entities, aggregates, and domain services for that bounded context.</span></span>

<span data-ttu-id="839fe-113">その結果、ドメイン モデルからアプリケーション設計に移行する準備ができています。</span><span class="sxs-lookup"><span data-stu-id="839fe-113">Now we're ready to go from domain model to application design.</span></span> <span data-ttu-id="839fe-114">ドメイン モデルからマイクロサービスを導き出すために使うことができるアプローチを次に示します。</span><span class="sxs-lookup"><span data-stu-id="839fe-114">Here's an approach that you can use to derive microservices from the domain model.</span></span>

1. <span data-ttu-id="839fe-115">境界付けられたコンテキストから始めます。</span><span class="sxs-lookup"><span data-stu-id="839fe-115">Start with a bounded context.</span></span> <span data-ttu-id="839fe-116">一般に、マイクロサービスの機能は、複数の境界付けられたコンテキストにまたがっていてはなりません。</span><span class="sxs-lookup"><span data-stu-id="839fe-116">In general, the functionality in a microservice should not span more than one bounded context.</span></span> <span data-ttu-id="839fe-117">定義上、境界付けられたコンテキストは特定のドメイン モデルの境界をマークします。</span><span class="sxs-lookup"><span data-stu-id="839fe-117">By definition, a bounded context marks the boundary of a particular domain model.</span></span> <span data-ttu-id="839fe-118">1 つのマイクロサービスに複数の異なるドメイン モデルが含まれることがわかった場合は、前に戻ってドメイン分析を修正する必要があることを示しています。</span><span class="sxs-lookup"><span data-stu-id="839fe-118">If you find that a microservice mixes different domain models together, that's a sign that you may need to go back and refine your domain analysis.</span></span>

2. <span data-ttu-id="839fe-119">次に、ドメイン モデルの集計を確認します。</span><span class="sxs-lookup"><span data-stu-id="839fe-119">Next, look at the aggregates in your domain model.</span></span> <span data-ttu-id="839fe-120">集計はマイクロサービスの適切な候補になることがよくあります。</span><span class="sxs-lookup"><span data-stu-id="839fe-120">Aggregates are often good candidates for microservices.</span></span> <span data-ttu-id="839fe-121">適切に設計された集計は、次のような適切に設計されたマイクロサービスの特徴を多く備えています。</span><span class="sxs-lookup"><span data-stu-id="839fe-121">A well-designed aggregate exhibits many of the characteristics of a well-designed microservice, such as:</span></span>

    - <span data-ttu-id="839fe-122">集計は、データ アクセスやメッセージングなどの技術的な問題ではなく、ビジネス要件から派生します。</span><span class="sxs-lookup"><span data-stu-id="839fe-122">An aggregate is derived from business requirements, rather than technical concerns such as data access or messaging.</span></span>
    - <span data-ttu-id="839fe-123">集計には、機能の高い凝集度が必要です。</span><span class="sxs-lookup"><span data-stu-id="839fe-123">An aggregate should have high functional cohesion.</span></span>
    - <span data-ttu-id="839fe-124">集計は永続性の境界です。</span><span class="sxs-lookup"><span data-stu-id="839fe-124">An aggregate is a boundary of persistence.</span></span>
    - <span data-ttu-id="839fe-125">集計同士は疎に結合されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="839fe-125">Aggregates should be loosely coupled.</span></span>

3. <span data-ttu-id="839fe-126">ドメイン サービスもマイクロサービスに適した候補です。</span><span class="sxs-lookup"><span data-stu-id="839fe-126">Domain services are also good candidates for microservices.</span></span> <span data-ttu-id="839fe-127">ドメイン サービスは、複数の集計に対するステートレスな操作です。</span><span class="sxs-lookup"><span data-stu-id="839fe-127">Domain services are stateless operations across multiple aggregates.</span></span> <span data-ttu-id="839fe-128">典型的な例は、複数のマイクロサービスを含むワークフローです。</span><span class="sxs-lookup"><span data-stu-id="839fe-128">A typical example is a workflow that involves several microservices.</span></span> <span data-ttu-id="839fe-129">ドローン配送アプリケーションで、その例を見ることができます。</span><span class="sxs-lookup"><span data-stu-id="839fe-129">We'll see an example of this in the Drone Delivery application.</span></span>

4. <span data-ttu-id="839fe-130">最後に、機能以外の要件を検討します。</span><span class="sxs-lookup"><span data-stu-id="839fe-130">Finally, consider non-functional requirements.</span></span> <span data-ttu-id="839fe-131">チームの規模、データの型、テクノロジ、スケーラビリティの要件、可用性の要件、セキュリティの要件などの要因を確認します。</span><span class="sxs-lookup"><span data-stu-id="839fe-131">Look at factors such as team size, data types, technologies, scalability requirements, availability requirements, and security requirements.</span></span> <span data-ttu-id="839fe-132">これらの要因により、1 つのマイクロサービスを複数の小さいサービスにさらに分割したり、その逆に、複数のマイクロサービスを 1 つに結合したりすることになる場合があります。</span><span class="sxs-lookup"><span data-stu-id="839fe-132">These factors may lead you to further decompose a microservice into two or more smaller services, or do the opposite and combine several microservices into one.</span></span>

<span data-ttu-id="839fe-133">アプリケーション内のマイクロサービスを識別した後は、次の基準に照らし合わせて設計を検証します。</span><span class="sxs-lookup"><span data-stu-id="839fe-133">After you identify the microservices in your application, validate your design against the following criteria:</span></span>

- <span data-ttu-id="839fe-134">各サービスが 1 つの役割を持っていること。</span><span class="sxs-lookup"><span data-stu-id="839fe-134">Each service has a single responsibility.</span></span>
- <span data-ttu-id="839fe-135">サービス間で頻繁な呼び出しが行われないこと。</span><span class="sxs-lookup"><span data-stu-id="839fe-135">There are no chatty calls between services.</span></span> <span data-ttu-id="839fe-136">機能を 2 つのサービスに分割したことによってそれらの間で過度に頻繁に呼び出しが行われる場合、それらの関数が同じサービスに属すことを示している可能性があります。</span><span class="sxs-lookup"><span data-stu-id="839fe-136">If splitting functionality into two services causes them to be overly chatty, it may be a symptom that these functions belong in the same service.</span></span>
- <span data-ttu-id="839fe-137">各サービスが、独立して作業する小規模なチームで構築できるくらいに十分小さいこと。</span><span class="sxs-lookup"><span data-stu-id="839fe-137">Each service is small enough that it can be built by a small team working independently.</span></span>
- <span data-ttu-id="839fe-138">複数のサービスをロックステップでデプロイすることが必要になる相互依存関係がないこと。</span><span class="sxs-lookup"><span data-stu-id="839fe-138">There are no inter-dependencies that will require two or more services to be deployed in lock-step.</span></span> <span data-ttu-id="839fe-139">常に、他のサービスを再デプロイすることなくサービスをデプロイできる必要があります。</span><span class="sxs-lookup"><span data-stu-id="839fe-139">It should always be possible to deploy a service without redeploying any other services.</span></span>
- <span data-ttu-id="839fe-140">サービスが密結合されておらず、個別に展開できること。</span><span class="sxs-lookup"><span data-stu-id="839fe-140">Services are not tightly coupled, and can evolve independently.</span></span>
- <span data-ttu-id="839fe-141">そうすれば、サービスの境界でデータの一貫性や整合性の問題が発生することはありません。</span><span class="sxs-lookup"><span data-stu-id="839fe-141">Your service boundaries will not create problems with data consistency or integrity.</span></span> <span data-ttu-id="839fe-142">場合によっては、単一のマイクロサービスに機能を収めることによってデータの整合性を維持することが重要になります。</span><span class="sxs-lookup"><span data-stu-id="839fe-142">Sometimes it's important to maintain data consistency by putting functionality into a single microservice.</span></span> <span data-ttu-id="839fe-143">ただし、強力な一貫性が本当に必要かどうかを検討する必要があります。</span><span class="sxs-lookup"><span data-stu-id="839fe-143">That said, consider whether you really need strong consistency.</span></span> <span data-ttu-id="839fe-144">分散システムで最終的な整合性に対処するための戦略があり、多くの場合、サービスを分割するメリットの方が、最終的な整合性を管理する難しさより勝ります。</span><span class="sxs-lookup"><span data-stu-id="839fe-144">There are strategies for addressing eventual consistency in a distributed system, and the benefits of decomposing services often outweigh the challenges of managing eventual consistency.</span></span>

<span data-ttu-id="839fe-145">何よりもまず、実際的であること、そしてドメインベースの設計は反復プロセスであることを忘れないようにすることが重要です。</span><span class="sxs-lookup"><span data-stu-id="839fe-145">Above all, it's important to be pragmatic, and remember that domain-driven design is an iterative process.</span></span> <span data-ttu-id="839fe-146">判断に迷うときは、より粒度の粗いマイクロサービスで始めるようにします。</span><span class="sxs-lookup"><span data-stu-id="839fe-146">When in doubt, start with more coarse-grained microservices.</span></span> <span data-ttu-id="839fe-147">1 つのマイクロサービスを 2 つの小さいサービスに分割する方が、既存の複数のマイクロサービスの機能をリファクタリングするより簡単です。</span><span class="sxs-lookup"><span data-stu-id="839fe-147">Splitting a microservice into two smaller services is easier than refactoring functionality across several existing microservices.</span></span>
  
## <a name="example-defining-microservices-for-the-drone-delivery-application"></a><span data-ttu-id="839fe-148">例:ドローン配送アプリケーションのマイクロサービスを定義する</span><span class="sxs-lookup"><span data-stu-id="839fe-148">Example: Defining microservices for the Drone Delivery application</span></span>

<span data-ttu-id="839fe-149">開発チームは 4 つの集計 (配送、パッケージ、ドローン、アカウント) と 2 つのドメイン サービス (スケジューラとスーパーバイザー) を識別したことを思い出してください。</span><span class="sxs-lookup"><span data-stu-id="839fe-149">Recall that the development team had identified the four aggregates &mdash; Delivery, Package, Drone, and Account &mdash; and two domain services, Scheduler and Supervisor.</span></span>

<span data-ttu-id="839fe-150">配送とパッケージは、マイクロサービスの明らかな候補です。</span><span class="sxs-lookup"><span data-stu-id="839fe-150">Delivery and Package are obvious candidates for microservices.</span></span> <span data-ttu-id="839fe-151">スケジューラとスーパーバイザーは、他のマイクロサービスによって実行されるアクティビティを調整するので、これらのドメイン サービスをマイクロサービスとして実装するのは当然のことです。</span><span class="sxs-lookup"><span data-stu-id="839fe-151">The Scheduler and Supervisor coordinate the activities performed by other microservices, so it makes sense to implement these domain services as microservices.</span></span>

<span data-ttu-id="839fe-152">ドローンとアカウントが興味深いのは、他の境界付けられたコンテキストに属していることです。</span><span class="sxs-lookup"><span data-stu-id="839fe-152">Drone and Account are interesting because they belong to other bounded contexts.</span></span> <span data-ttu-id="839fe-153">1 つのオプションは、スケジューラでドローンとアカウントの境界付けられたコンテキストを直接呼び出すというものです。</span><span class="sxs-lookup"><span data-stu-id="839fe-153">One option is for the Scheduler to call the Drone and Account bounded contexts directly.</span></span> <span data-ttu-id="839fe-154">もう 1 つのオプションは、発送の境界付けられたコンテキストの内部にドローンとアカウントのマイクロサービスを作成することです。</span><span class="sxs-lookup"><span data-stu-id="839fe-154">Another option is to create Drone and Account microservices inside the Shipping bounded context.</span></span> <span data-ttu-id="839fe-155">これらマイクロサービスは、発送コンテキストにより適した API またはデータ スキーマを公開することにより、境界付けられたコンテキストの間を仲介します。</span><span class="sxs-lookup"><span data-stu-id="839fe-155">These microservices would mediate between the bounded contexts, by exposing APIs or data schemas that are more suited to the Shipping context.</span></span>

<span data-ttu-id="839fe-156">ドローンとアカウントの境界付けられたコンテキストの詳細はこのガイドの範囲外なので、参照実装ではこれらのモック サービスを作成しました。</span><span class="sxs-lookup"><span data-stu-id="839fe-156">The details of the Drone and Account bounded contexts are beyond the scope of this guidance, so we created mock services for them in our reference implementation.</span></span> <span data-ttu-id="839fe-157">ただし、この状況では次のような要因を考慮する必要があります。</span><span class="sxs-lookup"><span data-stu-id="839fe-157">But here are some factors to consider in this situation:</span></span>

- <span data-ttu-id="839fe-158">他の境界付けられたコンテキストを直接呼び出すとどのようなネットワーク オーバーヘッドがあるか。</span><span class="sxs-lookup"><span data-stu-id="839fe-158">What is the network overhead of calling directly into the other bounded context?</span></span>

- <span data-ttu-id="839fe-159">他の境界付けられたコンテキストのデータ スキーマがこのコンテキストに適しているか、またはこの境界付けられたコンテキストに合わせて調整されたスキーマを作成する方がよいか。</span><span class="sxs-lookup"><span data-stu-id="839fe-159">Is the data schema for the other bounded context suitable for this context, or is it better to have a schema that's tailored to this bounded context?</span></span>

- <span data-ttu-id="839fe-160">他の境界付けられたコンテキストはレガシ システムか。</span><span class="sxs-lookup"><span data-stu-id="839fe-160">Is the other bounded context a legacy system?</span></span> <span data-ttu-id="839fe-161">そうである場合は、[破損対策レイヤー](../../patterns/anti-corruption-layer.md)として機能するサービスを作成し、レガシ システムと最新のアプリケーションの間の変換を行うことが考えられます。</span><span class="sxs-lookup"><span data-stu-id="839fe-161">If so, you might create a service that acts as an [anti-corruption layer](../../patterns/anti-corruption-layer.md) to translate between the legacy system and the modern application.</span></span>

- <span data-ttu-id="839fe-162">チームはどのような構造か。</span><span class="sxs-lookup"><span data-stu-id="839fe-162">What is the team structure?</span></span> <span data-ttu-id="839fe-163">他の境界付けられたコンテキストを担当するチームと簡単に通信できるか。</span><span class="sxs-lookup"><span data-stu-id="839fe-163">Is it easy to communicate with the team that's responsible for the other bounded context?</span></span> <span data-ttu-id="839fe-164">そうでない場合は、2 つのコンテキストの間を仲介するサービスを作成すると、チーム間の通信コストの削減に役立つ場合があります。</span><span class="sxs-lookup"><span data-stu-id="839fe-164">If not, creating a service that mediates between the two contexts can help to mitigate the cost of cross-team communication.</span></span>

<span data-ttu-id="839fe-165">これまで、機能以外の要件については考慮してきませんでした。</span><span class="sxs-lookup"><span data-stu-id="839fe-165">So far, we haven't considered any non-functional requirements.</span></span> <span data-ttu-id="839fe-166">アプリケーションのスループット要件を考慮し、開発チームはクライアント要求のインジェストを行うインジェスト マイクロサービスを別に作成することを決定しました。</span><span class="sxs-lookup"><span data-stu-id="839fe-166">Thinking about the application's throughput requirements, the development team decided to create a separate Ingestion microservice that is responsible for ingesting client requests.</span></span> <span data-ttu-id="839fe-167">このマイクロサービスは、着信した要求を処理のためのバッファーに入れることで、[負荷平準化](../../patterns/queue-based-load-leveling.md)を実装します。</span><span class="sxs-lookup"><span data-stu-id="839fe-167">This microservice will implement [load leveling](../../patterns/queue-based-load-leveling.md) by putting incoming requests into a buffer for processing.</span></span> <span data-ttu-id="839fe-168">スケジューラは、バッファーから要求を読み取って、ワークフローを実行します。</span><span class="sxs-lookup"><span data-stu-id="839fe-168">The Scheduler will read the requests from the buffer and execute the workflow.</span></span>

<span data-ttu-id="839fe-169">機能以外の要件により、チームは 1 つの追加サービスを作成することにしました。</span><span class="sxs-lookup"><span data-stu-id="839fe-169">Non-functional requirements led the team to create one additional service.</span></span> <span data-ttu-id="839fe-170">これまでのサービスはすべて、パッケージのスケジューリングと配送をリアルタイムで行うプロセスに関するものでした。</span><span class="sxs-lookup"><span data-stu-id="839fe-170">All of the services so far have been about the process of scheduling and delivering packages in real time.</span></span> <span data-ttu-id="839fe-171">しかし、システムでは、データ分析のための長期的な記憶域にすべての配送の履歴を格納する必要もあります。</span><span class="sxs-lookup"><span data-stu-id="839fe-171">But the system also needs to store the history of every delivery in long-term storage for data analysis.</span></span> <span data-ttu-id="839fe-172">チームは、これを配送サービスで行うことを検討しました。</span><span class="sxs-lookup"><span data-stu-id="839fe-172">The team considered making this the responsibility of the Delivery service.</span></span> <span data-ttu-id="839fe-173">ただし、データ記憶域の要件は、履歴分析と処理中の操作ではまったく異なります (「[データに関する考慮事項](../design/data-considerations.md)」を参照)。</span><span class="sxs-lookup"><span data-stu-id="839fe-173">However, the data storage requirements are quite different for historical analysis versus in-flight operations (see [Data considerations](../design/data-considerations.md)).</span></span> <span data-ttu-id="839fe-174">そのため、チームは配送履歴サービスを別に作成することにしました。このサービスは、配送サービスからの DeliveryTracking イベントをリッスンし、長期的な記憶域にイベントを書き込みます。</span><span class="sxs-lookup"><span data-stu-id="839fe-174">Therefore, the team decided to create a separate Delivery History service, which will listen for DeliveryTracking events from the Delivery service and write the events into long-term storage.</span></span>

<span data-ttu-id="839fe-175">次の図は、この時点での設計を示したものです。</span><span class="sxs-lookup"><span data-stu-id="839fe-175">The following diagram shows the design at this point:</span></span>

![設計の図](../images/drone-delivery.png)

## <a name="next-steps"></a><span data-ttu-id="839fe-177">次の手順</span><span class="sxs-lookup"><span data-stu-id="839fe-177">Next steps</span></span>

<span data-ttu-id="839fe-178">この時点で、自分の設計における各マイクロサービスの目的と機能を明確に理解しているはずです。</span><span class="sxs-lookup"><span data-stu-id="839fe-178">At this point, you should have a clear understanding of the purpose and functionality of each microservice in your design.</span></span> <span data-ttu-id="839fe-179">これでシステムを設計できます。</span><span class="sxs-lookup"><span data-stu-id="839fe-179">Now you can architect the system.</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="839fe-180">マイクロサービス アーキテクチャの設計</span><span class="sxs-lookup"><span data-stu-id="839fe-180">Design a microservices architecture</span></span>](../design/index.md)

<!-- links -->

[event-grid]: /azure/event-grid/
[functions]: /azure/azure-functions/functions-overview
[functions-triggers]: /azure/azure-functions/functions-triggers-bindings
