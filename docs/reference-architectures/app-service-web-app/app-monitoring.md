---
title: Azure での Web アプリケーションの監視
description: Azure App Service でホストされる Web アプリケーションを監視します。
author: adamboeglin
ms.date: 12/12/2018
ms.topic: reference-architecture
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: azcat
ms.openlocfilehash: 34c21f4b5356dc0acbd5c2c85124300a6ed13c99
ms.sourcegitcommit: 579c39ff4b776704ead17a006bf24cd4cdc65edd
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/17/2019
ms.locfileid: "59640500"
---
# <a name="web-application-monitoring-on-azure"></a><span data-ttu-id="602cf-103">Azure での Web アプリケーションの監視</span><span class="sxs-lookup"><span data-stu-id="602cf-103">Web application monitoring on Azure</span></span>

<span data-ttu-id="602cf-104">Azure のサービスとしてのプラットフォーム (PaaS) オファリングによって、コンピューティング リソースが自動的に管理されます。また、これによりデプロイの監視方法が変わります。</span><span class="sxs-lookup"><span data-stu-id="602cf-104">Azure platform as a service (PaaS) offerings manage compute resources for you and affect how you monitor deployments.</span></span> <span data-ttu-id="602cf-105">Azure には、それぞれが特定の役割を果たす複数の監視サービスが含まれています。</span><span class="sxs-lookup"><span data-stu-id="602cf-105">Azure includes multiple monitoring services, each of which performs a specific role.</span></span> <span data-ttu-id="602cf-106">また、これらのサービスが組み合わされた包括的なソリューションを使用すれば、お使いのアプリケーションやそれらを使用する Azure リソースからテレメトリを収集、分析し、それに基づいて対処できます。</span><span class="sxs-lookup"><span data-stu-id="602cf-106">Together, these services deliver a comprehensive solution for collecting, analyzing, and acting on telemetry from your applications and the Azure resources they consume.</span></span>

<span data-ttu-id="602cf-107">このシナリオでは、使用できる監視サービスを扱い、複数のデータ ソースに使用できるデータフロー モデルについて説明します。</span><span class="sxs-lookup"><span data-stu-id="602cf-107">This scenario addresses the monitoring services you can use and describes a dataflow model for use with multiple data sources.</span></span> <span data-ttu-id="602cf-108">監視に関しては、多くのツールとサービスが Azure のデプロイメントで動作します。</span><span class="sxs-lookup"><span data-stu-id="602cf-108">When it comes to monitoring, many tools and services work with Azure deployments.</span></span> <span data-ttu-id="602cf-109">このシナリオでは、使いやすいという理由のみで、そのまま利用できるサービスを選択します。</span><span class="sxs-lookup"><span data-stu-id="602cf-109">In this scenario, we choose readily available services precisely because they are easy to consume.</span></span> <span data-ttu-id="602cf-110">他の監視オプションについては、この記事で後述します。</span><span class="sxs-lookup"><span data-stu-id="602cf-110">Other monitoring options are discussed later in this article.</span></span>

## <a name="relevant-use-cases"></a><span data-ttu-id="602cf-111">関連するユース ケース</span><span class="sxs-lookup"><span data-stu-id="602cf-111">Relevant use cases</span></span>

<span data-ttu-id="602cf-112">その他の関連するユース ケース:</span><span class="sxs-lookup"><span data-stu-id="602cf-112">Other relevant use cases include:</span></span>

- <span data-ttu-id="602cf-113">テレメトリを監視するための Web アプリケーションのインストルメント化。</span><span class="sxs-lookup"><span data-stu-id="602cf-113">Instrumenting a web application for monitoring telemetry.</span></span>
- <span data-ttu-id="602cf-114">Azure 上にデプロイされているアプリケーションのフロントエンドおよびバックエンド テレメトリの収集。</span><span class="sxs-lookup"><span data-stu-id="602cf-114">Collecting front-end and back-end telemetry for an application deployed on Azure.</span></span>
- <span data-ttu-id="602cf-115">Azure 上のサービスに関連するメトリックとクォータの監視。</span><span class="sxs-lookup"><span data-stu-id="602cf-115">Monitoring metrics and quotas associated with services on Azure.</span></span>

## <a name="architecture"></a><span data-ttu-id="602cf-116">アーキテクチャ</span><span class="sxs-lookup"><span data-stu-id="602cf-116">Architecture</span></span>

!["アーキテクチャ ダイアグラム"](./images/architecture-diagram-app-monitoring.svg)

<span data-ttu-id="602cf-118">このシナリオでは、マネージド Azure 環境を使用してアプリケーション層とデータ層をホストします。</span><span class="sxs-lookup"><span data-stu-id="602cf-118">This scenario uses a managed Azure environment to host an application and data tier.</span></span> <span data-ttu-id="602cf-119">このシナリオのデータ フローは次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="602cf-119">The data flows through the scenario as follows:</span></span>

1. <span data-ttu-id="602cf-120">ユーザーはアプリケーションと対話します。</span><span class="sxs-lookup"><span data-stu-id="602cf-120">A user interacts with the application.</span></span>
2. <span data-ttu-id="602cf-121">ブラウザーとアプリ サービスはテレメトリを出力します。</span><span class="sxs-lookup"><span data-stu-id="602cf-121">The browser and app service emit telemetry.</span></span>
3. <span data-ttu-id="602cf-122">Application Insights は、正常性、パフォーマンス、使用状況のデータを収集して分析します。</span><span class="sxs-lookup"><span data-stu-id="602cf-122">Application Insights collects and analyzes application health, performance, and usage data.</span></span>
4. <span data-ttu-id="602cf-123">開発者と管理者は、正常性、パフォーマンス、および使用状況の情報を確認できます。</span><span class="sxs-lookup"><span data-stu-id="602cf-123">Developers and administrators can review health, performance, and usage information.</span></span>
5. <span data-ttu-id="602cf-124">Azure SQL Database はテレメトリを出力します。</span><span class="sxs-lookup"><span data-stu-id="602cf-124">Azure SQL Database emits telemetry.</span></span>
6. <span data-ttu-id="602cf-125">Azure Monitor は、インフラストラクチャのメトリックとクォータを収集して分析します。</span><span class="sxs-lookup"><span data-stu-id="602cf-125">Azure Monitor collects and analyzes infrastructure metrics and quotas.</span></span>
7. <span data-ttu-id="602cf-126">Log Analytics は、ログとメトリックを収集して分析します。</span><span class="sxs-lookup"><span data-stu-id="602cf-126">Log Analytics collects and analyzes logs and metrics.</span></span>
8. <span data-ttu-id="602cf-127">開発者と管理者は、正常性、パフォーマンス、および使用状況の情報を確認できます。</span><span class="sxs-lookup"><span data-stu-id="602cf-127">Developers and administrators can review health, performance, and usage information.</span></span>

### <a name="components"></a><span data-ttu-id="602cf-128">コンポーネント</span><span class="sxs-lookup"><span data-stu-id="602cf-128">Components</span></span>

- <span data-ttu-id="602cf-129">[Azure App Service](/azure/app-service/) は、マネージド仮想マシンにアプリケーションを構築し、ホストするための PaaS サービスです。</span><span class="sxs-lookup"><span data-stu-id="602cf-129">[Azure App Service](/azure/app-service/) is a PaaS service for building and hosting apps in managed virtual machines.</span></span> <span data-ttu-id="602cf-130">アプリケーションが実行される基礎となるコンピューティング インフラストラクチャは、自動的に管理されます。</span><span class="sxs-lookup"><span data-stu-id="602cf-130">The underlying compute infrastructures on which your apps run is managed for you.</span></span> <span data-ttu-id="602cf-131">App Service には、リソース使用量のクォータとアプリのメトリック、診断情報のログ、メトリックに基づくアラートの監視機能があります。</span><span class="sxs-lookup"><span data-stu-id="602cf-131">App Service provides monitoring of resource usage quotas and app metrics, logging of diagnostic information, and alerts based on metrics.</span></span> <span data-ttu-id="602cf-132">さらに、Application Insights を使用して、異なるリージョンのアプリケーションをテストするための[可用性テスト][availability-tests]を作成することができます。</span><span class="sxs-lookup"><span data-stu-id="602cf-132">Even better, you can use Application Insights to create [availability tests][availability-tests] for testing your application from different regions.</span></span>
- <span data-ttu-id="602cf-133">[Application Insights][application-insights] は、開発者向けの拡張可能なアプリケーション パフォーマンス管理 (APM) サービスであり、複数のプラットフォームをサポートしています。</span><span class="sxs-lookup"><span data-stu-id="602cf-133">[Application Insights][application-insights] is an extensible Application Performance Management (APM) service for developers and supports multiple platforms.</span></span> <span data-ttu-id="602cf-134">アプリケーションを監視し、パフォーマンスの低下や障害などのアプリケーションの異常を検出し、テレメトリを Azure portal に送信します。</span><span class="sxs-lookup"><span data-stu-id="602cf-134">It monitors the application, detects application anomalies such as poor performance and failures, and sends telemetry to the Azure portal.</span></span> <span data-ttu-id="602cf-135">Application Insights は、ログ、分散トレース、カスタム アプリケーションのメトリックにも使用できます。</span><span class="sxs-lookup"><span data-stu-id="602cf-135">Application Insights can also be used for logging, distributed tracing, and custom application metrics.</span></span>
- <span data-ttu-id="602cf-136">[Azure Monitor][azure-monitor] では、Azure のほとんどのサービスに対して、基礎レベルのインフラストラクチャの[メトリックとログ][metrics]を提供します。</span><span class="sxs-lookup"><span data-stu-id="602cf-136">[Azure Monitor][azure-monitor] provides base-level infrastructure [metrics and logs][metrics] for most services in Azure.</span></span> <span data-ttu-id="602cf-137">複数の方法でメトリックを操作できます。たとえば、Azure portal でメトリックをグラフ化したり、REST API でアクセスしたり、PowerShell や CLI を使ってクエリを実行したりできます。</span><span class="sxs-lookup"><span data-stu-id="602cf-137">You can interact with the metrics in several ways, including charting them in Azure portal, accessing them through the REST API, or querying them using PowerShell or CLI.</span></span> <span data-ttu-id="602cf-138">また、Azure Monitor は、[Log Analytics やその他のサービス]にデータを直接提供します。そのサービスでは、そのデータのクエリを実行して、オンプレミス上やクラウド内の他のソースのデータと組み合わせることができます。</span><span class="sxs-lookup"><span data-stu-id="602cf-138">Azure Monitor also offers its data directly into [Log Analytics and other services], where you can query and combine it with data from other sources on premises or in the cloud.</span></span>
- <span data-ttu-id="602cf-139">[Log Analytics][log-analytics] を使用すると、Application Insights で収集された使用状況およびパフォーマンスに関するデータと、アプリをサポートしている Azure Portal リソースの構成およびパフォーマンスに関するデータを関連付ける際に役立ちます。</span><span class="sxs-lookup"><span data-stu-id="602cf-139">[Log Analytics][log-analytics] helps correlate the usage and performance data collected by Application Insights with configuration and performance data across the Azure resources that support the app.</span></span> <span data-ttu-id="602cf-140">このシナリオでは、[Azure Log Analytics エージェント][Azure Log Analytics agent] を使用して SQL Server 監査ログを Log Analytics にプッシュします。</span><span class="sxs-lookup"><span data-stu-id="602cf-140">This scenario uses the [Azure Log Analytics agent][Azure Log Analytics agent] to push SQL Server audit logs into Log Analytics.</span></span> <span data-ttu-id="602cf-141">Azure portal の Log Analytics ブレードでクエリを作成し、データを表示することができます。</span><span class="sxs-lookup"><span data-stu-id="602cf-141">You can write queries and view data in the Log Analytics blade of the Azure portal.</span></span>

## <a name="considerations"></a><span data-ttu-id="602cf-142">考慮事項</span><span class="sxs-lookup"><span data-stu-id="602cf-142">Considerations</span></span>

<span data-ttu-id="602cf-143">推奨プラクティスは、開発中に [Application Insights SDK][Application Insights SDKs] を使用して Application Insights をご自身のコードに追加し、アプリケーションごとにカスタマイズすることです。</span><span class="sxs-lookup"><span data-stu-id="602cf-143">A recommended practice is adding Application Insights to your code during development using the [Application Insights SDKs][Application Insights SDKs], and customizing per application.</span></span> <span data-ttu-id="602cf-144">これらのオープンソースの SDK は、ほとんどのアプリケーション フレームワークで使用できます。</span><span class="sxs-lookup"><span data-stu-id="602cf-144">These open-source SDKs are available for most application frameworks.</span></span> <span data-ttu-id="602cf-145">収集するデータを充実させて制御するには、テスト環境用と運用環境用の SDK の使用を開発プロセスに組み込む必要があります。</span><span class="sxs-lookup"><span data-stu-id="602cf-145">To enrich and control the data you collect, incorporate the use of the SDKs both for testing and production deployments into your development process.</span></span> <span data-ttu-id="602cf-146">主な要件は、インターネットに面したアドレスでホストされている Applications Insights のインジェスト エンドポイントへの直接的または間接的な視線をアプリが持つことです。</span><span class="sxs-lookup"><span data-stu-id="602cf-146">The main requirement is for the app to have a direct or indirect line of sight to the Applications Insights ingestion endpoint hosted with an Internet-facing address.</span></span> <span data-ttu-id="602cf-147">これで、テレメトリを追加したり、既存のテレメトリ コレクションを充実させたりすることができるようになります。</span><span class="sxs-lookup"><span data-stu-id="602cf-147">You can then add telemetry or enrich an existing telemetry collection.</span></span>

<span data-ttu-id="602cf-148">ランタイムの監視も簡単に始めることができます。</span><span class="sxs-lookup"><span data-stu-id="602cf-148">Runtime monitoring is another easy way to get started.</span></span> <span data-ttu-id="602cf-149">収集されるテレメトリは、構成ファイルで制御する必要があります。</span><span class="sxs-lookup"><span data-stu-id="602cf-149">The telemetry that is collected must be controlled through configuration files.</span></span> <span data-ttu-id="602cf-150">たとえば、[Application Insights Status Monitor][Application Insights Status Monitor] などのツールを使用して SDK を正しいフォルダーに配置し、適切な構成を追加して監視を開始するランタイム メソッドを含めることができます。</span><span class="sxs-lookup"><span data-stu-id="602cf-150">For example, you can include runtime methods that enable tools such as [Application Insights Status Monitor][Application Insights Status Monitor] to deploy the SDKs into the correct folder and add the right configurations to begin monitoring.</span></span>

<span data-ttu-id="602cf-151">Application Insights と同様に、Log Analytics には、[複数のソースのデータを分析する][analyzing data across sources]ツール、複雑なクエリを作成するツール、特定条件下で[事前のアラートを送信する][sending proactive alerts]ツールが用意されています。</span><span class="sxs-lookup"><span data-stu-id="602cf-151">Like Application Insights, Log Analytics provides tools for [analyzing data across sources][analyzing data across sources], creating complex queries, and [sending proactive alerts][sending proactive alerts] on specified conditions.</span></span> <span data-ttu-id="602cf-152">[Azure portal][the Azure portal] でテレメトリを確認することもできます。</span><span class="sxs-lookup"><span data-stu-id="602cf-152">You can also view telemetry in [the Azure portal][the Azure portal].</span></span> <span data-ttu-id="602cf-153">Log Analytics では、[Azure Monitor][azure-monitor] などの既存の監視サービスに価値を追加し、オンプレミス環境を監視することもできます。</span><span class="sxs-lookup"><span data-stu-id="602cf-153">Log Analytics adds value to existing monitoring services such as [Azure Monitor][azure-monitor] and can also monitor on-premises environments.</span></span>

<span data-ttu-id="602cf-154">Application Insights と Log Analytics はどちらも [Azure Log Analytics クエリ言語][Azure Log Analytics Query Language]を使用しています。</span><span class="sxs-lookup"><span data-stu-id="602cf-154">Both Application Insights and Log Analytics use [Azure Log Analytics Query Language][Azure Log Analytics Query Language].</span></span> <span data-ttu-id="602cf-155">また、[クロスリソース クエリ](https://azure.microsoft.com/blog/query-across-resources)を使用して、Application Insights と Log Analytics によって収集されたテレメトリを単一のクエリで分析することもできます。</span><span class="sxs-lookup"><span data-stu-id="602cf-155">You can also use [cross-resource queries](https://azure.microsoft.com/blog/query-across-resources) to analyze the telemetry gathered by Application Insights and Log Analytics in a single query.</span></span>

<span data-ttu-id="602cf-156">Azure Monitor、Application Insights、Log Analytics のすべてから[アラート](/azure/monitoring-and-diagnostics/monitoring-overview-alerts)が送信されます。</span><span class="sxs-lookup"><span data-stu-id="602cf-156">Azure Monitor, Application Insights, and Log Analytics all send [alerts](/azure/monitoring-and-diagnostics/monitoring-overview-alerts).</span></span> <span data-ttu-id="602cf-157">たとえば、Azure Monitor は、CPU 使用率などのプラットフォーム レベルのメトリックについて通知します。一方、Application Insights は、サーバーの応答時間などのアプリケーションレベルのメトリックについて通知します。</span><span class="sxs-lookup"><span data-stu-id="602cf-157">For example, Azure Monitor alerts on platform-level metrics such as CPU utilization, while Application Insights alerts on application-level metrics such as server response time.</span></span> <span data-ttu-id="602cf-158">Azure Monitor は、Azure アクティビティ ログの新しいイベントについて通知します。一方、Log Analytics は、使用するように構成されているサービスのメトリックまたはイベント データに関するアラートを発行できます。</span><span class="sxs-lookup"><span data-stu-id="602cf-158">Azure Monitor alerts on new events in the Azure Activity Log, while Log Analytics can issue alerts about metrics or event data for the services configured to use it.</span></span> <span data-ttu-id="602cf-159">[Azure Monitor の統合アラート](/azure/monitoring-and-diagnostics/monitoring-overview-unified-alerts)は、別の分類法を使用する、新しい Azure の統合アラート エクスペリエンスです。</span><span class="sxs-lookup"><span data-stu-id="602cf-159">[Unified alerts in Azure Monitor](/azure/monitoring-and-diagnostics/monitoring-overview-unified-alerts) is a new, unified alerting experience in Azure that uses a different taxonomy.</span></span>

### <a name="alternatives"></a><span data-ttu-id="602cf-160">代替手段</span><span class="sxs-lookup"><span data-stu-id="602cf-160">Alternatives</span></span>

<span data-ttu-id="602cf-161">この記事では、一般的な機能に便利に使用できる監視オプションについて説明しますが、独自のログ メカニズムを作成するオプションなど、多くの選択肢があります。</span><span class="sxs-lookup"><span data-stu-id="602cf-161">This article describes conveniently available monitoring options with popular features, but you have many choices, including the option to create your own logging mechanisms.</span></span> <span data-ttu-id="602cf-162">推奨プラクティスは、ソリューションに階層を構築するときに監視サービスを追加することです。</span><span class="sxs-lookup"><span data-stu-id="602cf-162">A recommended practice is to add monitoring services as you build out tiers in a solution.</span></span> <span data-ttu-id="602cf-163">ここでは、いくつかの拡張と代替案を紹介します。</span><span class="sxs-lookup"><span data-stu-id="602cf-163">Here are some possible extensions and alternatives:</span></span>

- <span data-ttu-id="602cf-164">[Grafana 用 Azure Monitor データ ソース][Azure Monitor Data Source For Grafana]を使用して、Grafana で Azure Monitor と Application Insights のメトリックを統合します。</span><span class="sxs-lookup"><span data-stu-id="602cf-164">Consolidate Azure Monitor and Application Insights metrics in Grafana using the [Azure Monitor Data Source For Grafana][Azure Monitor Data Source For Grafana].</span></span>
- <span data-ttu-id="602cf-165">[Data Dog][data-dog] は、Azure Monitor 用のコネクタを備えています</span><span class="sxs-lookup"><span data-stu-id="602cf-165">[Data Dog][data-dog] features a connector for Azure Monitor</span></span>
- <span data-ttu-id="602cf-166">[Azure Automation][Azure Automation] を使用して、監視機能を自動化します。</span><span class="sxs-lookup"><span data-stu-id="602cf-166">Automate monitoring functions using [Azure Automation][Azure Automation].</span></span>
- <span data-ttu-id="602cf-167">[ITSM ソリューション][ITSM solutions]との通信を追加します。</span><span class="sxs-lookup"><span data-stu-id="602cf-167">Add communication with [ITSM solutions][ITSM solutions].</span></span>
- <span data-ttu-id="602cf-168">[管理ソリューション][management solution]を使用して Log Analytics を拡張します。</span><span class="sxs-lookup"><span data-stu-id="602cf-168">Extend Log Analytics with a [management solution][management solution].</span></span>

### <a name="scalability-and-availability"></a><span data-ttu-id="602cf-169">スケーラビリティと可用性</span><span class="sxs-lookup"><span data-stu-id="602cf-169">Scalability and availability</span></span>

<span data-ttu-id="602cf-170">このシナリオでは、監視のための PaaS ソリューションに焦点を当てています。これは、主に可用性とスケーラビリティが適切に処理され、サービス レベル アグリーメント (SLA) に基づいているからです。</span><span class="sxs-lookup"><span data-stu-id="602cf-170">This scenario focuses on PaaS solutions for monitoring in large part because they conveniently handle availability and scalability for you and are backed by service-level agreements (SLAs).</span></span> <span data-ttu-id="602cf-171">たとえば、App Services には、その可用性を保証する [SLA][SLA] があります。</span><span class="sxs-lookup"><span data-stu-id="602cf-171">For example, App Services provides a guaranteed [SLA][SLA] for its availability.</span></span>

<span data-ttu-id="602cf-172">Application Insights は、1 秒あたりに処理できる要求の数について[制限][app-insights-limits]があります。</span><span class="sxs-lookup"><span data-stu-id="602cf-172">Application Insights has [limits][app-insights-limits] on how many requests can be processed per second.</span></span> <span data-ttu-id="602cf-173">要求の制限を超えると、メッセージの調整が発生することがあります。</span><span class="sxs-lookup"><span data-stu-id="602cf-173">If you exceed the request limit, you may experience message throttling.</span></span> <span data-ttu-id="602cf-174">調整を回避するには、[フィルター処理][message-filtering]または[サンプリング][message-sampling]を実装してデータ レートを減らします</span><span class="sxs-lookup"><span data-stu-id="602cf-174">To prevent throttling, implement [filtering][message-filtering] or [sampling][message-sampling] to reduce the data rate</span></span>

<span data-ttu-id="602cf-175">ただし、実行しているアプリの高可用性については、開発者が考慮する必要があります。</span><span class="sxs-lookup"><span data-stu-id="602cf-175">High availability considerations for the app you run, however, are the developer's responsibility.</span></span> <span data-ttu-id="602cf-176">たとえば、スケールの詳細については、基本的な Web アプリケーションの参照アーキテクチャの[スケーラビリティに関する考慮事項](./basic-web-app.md#scalability-considerations)のセクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="602cf-176">For information about scale, for example, see the [Scalability considerations](./basic-web-app.md#scalability-considerations) section in the basic web application reference architecture.</span></span> <span data-ttu-id="602cf-177">アプリをデプロイしたら、Application Insights を使用して[可用性を監視する][monitor its availability]テストを設定できます。</span><span class="sxs-lookup"><span data-stu-id="602cf-177">After an app is deployed, you can set up tests to [monitor its availability][monitor its availability] using Application Insights.</span></span>

### <a name="security"></a><span data-ttu-id="602cf-178">セキュリティ</span><span class="sxs-lookup"><span data-stu-id="602cf-178">Security</span></span>

<span data-ttu-id="602cf-179">機密情報とコンプライアンスの要件は、データの収集、保持、および保存に影響します。</span><span class="sxs-lookup"><span data-stu-id="602cf-179">Sensitive information and compliance requirements affect data collection, retention, and storage.</span></span> <span data-ttu-id="602cf-180">詳細については、[Application Insights][application-insights] と [Log Analytics][log-analytics] のテレメトリの処理方法を参照してください。</span><span class="sxs-lookup"><span data-stu-id="602cf-180">Learn more about how [Application Insights][application-insights] and [Log Analytics][log-analytics] handle telemetry.</span></span>

<span data-ttu-id="602cf-181">セキュリティに関する次の考慮事項も適用されることがあります。</span><span class="sxs-lookup"><span data-stu-id="602cf-181">The following security considerations may also apply:</span></span>

- <span data-ttu-id="602cf-182">開発者が独自のデータを収集したり、既存のテレメトリを充実させることができる場合は、個人情報の処理計画を立てます。</span><span class="sxs-lookup"><span data-stu-id="602cf-182">Develop a plan to handle personal information if developers are allowed to collect their own data or enrich existing telemetry.</span></span>
- <span data-ttu-id="602cf-183">データのリテンション期間を考慮します。</span><span class="sxs-lookup"><span data-stu-id="602cf-183">Consider data retention.</span></span> <span data-ttu-id="602cf-184">たとえば、Application Insights はテレメトリ データを 90 日間保持します。</span><span class="sxs-lookup"><span data-stu-id="602cf-184">For example, Application Insights retains telemetry data for 90 days.</span></span> <span data-ttu-id="602cf-185">Microsoft Power BI、Continuous Export、または REST API を使用して、長期間アクセスするデータをアーカイブします。</span><span class="sxs-lookup"><span data-stu-id="602cf-185">Archive data you want access to for longer periods using Microsoft Power BI, Continuous Export, or the REST API.</span></span> <span data-ttu-id="602cf-186">ストレージ料金が適用されます。</span><span class="sxs-lookup"><span data-stu-id="602cf-186">Storage rates apply.</span></span>
- <span data-ttu-id="602cf-187">Azure リソースへのアクセスを制限して、データへのアクセスと、特定のアプリケーションからテレメトリを表示できるユーザーを制御できます。</span><span class="sxs-lookup"><span data-stu-id="602cf-187">Limit access to Azure resources to control access to data and who can view telemetry from a specific application.</span></span> <span data-ttu-id="602cf-188">テレメトリの監視へのアクセスをロックする方法については、[Application Insights のリソース、ロール、およびアクセス制御][Resources, roles, and access control in Application Insights]に関するページを参照してください。</span><span class="sxs-lookup"><span data-stu-id="602cf-188">To help lock down access to monitoring telemetry, see [Resources, roles, and access control in Application Insights][Resources, roles, and access control in Application Insights].</span></span>
- <span data-ttu-id="602cf-189">アプリケーション コードの読み取り/書き込みアクセスを制御して、アプリケーションからのデータ インジェストを制限するバージョンまたはタグ マーカーをユーザーが追加しないようにするかどうかを検討します。</span><span class="sxs-lookup"><span data-stu-id="602cf-189">Consider whether to control read/write access in application code to prevent users from adding version or tag markers that limit data ingestion from the application.</span></span> <span data-ttu-id="602cf-190">Application Insights では、個々のデータ項目がリソースに送信された後に制御できないため、ユーザーが任意のデータに対してアクセス権を持っている場合、個々のリソース内のすべてのデータにアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="602cf-190">With Application Insights, there is no control over individual data items once they are sent to a resource, so if a user has access to any data, they have access to all data in an individual resource.</span></span>
- <span data-ttu-id="602cf-191">必要に応じて、Azure リソースに対してポリシーまたはコスト管理を適用するための[ガバナンス](/azure/security/governance-in-azure) メカニズムを追加します。</span><span class="sxs-lookup"><span data-stu-id="602cf-191">Add [governance](/azure/security/governance-in-azure) mechanisms to enforce policy or cost controls over Azure resources if needed.</span></span> <span data-ttu-id="602cf-192">たとえば、ポリシーやロールベースのアクセス制御などのセキュリティ関連の監視に Log Analytics を使用することや、ポリシー定義の作成、割り当て、管理に [Azure Policy](/azure/azure-policy/azure-policy-introduction) を使用することができます。</span><span class="sxs-lookup"><span data-stu-id="602cf-192">For example, use Log Analytics for security-related monitoring such as policies and role-based access control, or use [Azure Policy](/azure/azure-policy/azure-policy-introduction) to create, assign and, manage policy definitions.</span></span>
- <span data-ttu-id="602cf-193">潜在的なセキュリティの問題を監視し、Azure リソースのセキュリティ状態を一元的に確認するには、[Azure Security Center](/azure/security-center/security-center-intro) の使用を検討してください。</span><span class="sxs-lookup"><span data-stu-id="602cf-193">To monitor potential security issues and get a central view of the security state of your Azure resources, consider using [Azure Security Center](/azure/security-center/security-center-intro).</span></span>

## <a name="pricing"></a><span data-ttu-id="602cf-194">価格</span><span class="sxs-lookup"><span data-stu-id="602cf-194">Pricing</span></span>

<span data-ttu-id="602cf-195">監視料金は即時に追加される可能性があるため、事前に価格設定を検討し、監視対象を把握し、各サービスに関連する料金を確認してください。</span><span class="sxs-lookup"><span data-stu-id="602cf-195">Monitoring charges can add up quickly, so consider pricing up front, understand what you are monitoring, and check the associated fees for each service.</span></span> <span data-ttu-id="602cf-196">Azure Monitor には無料の[基本的なメトリック][basic metrics]が用意されていますが、[Application Insights][application-insights-pricing] と [Log Analytics][log-analytics] の監視コストは、インジェストされるデータのサイズと実行するテストの数に基づいて変わります。</span><span class="sxs-lookup"><span data-stu-id="602cf-196">Azure Monitor provides [basic metrics][basic metrics] at no cost, while monitoring costs for [Application Insights][application-insights-pricing] and [Log Analytics][log-analytics] are based on the amount of data ingested and the number of tests you run.</span></span>

<span data-ttu-id="602cf-197">まず、[料金計算ツール][pricing]を使用してコストを見積もります。</span><span class="sxs-lookup"><span data-stu-id="602cf-197">To help you get started, use the [pricing calculator][pricing] to estimate costs.</span></span> <span data-ttu-id="602cf-198">特定のユース ケースについて料金の変化を確認するには、予想されるデプロイに合わせてさまざまなオプションを変更します。</span><span class="sxs-lookup"><span data-stu-id="602cf-198">To see how the pricing would change for your particular use case, change the various options to match your expected deployment.</span></span>

<span data-ttu-id="602cf-199">Application Insights のテレメトリは、デバッグ中やアプリの公開後に Azure portal に送信されます。</span><span class="sxs-lookup"><span data-stu-id="602cf-199">Telemetry from Application Insights is sent to the Azure portal during debugging and after you have published your app.</span></span> <span data-ttu-id="602cf-200">テスト目的であり、料金の請求を避けるため、限られた量のテレメトリが装備されています。</span><span class="sxs-lookup"><span data-stu-id="602cf-200">For testing purposes and to avoid charges, a limited volume of telemetry is instrumented.</span></span> <span data-ttu-id="602cf-201">さらにインジケーターを追加するには、テレメトリの上限を上げることができます。</span><span class="sxs-lookup"><span data-stu-id="602cf-201">To add more indicators, you can raise the telemetry limit.</span></span> <span data-ttu-id="602cf-202">詳細については、「[Application Insights におけるサンプリング][Sampling in Application Insights]」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="602cf-202">For more granular control, see [Sampling in Application Insights][Sampling in Application Insights].</span></span>

<span data-ttu-id="602cf-203">デプロイ後に、パフォーマンス インジケーターの [Live Metrics Stream][Live Metrics Stream] を確認することができます。</span><span class="sxs-lookup"><span data-stu-id="602cf-203">After deployment, you can watch a [Live Metrics Stream][Live Metrics Stream] of performance indicators.</span></span> <span data-ttu-id="602cf-204">このデータは保存されません (リアルタイムのメトリックは表示されます) が、テレメトリを収集して後で分析することができます。</span><span class="sxs-lookup"><span data-stu-id="602cf-204">This data is not stored &mdash; you are viewing real-time metrics &mdash; but the telemetry can be collected and analyzed later.</span></span> <span data-ttu-id="602cf-205">Live Stream データの料金は発生しません。</span><span class="sxs-lookup"><span data-stu-id="602cf-205">There is no charge for Live Stream data.</span></span>

<span data-ttu-id="602cf-206">Log Analytics では、サービスに取り込まれたデータがギガバイト (GB) 単位で課金されます。</span><span class="sxs-lookup"><span data-stu-id="602cf-206">Log Analytics is billed per gigabyte (GB) of data ingested into the service.</span></span> <span data-ttu-id="602cf-207">毎月、Azure Log Analytics サービスにインジェストされる最初の 5 GB のデータは無料で提供されます。また、Log Analytics ワークスペース内のデータは、最初の 31 日間無料で保持されます。</span><span class="sxs-lookup"><span data-stu-id="602cf-207">The first 5 GB of data ingested to the Azure Log Analytics service every month is offered free, and the data is retained at no charge for first 31 days in your Log Analytics workspace.</span></span>

## <a name="next-steps"></a><span data-ttu-id="602cf-208">次の手順</span><span class="sxs-lookup"><span data-stu-id="602cf-208">Next steps</span></span>

<span data-ttu-id="602cf-209">独自の監視ソリューションを初めて構築する場合に役立つリソースを次に示します。</span><span class="sxs-lookup"><span data-stu-id="602cf-209">Check out these resources designed to help you get started with your own monitoring solution:</span></span>

<span data-ttu-id="602cf-210">[基本的な Web アプリケーションの参照アーキテクチャ][Basic web application reference architecture]</span><span class="sxs-lookup"><span data-stu-id="602cf-210">[Basic web application reference architecture][Basic web application reference architecture]</span></span>

<span data-ttu-id="602cf-211">[ASP.NET Web アプリケーションの監視を開始する][Start monitoring your ASP.NET Web Application]</span><span class="sxs-lookup"><span data-stu-id="602cf-211">[Start monitoring your ASP.NET Web Application][Start monitoring your ASP.NET Web Application]</span></span>

<span data-ttu-id="602cf-212">[Azure Virtual Machines に関するデータの収集][Collect data about Azure Virtual Machines]</span><span class="sxs-lookup"><span data-stu-id="602cf-212">[Collect data about Azure Virtual Machines][Collect data about Azure Virtual Machines]</span></span>

## <a name="related-resources"></a><span data-ttu-id="602cf-213">関連リソース</span><span class="sxs-lookup"><span data-stu-id="602cf-213">Related resources</span></span>

<span data-ttu-id="602cf-214">[Azure のアプリケーションおよびリソースの監視][Monitoring Azure applications and resources]</span><span class="sxs-lookup"><span data-stu-id="602cf-214">[Monitoring Azure applications and resources][Monitoring Azure applications and resources]</span></span>

<span data-ttu-id="602cf-215">[Azure Application Insights でランタイムの例外を見つけて診断する][Find and diagnose run-time exceptions with Azure Application Insights]</span><span class="sxs-lookup"><span data-stu-id="602cf-215">[Find and diagnose run-time exceptions with Azure Application Insights][Find and diagnose run-time exceptions with Azure Application Insights]</span></span>

<!-- links -->
[architecture]: ./images/architecture-diagram-app-monitoring.svg
[availability-tests]: /azure/application-insights/app-insights-monitor-web-app-availability
[application-insights]: /azure/application-insights/app-insights-overview
[azure-monitor]: /azure/monitoring-and-diagnostics/monitoring-overview-azure-monitor
[metrics]: /azure/monitoring-and-diagnostics/monitoring-supported-metrics
[Log Analytics やその他のサービス]: /azure/log-analytics/log-analytics-azure-storage
[Log Analytics and other services]: /azure/log-analytics/log-analytics-azure-storage
[log-analytics]: /azure/log-analytics/log-analytics-overview
[Azure Log Analytics agent]: https://blogs.msdn.microsoft.com/sqlsecurity/2017/12/28/azure-log-analytics-oms-agent-now-collects-sql-server-audit-logs/
[application-insights-pricing]: https://azure.microsoft.com/pricing/details/application-insights/
[Application Insights SDKs]: /azure/application-insights/app-insights-asp-net
[Application Insights Status Monitor]: https://azure.microsoft.com/updates/application-insights-status-monitor-and-sdk-updated/
[analyzing data across sources]: /azure/log-analytics/log-analytics-dashboards
[sending proactive alerts]: /azure/log-analytics/log-analytics-alerts
[the Azure portal]: /azure/log-analytics/log-analytics-tutorial-dashboards
[Azure Log Analytics Query Language]: https://docs.loganalytics.io/docs/Learn
[cross-resource queries]: https://azure.microsoft.com/blog/query-across-resources/
[alerts]: /azure/monitoring-and-diagnostics/monitoring-overview-alerts
[Alerts (Preview)]: /azure/monitoring-and-diagnostics/monitoring-overview-unified-alerts
[Azure Monitor Data Source For Grafana]: https://grafana.com/plugins/grafana-azure-monitor-datasource
[Azure Automation]: /azure/automation/automation-intro
[ITSM solutions]: https://azure.microsoft.com/blog/itsm-connector-for-azure-is-now-generally-available/
[management solution]: /azure/monitoring/monitoring-solutions
[SLA]: https://azure.microsoft.com/support/legal/sla/app-service/v1_4/
[monitor its availability]: /azure/application-insights/app-insights-monitor-web-app-availability
[Resources, roles, and access control in Application Insights]: /azure/application-insights/app-insights-resources-roles-access-control
[basic metrics]: /azure/monitoring-and-diagnostics/monitoring-supported-metrics
[pricing]: https://azure.microsoft.com/pricing/calculator/#log-analyticsc126d8c1-ec9c-4e5b-9b51-4db95d06a9b1
[Sampling in Application Insights]: /azure/application-insights/app-insights-sampling
[Live Metrics Stream]: /azure/application-insights/app-insights-live-stream
[Basic web application reference architecture]: /azure/architecture/reference-architectures/app-service-web-app/basic-web-app#scalability-considerations
[Start monitoring your ASP.NET Web Application]: /azure/application-insights/quick-monitor-portal
[Collect data about Azure Virtual Machines]: /azure/log-analytics/log-analytics-quick-collect-azurevm
[Monitoring Azure applications and resources]: /azure/monitoring-and-diagnostics/monitoring-overview
[Find and diagnose run-time exceptions with Azure Application Insights]: /azure/application-insights/app-insights-tutorial-runtime-exceptions
[data-dog]: https://www.datadoghq.com/blog/azure-monitoring-enhancements/
[app-insights-limits]: /azure/azure-subscription-service-limits#application-insights-limits
[message-filtering]: /azure/application-insights/app-insights-api-filtering-sampling
[message-sampling]: /azure/application-insights/app-insights-sampling
