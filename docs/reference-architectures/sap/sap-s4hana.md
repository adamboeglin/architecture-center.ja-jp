---
title: Azure における Linux Virtual Machines の SAP S/4HANA
titleSuffix: Azure Reference Architectures
description: 高可用性を備えた Azure の Linux環境で SAP S/4HANA を実行するための実証済みプラクティス。
author: lbrader
ms.date: 05/11/2018
ms.topic: reference-architecture
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: seodec18, SAP, Linux
ms.openlocfilehash: 4e15fcc17ac5363a84c42903339a0e76333acc83
ms.sourcegitcommit: c053e6edb429299a0ad9b327888d596c48859d4a
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/20/2019
ms.locfileid: "58242923"
---
# <a name="sap-s4hana-for-linux-virtual-machines-on-azure"></a><span data-ttu-id="8137d-103">Azure における Linux Virtual Machines の SAP S/4HANA</span><span class="sxs-lookup"><span data-stu-id="8137d-103">SAP S/4HANA for Linux virtual machines on Azure</span></span>

<span data-ttu-id="8137d-104">この参照用アーキテクチャは、Azure でディザスター リカバリーをサポートする高可用性環境で S/4HANA を実行するための一連の実証済みプラクティスを示しています。</span><span class="sxs-lookup"><span data-stu-id="8137d-104">This reference architecture shows a set of proven practices for running S/4HANA in a high availability environment that supports disaster recovery on Azure.</span></span> <span data-ttu-id="8137d-105">このアーキテクチャは特定の仮想マシン (VM) サイズでデプロイされ、お客様の組織のニーズに合わせて変更できます。</span><span class="sxs-lookup"><span data-stu-id="8137d-105">This architecture is deployed with specific virtual machine (VM) sizes that can be changed to accommodate your organization's needs.</span></span>

![Azure における Linux Virtual Machines の SAP S/4HANA の参照アーキテクチャ](./images/sap-s4hana.png)

<span data-ttu-id="8137d-107">"*このアーキテクチャの [Visio ファイル][visio-download]をダウンロードします。*"</span><span class="sxs-lookup"><span data-stu-id="8137d-107">*Download a [Visio file][visio-download] of this architecture.*</span></span>

> [!NOTE]
> <span data-ttu-id="8137d-108">この参照用アーキテクチャをデプロイするには、SAP 製品と他の Microsoft 以外のテクノロジの適切なライセンスが必要です。</span><span class="sxs-lookup"><span data-stu-id="8137d-108">Deploying this reference architecture requires appropriate licensing of SAP products and other non-Microsoft technologies.</span></span>

## <a name="architecture"></a><span data-ttu-id="8137d-109">アーキテクチャ</span><span class="sxs-lookup"><span data-stu-id="8137d-109">Architecture</span></span>

<span data-ttu-id="8137d-110">この参照アーキテクチャでは、エンタープライズ レベル、運用レベルのシステムについて説明します。</span><span class="sxs-lookup"><span data-stu-id="8137d-110">This reference architecture describes a enterprise-grade, production-level system.</span></span> <span data-ttu-id="8137d-111">この構成は、お客様のビジネス ニーズに合わせて単一の仮想マシンに縮小できます。</span><span class="sxs-lookup"><span data-stu-id="8137d-111">To suit your business needs, this configuration can be reduced to a single virtual machine.</span></span> <span data-ttu-id="8137d-112">ただし、以下のコンポーネントが必要です。</span><span class="sxs-lookup"><span data-stu-id="8137d-112">However, the following components are required:</span></span>

<span data-ttu-id="8137d-113">**Virtual network**。</span><span class="sxs-lookup"><span data-stu-id="8137d-113">**Virtual network**.</span></span> <span data-ttu-id="8137d-114">[Azure Virtual Network](/azure/virtual-network/virtual-networks-overview) サービスによって、Azure リソースが安全に相互接続されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-114">The [Azure Virtual Network](/azure/virtual-network/virtual-networks-overview) service securely connects Azure resources to each other.</span></span> <span data-ttu-id="8137d-115">このアーキテクチャでは、仮想ネットワークは、[ハブスポーク トポロジ](../hybrid-networking/hub-spoke.md)のハブにデプロイされたゲートウェイ経由でオンプレミス環境に接続されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-115">In this architecture, the virtual network connects to an on-premises environment through a gateway deployed in the hub of a [hub-spoke topology](../hybrid-networking/hub-spoke.md).</span></span> <span data-ttu-id="8137d-116">スポークは、SAP アプリケーションに使用される仮想ネットワークです。</span><span class="sxs-lookup"><span data-stu-id="8137d-116">The spoke is the virtual network used for the SAP applications.</span></span>

<span data-ttu-id="8137d-117">**サブネット**。</span><span class="sxs-lookup"><span data-stu-id="8137d-117">**Subnets**.</span></span> <span data-ttu-id="8137d-118">仮想ネットワークは、階層 (ゲートウェイ層、アプリケーション層、データベース層、共有サービス層) ごとに個別の[サブネット](/azure/virtual-network/virtual-network-manage-subnet)に分割されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-118">The virtual network is subdivided into separate [subnets](/azure/virtual-network/virtual-network-manage-subnet) for each tier: gateway, application, database, and shared services.</span></span>

<span data-ttu-id="8137d-119">**仮想マシン**。</span><span class="sxs-lookup"><span data-stu-id="8137d-119">**Virtual machines**.</span></span> <span data-ttu-id="8137d-120">このアーキテクチャでは、アプリケーション層とデータベース層に Linux が実行されている仮想マシンが使用され、次のようにグループ化されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-120">This architecture uses virtual machines running Linux for the application tier and database tier, grouped as follows:</span></span>

- <span data-ttu-id="8137d-121">**アプリケーション層**。</span><span class="sxs-lookup"><span data-stu-id="8137d-121">**Application tier**.</span></span> <span data-ttu-id="8137d-122">Fiori Front-end Server プール、SAP Web Dispatcher プール、アプリケーション サーバー プール、および SAP セントラル サービス クラスターが含まれます。</span><span class="sxs-lookup"><span data-stu-id="8137d-122">Includes the Fiori Front-end Server pool, SAP Web Dispatcher pool, application server pool, and SAP Central Services cluster.</span></span> <span data-ttu-id="8137d-123">Azure Linux 仮想マシンでセントラル サービスの高可用性を実現するには、高可用性ネットワーク ファイル システム (NFS) サービスが必要です。</span><span class="sxs-lookup"><span data-stu-id="8137d-123">For high availability of Central Services on Azure Linux virtual machines, a highly available Network File System (NFS) service is required.</span></span>
- <span data-ttu-id="8137d-124">**NFS クラスター**。</span><span class="sxs-lookup"><span data-stu-id="8137d-124">**NFS cluster**.</span></span> <span data-ttu-id="8137d-125">このアーキテクチャでは、Linux クラスターで実行されている [NFS](/azure/virtual-machines/workloads/sap/high-availability-guide-suse-nfs) サーバーを使って、SAP システム間で共有されるデータが格納されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-125">This architecture uses an [NFS](/azure/virtual-machines/workloads/sap/high-availability-guide-suse-nfs) server running on a Linux cluster to store data shared between SAP systems.</span></span> <span data-ttu-id="8137d-126">この一元化されたクラスターは、複数の SAP システムで共有できます。</span><span class="sxs-lookup"><span data-stu-id="8137d-126">This centralized cluster can be shared across multiple SAP systems.</span></span> <span data-ttu-id="8137d-127">NFS サービスの高可用性は、選択されている Linux ディストリビューションに適した High Availability Extension によって実現します。</span><span class="sxs-lookup"><span data-stu-id="8137d-127">For high availability of the NFS service, the appropriate High Availability Extension for the selected Linux distribution is used.</span></span>
- <span data-ttu-id="8137d-128">**SAP HANA**。</span><span class="sxs-lookup"><span data-stu-id="8137d-128">**SAP HANA**.</span></span> <span data-ttu-id="8137d-129">データベース層では、高可用性を実現するために、クラスターで複数の Linux 仮想マシンが使用されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-129">The database tier uses two or more Linux virtual machines in a cluster to achieve high availability.</span></span> <span data-ttu-id="8137d-130">HANA システム レプリケーション (HSR) を使用して、プライマリ HANA システムとセカンダリHANA システムの間でコンテンツがレプリケートされます。</span><span class="sxs-lookup"><span data-stu-id="8137d-130">HANA System Replication (HSR) is used to replicate contents between primary and secondary HANA systems.</span></span> <span data-ttu-id="8137d-131">システム障害の検出と自動フェールオーバーの促進には Linux クラスタリングが使用されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-131">Linux clustering is used to detect system failures and facilitate automatic failover.</span></span> <span data-ttu-id="8137d-132">また、ストレージ ベースまたはクラウド ベースのフェンス メカニズムが採用され、障害が発生したシステムを確実に分離またはシャットダウンし、クラスターのスプリット ブレイン状態を回避できます。</span><span class="sxs-lookup"><span data-stu-id="8137d-132">A storage-based or cloud-based fencing mechanism can be used to ensure the failed system is isolated or shut down to avoid the cluster split-brain condition.</span></span>
- <span data-ttu-id="8137d-133">**Jumpbox**。</span><span class="sxs-lookup"><span data-stu-id="8137d-133">**Jumpbox**.</span></span> <span data-ttu-id="8137d-134">要塞ホストとも呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="8137d-134">Also called a bastion host.</span></span> <span data-ttu-id="8137d-135">これは、他の仮想マシンに接続するために管理者が使用するネットワークの安全な仮想マシンです。</span><span class="sxs-lookup"><span data-stu-id="8137d-135">This is a secure virtual machine on the network that administrators use to connect to the other virtual machines.</span></span> <span data-ttu-id="8137d-136">Windows または Linux を実行できます。</span><span class="sxs-lookup"><span data-stu-id="8137d-136">It can run Windows or Linux.</span></span> <span data-ttu-id="8137d-137">HANA Cockpit または HANA Studio 管理ツールを使用するときは、Web を閲覧しやすいように Windows Jumpbox を使用します。</span><span class="sxs-lookup"><span data-stu-id="8137d-137">Use a Windows jumpbox for web browsing convenience when using HANA Cockpit or HANA Studio management tools.</span></span>

<span data-ttu-id="8137d-138">**ロード バランサー**。</span><span class="sxs-lookup"><span data-stu-id="8137d-138">**Load balancers**.</span></span> <span data-ttu-id="8137d-139">組み込みの SAP ロード バランサーと [Azure Load Balancer](/azure/load-balancer/load-balancer-overview) の両方が、HA を実現するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-139">Both built-in SAP load balancers and [Azure Load Balancer](/azure/load-balancer/load-balancer-overview) are used to achieve HA.</span></span> <span data-ttu-id="8137d-140">Azure Load Balancer インスタンスは、アプリケーション層サブネット内の仮想マシンにトラフィックを分散させるときに使用されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-140">Azure Load Balancer instances are used to distribute traffic to virtual machines in the application tier subnet.</span></span>

<span data-ttu-id="8137d-141">**可用性セット**。</span><span class="sxs-lookup"><span data-stu-id="8137d-141">**Availability sets**.</span></span> <span data-ttu-id="8137d-142">すべてのプールおよびクラスター (Web Dispatcher、SAP アプリケーション サーバー、セントラル サービス、NFS、および HANA) の仮想マシンが個別の[可用性セット](/azure/virtual-machines/windows/tutorial-availability-sets)にグループ化され、ロールあたり少なくとも 2 つの仮想マシンがプロビジョニングされます。</span><span class="sxs-lookup"><span data-stu-id="8137d-142">Virtual machines for all pools and clusters (Web Dispatcher, SAP application servers, Central Services, NFS, and HANA) are grouped into separate [availability sets](/azure/virtual-machines/windows/tutorial-availability-sets), and at least two virtual machines are provisioned per role.</span></span> <span data-ttu-id="8137d-143">これにより、仮想マシンが、より高度な[サービス レベル アグリーメント](https://azure.microsoft.com/support/legal/sla/virtual-machines) (SLA) に対応できるようになります。</span><span class="sxs-lookup"><span data-stu-id="8137d-143">This makes the virtual machines eligible for a higher [service level agreement](https://azure.microsoft.com/support/legal/sla/virtual-machines) (SLA).</span></span>

<span data-ttu-id="8137d-144">**NIC**。</span><span class="sxs-lookup"><span data-stu-id="8137d-144">**NICs**.</span></span> <span data-ttu-id="8137d-145">[ネットワーク インターフェイス カード](/azure/virtual-network/virtual-network-network-interface) (NIC) により、仮想ネットワーク上の仮想マシンのすべての通信が有効になります。</span><span class="sxs-lookup"><span data-stu-id="8137d-145">[Network interface cards](/azure/virtual-network/virtual-network-network-interface) (NICs) enable all communication of virtual machines on a virtual network.</span></span>

<span data-ttu-id="8137d-146">**ネットワーク セキュリティ グループ**。</span><span class="sxs-lookup"><span data-stu-id="8137d-146">**Network security groups**.</span></span> <span data-ttu-id="8137d-147">仮想ネットワークで受信トラフィック、送信トラフィック、およびサブネット間トラフィックを制限するために、[ネットワーク セキュリティ グループ](/azure/virtual-network/virtual-networks-nsg) (NSG) が使用されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-147">To restrict incoming, outgoing, and intra-subnet traffic in the virtual network, [network security groups](/azure/virtual-network/virtual-networks-nsg) (NSGs) are used.</span></span>

<span data-ttu-id="8137d-148">**ゲートウェイ**。</span><span class="sxs-lookup"><span data-stu-id="8137d-148">**Gateway**.</span></span> <span data-ttu-id="8137d-149">ゲートウェイにより、オンプレミス ネットワークが Azure 仮想ネットワークに拡張されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-149">A gateway extends your on-premises network to the Azure virtual network.</span></span> <span data-ttu-id="8137d-150">[ExpressRoute](/azure/architecture/reference-architectures/hybrid-networking/expressroute) は、パブリック インターネットを経由しないプライベート接続を作成するための推奨 Azure サービスですが、[サイト間](/azure/vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal)接続を使用することもできます。</span><span class="sxs-lookup"><span data-stu-id="8137d-150">[ExpressRoute](/azure/architecture/reference-architectures/hybrid-networking/expressroute) is the recommended Azure service for creating private connections that do not go over the public Internet, but a [Site-to-Site](/azure/vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal) connection can also be used.</span></span>

<span data-ttu-id="8137d-151">**Azure Storage**。</span><span class="sxs-lookup"><span data-stu-id="8137d-151">**Azure Storage**.</span></span> <span data-ttu-id="8137d-152">仮想マシンの仮想ハード ディスク (VHD) の永続的ストレージを提供するには、[Azure Storage](/azure/storage/) が必要です。</span><span class="sxs-lookup"><span data-stu-id="8137d-152">To provide persistent storage of a virtual machine's virtual hard disk (VHD), [Azure Storage](/azure/storage/) is required.</span></span>

## <a name="recommendations"></a><span data-ttu-id="8137d-153">Recommendations</span><span class="sxs-lookup"><span data-stu-id="8137d-153">Recommendations</span></span>

<span data-ttu-id="8137d-154">このアーキテクチャでは、小規模な運用レベルのエンタープライズ デプロイについて説明します。</span><span class="sxs-lookup"><span data-stu-id="8137d-154">This architecture describes a small production-level enterprise deployment.</span></span> <span data-ttu-id="8137d-155">対象となるデプロイは、ビジネス要件によって異なります。</span><span class="sxs-lookup"><span data-stu-id="8137d-155">Your deployment will differ based on your business requirements.</span></span> <span data-ttu-id="8137d-156">これらの推奨事項を開始点として使用してください。</span><span class="sxs-lookup"><span data-stu-id="8137d-156">Use these recommendations as a starting point.</span></span>

### <a name="virtual-machines"></a><span data-ttu-id="8137d-157">仮想マシン</span><span class="sxs-lookup"><span data-stu-id="8137d-157">Virtual machines</span></span>

<span data-ttu-id="8137d-158">アプリケーション サーバーのプールおよびクラスターで、それぞれの要件に基づいて仮想マシンの数を調整します。</span><span class="sxs-lookup"><span data-stu-id="8137d-158">In application server pools and clusters, adjust the number of virtual machines based on your requirements.</span></span> <span data-ttu-id="8137d-159">[Azure Virtual Machines の計画と実装ガイド](/azure/virtual-machines/workloads/sap/planning-guide)に関するページには、仮想マシンでの SAP NetWeaver の実行について詳しく説明されていますが、この説明は SAP S/4HANA にも適用されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-159">The [Azure Virtual Machines planning and implementation guide](/azure/virtual-machines/workloads/sap/planning-guide) includes details about running SAP NetWeaver on virtual machines, but the information applies to SAP S/4HANA as well.</span></span>

<span data-ttu-id="8137d-160">Azure 仮想マシンの種類とスループットのメトリック (SAPS) の SAP サポートの詳細については、[SAP Note 1928533](https://launchpad.support.sap.com/#/notes/1928533) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8137d-160">For details about SAP support for Azure virtual machine types and throughput metrics (SAPS), see [SAP Note 1928533](https://launchpad.support.sap.com/#/notes/1928533).</span></span>

### <a name="sap-web-dispatcher-pool"></a><span data-ttu-id="8137d-161">SAP Web Dispatcher プール</span><span class="sxs-lookup"><span data-stu-id="8137d-161">SAP Web Dispatcher pool</span></span>

<span data-ttu-id="8137d-162">Web Dispatcher コンポーネントは、SAP アプリケーション サーバー間の SAP トラフィックのロード バランサーとして使用されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-162">The Web Dispatcher component is used as a load balancer for SAP traffic among the SAP application servers.</span></span> <span data-ttu-id="8137d-163">Web Dispatcher コンポーネントの高可用性は、バランサーのバックエンド プールで使用可能な Web Dispatcher 間での HTTP (S) トラフィック分散のために、Azure Load Balancer を使って、ラウンドロビン構成で並列 Web Dispatcher セットアップを実装することで実現します。</span><span class="sxs-lookup"><span data-stu-id="8137d-163">To achieve high availability for the Web Dispatcher component, Azure Load Balancer is used to implement the parallel Web Dispatcher setup in a round-robin configuration for HTTP(S) traffic distribution among the available Web Dispatchers in the balancers back-end pool.</span></span>

### <a name="fiori-front-end-server"></a><span data-ttu-id="8137d-164">Fiori Front-end Server</span><span class="sxs-lookup"><span data-stu-id="8137d-164">Fiori Front-end Server</span></span>

<span data-ttu-id="8137d-165">Fiori Front-end Server では [NetWeaver Gateway](https://help.sap.com/doc/saphelp_gateway20sp12/2.0/en-US/76/08828d832e4aa78748e9f82204a864/content.htm?no_cache=true) が使用されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-165">The Fiori Front-end Server uses a [NetWeaver Gateway](https://help.sap.com/doc/saphelp_gateway20sp12/2.0/en-US/76/08828d832e4aa78748e9f82204a864/content.htm?no_cache=true).</span></span> <span data-ttu-id="8137d-166">小規模なデプロイについては、Fiori サーバーに読み込むことができます。</span><span class="sxs-lookup"><span data-stu-id="8137d-166">For small deployments, it can be loaded on the Fiori server.</span></span> <span data-ttu-id="8137d-167">大規模なデプロイでは、NetWeaver Gateway 用の別個のサーバーを、Fiori Front-end Server プールの外側にデプロイできます。</span><span class="sxs-lookup"><span data-stu-id="8137d-167">For large deployments, a separate server for the NetWeaver Gateway may be deployed in front of the Fiori Front-end Server pool.</span></span>

### <a name="application-servers-pool"></a><span data-ttu-id="8137d-168">アプリケーション サーバー プール</span><span class="sxs-lookup"><span data-stu-id="8137d-168">Application servers pool</span></span>

<span data-ttu-id="8137d-169">ABAP アプリケーション サーバーのログオン グループの管理には、SMLG トランザクションが使用されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-169">To manage logon groups for ABAP application servers, the SMLG transaction is used.</span></span> <span data-ttu-id="8137d-170">この場合、セントラル サービスのメッセージ サーバー内の負荷分散機能を使って、SAPGUI および RFC トラフィックの SAP アプリケーション サーバーのプールにワークロードが分散されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-170">It uses the load balancing function within the message server of the Central Services to distribute workload among SAP application servers pool for SAPGUIs and RFC traffic.</span></span> <span data-ttu-id="8137d-171">アプリケーション サーバーは、クラスター仮想ネットワーク名を介して高可用性セントラル サービスに接続されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-171">The application server connection to the highly available Central Services is through the cluster virtual network name.</span></span> <span data-ttu-id="8137d-172">これにより、ローカル フェールオーバー後に、セントラル サービス接続用のアプリケーション サーバー プロファイルを変更する必要がなくなります。</span><span class="sxs-lookup"><span data-stu-id="8137d-172">This avoids the need to change the application server profile for Central Services connectivity after a local failover.</span></span>

### <a name="sap-central-services-cluster"></a><span data-ttu-id="8137d-173">SAP セントラル サービス クラスター</span><span class="sxs-lookup"><span data-stu-id="8137d-173">SAP Central Services cluster</span></span>

<span data-ttu-id="8137d-174">高可用性が不要な場合は、セントラル サービスを単一の仮想マシンにデプロイできます。</span><span class="sxs-lookup"><span data-stu-id="8137d-174">Central Services can be deployed to a single virtual machine when high availability is not a requirement.</span></span> <span data-ttu-id="8137d-175">ただし、単一の仮想マシンは、SAP 環境の単一障害点 (SPOF) になる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="8137d-175">However, the single virtual machine becomes a potential single point of failure (SPOF) for the SAP environment.</span></span> <span data-ttu-id="8137d-176">高可用性セントラル サービス デプロイについては、高可用性 NFS クラスターと高可用性セントラル サービス クラスターが使用されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-176">For a highly available Central Services deployment, a highly available NFS cluster and a highly available Central Services cluster are used.</span></span>

### <a name="nfs-cluster"></a><span data-ttu-id="8137d-177">NFS クラスター</span><span class="sxs-lookup"><span data-stu-id="8137d-177">NFS cluster</span></span>

<span data-ttu-id="8137d-178">NFS クラスターのノード間のレプリケーションには DRBD (Distributed Replicated Block Device) が使用されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-178">DRBD (Distributed Replicated Block Device) is used for replication between the nodes of the NFS cluster.</span></span>

### <a name="availability-sets"></a><span data-ttu-id="8137d-179">可用性セット</span><span class="sxs-lookup"><span data-stu-id="8137d-179">Availability sets</span></span>

<span data-ttu-id="8137d-180">可用性セットにより、サーバーがさまざまな物理インフラストラクチャおよび更新グループに分散され、サービスの可用性が向上します。</span><span class="sxs-lookup"><span data-stu-id="8137d-180">Availability sets distribute servers to different physical infrastructure and update groups to improve service availability.</span></span> <span data-ttu-id="8137d-181">同じロールを実行する仮想マシンを可用性セットに配置すると、Azure インフラストラクチャのメンテナンスに伴うダウンタイムを防ぎ、[サービス レベル アグリーメント](https://azure.microsoft.com/support/legal/sla/virtual-machines) に準拠するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="8137d-181">Put virtual machines that perform the same role into an availability sets to help guard against downtime caused by Azure infrastructure maintenance and to meet [SLAs](https://azure.microsoft.com/support/legal/sla/virtual-machines).</span></span> <span data-ttu-id="8137d-182">可用性セットごとに複数の仮想マシンを配置することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="8137d-182">Two or more virtual machines per availability set is recommended.</span></span>

<span data-ttu-id="8137d-183">セット内の仮想マシンはすべて、同じロールを実行します。</span><span class="sxs-lookup"><span data-stu-id="8137d-183">All virtual machines in a set must perform the same role.</span></span> <span data-ttu-id="8137d-184">同じ可用性セットに異なるロールのサーバーを混在させないでください。</span><span class="sxs-lookup"><span data-stu-id="8137d-184">Do not mix servers of different roles in the same availability set.</span></span> <span data-ttu-id="8137d-185">たとえば、アプリケーション サーバーを含む可用性セットには、ASCS ノードを配置しないでください。</span><span class="sxs-lookup"><span data-stu-id="8137d-185">For example, don't place a ASCS node in the same availability set with the application server.</span></span>

### <a name="nics"></a><span data-ttu-id="8137d-186">NIC</span><span class="sxs-lookup"><span data-stu-id="8137d-186">NICs</span></span>

<span data-ttu-id="8137d-187">従来のオンプレミスの SAP 環境では、管理トラフィックとビジネス トラフィックを切り離すために、マシンごとに複数のネットワーク インターフェイス カード (NIC) が実装されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-187">Traditional on-premises SAP landscapes implement multiple network interface cards (NICs) per machine to segregate administrative traffic from business traffic.</span></span> <span data-ttu-id="8137d-188">Azure では、仮想ネットワークは、すべてのトラフィックを同じネットワーク ファブリック経由で送信するソフトウェア定義ネットワークです。</span><span class="sxs-lookup"><span data-stu-id="8137d-188">On Azure, the virtual network is a software-defined network that sends all traffic through the same network fabric.</span></span> <span data-ttu-id="8137d-189">したがって、複数の NIC を使用する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="8137d-189">Therefore, the use of multiple NICs is unnecessary.</span></span> <span data-ttu-id="8137d-190">ただし、お客様の組織がトラフィックを分離する必要がある場合は、VM ごとに複数の NIC をデプロイし、各 NIC をそれぞれ異なるサブネットに接続することで、NSG を使ってさまざまなアクセス制御ポリシーを強制できます。</span><span class="sxs-lookup"><span data-stu-id="8137d-190">However, if your organization needs to segregate traffic, you can deploy multiple NICs per VM, connect each NIC to a different subnet, and then use NSGs to enforce different access control policies.</span></span>

### <a name="subnets-and-nsgs"></a><span data-ttu-id="8137d-191">サブネットと NSG</span><span class="sxs-lookup"><span data-stu-id="8137d-191">Subnets and NSGs</span></span>

<span data-ttu-id="8137d-192">このアーキテクチャでは、仮想ネットワーク アドレス空間がサブネットに分割されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-192">This architecture subdivides the virtual network address space into subnets.</span></span> <span data-ttu-id="8137d-193">各サブネットを、サブネットのアクセス ポリシーを定義する NSG に関連付けることができます。</span><span class="sxs-lookup"><span data-stu-id="8137d-193">Each subnet can be associated with a NSG that defines the access policies for the subnet.</span></span> <span data-ttu-id="8137d-194">アプリケーション サーバーは、切り離されたサブネットに配置してください。これにより管理対象が個別のサーバーではなく、サブネット セキュリティ ポリシーになるため、サーバーのセキュリティが確保しやすくなります。</span><span class="sxs-lookup"><span data-stu-id="8137d-194">Place application servers on a separate subnet so you can secure them more easily by managing the subnet security policies, not the individual servers.</span></span>

<span data-ttu-id="8137d-195">NSG がサブネットに関連付けられている場合、その NSG はサブネット内のすべてのサーバーに適用されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-195">When a NSG is associated with a subnet, it then applies to all the servers within the subnet.</span></span> <span data-ttu-id="8137d-196">NSG を使用してサブネット内のサーバーをきめ細かく制御する方法の詳細については、[ネットワーク セキュリティ グループによるネットワーク トラフィックのフィルター処理](https://azure.microsoft.com/blog/multiple-vm-nics-and-network-virtual-appliances-in-azure/)に関するページをご覧ください。</span><span class="sxs-lookup"><span data-stu-id="8137d-196">For more information about using NSGs for fine-grained control over the servers in a subnet, see [Filter network traffic with network security groups](https://azure.microsoft.com/blog/multiple-vm-nics-and-network-virtual-appliances-in-azure/).</span></span>

<span data-ttu-id="8137d-197">また、「[VPN ゲートウェイの計画と設計](/azure/vpn-gateway/vpn-gateway-plan-design)」も参照してください。</span><span class="sxs-lookup"><span data-stu-id="8137d-197">See also [Planning and design for VPN Gateway](/azure/vpn-gateway/vpn-gateway-plan-design).</span></span>

### <a name="load-balancers"></a><span data-ttu-id="8137d-198">ロード バランサー</span><span class="sxs-lookup"><span data-stu-id="8137d-198">Load balancers</span></span>

<span data-ttu-id="8137d-199">[SAP Web Dispatcher](https://help.sap.com/doc/saphelp_nw73ehp1/7.31.19/en-US/48/8fe37933114e6fe10000000a421937/frameset.htm) では、SAP アプリケーション サーバー プールへの HTTP(S) トラフィック (Fiori スタイルのアプリケーションを含む) の負荷分散が処理されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-199">[SAP Web Dispatcher](https://help.sap.com/doc/saphelp_nw73ehp1/7.31.19/en-US/48/8fe37933114e6fe10000000a421937/frameset.htm) handles load balancing of HTTP(S) traffic including Fiori style applications to a pool of SAP application servers.</span></span>

<span data-ttu-id="8137d-200">DIAG またはリモート ファンクション コール (RFC) を使用して SAP サーバーに接続している SAP GUI クライアントからのトラフィックについては、セントラル サービスのメッセージ サーバーでは、SAP アプリケーション サーバーの[ログオン グループ](https://wiki.scn.sap.com/wiki/display/SI/ABAP+Logon+Group+based+Load+Balancing)を使用して負荷が分散されます。したがって、追加のロード バランサーは必要ありません。</span><span class="sxs-lookup"><span data-stu-id="8137d-200">For traffic from SAP GUI clients connecting a SAP server via DIAG or Remote Function Calls (RFC), the Central Service message server balances the load through SAP application server [logon groups](https://wiki.scn.sap.com/wiki/display/SI/ABAP+Logon+Group+based+Load+Balancing), so no additional load balancer is needed.</span></span>

### <a name="azure-storage"></a><span data-ttu-id="8137d-201">Azure Storage</span><span class="sxs-lookup"><span data-stu-id="8137d-201">Azure Storage</span></span>

<span data-ttu-id="8137d-202">データベース サーバーの仮想マシンに対して Azure Premium Storage を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="8137d-202">We recommend using Azure Premium Storage for the database server virtual machines.</span></span> <span data-ttu-id="8137d-203">Premium Storage により、一貫した読み取り/書き込みの待機時間を実現できます。</span><span class="sxs-lookup"><span data-stu-id="8137d-203">Premium storage provides consistent read/write latency.</span></span> <span data-ttu-id="8137d-204">単一インスタンス仮想マシンのオペレーティング システム ディスクおよびデータ ディスクに対する Premium Storage の使用に関する詳細については、「[Virtual Machines の SLA](https://azure.microsoft.com/support/legal/sla/virtual-machines/)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8137d-204">For details about using Premium Storage for the operating system disks and data disks of a single-instance virtual machine, see [SLA for Virtual Machines](https://azure.microsoft.com/support/legal/sla/virtual-machines/).</span></span>

<span data-ttu-id="8137d-205">すべての運用 SAP システムで、Premium [Azure Managed Disks](/azure/storage/storage-managed-disks-overview) を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="8137d-205">For all production SAP systems, we recommend using Premium [Azure Managed Disks](/azure/storage/storage-managed-disks-overview).</span></span> <span data-ttu-id="8137d-206">ディスクの VHD ファイルの管理には、信頼性を高めるために、Managed Disks が使用されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-206">Managed Disks are used to manage the VHD files for the disks, adding reliability.</span></span> <span data-ttu-id="8137d-207">また、これにより可用性セット内の仮想マシンのディスクが必ず分離されるため、単一障害点を回避できます。</span><span class="sxs-lookup"><span data-stu-id="8137d-207">They also ensure that the disks for virtual machines within an availability set are isolated to avoid single points of failure.</span></span>

<span data-ttu-id="8137d-208">セントラル サービス仮想マシンなどの SAP アプリケーション サーバーでは、アプリケーション実行はメモリ内で行われ、ログ記録だけにディスクが使用されるため、Azure Standard Storage を使用してコストを削減できます。</span><span class="sxs-lookup"><span data-stu-id="8137d-208">For SAP application servers, including the Central Services virtual machines, you can use Azure Standard Storage to reduce cost, because application execution takes place in memory and uses disks for logging only.</span></span> <span data-ttu-id="8137d-209">ただし、現時点では、Standard Storage はアンマネージド ストレージに対してのみ認定されています。</span><span class="sxs-lookup"><span data-stu-id="8137d-209">However, at this time, Standard Storage is only certified for unmanaged storage.</span></span> <span data-ttu-id="8137d-210">アプリケーション サーバーではデータがホストされないため、小さいサイズの P4 および P6 Premium Storage ディスクが、コストを最小限に抑えるうえで役に立つこともあります。</span><span class="sxs-lookup"><span data-stu-id="8137d-210">Since application servers do not host any data, you can also use the smaller P4 and P6 Premium Storage disks to help minimize cost.</span></span>

<span data-ttu-id="8137d-211">バックアップ データ ストアでは、Azure の[クール アクセス層ストレージやアーカイブ アクセス層ストレージ](/azure/storage/storage-blob-storage-tiers)を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="8137d-211">For the backup data store, we recommend using Azure [cool access tier storage and/or archive access tier storage](/azure/storage/storage-blob-storage-tiers).</span></span> <span data-ttu-id="8137d-212">これらのストレージ層により、コスト効果の高い方法で、有効期間が長くアクセスの少ないデータを格納できます。</span><span class="sxs-lookup"><span data-stu-id="8137d-212">These storage tiers are cost-effective ways to store long-lived data that is less frequently accessed.</span></span>

## <a name="performance-considerations"></a><span data-ttu-id="8137d-213">パフォーマンスに関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="8137d-213">Performance considerations</span></span>

<span data-ttu-id="8137d-214">SAP アプリケーション サーバーは、データベース サーバーと常に通信しています。</span><span class="sxs-lookup"><span data-stu-id="8137d-214">SAP application servers carry on constant communications with the database servers.</span></span> <span data-ttu-id="8137d-215">HANA データベースの仮想マシンについては、[書き込みアクセラレータ](/azure/virtual-machines/linux/how-to-enable-write-accelerator)を有効にして、ログ書き込みの待機時間を短縮することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="8137d-215">For the HANA database virtual machines, consider enabling [Write Accelerator](/azure/virtual-machines/linux/how-to-enable-write-accelerator) to improve log write latency.</span></span> <span data-ttu-id="8137d-216">サーバー間の通信を最適化するには、[高速ネットワーク](https://azure.microsoft.com/blog/linux-and-windows-networking-performance-enhancements-accelerated-networking/)を使用します。</span><span class="sxs-lookup"><span data-stu-id="8137d-216">To optimize inter-server communications, use the [Accelerated Network](https://azure.microsoft.com/blog/linux-and-windows-networking-performance-enhancements-accelerated-networking/).</span></span> <span data-ttu-id="8137d-217">これらのアクセラレータは、特定の VM シリーズでしか使用できないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="8137d-217">Note that these accelerators are available only for certain VM series.</span></span>

<span data-ttu-id="8137d-218">高い IOPS とディスク帯域幅のスループットを達成するために、ストレージ ボリュームの[パフォーマンス最適化](/azure/virtual-machines/linux/premium-storage-performance)の共通プラクティスが、Azure Storage レイアウトに適用されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-218">To achieve high IOPS and disk bandwidth throughput, the common practices in storage volume [performance optimization](/azure/virtual-machines/linux/premium-storage-performance) apply to Azure storage layout.</span></span> <span data-ttu-id="8137d-219">たとえば、ストライピングされたディスク ボリュームを作成するために複数のディスクを結合すると、IO パフォーマンスが向上します。</span><span class="sxs-lookup"><span data-stu-id="8137d-219">For example, combining multiple disks together to create a striped disk volume improves IO performance.</span></span> <span data-ttu-id="8137d-220">変更が頻繁に行われないストレージ コンテンツの読み取りキャッシュを有効にすると、データ取得の速度が向上します。</span><span class="sxs-lookup"><span data-stu-id="8137d-220">Enabling the read cache on storage content that changes infrequently enhances the speed of data retrieval.</span></span> <span data-ttu-id="8137d-221">パフォーマンス要件の詳細については、「[SAP Note 1943937 - Hardware Configuration Check Tool (SAP Note 1943937 - ハードウェア構成チェックツール)](https://launchpad.support.sap.com/#/notes/1943937)」を参照してください (アクセスするには、SAP Service Marketplace アカウントが必要です)。</span><span class="sxs-lookup"><span data-stu-id="8137d-221">For details about performance requirements, see [SAP note 1943937 - Hardware Configuration Check Tool](https://launchpad.support.sap.com/#/notes/1943937) (SAP Service Marketplace account required for access).</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="8137d-222">スケーラビリティに関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="8137d-222">Scalability considerations</span></span>

<span data-ttu-id="8137d-223">SAP アプリケーション レイヤーでは、Azure は、スケールアップおよびスケールアウトのための幅広い仮想マシン サイズを提供しています。詳細な一覧については、[SAP Note 1928533](https://launchpad.support.sap.com/#/notes/1928533) の「SAP Applications on Azure: Supported Products and Azure VM types (Azure 上の SAP アプリケーション:サポートされる製品と Azure VM の種類)」を参照してください (アクセスするには、SAP Service Marketplace アカウントが必要です)。</span><span class="sxs-lookup"><span data-stu-id="8137d-223">At the SAP application layer, Azure offers a wide range of virtual machine sizes for scaling up and scaling out. For an inclusive list, see [SAP Note 1928533](https://launchpad.support.sap.com/#/notes/1928533) - SAP Applications on Azure: Supported Products and Azure VM types (SAP Service Marketplace account required for access).</span></span> <span data-ttu-id="8137d-224">認定済み仮想マシンの種類が引き続き増えていくことで、ユーザーは同じクラウド デプロイでスケールアップまたはスケールダウンできます。</span><span class="sxs-lookup"><span data-stu-id="8137d-224">As we continue to certify more virtual machines types, you can scale up or down with the same cloud deployment.</span></span>

<span data-ttu-id="8137d-225">データベース層では、このアーキテクチャによって VM で HANA が実行されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-225">At the database layer, this architecture runs HANA on VMs.</span></span> <span data-ttu-id="8137d-226">ご自身のワークロードが最大 VM サイズを超えた場合は、Microsoft では、[Azure Large Instances](/azure/virtual-machines/workloads/sap/hana-overview-architecture) for SAP HANA も提供しています。</span><span class="sxs-lookup"><span data-stu-id="8137d-226">If your workload exceeds the maximum VM size, Microsoft also offers [Azure Large Instances](/azure/virtual-machines/workloads/sap/hana-overview-architecture) for SAP HANA.</span></span> <span data-ttu-id="8137d-227">これらの物理サーバーは Microsoft Azure 認定データセンターに併置され、このドキュメントの作成時点では、単一インスタンスに対して最大 20 TB のメモリ容量を提供します。</span><span class="sxs-lookup"><span data-stu-id="8137d-227">These physical servers are co-located in a Microsoft Azure certified datacenter and as of this writing, provide up to 20 TB of memory capacity for a single instance.</span></span> <span data-ttu-id="8137d-228">複数ノードの構成では、最大 60 TB の合計メモリ容量を備えることも可能です。</span><span class="sxs-lookup"><span data-stu-id="8137d-228">Multi-node configuration is also possible with a total memory capacity of up to 60 TB.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="8137d-229">可用性に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="8137d-229">Availability considerations</span></span>

<span data-ttu-id="8137d-230">リソースの冗長性は、高可用性インフラストラクチャ ソリューションの一般的なテーマです。</span><span class="sxs-lookup"><span data-stu-id="8137d-230">Resource redundancy is the general theme in highly available infrastructure solutions.</span></span> <span data-ttu-id="8137d-231">SLA がそれほど厳しくない企業については、単一インスタンスの Azure VM によってアップタイム SLA が提供されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-231">For enterprises that have a less stringent SLA, single-instance Azure VMs offer an uptime SLA.</span></span> <span data-ttu-id="8137d-232">詳細については、[Azure サービス レベル アグリーメント](https://azure.microsoft.com/support/legal/sla/)に関するページをご覧ください。</span><span class="sxs-lookup"><span data-stu-id="8137d-232">For more information, see [Azure Service Level Agreement](https://azure.microsoft.com/support/legal/sla/).</span></span>

<span data-ttu-id="8137d-233">このように SAP アプリケーションを分散してインストールした場合、高可用性を実現するために基本のインストールがレプリケートされます。</span><span class="sxs-lookup"><span data-stu-id="8137d-233">In this distributed installation of the SAP application, the base installation is replicated to achieve high availability.</span></span> <span data-ttu-id="8137d-234">高可用性の設計は、アーキテクチャのレイヤーごとに異なります。</span><span class="sxs-lookup"><span data-stu-id="8137d-234">For each layer of the architecture, the high availability design varies.</span></span>

### <a name="application-tier"></a><span data-ttu-id="8137d-235">アプリケーション層</span><span class="sxs-lookup"><span data-stu-id="8137d-235">Application tier</span></span>

- <span data-ttu-id="8137d-236">Web Dispatcher。</span><span class="sxs-lookup"><span data-stu-id="8137d-236">Web Dispatcher.</span></span> <span data-ttu-id="8137d-237">高可用性は冗長 Web Dispatcher インスタンスによって実現します。</span><span class="sxs-lookup"><span data-stu-id="8137d-237">High availability is achieved with redundant Web Dispatcher instances.</span></span> <span data-ttu-id="8137d-238">SAP ドキュメントの「[SAP Web Dispatcher](https://help.sap.com/doc/saphelp_nw70ehp2/7.02.16/en-us/48/8fe37933114e6fe10000000a421937/frameset.htm)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8137d-238">See [SAP Web Dispatcher](https://help.sap.com/doc/saphelp_nw70ehp2/7.02.16/en-us/48/8fe37933114e6fe10000000a421937/frameset.htm) in the SAP documentation.</span></span>
- <span data-ttu-id="8137d-239">Fiori サーバー。</span><span class="sxs-lookup"><span data-stu-id="8137d-239">Fiori servers.</span></span> <span data-ttu-id="8137d-240">高可用性は、サーバーのプール内の負荷分散トラフィックによって実現します。</span><span class="sxs-lookup"><span data-stu-id="8137d-240">High availability is achieved by load balancing traffic within a pool of servers.</span></span>
- <span data-ttu-id="8137d-241">セントラル サービス。</span><span class="sxs-lookup"><span data-stu-id="8137d-241">Central Services.</span></span> <span data-ttu-id="8137d-242">Azure Linux 仮想マシンのセントラル サービスの高可用性は、選択されている Linux ディストリビューションに適した High Availability Extension によって実現します。また、高可用性 NFS クラスターによって DRBD ストレージがホストされます。</span><span class="sxs-lookup"><span data-stu-id="8137d-242">For high availability of Central Services on Azure Linux virtual machines, the appropriate High Availability Extension for the selected Linux distribution is used, and the highly available NFS cluster hosts DRBD storage.</span></span>
- <span data-ttu-id="8137d-243">アプリケーション サーバー。</span><span class="sxs-lookup"><span data-stu-id="8137d-243">Application servers.</span></span> <span data-ttu-id="8137d-244">高可用性は、アプリケーション サーバーのプール内の負荷分散トラフィックによって実現されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-244">High availability is achieved by load balancing traffic within a pool of application servers.</span></span>

### <a name="database-tier"></a><span data-ttu-id="8137d-245">データベース層</span><span class="sxs-lookup"><span data-stu-id="8137d-245">Database tier</span></span>

<span data-ttu-id="8137d-246">この参照アーキテクチャは、2 つの Azure 仮想マシンで構成される高可用性 SAP HANA データベース システムを示しています。</span><span class="sxs-lookup"><span data-stu-id="8137d-246">This reference architecture depicts a highly available SAP HANA database system consisting of two Azure virtual machines.</span></span> <span data-ttu-id="8137d-247">データベース層のネイティブのシステム レプリケーション機能では、レプリケートされたノード間でのフェールオーバーを手動または自動で行うことができます。</span><span class="sxs-lookup"><span data-stu-id="8137d-247">The database tier's native system replication feature provides either manual or automatic failover between replicated nodes:</span></span>

- <span data-ttu-id="8137d-248">手動フェールオーバーを行うには、複数の HANA インスタンスをデプロイし、HANA システム レプリケーション (HSR) を使用します。</span><span class="sxs-lookup"><span data-stu-id="8137d-248">For manual failover, deploy more than one HANA instance and use HANA System Replication (HSR).</span></span>
- <span data-ttu-id="8137d-249">自動フェールオーバーを行うには、お使いの Linux ディストリビューションに適した HSR と Linux High Availability Extension (HAE) の両方を使用します。</span><span class="sxs-lookup"><span data-stu-id="8137d-249">For automatic failover, use both HSR and Linux High Availability Extension (HAE) for your Linux distribution.</span></span> <span data-ttu-id="8137d-250">Linux HAE はクラスター サービスを HANA リソースに提供することで、障害イベントを検出し、正常なノードへの誤ったサービスのフェールオーバーを調整します。</span><span class="sxs-lookup"><span data-stu-id="8137d-250">Linux HAE provides the cluster services to the HANA resources, detecting failure events and orchestrating the failover of errant services to the healthy node.</span></span>

<span data-ttu-id="8137d-251">「[Microsoft Azure で実行されている SAP の認定と構成](/azure/virtual-machines/workloads/sap/sap-certifications)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8137d-251">See [SAP certifications and configurations running on Microsoft Azure](/azure/virtual-machines/workloads/sap/sap-certifications).</span></span>

### <a name="disaster-recovery-considerations"></a><span data-ttu-id="8137d-252">ディザスター リカバリーの考慮事項</span><span class="sxs-lookup"><span data-stu-id="8137d-252">Disaster recovery considerations</span></span>

<span data-ttu-id="8137d-253">各層では、さまざまな戦略を利用して、ディザスター リカバリー (DR) の保護を提供しています。</span><span class="sxs-lookup"><span data-stu-id="8137d-253">Each tier uses a different strategy to provide disaster recovery (DR) protection.</span></span>

- <span data-ttu-id="8137d-254">**アプリケーション サーバー層**。</span><span class="sxs-lookup"><span data-stu-id="8137d-254">**Application servers tier**.</span></span> <span data-ttu-id="8137d-255">SAP アプリケーション サーバーには、ビジネス データが含まれていません。</span><span class="sxs-lookup"><span data-stu-id="8137d-255">SAP application servers do not contain business data.</span></span> <span data-ttu-id="8137d-256">Azure での単純な DR 戦略は、セカンダリ リージョンで SAP アプリケーション サーバーを作成し、そのサーバーをシャットダウンすることです。</span><span class="sxs-lookup"><span data-stu-id="8137d-256">On Azure, a simple DR strategy is to create SAP application servers in the secondary region, then shut them down.</span></span> <span data-ttu-id="8137d-257">プライマリ アプリケーション サーバーで任意の構成変更やカーネル更新を行った場合、同じ変更がセカンダリ リージョンの仮想マシンに適用されなければなりません。</span><span class="sxs-lookup"><span data-stu-id="8137d-257">Upon any configuration changes or kernel updates on the primary application server, the same changes must be applied to the virtual machines in the secondary region.</span></span> <span data-ttu-id="8137d-258">たとえば、SAP カーネルの実行可能ファイルを DR 仮想マシンにコピーします。</span><span class="sxs-lookup"><span data-stu-id="8137d-258">For example, copy the SAP kernel executables to the DR virtual machines.</span></span> <span data-ttu-id="8137d-259">アプリケーション サーバーをセカンダリ リージョンに自動的にレプリケートするためのソリューションとしては、[Azure Site Recovery](/azure/site-recovery/site-recovery-overview) をお勧めします。</span><span class="sxs-lookup"><span data-stu-id="8137d-259">For automatic replication of application servers to a secondary region, [Azure Site Recovery](/azure/site-recovery/site-recovery-overview) is the recommended solution.</span></span> <span data-ttu-id="8137d-260">このドキュメントの作成時点では、ASR では、Azure VM における高速ネットワーク構成設定のレプリケーションがまだサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="8137d-260">As of the writing of this paper, ASR doesn't yet support the replication of the Accelerated Network configuration setting in Azure VMs.</span></span>

- <span data-ttu-id="8137d-261">**セントラル サービス**。</span><span class="sxs-lookup"><span data-stu-id="8137d-261">**Central Services**.</span></span> <span data-ttu-id="8137d-262">SAP アプリケーション スタックのこのコンポーネントにも、ビジネス データが保持されません。</span><span class="sxs-lookup"><span data-stu-id="8137d-262">This component of the SAP application stack also does not persist business data.</span></span> <span data-ttu-id="8137d-263">セカンダリ リージョンで VM を作成すると、セントラル サービス ロールを実行できます。</span><span class="sxs-lookup"><span data-stu-id="8137d-263">You can build a VM in the secondary region to run the Central Services role.</span></span> <span data-ttu-id="8137d-264">プライマリ セントラル サービス ノードから同期されるコンテンツは、/sapmnt 共有コンテンツだけです。</span><span class="sxs-lookup"><span data-stu-id="8137d-264">The only content from the primary Central Services node to synchronize is the /sapmnt share content.</span></span> <span data-ttu-id="8137d-265">また、構成の変更やカーネルの更新がプライマリ セントラル サービス サーバーで発生した場合、その変更や更新は、セントラル サービスが実行されているセカンダリ リージョンの VM でもう一度行われなければなりません。</span><span class="sxs-lookup"><span data-stu-id="8137d-265">Also, if configuration changes or kernel updates take place on the primary Central Services servers, they must be repeated on the VM in the secondary region running Central Services.</span></span> <span data-ttu-id="8137d-266">2 つのサーバーを同期するには、Azure Site Recovery を使用してクラスター ノードをレプリケートするか、単純に、定期的にコピーするようにスケジュール設定されたコピー ジョブを使用して、/sapmnt を DR 側にコピーします。</span><span class="sxs-lookup"><span data-stu-id="8137d-266">To synchronize the two servers, you can use either Azure Site Recovery, to replicate the cluster nodes, or simply use a regularly scheduled copy job to copy /sapmnt to the DR side.</span></span> <span data-ttu-id="8137d-267">作成、コピー、およびテスト フェールオーバー プロセスの詳細については、「[SAP NetWeaver:Building a Hyper-V and Microsoft Azure–based Disaster Recovery Solution (SAP NetWeaver: Hyper-V および Microsoft Azure ベースのディザスター リカバリー ソリューション)](https://download.microsoft.com/download/9/5/6/956FEDC3-702D-4EFB-A7D3-2DB7505566B6/SAP%20NetWeaver%20-%20Building%20an%20Azure%20based%20Disaster%20Recovery%20Solution%20V1_5%20.docx)」をダウンロードして、「4.3. SAP SPOF layer (ASCS) (4.3 SAP SPOF レイヤー (ASCS))」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8137d-267">For details about the build, copy, and test failover process, download [SAP NetWeaver: Building a Hyper-V and Microsoft Azure–based Disaster Recovery Solution](https://download.microsoft.com/download/9/5/6/956FEDC3-702D-4EFB-A7D3-2DB7505566B6/SAP%20NetWeaver%20-%20Building%20an%20Azure%20based%20Disaster%20Recovery%20Solution%20V1_5%20.docx), and refer to section 4.3, "SAP SPOF layer (ASCS)."</span></span> <span data-ttu-id="8137d-268">このドキュメントは、Windows で実行されている NetWeaver に適用されますが、Linux 用の同等の構成を作成することもできます。</span><span class="sxs-lookup"><span data-stu-id="8137d-268">This paper applies to NetWeaver running on Windows, but you can create the equivalent configuration for Linux.</span></span> <span data-ttu-id="8137d-269">セントラル サービスについては、[Azure Site Recovery](/en-us/azure/site-recovery/site-recovery-overview) を使用して、クラスター ノードとストレージをレプリケートします。</span><span class="sxs-lookup"><span data-stu-id="8137d-269">For Central Services, use [Azure Site Recovery](/en-us/azure/site-recovery/site-recovery-overview) to replicate the cluster nodes and storage.</span></span> <span data-ttu-id="8137d-270">Linux については、High Availability Extension を使用して、3 つのノード geo クラスターを作成します。</span><span class="sxs-lookup"><span data-stu-id="8137d-270">For Linux, create a three node geo-cluster using a High Availability Extension.</span></span>

- <span data-ttu-id="8137d-271">**SAP データベース層**。</span><span class="sxs-lookup"><span data-stu-id="8137d-271">**SAP database tier**.</span></span> <span data-ttu-id="8137d-272">HANA でサポートされているレプリケーションに対して HSR を使用します。</span><span class="sxs-lookup"><span data-stu-id="8137d-272">Use HSR for HANA-supported replication.</span></span> <span data-ttu-id="8137d-273">2 ノードのローカル高可用性セットアップのほかに、HSR では多層レプリケーションがサポートされます。このレプリケーションで、切り離された Azure リージョンの 3 つ目のノードは、クラスターの一部としてではなく、外部エンティティとして動作し、そのレプリケーション ターゲットとして、クラスター化された HSR ペアのセカンダリ レプリカに登録します。</span><span class="sxs-lookup"><span data-stu-id="8137d-273">In addition to a local, two-node high availability setup, HSR supports multi-tier replication where a third node in a separate Azure region acts as a foreign entity, not part of the cluster, and registers to the secondary replica of the clustered HSR pair as its replication target.</span></span> <span data-ttu-id="8137d-274">これにより、レプリケーション デイジー チェーンが形成されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-274">This form a replication daisy chain.</span></span> <span data-ttu-id="8137d-275">DR ノードへのフェールオーバーは、手動プロセスです。</span><span class="sxs-lookup"><span data-stu-id="8137d-275">The failover to the DR node is a manual process.</span></span>

<span data-ttu-id="8137d-276">Azure Site Recovery を使用して、ご自身の元のサイトが完全にレプリケートされた運用サイトを自動的に構築するには、カスタマイズされた[デプロイ スクリプト](/azure/site-recovery/site-recovery-runbook-automation)を実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8137d-276">To use Azure Site Recovery to automatically build a fully replicated production site of your original, you must run customized [deployment scripts](/azure/site-recovery/site-recovery-runbook-automation).</span></span> <span data-ttu-id="8137d-277">Site Recovery によって、最初に仮想マシンが可用性セットにデプロイされ、その後、ロード バランサーなどのリソースを追加するスクリプトが実行されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-277">Site Recovery first deploys the virtual machines in availability sets, then runs scripts to add resources such as load balancers.</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="8137d-278">管理容易性に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="8137d-278">Manageability considerations</span></span>

<span data-ttu-id="8137d-279">SAP HANA は、基本となる Azure インフラストラクチャを使用したバックアップ機能を備えています。</span><span class="sxs-lookup"><span data-stu-id="8137d-279">SAP HANA has a backup feature that makes use of the underlying Azure infrastructure.</span></span> <span data-ttu-id="8137d-280">Azure 仮想マシンで実行されている SAP HANA データベースをバックアップするために、SAP HANA スナップショットと Azure ストレージ スナップショットの両方が、バックアップ ファイルの一貫性を確保するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-280">To back up the SAP HANA database running on Azure virtual machines, both the SAP HANA snapshot and Azure storage snapshot are used to ensure the backup files' consistency.</span></span> <span data-ttu-id="8137d-281">詳細については、「[Azure Virtual Machines 上の SAP HANA のバックアップ ガイド](/azure/virtual-machines/workloads/sap/sap-hana-backup-guide)」および「[Azure Backup サービスについての質問](/azure/backup/backup-azure-backup-faq)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8137d-281">For details, see [Backup guide for SAP HANA on Azure Virtual Machines](/azure/virtual-machines/workloads/sap/sap-hana-backup-guide) and the [Azure Backup service FAQ](/azure/backup/backup-azure-backup-faq).</span></span> <span data-ttu-id="8137d-282">Azure ストレージ スナップショットをサポートするのは、HANA の単一コンテナー デプロイだけです。</span><span class="sxs-lookup"><span data-stu-id="8137d-282">Only HANA single container deployments support Azure storage snapshot.</span></span>

### <a name="identity-management"></a><span data-ttu-id="8137d-283">ID 管理</span><span class="sxs-lookup"><span data-stu-id="8137d-283">Identity management</span></span>

<span data-ttu-id="8137d-284">すべてのレベルで一元化された ID 管理システムを使用して、リソースへのアクセスを制御します。</span><span class="sxs-lookup"><span data-stu-id="8137d-284">Control access to resources by using a centralized identity management system at all levels:</span></span>

- <span data-ttu-id="8137d-285">[ロールベースのアクセス制御](/azure/active-directory/role-based-access-control-what-is) (RBAC) を使用して、Azure リソースへのアクセスを提供します。</span><span class="sxs-lookup"><span data-stu-id="8137d-285">Provide access to Azure resources through [role-based access control](/azure/active-directory/role-based-access-control-what-is) (RBAC).</span></span>
- <span data-ttu-id="8137d-286">LDAP、Azure Active Directory、Kerberos、または他のシステム介して Azure VM へのアクセスを許可します。</span><span class="sxs-lookup"><span data-stu-id="8137d-286">Grant access to Azure VMs through LDAP, Azure Active Directory, Kerberos, or another system.</span></span>
- <span data-ttu-id="8137d-287">SAP が提供するサービスを介してアプリ自体でアクセスをサポートするか、[OAuth 2.0 と Azure Active Directory](/azure/active-directory/develop/active-directory-protocols-oauth-code) を使用します。</span><span class="sxs-lookup"><span data-stu-id="8137d-287">Support access within the apps themselves through the services that SAP provides, or use [OAuth 2.0 and Azure Active Directory](/azure/active-directory/develop/active-directory-protocols-oauth-code).</span></span>

### <a name="monitoring"></a><span data-ttu-id="8137d-288">監視</span><span class="sxs-lookup"><span data-stu-id="8137d-288">Monitoring</span></span>

<span data-ttu-id="8137d-289">Azure には、インフラストラクチャ全体の[監視と診断](/azure/architecture/best-practices/monitoring)を行うための機能が複数用意されています。</span><span class="sxs-lookup"><span data-stu-id="8137d-289">Azure provides several functions for [monitoring and diagnostics](/azure/architecture/best-practices/monitoring) of the overall infrastructure.</span></span> <span data-ttu-id="8137d-290">また、Azure 仮想マシン (Linux または Windows) の高度な監視は、Azure Operations Management Suite (OMS) で処理されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-290">Also, enhanced monitoring of Azure virtual machines (Linux or Windows) is handled by Azure Operations Management Suite (OMS).</span></span>

<span data-ttu-id="8137d-291">SAP インフラストラクチャのリソースとサービス パフォーマンスの SAP ベースの監視には、[Azure SAP Enhanced Monitoring](/azure/virtual-machines/workloads/sap/deployment-guide#d98edcd3-f2a1-49f7-b26a-07448ceb60ca) 拡張機能が使用されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-291">To provide SAP-based monitoring of resources and service performance of the SAP infrastructure, the [Azure SAP Enhanced Monitoring](/azure/virtual-machines/workloads/sap/deployment-guide#d98edcd3-f2a1-49f7-b26a-07448ceb60ca) extension is used.</span></span> <span data-ttu-id="8137d-292">この拡張機能では、Azure 監視統計情報をオペレーティング システムの監視と DBA Cockpit 機能のための SAP アプリケーションにフィードします。</span><span class="sxs-lookup"><span data-stu-id="8137d-292">This extension feeds Azure monitoring statistics into the SAP application for operating system monitoring and DBA Cockpit functions.</span></span> <span data-ttu-id="8137d-293">SAP の拡張された監視機能は、Azure で SAP を実行するうえで必須の前提条件です。</span><span class="sxs-lookup"><span data-stu-id="8137d-293">SAP enhanced monitoring is a mandatory prerequisite to run SAP on Azure.</span></span> <span data-ttu-id="8137d-294">詳細については、[SAP Note 2191498](https://launchpad.support.sap.com/#/notes/2191498) の「SAP on Linux with Azure:Enhanced Monitoring (Azure を使用した Linux 上の SAP: 拡張された監視機能)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8137d-294">For details, see [SAP Note 2191498](https://launchpad.support.sap.com/#/notes/2191498) – "SAP on Linux with Azure: Enhanced Monitoring."</span></span>

## <a name="security-considerations"></a><span data-ttu-id="8137d-295">セキュリティに関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="8137d-295">Security considerations</span></span>

<span data-ttu-id="8137d-296">SAP は、SAP アプリケーション内でのロールベース アクセスと承認を制御するために、独自のユーザー管理エンジン (UME) を備えています。</span><span class="sxs-lookup"><span data-stu-id="8137d-296">SAP has its own Users Management Engine (UME) to control role-based access and authorization within the SAP application.</span></span> <span data-ttu-id="8137d-297">詳細については、「[SAP HANA Security &mdash; An Overview](https://archive.sap.com/documents/docs/DOC-62943)」(SAP HANA のセキュリティ - 概要) を参照してください (アクセスするには、SAP Service Marketplace アカウントが必要です)。</span><span class="sxs-lookup"><span data-stu-id="8137d-297">For details, see [SAP HANA Security  &mdash;  An Overview](https://archive.sap.com/documents/docs/DOC-62943) (SAP Service Marketplace account required for access.)</span></span>

<span data-ttu-id="8137d-298">追加のネットワーク セキュリティについては、[ネットワーク DMZ](/azure/architecture/reference-architectures/dmz/secure-vnet-hybrid) を実装することを検討します。これにより、ネットワーク仮想アプライアンスを使用して、Web Dispatcher および Fiori Front-End Server プールのサブネットの外側にファイアウォールが作成されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-298">For additional network security, consider implementing a [Network DMZ](/azure/architecture/reference-architectures/dmz/secure-vnet-hybrid), which uses a network virtual appliance to create a firewall in front of the subnet for Web Dispatcher and Fiori Front-End Server pools.</span></span>

<span data-ttu-id="8137d-299">インフラストラクチャ セキュリティでは、データは転送時および保存時に暗号化されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-299">For infrastructure security, data is encrypted in transit and at rest.</span></span> <span data-ttu-id="8137d-300">[Azure Virtual Machines 上の SAP NetWeaver の計画と実装に関するガイド](/azure/virtual-machines/workloads/sap/planning-guide)の「セキュリティに関する考慮事項」セクションでは、冒頭にネットワーク セキュリティへの対応について記述されています。このセクションは S/4HANA に適用されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-300">The "Security considerations" section of the [SAP NetWeaver on Azure Virtual Machines–Planning and Implementation Guide](/azure/virtual-machines/workloads/sap/planning-guide) begins to address network security and applies to S/4HANA.</span></span> <span data-ttu-id="8137d-301">また、このガイドでは、アプリケーション通信を許可するために、ファイアウォールで開く必要があるネットワーク ポートも指定しています。</span><span class="sxs-lookup"><span data-stu-id="8137d-301">The guide also specifies the network ports you must open on the firewalls to allow application communication.</span></span>

<span data-ttu-id="8137d-302">Linux IaaS 仮想マシン ディスクを暗号化するには、[Azure Disk Encryption](/azure/security/azure-security-disk-encryption) を使用できます。</span><span class="sxs-lookup"><span data-stu-id="8137d-302">To encrypt Linux IaaS virtual machine disks, you can use [Azure Disk Encryption](/azure/security/azure-security-disk-encryption).</span></span> <span data-ttu-id="8137d-303">この場合、Linux の DM-Crypt 機能によって、オペレーティング システムおよびデータ ディスクのボリュームが暗号化されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-303">It uses the DM-Crypt feature of Linux to provide volume encryption for the operating system and the data disks.</span></span> <span data-ttu-id="8137d-304">また、このソリューションは Azure Key Vault と共に動作するため、お使いのキー コンテナー サブスクリプションのディスク暗号化キーとシークレットの制御および管理にも役立ちます。</span><span class="sxs-lookup"><span data-stu-id="8137d-304">The solution also works with Azure Key Vault to help you control and manage the disk-encryption keys and secrets in your key vault subscription.</span></span> <span data-ttu-id="8137d-305">仮想マシンのディスク上のデータは暗号化され、お使いの Azure ストレージに保存されます。</span><span class="sxs-lookup"><span data-stu-id="8137d-305">Data on the virtual machine disks are encrypted at rest in your Azure storage.</span></span>

<span data-ttu-id="8137d-306">保存されている SAP HANA データの暗号化には、SAP HANA のネイティブ暗号化テクノロジを使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="8137d-306">For SAP HANA data-at-rest encryption, we recommend using the SAP HANA native encryption technology.</span></span>

> [!NOTE]
> <span data-ttu-id="8137d-307">同じサーバー上の Azure Disk Encryption には、保存されている HANA データの暗号化を使用しないでください。</span><span class="sxs-lookup"><span data-stu-id="8137d-307">Do not use the HANA data-at-rest encryption with Azure Disk Encryption on the same server.</span></span> <span data-ttu-id="8137d-308">HANA については、HANA データの暗号化のみを使用します。</span><span class="sxs-lookup"><span data-stu-id="8137d-308">For HANA, use only HANA data encryption.</span></span>

## <a name="communities"></a><span data-ttu-id="8137d-309">コミュニティ</span><span class="sxs-lookup"><span data-stu-id="8137d-309">Communities</span></span>

<span data-ttu-id="8137d-310">コミュニティは質問に答え、デプロイを正常に完了できるよう支援します。</span><span class="sxs-lookup"><span data-stu-id="8137d-310">Communities can answer questions and help you set up a successful deployment.</span></span> <span data-ttu-id="8137d-311">以下、具体例に沿って説明します。</span><span class="sxs-lookup"><span data-stu-id="8137d-311">Consider the following:</span></span>

- [<span data-ttu-id="8137d-312">Microsoft プラットフォームでの SAP アプリケーションの実行 (ブログ)</span><span class="sxs-lookup"><span data-stu-id="8137d-312">Running SAP Applications on the Microsoft Platform Blog</span></span>](https://blogs.msdn.microsoft.com/saponsqlserver/2017/05/04/sap-on-azure-general-update-for-customers-partners-april-2017/)
- [<span data-ttu-id="8137d-313">Azure コミュニティ サポート</span><span class="sxs-lookup"><span data-stu-id="8137d-313">Azure Community Support</span></span>](https://azure.microsoft.com/support/community/)
- [<span data-ttu-id="8137d-314">SAP Community</span><span class="sxs-lookup"><span data-stu-id="8137d-314">SAP Community</span></span>](https://www.sap.com/community.html)
- [<span data-ttu-id="8137d-315">Stack Overflow</span><span class="sxs-lookup"><span data-stu-id="8137d-315">Stack Overflow</span></span>](https://stackoverflow.com/tags/sap/)

## <a name="related-resources"></a><span data-ttu-id="8137d-316">関連リソース</span><span class="sxs-lookup"><span data-stu-id="8137d-316">Related resources</span></span>

<span data-ttu-id="8137d-317">同じテクノロジの一部を使用する具体的なソリューションを示す次の [Azure のサンプル シナリオ](/azure/architecture/example-scenario)をレビューできます。</span><span class="sxs-lookup"><span data-stu-id="8137d-317">You may wish to review the following [Azure example scenarios](/azure/architecture/example-scenario) that demonstrate specific solutions using some of the same technologies:</span></span>

- [<span data-ttu-id="8137d-318">Azure での Oracle Database を使用した SAP 運用環境ワークロードの実行</span><span class="sxs-lookup"><span data-stu-id="8137d-318">Running SAP production workloads using an Oracle Database on Azure</span></span>](/azure/architecture/example-scenario/apps/sap-production)
- [<span data-ttu-id="8137d-319">Azure での SAP ワークロード向けの開発/テスト環境</span><span class="sxs-lookup"><span data-stu-id="8137d-319">Dev/test environments for SAP workloads on Azure</span></span>](/azure/architecture/example-scenario/apps/sap-dev-test)

<!-- links -->

[visio-download]: https://archcenter.blob.core.windows.net/cdn/sap-reference-architectures.vsdx
