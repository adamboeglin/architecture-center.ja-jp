---
title: AnyDB 向けの SAP NetWeaver (Windows) を Azure VM にデプロイする
titleSuffix: Azure Reference Architectures
description: 高可用性を備えた Azure の Linux環境で SAP S/4HANA を実行するための実証済みプラクティス。
author: lbrader
ms.date: 08/03/2018
ms.topic: reference-architecture
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: seodec18, SAP, Windows
ms.openlocfilehash: a93ceead8d160e8c0d0915abeb5e78782190efd6
ms.sourcegitcommit: c053e6edb429299a0ad9b327888d596c48859d4a
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/20/2019
ms.locfileid: "58248099"
---
# <a name="deploy-sap-netweaver-windows-for-anydb-on-azure-virtual-machines"></a><span data-ttu-id="e335d-103">AnyDB 向けの SAP NetWeaver (Windows) を Azure 仮想マシンにデプロイする</span><span class="sxs-lookup"><span data-stu-id="e335d-103">Deploy SAP NetWeaver (Windows) for AnyDB on Azure virtual machines</span></span>

<span data-ttu-id="e335d-104">この参照用アーキテクチャは、高可用性を備えた Azure の Windows 環境で SAP NetWeaver を実行するための一連の実証済みプラクティスを示しています。</span><span class="sxs-lookup"><span data-stu-id="e335d-104">This reference architecture shows a set of proven practices for running SAP NetWeaver in a Windows environment on Azure with high availability.</span></span> <span data-ttu-id="e335d-105">データベースは AnyDB (SAP HANA を除く、サポートされている任意の DBMS を表す SAP 用語) です。</span><span class="sxs-lookup"><span data-stu-id="e335d-105">The database is AnyDB, the SAP term for any supported DBMS besides SAP HANA.</span></span> <span data-ttu-id="e335d-106">このアーキテクチャは特定の仮想マシン (VM) サイズでデプロイされ、お客様の組織のニーズに合わせて変更できます。</span><span class="sxs-lookup"><span data-stu-id="e335d-106">This architecture is deployed with specific virtual machine (VM) sizes that can be changed to accommodate your organization's needs.</span></span>

![Azure VM 上の AnyDB 向けの SAP NetWeaver (Windows) の参照アーキテクチャ](./images/sap-netweaver.png)

<span data-ttu-id="e335d-108">"*このアーキテクチャの [Visio ファイル][visio-download]をダウンロードします。*"</span><span class="sxs-lookup"><span data-stu-id="e335d-108">*Download a [Visio file][visio-download] of this architecture.*</span></span>

> [!NOTE]
> <span data-ttu-id="e335d-109">この参照用アーキテクチャをデプロイするには、SAP 製品と他の Microsoft 以外のテクノロジの適切なライセンスが必要です。</span><span class="sxs-lookup"><span data-stu-id="e335d-109">Deploying this reference architecture requires appropriate licensing of SAP products and other non-Microsoft technologies.</span></span>

## <a name="architecture"></a><span data-ttu-id="e335d-110">アーキテクチャ</span><span class="sxs-lookup"><span data-stu-id="e335d-110">Architecture</span></span>

<span data-ttu-id="e335d-111">このアーキテクチャは、次のインフラストラクチャ コンポーネントと主要ソフトウェア コンポーネントで構成されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-111">The architecture consists of the following infrastructure and key software components.</span></span>

<span data-ttu-id="e335d-112">**Virtual network**。</span><span class="sxs-lookup"><span data-stu-id="e335d-112">**Virtual network**.</span></span> <span data-ttu-id="e335d-113">Azure Virtual Network サービスによって、Azure リソースが安全に相互接続されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-113">The Azure Virtual Network service securely connects Azure resources to each other.</span></span> <span data-ttu-id="e335d-114">このアーキテクチャでは、仮想ネットワークは、[ハブスポーク](../hybrid-networking/hub-spoke.md)のハブにデプロイされた VPN ゲートウェイ経由でオンプレミス環境に接続されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-114">In this architecture, the virtual network connects to an on-premises environment through a VPN gateway deployed in the hub of a [hub-spoke](../hybrid-networking/hub-spoke.md).</span></span> <span data-ttu-id="e335d-115">スポークは、SAP アプリケーションおよびデータベース層に使用される仮想ネットワークです。</span><span class="sxs-lookup"><span data-stu-id="e335d-115">The spoke is the virtual network used for the SAP applications and database tier.</span></span>

<span data-ttu-id="e335d-116">**サブネット**。</span><span class="sxs-lookup"><span data-stu-id="e335d-116">**Subnets**.</span></span> <span data-ttu-id="e335d-117">仮想ネットワークは、階層 (アプリケーション (SAP NetWeaver) 層、データベース層、共有サービス (Jumpbox) 層、Active Directory 層) ごとに個別のサブネットに分割されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-117">The virtual network is subdivided into separate subnets for each tier: application (SAP NetWeaver), database, shared services (the jumpbox), and Active Directory.</span></span>

<span data-ttu-id="e335d-118">**仮想マシン**。</span><span class="sxs-lookup"><span data-stu-id="e335d-118">**Virtual machines**.</span></span> <span data-ttu-id="e335d-119">このアーキテクチャでは、アプリケーション層とデータベース層に仮想マシンが使用され、次のようにグループ化されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-119">This architecture uses virtual machines for the application tier and database tier, grouped as follows:</span></span>

- <span data-ttu-id="e335d-120">**SAP NetWeaver**。</span><span class="sxs-lookup"><span data-stu-id="e335d-120">**SAP NetWeaver**.</span></span> <span data-ttu-id="e335d-121">アプリケーション層では Windows 仮想マシンが使用され、SAP セントラル サービスと SAP アプリケーション サーバーが実行されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-121">The application tier uses Windows virtual machines and runs SAP Central Services and SAP application servers.</span></span> <span data-ttu-id="e335d-122">セントラル サービスを実行する VM は、高可用性のために Windows Server フェールオーバー クラスターとして構成され、SIOS DataKeeper Cluster Edition によってサポートされます。</span><span class="sxs-lookup"><span data-stu-id="e335d-122">The VMs that run Central Services are configured as a Windows Server Failover Cluster for high availability, supported by SIOS DataKeeper Cluster Edition.</span></span>
- <span data-ttu-id="e335d-123">**AnyDB**。</span><span class="sxs-lookup"><span data-stu-id="e335d-123">**AnyDB**.</span></span> <span data-ttu-id="e335d-124">データベース層では、AnyDB (Microsoft SQL Server、Oracle、IBM DB2 など) がソース データベースとして実行されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-124">The database tier runs AnyDB as the source database, such as Microsoft SQL Server, Oracle, or IBM DB2.</span></span>
- <span data-ttu-id="e335d-125">**Jumpbox**。</span><span class="sxs-lookup"><span data-stu-id="e335d-125">**Jumpbox**.</span></span> <span data-ttu-id="e335d-126">要塞ホストとも呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="e335d-126">Also called a bastion host.</span></span> <span data-ttu-id="e335d-127">これは、他の仮想マシンに接続するために管理者が使用するネットワークの安全な仮想マシンです。</span><span class="sxs-lookup"><span data-stu-id="e335d-127">This is a secure virtual machine on the network that administrators use to connect to the other virtual machines.</span></span>
- <span data-ttu-id="e335d-128">**Windows Server Active Directory ドメイン コントローラー**。</span><span class="sxs-lookup"><span data-stu-id="e335d-128">**Windows Server Active Directory domain controllers**.</span></span> <span data-ttu-id="e335d-129">ドメイン コントローラーは、ドメイン内のすべての VM とユーザーで使用されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-129">The domain controllers are used on all VMs and users in the domain.</span></span>

<span data-ttu-id="e335d-130">**ロード バランサー**。</span><span class="sxs-lookup"><span data-stu-id="e335d-130">**Load balancers**.</span></span> <span data-ttu-id="e335d-131">[Azure Load Balancer](/azure/load-balancer/load-balancer-overview) インスタンスは、アプリケーション層サブネット内の仮想マシンにトラフィックを分散させるときに使用されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-131">[Azure Load Balancer](/azure/load-balancer/load-balancer-overview) instances are used to distribute traffic to virtual machines in the application tier subnet.</span></span> <span data-ttu-id="e335d-132">データ層では、DBMS に応じて、組み込みの SAP ロード バランサー、Azure Load Balancer、またはその他のメカニズムを使用して高可用性を実現できます。</span><span class="sxs-lookup"><span data-stu-id="e335d-132">At the data tier, high availability may be achieved using built-in SAP load balancers, Azure Load Balancer, or other mechanisms, depending on the DBMS.</span></span> <span data-ttu-id="e335d-133">詳細については、「[SAP NetWeaver のための Azure Virtual Machines DBMS のデプロイ](/azure/virtual-machines/workloads/sap/dbms-guide)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e335d-133">For more information, see [Azure Virtual Machines DBMS deployment for SAP NetWeaver](/azure/virtual-machines/workloads/sap/dbms-guide).</span></span>

<span data-ttu-id="e335d-134">**可用性セット**。</span><span class="sxs-lookup"><span data-stu-id="e335d-134">**Availability sets**.</span></span> <span data-ttu-id="e335d-135">SAP Web Dispatcher、SAP アプリケーション サーバー、および (A) SCS ロールの仮想マシンが個別の[可用性セット](/azure/virtual-machines/windows/tutorial-availability-sets)にグループ化され、ロールごとに少なくとも 2 つの仮想マシンがプロビジョニングされます。</span><span class="sxs-lookup"><span data-stu-id="e335d-135">Virtual machines for the SAP Web Dispatcher, SAP application server, and (A)SCS, roles are grouped into separate [availability sets](/azure/virtual-machines/windows/tutorial-availability-sets), and at least two virtual machines are provisioned per role.</span></span> <span data-ttu-id="e335d-136">これにより、仮想マシンが、より高度な[サービス レベル アグリーメント](https://azure.microsoft.com/support/legal/sla/virtual-machines) (SLA) に対応できるようになります。</span><span class="sxs-lookup"><span data-stu-id="e335d-136">This makes the virtual machines eligible for a higher [service level agreement](https://azure.microsoft.com/support/legal/sla/virtual-machines) (SLA).</span></span>

<span data-ttu-id="e335d-137">**NIC**。</span><span class="sxs-lookup"><span data-stu-id="e335d-137">**NICs**.</span></span> <span data-ttu-id="e335d-138">[ネットワーク インターフェイス カード](/azure/virtual-network/virtual-network-network-interface) (NIC) により、仮想ネットワーク上の仮想マシンのすべての通信が有効になります。</span><span class="sxs-lookup"><span data-stu-id="e335d-138">[Network interface cards](/azure/virtual-network/virtual-network-network-interface) (NICs) enable all communication of virtual machines on a virtual network.</span></span>

<span data-ttu-id="e335d-139">**ネットワーク セキュリティ グループ**。</span><span class="sxs-lookup"><span data-stu-id="e335d-139">**Network security groups**.</span></span> <span data-ttu-id="e335d-140">仮想ネットワークの受信トラフィック、送信トラフィック、およびサブネット間トラフィックを制限するために、[ネットワーク セキュリティ グループ](/azure/virtual-network/virtual-networks-nsg) (NSG) を作成できます。</span><span class="sxs-lookup"><span data-stu-id="e335d-140">To restrict incoming, outgoing, and intra-subnet traffic in the virtual network, you can create [network security groups](/azure/virtual-network/virtual-networks-nsg) (NSGs).</span></span>

<span data-ttu-id="e335d-141">**ゲートウェイ**。</span><span class="sxs-lookup"><span data-stu-id="e335d-141">**Gateway**.</span></span> <span data-ttu-id="e335d-142">ゲートウェイにより、オンプレミス ネットワークが Azure 仮想ネットワークに拡張されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-142">A gateway extends your on-premises network to the Azure virtual network.</span></span> <span data-ttu-id="e335d-143">[ExpressRoute](/azure/architecture/reference-architectures/hybrid-networking/expressroute) は、パブリック インターネットを経由しないプライベート接続を作成するための推奨 Azure サービスですが、[サイト間](/azure/vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal)接続を使用することもできます。</span><span class="sxs-lookup"><span data-stu-id="e335d-143">[ExpressRoute](/azure/architecture/reference-architectures/hybrid-networking/expressroute) is the recommended Azure service for creating private connections that do not go over the public Internet, but a [Site-to-Site](/azure/vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal) connection can also be used.</span></span>

<span data-ttu-id="e335d-144">**Azure Storage**。</span><span class="sxs-lookup"><span data-stu-id="e335d-144">**Azure Storage**.</span></span> <span data-ttu-id="e335d-145">仮想マシンの仮想ハード ディスク (VHD) の永続的ストレージを提供するには、[Azure Storage](/azure/storage/storage-standard-storage) が必要です。</span><span class="sxs-lookup"><span data-stu-id="e335d-145">To provide persistent storage of a virtual machine's virtual hard disk (VHD), [Azure Storage](/azure/storage/storage-standard-storage) is required.</span></span> <span data-ttu-id="e335d-146">これは、フェールオーバー クラスター操作を実装するために、[クラウド監視](/windows-server/failover-clustering/deploy-cloud-witness)によっても使用されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-146">It is also used by [Cloud Witness](/windows-server/failover-clustering/deploy-cloud-witness) to implement a failover cluster operation.</span></span>

## <a name="recommendations"></a><span data-ttu-id="e335d-147">Recommendations</span><span class="sxs-lookup"><span data-stu-id="e335d-147">Recommendations</span></span>

<span data-ttu-id="e335d-148">実際の要件は、ここで説明するアーキテクチャとは異なる場合があります。</span><span class="sxs-lookup"><span data-stu-id="e335d-148">Your requirements might differ from the architecture described here.</span></span> <span data-ttu-id="e335d-149">これらの推奨事項を開始点として使用してください。</span><span class="sxs-lookup"><span data-stu-id="e335d-149">Use these recommendations as a starting point.</span></span>

### <a name="sap-web-dispatcher-pool"></a><span data-ttu-id="e335d-150">SAP Web Dispatcher プール</span><span class="sxs-lookup"><span data-stu-id="e335d-150">SAP Web Dispatcher pool</span></span>

<span data-ttu-id="e335d-151">Web Dispatcher コンポーネントは、SAP アプリケーション サーバー間の SAP トラフィックのロード バランサーとして使用されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-151">The Web Dispatcher component is used as a load balancer for SAP traffic among the SAP application servers.</span></span> <span data-ttu-id="e335d-152">Web Dispatcher コンポーネントの高可用性は、Azure Load Balancer を使って、並列 Web Dispatcher セットアップを実装することで実現します。</span><span class="sxs-lookup"><span data-stu-id="e335d-152">To achieve high availability for the Web Dispatcher component, Azure Load Balancer is used to implement the parallel Web Dispatcher setup.</span></span> <span data-ttu-id="e335d-153">Web Dispatcher は、バランサー プール内で使用可能な Web Dispatcher での HTTP (S) トラフィック分散のために、ラウンドロビン構成で使用されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-153">Web Dispatcher uses in a round-robin configuration for HTTP(S) traffic distribution among the available Web Dispatchers in the balancers pool.</span></span>

<span data-ttu-id="e335d-154">Azure VM での SAP NetWeaver の実行の詳細については、「[SAP NetWeaver のための Azure Virtual Machines の計画と実装](/azure/virtual-machines/workloads/sap/planning-guide)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e335d-154">For details about running SAP NetWeaver in Azure VMs, see [Azure Virtual Machines planning and implementation for SAP NetWeaver](/azure/virtual-machines/workloads/sap/planning-guide).</span></span>

### <a name="application-servers-pool"></a><span data-ttu-id="e335d-155">アプリケーション サーバー プール</span><span class="sxs-lookup"><span data-stu-id="e335d-155">Application servers pool</span></span>

<span data-ttu-id="e335d-156">ABAP アプリケーション サーバーのログオン グループの管理には、SMLG トランザクションが使用されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-156">To manage logon groups for ABAP application servers, the SMLG transaction is used.</span></span> <span data-ttu-id="e335d-157">この場合、セントラル サービスのメッセージ サーバー内の負荷分散機能を使って、SAPGUI および RFC トラフィックの SAP アプリケーション サーバーのプールにワークロードが分散されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-157">It uses the load balancing function within the message server of the Central Services to distribute workload among SAP application servers pool for SAPGUIs and RFC traffic.</span></span> <span data-ttu-id="e335d-158">アプリケーション サーバーは、クラスター仮想ネットワーク名を介して高可用性セントラル サービスに接続されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-158">The application server connection to the highly available Central Services is through the cluster virtual network name.</span></span>

### <a name="sap-central-services-cluster"></a><span data-ttu-id="e335d-159">SAP セントラル サービス クラスター</span><span class="sxs-lookup"><span data-stu-id="e335d-159">SAP Central Services cluster</span></span>

<span data-ttu-id="e335d-160">この参照アーキテクチャでは、アプリケーション層の VM でセントラル サービスが実行されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-160">This reference architecture runs Central Services on VMs in the application tier.</span></span> <span data-ttu-id="e335d-161">セントラル サービスは、1 つの VM にデプロイすると単一障害点 (SPOF) になる可能性があります (これは高可用性が不要な場合の一般的なデプロイです)。</span><span class="sxs-lookup"><span data-stu-id="e335d-161">The Central Services is a potential single point of failure (SPOF) when deployed to a single VM &mdash; a typical deployment when high availability is not a requirement.</span></span> <span data-ttu-id="e335d-162">高可用性ソリューションを実装するには、共有ディスク クラスターまたはファイル共有クラスターのいずれかを使用します。</span><span class="sxs-lookup"><span data-stu-id="e335d-162">To implement a high availability solution, use either a shared disk cluster or a file share cluster.</span></span>

<span data-ttu-id="e335d-163">共有ディスク クラスター用に VM を構成するには、[Windows Server フェールオーバー クラスター](https://blogs.sap.com/2018/01/25/how-to-create-sap-resources-in-windows-failover-cluster/)を使用します。</span><span class="sxs-lookup"><span data-stu-id="e335d-163">To configure VMs for a shared disk cluster, use [Windows Server Failover Cluster](https://blogs.sap.com/2018/01/25/how-to-create-sap-resources-in-windows-failover-cluster/).</span></span> <span data-ttu-id="e335d-164">クォーラム監視として[クラウド監視](/windows-server/failover-clustering/deploy-cloud-witness)をお勧めします。</span><span class="sxs-lookup"><span data-stu-id="e335d-164">[Cloud Witness](/windows-server/failover-clustering/deploy-cloud-witness) is recommended as a quorum witness.</span></span> <span data-ttu-id="e335d-165">フェールオーバー クラスター環境をサポートするために、[SIOS DataKeeper クラスター エディション](https://azuremarketplace.microsoft.com/marketplace/apps/sios_datakeeper.sios-datakeeper-8)では、クラスター ノードが所有する独立したディスクをレプリケートすることによって、クラスターの共有ボリューム機能が実行されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-165">To support the failover cluster environment, [SIOS DataKeeper Cluster Edition](https://azuremarketplace.microsoft.com/marketplace/apps/sios_datakeeper.sios-datakeeper-8) performs the cluster shared volume function by replicating independent disks owned by the cluster nodes.</span></span> <span data-ttu-id="e335d-166">Azure では共有ディスクがネイティブでサポートされていないため、SIOS 提供のソリューションが必要です。</span><span class="sxs-lookup"><span data-stu-id="e335d-166">Azure does not natively support shared disks and therefore requires solutions provided by SIOS.</span></span>

<span data-ttu-id="e335d-167">詳細については、</span><span class="sxs-lookup"><span data-stu-id="e335d-167">For details, see "3.</span></span> <span data-ttu-id="e335d-168">「[Running SAP applications on the Microsoft platform (Microsoft プラットフォーム上での SAP アプリケーションの実行)](https://blogs.msdn.microsoft.com/saponsqlserver/2017/05/04/sap-on-azure-general-update-for-customers-partners-april-2017/)」で、Azure の SIOS で ASCS を実行する SAP のお客様向けの重要な更新に関するトピックをご覧ください。</span><span class="sxs-lookup"><span data-stu-id="e335d-168">Important Update for SAP Customers Running ASCS on SIOS on Azure” at [Running SAP applications on the Microsoft platform](https://blogs.msdn.microsoft.com/saponsqlserver/2017/05/04/sap-on-azure-general-update-for-customers-partners-april-2017/).</span></span>

<span data-ttu-id="e335d-169">Windows Server フェールオーバー クラスターを使ってファイル共有クラスターを実装して、クラスタリングを処理することもできます。</span><span class="sxs-lookup"><span data-stu-id="e335d-169">Another way to handle clustering is to implement a file share cluster using Windows Server Failover Cluster.</span></span> <span data-ttu-id="e335d-170">[SAP](https://blogs.sap.com/2018/03/19/migration-from-a-shared-disk-cluster-to-a-file-share-cluster/) では、UNC パスを介して /sapmnt グローバル ディレクトリにアクセスするための、セントラル サービス デプロイ パターンを最近変更しました。</span><span class="sxs-lookup"><span data-stu-id="e335d-170">[SAP](https://blogs.sap.com/2018/03/19/migration-from-a-shared-disk-cluster-to-a-file-share-cluster/) recently modified the Central Services deployment pattern to access the /sapmnt global directories via a UNC path.</span></span> <span data-ttu-id="e335d-171">この変更により、セントラル サービス VM の SIOS または他の共有ディスク ソリューションに関する[要件がなくなりました](https://blogs.msdn.microsoft.com/saponsqlserver/2017/08/10/high-available-ascs-for-windows-on-file-share-shared-disk-no-longer-required/)。</span><span class="sxs-lookup"><span data-stu-id="e335d-171">This change [removes the requirement](https://blogs.msdn.microsoft.com/saponsqlserver/2017/08/10/high-available-ascs-for-windows-on-file-share-shared-disk-no-longer-required/) for SIOS or other shared disk solutions on the Central Services VMs.</span></span> <span data-ttu-id="e335d-172">ただし、/sapmnt UNC 共有の[高可用性](https://blogs.sap.com/2017/07/21/how-to-create-a-high-available-sapmnt-share/)は確保することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="e335d-172">It is still recommended to ensure that the /sapmnt UNC share is [highly available](https://blogs.sap.com/2017/07/21/how-to-create-a-high-available-sapmnt-share/).</span></span> <span data-ttu-id="e335d-173">セントラル サービス インスタンスでこれを実現するには、Windows Server フェールオーバー クラスターと、Windows Server 2016 で[スケールアウト ファイル サーバー](https://blogs.msdn.microsoft.com/saponsqlserver/2017/11/14/file-server-with-sofs-and-s2d-as-an-alternative-to-cluster-shared-disk-for-clustering-of-an-sap-ascs-instance-in-azure-is-generally-available/) (SOFS) および[記憶域スペース ダイレクト](https://blogs.sap.com/2018/03/07/your-sap-on-azure-part-5-ascs-high-availability-with-storage-spaces-direct/) (S2D) 機能を使用します。</span><span class="sxs-lookup"><span data-stu-id="e335d-173">This can be done on the Central Services instance by using Windows Server Failover Cluster with [Scale Out File Server](https://blogs.msdn.microsoft.com/saponsqlserver/2017/11/14/file-server-with-sofs-and-s2d-as-an-alternative-to-cluster-shared-disk-for-clustering-of-an-sap-ascs-instance-in-azure-is-generally-available/) (SOFS) and the [Storage Spaces Direct](https://blogs.sap.com/2018/03/07/your-sap-on-azure-part-5-ascs-high-availability-with-storage-spaces-direct/) (S2D) feature in Windows Server 2016.</span></span>

### <a name="availability-sets"></a><span data-ttu-id="e335d-174">可用性セット</span><span class="sxs-lookup"><span data-stu-id="e335d-174">Availability sets</span></span>

<span data-ttu-id="e335d-175">可用性セットにより、サーバーがさまざまな物理インフラストラクチャおよび更新グループに分散され、サービスの可用性が向上します。</span><span class="sxs-lookup"><span data-stu-id="e335d-175">Availability sets distribute servers to different physical infrastructure and update groups to improve service availability.</span></span> <span data-ttu-id="e335d-176">同じロールを実行する仮想マシンを可用性セットに配置すると、Azure インフラストラクチャのメンテナンスに伴うダウンタイムを防ぎ、[サービス レベル アグリーメント](https://azure.microsoft.com/support/legal/sla/virtual-machines) (SLA) に準拠するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="e335d-176">Put virtual machines that perform the same role into an availability sets to help guard against downtime caused by Azure infrastructure maintenance and to meet [SLAs](https://azure.microsoft.com/support/legal/sla/virtual-machines) (SLAs).</span></span> <span data-ttu-id="e335d-177">可用性セットごとに複数の仮想マシンを配置することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="e335d-177">Two or more virtual machines per availability set is recommended.</span></span>

<span data-ttu-id="e335d-178">セット内の仮想マシンはすべて、同じロールを実行します。</span><span class="sxs-lookup"><span data-stu-id="e335d-178">All virtual machines in a set must perform the same role.</span></span> <span data-ttu-id="e335d-179">同じ可用性セットに異なるロールのサーバーを混在させないでください。</span><span class="sxs-lookup"><span data-stu-id="e335d-179">Do not mix servers of different roles in the same availability set.</span></span> <span data-ttu-id="e335d-180">たとえば、アプリケーション サーバーを含む可用性セットには、セントラル サービス ノードを配置しないでください。</span><span class="sxs-lookup"><span data-stu-id="e335d-180">For example, don't place a Central Services node in the same availability set with the application server.</span></span>

### <a name="nics"></a><span data-ttu-id="e335d-181">NIC</span><span class="sxs-lookup"><span data-stu-id="e335d-181">NICs</span></span>

<span data-ttu-id="e335d-182">従来のオンプレミスの SAP デプロイでは、管理トラフィックとビジネス トラフィックを切り離すために、マシンごとに複数のネットワーク インターフェイス カード (NIC) が実装されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-182">Traditional on-premises SAP deployments implement multiple network interface cards (NICs) per machine to segregate administrative traffic from business traffic.</span></span> <span data-ttu-id="e335d-183">Azure では、仮想ネットワークは、すべてのトラフィックを同じネットワーク ファブリック経由で送信するソフトウェア定義ネットワークです。</span><span class="sxs-lookup"><span data-stu-id="e335d-183">On Azure, the virtual network is a software-defined network that sends all traffic through the same network fabric.</span></span> <span data-ttu-id="e335d-184">したがって、複数の NIC を使用する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="e335d-184">Therefore, the use of multiple NICs is unnecessary.</span></span> <span data-ttu-id="e335d-185">ただし、お客様の組織がトラフィックを分離する必要がある場合は、VM ごとに複数の NIC をデプロイし、各 NIC をそれぞれ異なるサブネットに接続することで、NSG を使ってさまざまなアクセス制御ポリシーを強制できます。</span><span class="sxs-lookup"><span data-stu-id="e335d-185">However, if your organization needs to segregate traffic, you can deploy multiple NICs per VM, connect each NIC to a different subnet, and then use NSGs to enforce different access control policies.</span></span>

### <a name="subnets-and-nsgs"></a><span data-ttu-id="e335d-186">サブネットと NSG</span><span class="sxs-lookup"><span data-stu-id="e335d-186">Subnets and NSGs</span></span>

<span data-ttu-id="e335d-187">このアーキテクチャでは、仮想ネットワーク アドレス空間がサブネットに分割されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-187">This architecture subdivides the virtual network address space into subnets.</span></span> <span data-ttu-id="e335d-188">この参照アーキテクチャは、主に、主にアプリケーション層のサブネットに焦点を当てています。</span><span class="sxs-lookup"><span data-stu-id="e335d-188">This reference architecture focuses primarily on the application tier subnet.</span></span> <span data-ttu-id="e335d-189">各サブネットを、サブネットのアクセス ポリシーを定義する NSG に関連付けることができます。</span><span class="sxs-lookup"><span data-stu-id="e335d-189">Each subnet can be associated with a NSG that defines the access policies for the subnet.</span></span> <span data-ttu-id="e335d-190">アプリケーション サーバーは、切り離されたサブネットに配置してください。これにより管理対象が個別のサーバーではなく、サブネット セキュリティ ポリシーになるため、サーバーのセキュリティが確保しやすくなります。</span><span class="sxs-lookup"><span data-stu-id="e335d-190">Place application servers on a separate subnet so you can secure them more easily by managing the subnet security policies, not the individual servers.</span></span>

<span data-ttu-id="e335d-191">NSG がサブネットに関連付けられている場合、その NSG はサブネット内のすべてのサーバーに適用されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-191">When a NSG is associated with a subnet, it applies to all the servers within the subnet.</span></span> <span data-ttu-id="e335d-192">NSG を使用してサブネット内のサーバーをきめ細かく制御する方法の詳細については、[ネットワーク セキュリティ グループによるネットワーク トラフィックのフィルター処理](https://azure.microsoft.com/blog/multiple-vm-nics-and-network-virtual-appliances-in-azure)に関するページをご覧ください。</span><span class="sxs-lookup"><span data-stu-id="e335d-192">For more information about using NSGs for fine-grained control over the servers in a subnet, see [Filter network traffic with network security groups](https://azure.microsoft.com/blog/multiple-vm-nics-and-network-virtual-appliances-in-azure).</span></span>

### <a name="load-balancers"></a><span data-ttu-id="e335d-193">ロード バランサー</span><span class="sxs-lookup"><span data-stu-id="e335d-193">Load balancers</span></span>

<span data-ttu-id="e335d-194">[SAP Web Dispatcher](https://help.sap.com/doc/saphelp_nw73ehp1/7.31.19/en-US/48/8fe37933114e6fe10000000a421937/frameset.htm) では、SAP アプリケーション サーバー プールへの HTTP(S) トラフィックの負荷分散が処理されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-194">[SAP Web Dispatcher](https://help.sap.com/doc/saphelp_nw73ehp1/7.31.19/en-US/48/8fe37933114e6fe10000000a421937/frameset.htm) handles load balancing of HTTP(S) traffic to a pool of SAP application servers.</span></span>

<span data-ttu-id="e335d-195">DIAG プロトコルまたはリモート ファンクション コール (RFC) を使用して SAP サーバーに接続している SAP GUI クライアントからのトラフィックについては、セントラル サービスのメッセージ サーバーでは、SAP アプリケーション サーバーの[ログオン グループ](https://wiki.scn.sap.com/wiki/display/SI/ABAP+Logon+Group+based+Load+Balancing)を使用して負荷が分散されます。したがって、追加のロード バランサーは必要ありません。</span><span class="sxs-lookup"><span data-stu-id="e335d-195">For traffic from SAP GUI clients connecting a SAP server via DIAG protocol or Remote Function Calls (RFC), the Central Services message server balances the load through SAP application server [logon groups](https://wiki.scn.sap.com/wiki/display/SI/ABAP+Logon+Group+based+Load+Balancing), so no additional load balancer is needed.</span></span>

### <a name="azure-storage"></a><span data-ttu-id="e335d-196">Azure Storage</span><span class="sxs-lookup"><span data-stu-id="e335d-196">Azure Storage</span></span>

<span data-ttu-id="e335d-197">すべてデータベース サーバーの仮想マシンで、Azure Premium Storage を使用して、読み取り/書き込みの待機時間に一貫性を確保することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="e335d-197">For all database server virtual machines, we recommend using Azure Premium Storage for consistent read/write latency.</span></span> <span data-ttu-id="e335d-198">すべてのオペレーティング システム ディスクおよびデータ ディスクに対して Premium Storage を使用する単一インスタンス仮想マシンについては、「[Virtual Machines の SLA](https://azure.microsoft.com/support/legal/sla/virtual-machines)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e335d-198">For any single instance virtual machine using Premium Storage for all operating system disks and data disks, see [SLA for Virtual Machines](https://azure.microsoft.com/support/legal/sla/virtual-machines).</span></span> <span data-ttu-id="e335d-199">また、運用 SAP システムでは、どの場合も Premium [Azure Managed Disks](/azure/storage/storage-managed-disks-overview) を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="e335d-199">Also, for production SAP systems, we recommend using Premium [Azure Managed Disks](/azure/storage/storage-managed-disks-overview) in all cases.</span></span> <span data-ttu-id="e335d-200">信頼性を確保するために、ディスクの VHD ファイルの管理には Managed Disks が使用されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-200">For reliability, Managed Disks are used to manage the VHD files for the disks.</span></span> <span data-ttu-id="e335d-201">マネージド ディスクでは、可用性セット内の仮想マシンのディスクが必ず分離されるため、単一障害点を回避できます。</span><span class="sxs-lookup"><span data-stu-id="e335d-201">Managed disks ensure that the disks for virtual machines within an availability set are isolated to avoid single points of failure.</span></span>

<span data-ttu-id="e335d-202">セントラル サービス仮想マシンなどの SAP アプリケーション サーバーでは、アプリケーション実行はメモリ内で行われ、ログ記録だけにディスクが使用されるため、Azure Standard Storage を使用してコストを削減できます。</span><span class="sxs-lookup"><span data-stu-id="e335d-202">For SAP application servers, including the Central Services virtual machines, you can use Azure Standard Storage to reduce cost, because application execution takes place in memory and disks are used for logging only.</span></span> <span data-ttu-id="e335d-203">ただし、現時点では、Standard Storage はアンマネージド ストレージに対してのみ認定されています。</span><span class="sxs-lookup"><span data-stu-id="e335d-203">However, at this time, Standard Storage is only certified for unmanaged storage.</span></span> <span data-ttu-id="e335d-204">アプリケーション サーバーではデータがホストされないため、小さいサイズの P4 および P6 Premium Storage ディスクが、コストを最小限に抑えるうえで役に立つこともあります。</span><span class="sxs-lookup"><span data-stu-id="e335d-204">Since application servers do not host any data, you can also use the smaller P4 and P6 Premium Storage disks to help minimize cost.</span></span>

<span data-ttu-id="e335d-205">Azure Storage は[クラウド監視](/windows-server/failover-clustering/deploy-cloud-witness)で も使用されます。これにより、クラスターが存在するプライマリ リージョンから離れた場所にあるリモート Azure リージョンのデバイスで、クォーラムが保持されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-205">Azure Storage is also used by [Cloud Witness](/windows-server/failover-clustering/deploy-cloud-witness) to maintain quorum with a device in a remote Azure region away from the primary region where the cluster resides.</span></span>

<span data-ttu-id="e335d-206">バックアップ データ ストアでは、Azure の[クール アクセス層](/azure/storage/storage-blob-storage-tiers)および[アーカイブ アクセス層ストレージ](/azure/storage/storage-blob-storage-tiers)を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="e335d-206">For the backup data store, we recommend using Azure [coolaccess tier](/azure/storage/storage-blob-storage-tiers) and [archive access tier storage](/azure/storage/storage-blob-storage-tiers).</span></span> <span data-ttu-id="e335d-207">これらのストレージ層により、コスト効果の高い方法で、有効期間が長くアクセスの少ないデータを格納できます。</span><span class="sxs-lookup"><span data-stu-id="e335d-207">These storage tiers are cost-effective ways to store long-lived data that is infrequently accessed.</span></span>

## <a name="performance-considerations"></a><span data-ttu-id="e335d-208">パフォーマンスに関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="e335d-208">Performance considerations</span></span>

<span data-ttu-id="e335d-209">SAP アプリケーション サーバーは、データベース サーバーと常に通信しています。</span><span class="sxs-lookup"><span data-stu-id="e335d-209">SAP application servers carry on constant communications with the database servers.</span></span> <span data-ttu-id="e335d-210">SAP HANA など、任意のデータベース プラットフォームで実行されているパフォーマンス クリティカルなアプリケーションについては、[書き込みアクセラレータ](/azure/virtual-machines/linux/how-to-enable-write-accelerator)を有効にして、ログ書き込みの待機時間を短縮することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="e335d-210">For performance-critical applications running on any database platforms, including SAP HANA, consider enabling [Write Accelerator](/azure/virtual-machines/linux/how-to-enable-write-accelerator) to improve log write latency.</span></span> <span data-ttu-id="e335d-211">サーバー間の通信を最適化するには、[高速ネットワーク](https://azure.microsoft.com/blog/linux-and-windows-networking-performance-enhancements-accelerated-networking/)を使用します。</span><span class="sxs-lookup"><span data-stu-id="e335d-211">To optimize inter-server communications, use the [Accelerated Network](https://azure.microsoft.com/blog/linux-and-windows-networking-performance-enhancements-accelerated-networking/).</span></span> <span data-ttu-id="e335d-212">これらのアクセラレータは、特定の VM シリーズでしか使用できないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="e335d-212">Note that these accelerators are available only for certain VM series.</span></span>

<span data-ttu-id="e335d-213">高い IOPS とディスク帯域幅のスループットを達成するために、ストレージ ボリュームの[パフォーマンス最適化](/azure/virtual-machines/windows/premium-storage-performance)の共通プラクティスが、Azure Storage レイアウトに適用されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-213">To achieve high IOPS and disk bandwidth throughput, the common practices in storage volume [performance optimization](/azure/virtual-machines/windows/premium-storage-performance) apply to Azure storage layout.</span></span> <span data-ttu-id="e335d-214">たとえば、ストライピングされたディスク ボリュームを作成するために複数のディスクを結合すると、IO パフォーマンスが向上します。</span><span class="sxs-lookup"><span data-stu-id="e335d-214">For example, combining multiple disks together to create a striped disk volume improves IO performance.</span></span> <span data-ttu-id="e335d-215">変更が頻繁に行われないストレージ コンテンツの読み取りキャッシュを有効にすると、データ取得の速度が向上します。</span><span class="sxs-lookup"><span data-stu-id="e335d-215">Enabling the read cache on storage content that changes infrequently enhances the speed of data retrieval.</span></span>

<span data-ttu-id="e335d-216">SQL 上の SAP については、「[Top 10 Key Considerations for Deploying SAP Applications on Azure (Azure に SAP アプリケーションをデプロイするための重要な考慮事項トップ 10)](https://blogs.msdn.microsoft.com/saponsqlserver/2015/05/25/top-10-key-considerations-for-deploying-sap-applications-on-azure/)」ブログに、SQL Server で Azure Storage を SAP ワークロード用に最適化するうえで役立つアドバイスが記載されています。</span><span class="sxs-lookup"><span data-stu-id="e335d-216">For SAP on SQL, the [Top 10 Key Considerations for Deploying SAP Applications on Azure](https://blogs.msdn.microsoft.com/saponsqlserver/2015/05/25/top-10-key-considerations-for-deploying-sap-applications-on-azure/) blog offers excellent advice on optimizing Azure storage for SAP workloads on SQL Server.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="e335d-217">スケーラビリティに関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="e335d-217">Scalability considerations</span></span>

<span data-ttu-id="e335d-218">SAP アプリケーション レイヤーでは、Azure は、スケールアップおよびスケールアウトのための幅広い仮想マシン サイズを提供しています。詳細な一覧については、[SAP Note 1928533](https://launchpad.support.sap.com/#/notes/1928533) の「SAP Applications on Azure: Supported Products and Azure VM Types (Azure 上の SAP アプリケーション:サポートされる製品と Azure VM の種類)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e335d-218">At the SAP application layer, Azure offers a wide range of virtual machine sizes for scaling up and scaling out. For an inclusive list, see [SAP note 1928533](https://launchpad.support.sap.com/#/notes/1928533) - SAP Applications on Azure: Supported Products and Azure VM Types.</span></span> <span data-ttu-id="e335d-219">(アクセスするには、SAP Service Marketplace アカウントが必要です)。</span><span class="sxs-lookup"><span data-stu-id="e335d-219">(SAP Service Marketplace account required for access).</span></span> <span data-ttu-id="e335d-220">SAP アプリケーション サーバーとセントラル サービス クラスターは、インスタンスを追加することでスケールアップ/スケールダウンまたはスケールアウトできます。</span><span class="sxs-lookup"><span data-stu-id="e335d-220">SAP application servers and the Central Services clusters can scale up/down or scale out by adding more instances.</span></span> <span data-ttu-id="e335d-221">AnyDB データベースの場合、スケールアップ/スケールダウンは可能ですが、スケールアウトできません。AnyDB の SAP データベース コンテナーでは、シャーディングがサポートされません。</span><span class="sxs-lookup"><span data-stu-id="e335d-221">The AnyDB database can scale up/down but does not scale out. The SAP database container for AnyDB does not support sharding.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="e335d-222">可用性に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="e335d-222">Availability considerations</span></span>

<span data-ttu-id="e335d-223">リソースの冗長性は、高可用性インフラストラクチャ ソリューションの一般的なテーマです。</span><span class="sxs-lookup"><span data-stu-id="e335d-223">Resource redundancy is the general theme in highly available infrastructure solutions.</span></span> <span data-ttu-id="e335d-224">SLA がそれほど厳しくない企業については、単一インスタンスの Azure VM によってアップタイム SLA が提供されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-224">For enterprises that have a less stringent SLA, single-instance Azure VMs offer an uptime SLA.</span></span> <span data-ttu-id="e335d-225">詳細については、[Azure サービス レベル アグリーメント](https://azure.microsoft.com/support/legal/sla/)に関するページをご覧ください。</span><span class="sxs-lookup"><span data-stu-id="e335d-225">For more information, see [Azure Service Level Agreement](https://azure.microsoft.com/support/legal/sla/).</span></span>

<span data-ttu-id="e335d-226">このように SAP アプリケーションを分散してインストールした場合、高可用性を実現するために基本のインストールがレプリケートされます。</span><span class="sxs-lookup"><span data-stu-id="e335d-226">In this distributed installation of the SAP application, the base installation is replicated to achieve high availability.</span></span> <span data-ttu-id="e335d-227">高可用性の設計は、アーキテクチャのレイヤーごとに異なります。</span><span class="sxs-lookup"><span data-stu-id="e335d-227">For each layer of the architecture, the high availability design varies.</span></span>

### <a name="application-tier"></a><span data-ttu-id="e335d-228">アプリケーション層</span><span class="sxs-lookup"><span data-stu-id="e335d-228">Application tier</span></span>

<span data-ttu-id="e335d-229">SAP Web Dispatcher の高可用性は冗長インスタンスによって実現します。</span><span class="sxs-lookup"><span data-stu-id="e335d-229">High availability for SAP Web Dispatcher is achieved with redundant instances.</span></span> <span data-ttu-id="e335d-230">SAP ドキュメントの「[SAP Web Dispatcher](https://help.sap.com/doc/saphelp_nw70ehp2/7.02.16/en-us/48/8fe37933114e6fe10000000a421937/frameset.htm)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e335d-230">See [SAP Web Dispatcher](https://help.sap.com/doc/saphelp_nw70ehp2/7.02.16/en-us/48/8fe37933114e6fe10000000a421937/frameset.htm) in the SAP Documentation.</span></span>

<span data-ttu-id="e335d-231">セントラル サービスの高可用性は、Windows Server フェールオーバー クラスターで実装されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-231">High availability of the Central Services is implemented with Windows Server Failover Cluster.</span></span> <span data-ttu-id="e335d-232">フェールオーバー クラスターのクラスター記憶域は、Azure にデプロイするときに、クラスター化共有ボリュームまたはファイル共有のいずれかを使用して構成できます。</span><span class="sxs-lookup"><span data-stu-id="e335d-232">When deployed on Azure, the cluster storage for the failover cluster can be configured using two approaches: either a clustered shared volume or a file share.</span></span>

<span data-ttu-id="e335d-233">Azure では共有ディスクを使用できないため、SIOS Datakeeper を使って、クラスター ノードに接続されている独立したディスクの内容がレプリケートされ、ドライブはクラスター マネージャーのクラスター共有ボリュームとして抽象化されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-233">Since shared disks are not possible on Azure, SIOS Datakeeper is used to replicate the content of independent disks attached to the cluster nodes and to abstract the drives as a cluster shared volume for the cluster manager.</span></span> <span data-ttu-id="e335d-234">実装の詳細については、[Azure での SAP ASCS のクラスタリング](https://blogs.msdn.microsoft.com/saponsqlserver/2015/05/20/clustering-sap-ascs-instance-using-windows-server-failover-cluster-on-microsoft-azure-with-sios-datakeeper-and-azure-internal-load-balancer/)に関するページをご覧ください。</span><span class="sxs-lookup"><span data-stu-id="e335d-234">For implementation details, see [Clustering SAP ASCS on Azure](https://blogs.msdn.microsoft.com/saponsqlserver/2015/05/20/clustering-sap-ascs-instance-using-windows-server-failover-cluster-on-microsoft-azure-with-sios-datakeeper-and-azure-internal-load-balancer/).</span></span>

<span data-ttu-id="e335d-235">[スケールアウト ファイル サーバー](https://blogs.msdn.microsoft.com/saponsqlserver/2017/11/14/file-server-with-sofs-and-s2d-as-an-alternative-to-cluster-shared-disk-for-clustering-of-an-sap-ascs-instance-in-azure-is-generally-available/) (SOFS) によって提供されるファイル共有を使用することもできます。</span><span class="sxs-lookup"><span data-stu-id="e335d-235">Another option is to use a file share served up by the [Scale Out Fileserver](https://blogs.msdn.microsoft.com/saponsqlserver/2017/11/14/file-server-with-sofs-and-s2d-as-an-alternative-to-cluster-shared-disk-for-clustering-of-an-sap-ascs-instance-in-azure-is-generally-available/) (SOFS).</span></span> <span data-ttu-id="e335d-236">SOFS によって提供されるのは回復力のあるファイル共有で、これは Windows クラスターのクラスター共有ボリュームとして使用できます。</span><span class="sxs-lookup"><span data-stu-id="e335d-236">SOFS offers resilient file shares you can use as a cluster shared volume for the Windows cluster.</span></span> <span data-ttu-id="e335d-237">1 つの SOFS クラスターを、複数のセントラル サービス ノードが共有できます。</span><span class="sxs-lookup"><span data-stu-id="e335d-237">A SOFS cluster can be shared among multiple Central Services nodes.</span></span> <span data-ttu-id="e335d-238">このドキュメントの作成時点では、SOFS は高可用性の設計のみを目的として使用されます。SOFS クラスターはリージョンの枠を越えては拡張されず、ディザスター リカバリーがサポートされないためです。</span><span class="sxs-lookup"><span data-stu-id="e335d-238">As of this writing, SOFS is used only for high availability design, because the SOFS cluster does not extend across regions to provide disaster recovery support.</span></span>

<span data-ttu-id="e335d-239">SAP アプリケーション サーバーの高可用性は、アプリケーション サーバーのプール内のトラフィックを負荷分散することによって実現します。</span><span class="sxs-lookup"><span data-stu-id="e335d-239">High availability for the SAP application servers is achieved by load balancing traffic within a pool of application servers.</span></span>
<span data-ttu-id="e335d-240">「[Microsoft Azure で実行されている SAP の認定と構成](/azure/virtual-machines/workloads/sap/sap-certifications)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e335d-240">See [SAP certifications and configurations running on Microsoft Azure](/azure/virtual-machines/workloads/sap/sap-certifications).</span></span>

### <a name="database-tier"></a><span data-ttu-id="e335d-241">データベース層</span><span class="sxs-lookup"><span data-stu-id="e335d-241">Database tier</span></span>

<span data-ttu-id="e335d-242">この参照アーキテクチャでは、ソース データベースが AnyDB、つまり、SQL Server、SAP ASE、IBM DB2、Oracle などの DBMS で実行されていることを前提としています。</span><span class="sxs-lookup"><span data-stu-id="e335d-242">This reference architecture assumes the source database is running on AnyDB &mdash; that is, a DBMS such as SQL Server, SAP ASE, IBM DB2, or Oracle.</span></span> <span data-ttu-id="e335d-243">データベース層のネイティブのレプリケーション機能では、レプリケートされたノード間でのフェールオーバーを手動または自動で行うことができます。</span><span class="sxs-lookup"><span data-stu-id="e335d-243">The database tier's native replication feature provides either manual or automatic failover between replicated nodes.</span></span>

<span data-ttu-id="e335d-244">特定のデータベース システムの実装の詳細については、「[SAP NetWeaver のための Azure Virtual Machines DBMS のデプロイ](/azure/virtual-machines/workloads/sap/dbms-guide)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e335d-244">For implementation details about specific database systems, see [Azure Virtual Machines DBMS deployment for SAP NetWeaver](/azure/virtual-machines/workloads/sap/dbms-guide).</span></span>

## <a name="disaster-recovery-considerations"></a><span data-ttu-id="e335d-245">ディザスター リカバリーの考慮事項</span><span class="sxs-lookup"><span data-stu-id="e335d-245">Disaster recovery considerations</span></span>

<span data-ttu-id="e335d-246">ディザスター リカバリー (DR) を確保するために、セカンダリ リージョンにフェールオーバーできる必要があります。</span><span class="sxs-lookup"><span data-stu-id="e335d-246">For disaster recovery (DR), you must be able to fail over to a secondary region.</span></span> <span data-ttu-id="e335d-247">各層では、さまざまな戦略を利用して、ディザスター リカバリー (DR) の保護を提供しています。</span><span class="sxs-lookup"><span data-stu-id="e335d-247">Each tier uses a different strategy to provide disaster recovery (DR) protection.</span></span>

- <span data-ttu-id="e335d-248">**アプリケーション サーバー層**。</span><span class="sxs-lookup"><span data-stu-id="e335d-248">**Application servers tier**.</span></span> <span data-ttu-id="e335d-249">SAP アプリケーション サーバーには、ビジネス データが含まれていません。</span><span class="sxs-lookup"><span data-stu-id="e335d-249">SAP application servers do not contain business data.</span></span> <span data-ttu-id="e335d-250">Azure での単純な DR 戦略は、セカンダリ リージョンで SAP アプリケーション サーバーを作成し、そのサーバーをシャットダウンすることです。</span><span class="sxs-lookup"><span data-stu-id="e335d-250">On Azure, a simple DR strategy is to create SAP application servers in the secondary region, then shut them down.</span></span> <span data-ttu-id="e335d-251">プライマリ アプリケーション サーバーで構成変更やカーネル更新を行った場合、同じ変更がセカンダリ リージョンの仮想マシンにコピーされなければなりません。</span><span class="sxs-lookup"><span data-stu-id="e335d-251">Upon any configuration changes or kernel updates on the primary application server, the same changes must be copied to the virtual machines in the secondary region.</span></span> <span data-ttu-id="e335d-252">たとえば、カーネルの実行可能ファイルが DR 仮想マシンにコピーされます。</span><span class="sxs-lookup"><span data-stu-id="e335d-252">For example, the kernel executables copied to the DR virtual machines.</span></span> <span data-ttu-id="e335d-253">アプリケーション サーバーをセカンダリ リージョンに自動的にレプリケートするためのソリューションとしては、[Azure Site Recovery](/azure/site-recovery/site-recovery-overview) をお勧めします。</span><span class="sxs-lookup"><span data-stu-id="e335d-253">For automatic replication of application servers to a secondary region, [Azure Site Recovery](/azure/site-recovery/site-recovery-overview) is the recommended solution.</span></span>

- <span data-ttu-id="e335d-254">**セントラル サービス**。</span><span class="sxs-lookup"><span data-stu-id="e335d-254">**Central Services**.</span></span> <span data-ttu-id="e335d-255">SAP アプリケーション スタックのこのコンポーネントにも、ビジネス データが保持されません。</span><span class="sxs-lookup"><span data-stu-id="e335d-255">This component of the SAP application stack also does not persist business data.</span></span> <span data-ttu-id="e335d-256">ディザスター リカバリー リージョンで VM を作成すると、セントラル サービス ロールを実行できます。</span><span class="sxs-lookup"><span data-stu-id="e335d-256">You can build a VM in the disaster recovery region to run the Central Services role.</span></span> <span data-ttu-id="e335d-257">プライマリ セントラル サービス ノードから同期されるコンテンツは、/sapmnt 共有コンテンツだけです。</span><span class="sxs-lookup"><span data-stu-id="e335d-257">The only content from the primary Central Services node to synchronize is the /sapmnt share content.</span></span> <span data-ttu-id="e335d-258">また、構成の変更やカーネルの更新がプライマリ セントラル サービス サーバーで発生した場合、その変更や更新は、セントラル サービスが実行されているディザスター リカバリー リージョンの VM でもう一度行われなければなりません。</span><span class="sxs-lookup"><span data-stu-id="e335d-258">Also, if configuration changes or kernel updates take place on the primary Central Services servers, they must be repeated on the VM in the disaster recovery region running Central Services.</span></span> <span data-ttu-id="e335d-259">2 つのサーバーを同期するには、Azure Site Recovery を使用してクラスター ノードをレプリケートするか、単純に、定期的にコピーするようにスケジュール設定されたコピー ジョブを使用して、/sapmnt をディザスター リカバリー リージョンにコピーします。</span><span class="sxs-lookup"><span data-stu-id="e335d-259">To synchronize the two servers, you can use either Azure Site Recovery to replicate the cluster nodes or simply use a regularly scheduled copy job to copy /sapmnt to the disaster recovery region.</span></span> <span data-ttu-id="e335d-260">このシンプルなレプリケーション方法の作成、コピー、およびテスト フェールオーバー プロセスの詳細については、「[SAP NetWeaver:Building a Hyper-V and Microsoft Azure–based Disaster Recovery Solution (SAP NetWeaver: Hyper-V および Microsoft Azure ベースのディザスター リカバリー ソリューション)](https://download.microsoft.com/download/9/5/6/956FEDC3-702D-4EFB-A7D3-2DB7505566B6/SAP%20NetWeaver%20-%20Building%20an%20Azure%20based%20Disaster%20Recovery%20Solution%20V1_5%20.docx)」をダウンロードして、「4.3.</span><span class="sxs-lookup"><span data-stu-id="e335d-260">For details about this simple replication method's build, copy, and test failover process, download [SAP NetWeaver: Building a Hyper-V and Microsoft Azure–based Disaster Recovery Solution](https://download.microsoft.com/download/9/5/6/956FEDC3-702D-4EFB-A7D3-2DB7505566B6/SAP%20NetWeaver%20-%20Building%20an%20Azure%20based%20Disaster%20Recovery%20Solution%20V1_5%20.docx), and refer to "4.3.</span></span> <span data-ttu-id="e335d-261">SAP SPOF layer (ASCS) (4.3 SAP SPOF レイヤー (ASCS))」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e335d-261">SAP SPOF layer (ASCS)."</span></span>

- <span data-ttu-id="e335d-262">**データベース層**。</span><span class="sxs-lookup"><span data-stu-id="e335d-262">**Database tier**.</span></span> <span data-ttu-id="e335d-263">DR の実装には、データベース独自の統合レプリケーション テクノロジを使用するのが最適です。</span><span class="sxs-lookup"><span data-stu-id="e335d-263">DR is best implemented with the database's own integrated replication technology.</span></span> <span data-ttu-id="e335d-264">たとえば、SQL Server の場合は、AlwaysOn 可用性グループを使用して、リモート リージョンにレプリカを作成し、手動フェールオーバーで非同期的にトランザクションをレプリケートすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="e335d-264">In the case of SQL Server, for example, we recommend using AlwaysOn Availability Group to establish a replica in a remote region, replicating transactions asynchronously with manual failover.</span></span> <span data-ttu-id="e335d-265">非同期レプリケーションにより、プライマリ サイトにおけるインタラクティブ ワークロードのパフォーマンスへの影響を回避できます。</span><span class="sxs-lookup"><span data-stu-id="e335d-265">Asynchronous replication avoids an impact to the performance of interactive workloads at the primary site.</span></span> <span data-ttu-id="e335d-266">手動フェールオーバーにより、ユーザーが、DR の影響を評価し、DR サイトからの操作が正当かどうかを判断できるようになります。</span><span class="sxs-lookup"><span data-stu-id="e335d-266">Manual failover offers the opportunity for a person to evaluate the DR impact and decide if operating from the DR site is justified.</span></span>

<span data-ttu-id="e335d-267">Azure Site Recovery を使用して、ご自身の元のサイトが完全にレプリケートされた運用サイトを自動的に構築するには、カスタマイズされた[デプロイ スクリプト](/azure/site-recovery/site-recovery-runbook-automation)を実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e335d-267">To use Azure Site Recovery to automatically build out a fully replicated production site of your original, you must run customized [deployment scripts](/azure/site-recovery/site-recovery-runbook-automation).</span></span> <span data-ttu-id="e335d-268">Site Recovery によって、最初に VM が可用性セットにデプロイされ、その後、ロード バランサーなどのリソースを追加するスクリプトが実行されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-268">Site Recovery first deploys the VMs in availability sets, then runs scripts to add resources such as load balancers.</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="e335d-269">管理容易性に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="e335d-269">Manageability considerations</span></span>

<span data-ttu-id="e335d-270">Azure には、インフラストラクチャ全体の[監視と診断](/azure/architecture/best-practices/monitoring)を行うための機能が複数用意されています。</span><span class="sxs-lookup"><span data-stu-id="e335d-270">Azure provides several functions for [monitoring and diagnostics](/azure/architecture/best-practices/monitoring) of the overall infrastructure.</span></span> <span data-ttu-id="e335d-271">また、Azure 仮想マシンの高度な監視は、Azure Operations Management Suite (OMS) で処理されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-271">Also, enhanced monitoring of Azure virtual machines is handled by Azure Operations Management Suite (OMS).</span></span>

<span data-ttu-id="e335d-272">SAP インフラストラクチャのリソースとサービス パフォーマンスの SAP ベースの監視には、[Azure SAP Enhanced Monitoring](/azure/virtual-machines/workloads/sap/deployment-guide#detailed-tasks-for-sap-software-deployment) 拡張機能が使用されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-272">To provide SAP-based monitoring of resources and service performance of the SAP infrastructure, the [Azure SAP Enhanced Monitoring](/azure/virtual-machines/workloads/sap/deployment-guide#detailed-tasks-for-sap-software-deployment) extension is used.</span></span> <span data-ttu-id="e335d-273">この拡張機能では、Azure 監視統計情報をオペレーティング システムの監視と DBA Cockpit 機能のための SAP アプリケーションにフィードします。</span><span class="sxs-lookup"><span data-stu-id="e335d-273">This extension feeds Azure monitoring statistics into the SAP application for operating system monitoring and DBA Cockpit functions.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="e335d-274">セキュリティに関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="e335d-274">Security considerations</span></span>

<span data-ttu-id="e335d-275">SAP は、SAP アプリケーション内でのロールベース アクセスと承認を制御するために、独自のユーザー管理エンジン (UME) を備えています。</span><span class="sxs-lookup"><span data-stu-id="e335d-275">SAP has its own Users Management Engine (UME) to control role-based access and authorization within the SAP application.</span></span> <span data-ttu-id="e335d-276">詳細については、「[SAP NetWeaver Application Server for ABAP Security Guide (SAP NetWeaver Application Server for ABAP セキュリティ ガイド)](https://help.sap.com/viewer/864321b9b3dd487d94c70f6a007b0397/7.4.19)」および「[SAP NetWeaver Application Server Java Security Guide (SAP NetWeaver Application Server Java セキュリティ ガイド)](https://help.sap.com/doc/saphelp_snc_uiaddon_10/1.0/en-US/57/d8bfcf38f66f48b95ce1f52b3f5184/frameset.htm)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e335d-276">For details, see [SAP NetWeaver Application Server for ABAP Security Guide](https://help.sap.com/viewer/864321b9b3dd487d94c70f6a007b0397/7.4.19) and [SAP NetWeaver Application Server Java Security Guide](https://help.sap.com/doc/saphelp_snc_uiaddon_10/1.0/en-US/57/d8bfcf38f66f48b95ce1f52b3f5184/frameset.htm).</span></span>

<span data-ttu-id="e335d-277">追加のネットワーク セキュリティについては、[ネットワーク DMZ](../dmz/secure-vnet-hybrid.md) を実装することを検討します。これにより、ネットワーク仮想アプライアンスを使用して、Web Dispatcher のサブネットの外側にファイアウォールが作成されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-277">For additional network security, consider implementing a [network DMZ](../dmz/secure-vnet-hybrid.md), which uses a network virtual appliance to create a firewall in front of the subnet for Web Dispatcher.</span></span>

<span data-ttu-id="e335d-278">インフラストラクチャ セキュリティでは、データは転送時および保存時に暗号化されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-278">For infrastructure security, data is encrypted in transit and at rest.</span></span> <span data-ttu-id="e335d-279">[Azure Virtual Machines (VM) 上の SAP NetWeaver の計画と実装に関するガイド](/azure/virtual-machines/workloads/sap/planning-guide)の「セキュリティに関する考慮事項」セクションでは、冒頭にネットワーク セキュリティへの対応について記述されています。</span><span class="sxs-lookup"><span data-stu-id="e335d-279">The "Security considerations” section of the [SAP NetWeaver on Azure Virtual Machines (VMs) – Planning and Implementation Guide](/azure/virtual-machines/workloads/sap/planning-guide) begins to address network security.</span></span> <span data-ttu-id="e335d-280">また、このガイドでは、アプリケーション通信を許可するために、ファイアウォールで開く必要があるネットワーク ポートも指定しています。</span><span class="sxs-lookup"><span data-stu-id="e335d-280">The guide also specifies the network ports you must open on the firewalls to allow application communication.</span></span>

<span data-ttu-id="e335d-281">Windows 仮想マシン ディスクを暗号化するには、[Azure Disk Encryption](/azure/security/azure-security-disk-encryption) を使用できます。</span><span class="sxs-lookup"><span data-stu-id="e335d-281">To encrypt Windows virtual machine disks, you can use [Azure Disk Encryption](/azure/security/azure-security-disk-encryption).</span></span> <span data-ttu-id="e335d-282">この場合、Windows の BitLocker 機能によって、オペレーティング システムおよびデータ ディスクのボリュームが暗号化されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-282">It uses the BitLocker feature of Windows to provide volume encryption for the operating system and the data disks.</span></span> <span data-ttu-id="e335d-283">また、このソリューションは Azure Key Vault と共に動作するため、お使いのキー コンテナー サブスクリプションのディスク暗号化キーとシークレットの制御および管理にも役立ちます。</span><span class="sxs-lookup"><span data-stu-id="e335d-283">The solution also works with Azure Key Vault to help you control and manage the disk-encryption keys and secrets in your key vault subscription.</span></span> <span data-ttu-id="e335d-284">仮想マシンのディスク上のデータは暗号化され、お使いの Azure ストレージに保存されます。</span><span class="sxs-lookup"><span data-stu-id="e335d-284">Data on the virtual machine disks are encrypted at rest in your Azure storage.</span></span>

## <a name="communities"></a><span data-ttu-id="e335d-285">コミュニティ</span><span class="sxs-lookup"><span data-stu-id="e335d-285">Communities</span></span>

<span data-ttu-id="e335d-286">コミュニティは質問に答え、デプロイを正常に完了できるよう支援します。</span><span class="sxs-lookup"><span data-stu-id="e335d-286">Communities can answer questions and help you set up a successful deployment.</span></span> <span data-ttu-id="e335d-287">以下、具体例に沿って説明します。</span><span class="sxs-lookup"><span data-stu-id="e335d-287">Consider the following:</span></span>

- [<span data-ttu-id="e335d-288">Microsoft プラットフォームでの SAP アプリケーションの実行 (ブログ)</span><span class="sxs-lookup"><span data-stu-id="e335d-288">Running SAP Applications on the Microsoft Platform Blog</span></span>](https://blogs.msdn.microsoft.com/saponsqlserver/2017/05/04/sap-on-azure-general-update-for-customers-partners-april-2017/)
- [<span data-ttu-id="e335d-289">Azure コミュニティ サポート</span><span class="sxs-lookup"><span data-stu-id="e335d-289">Azure Community Support</span></span>](https://azure.microsoft.com/support/community/)
- [<span data-ttu-id="e335d-290">SAP Community</span><span class="sxs-lookup"><span data-stu-id="e335d-290">SAP Community</span></span>](https://www.sap.com/community.html)
- [<span data-ttu-id="e335d-291">Stack Overflow</span><span class="sxs-lookup"><span data-stu-id="e335d-291">Stack Overflow</span></span>](https://stackoverflow.com/tags/sap/)

## <a name="related-resources"></a><span data-ttu-id="e335d-292">関連リソース</span><span class="sxs-lookup"><span data-stu-id="e335d-292">Related resources</span></span>

<span data-ttu-id="e335d-293">同じテクノロジの一部を使用する具体的なソリューションを示す次の [Azure のサンプル シナリオ](/azure/architecture/example-scenario)をレビューできます。</span><span class="sxs-lookup"><span data-stu-id="e335d-293">You may wish to review the following [Azure example scenarios](/azure/architecture/example-scenario) that demonstrate specific solutions using some of the same technologies:</span></span>

- [<span data-ttu-id="e335d-294">Azure での Oracle Database を使用した SAP 運用環境ワークロードの実行</span><span class="sxs-lookup"><span data-stu-id="e335d-294">Running SAP production workloads using an Oracle Database on Azure</span></span>](/azure/architecture/example-scenario/apps/sap-production)
- [<span data-ttu-id="e335d-295">Azure での SAP ワークロード向けの開発/テスト環境</span><span class="sxs-lookup"><span data-stu-id="e335d-295">Dev/test environments for SAP workloads on Azure</span></span>](/azure/architecture/example-scenario/apps/sap-dev-test)

<!-- links -->

[visio-download]: https://archcenter.blob.core.windows.net/cdn/sap-reference-architectures.vsdx
