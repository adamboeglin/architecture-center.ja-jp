---
title: オンプレミスの AD ドメインと Azure AD を統合する
titleSuffix: Azure Reference Architectures
description: Azure Active Directory を使用するセキュリティ保護されたハイブリッド ネットワーク アーキテクチャを実装します。
author: telmosampaio
ms.date: 11/28/2016
ms.topic: reference-architecture
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: seodec18, identity
ms.openlocfilehash: 81053a4eda5e30ca614b2c18b92ddf411a05eac9
ms.sourcegitcommit: c053e6edb429299a0ad9b327888d596c48859d4a
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/20/2019
ms.locfileid: "58244353"
---
# <a name="integrate-on-premises-active-directory-domains-with-azure-active-directory"></a><span data-ttu-id="81e02-103">オンプレミスの Active Directory ドメインと Azure Active Directory を統合する</span><span class="sxs-lookup"><span data-stu-id="81e02-103">Integrate on-premises Active Directory domains with Azure Active Directory</span></span>

<span data-ttu-id="81e02-104">Azure Active Directory (Azure AD) は、クラウド ベースでマルチテナントのディレクトリおよび ID サービスです。</span><span class="sxs-lookup"><span data-stu-id="81e02-104">Azure Active Directory (Azure AD) is a cloud based multi-tenant directory and identity service.</span></span> <span data-ttu-id="81e02-105">この参照アーキテクチャでは、オンプレミスの Active Directory ドメインと Azure AD を統合してクラウド ベースの ID 認証を提供する場合のベスト プラクティスを示します。</span><span class="sxs-lookup"><span data-stu-id="81e02-105">This reference architecture shows best practices for integrating on-premises Active Directory domains with Azure AD to provide cloud-based identity authentication.</span></span> <span data-ttu-id="81e02-106">[**このソリューションをデプロイします**](#deploy-the-solution)。</span><span class="sxs-lookup"><span data-stu-id="81e02-106">[**Deploy this solution**](#deploy-the-solution).</span></span>

![Azure Active Directory を使用するクラウド ID アーキテクチャ](./images/azure-ad.png)

<span data-ttu-id="81e02-108">"*このアーキテクチャの [Visio ファイル][visio-download]をダウンロードします。*"</span><span class="sxs-lookup"><span data-stu-id="81e02-108">*Download a [Visio file][visio-download] of this architecture.*</span></span>

> [!NOTE]
> <span data-ttu-id="81e02-109">わかりやすくするため、この図では Azure AD に直接関係する接続のみを示してあり、認証および ID フェデレーションの一部として発生する可能性があるプロトコル関連のトラフィックは示されていません。</span><span class="sxs-lookup"><span data-stu-id="81e02-109">For simplicity, this diagram only shows the connections directly related to Azure AD, and not protocol-related traffic that may occur as part of authentication and identity federation.</span></span> <span data-ttu-id="81e02-110">たとえば、Web アプリケーションは Azure AD を介して要求を認証するため Web ブラウザーをリダイレクトする可能性があります。</span><span class="sxs-lookup"><span data-stu-id="81e02-110">For example, a web application may redirect the web browser to authenticate the request through Azure AD.</span></span> <span data-ttu-id="81e02-111">認証が済むと、適切な ID 情報と共に要求を Web アプリケーションに戻すことができます。</span><span class="sxs-lookup"><span data-stu-id="81e02-111">Once authenticated, the request can be passed back to the web application, with the appropriate identity information.</span></span>
>

<span data-ttu-id="81e02-112">この参照アーキテクチャの一般的な用途は次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="81e02-112">Typical uses for this reference architecture include:</span></span>

- <span data-ttu-id="81e02-113">組織に属しているリモート ユーザーにアクセスを提供する、Azure にデプロイされた Web アプリケーション。</span><span class="sxs-lookup"><span data-stu-id="81e02-113">Web applications deployed in Azure that provide access to remote users who belong to your organization.</span></span>
- <span data-ttu-id="81e02-114">パスワードのリセットやグループ管理の委任など、エンド ユーザー向けのセルフ サービス機能の実装。</span><span class="sxs-lookup"><span data-stu-id="81e02-114">Implementing self-service capabilities for end-users, such as resetting their passwords, and delegating group management.</span></span> <span data-ttu-id="81e02-115">これには Azure AD Premium Edition が必要であることにご注意ください。</span><span class="sxs-lookup"><span data-stu-id="81e02-115">Note that this requires Azure AD Premium edition.</span></span>
- <span data-ttu-id="81e02-116">オンプレミスのネットワークとアプリケーションの Azure VNet が VPN トンネルまたは ExpressRoute 回線を使って接続されていないアーキテクチャ。</span><span class="sxs-lookup"><span data-stu-id="81e02-116">Architectures in which the on-premises network and the application's Azure VNet are not connected using a VPN tunnel or ExpressRoute circuit.</span></span>

> [!NOTE]
> <span data-ttu-id="81e02-117">Azure AD では、組織のディレクトリに存在するユーザーおよびアプリケーションの ID を認証できます。</span><span class="sxs-lookup"><span data-stu-id="81e02-117">Azure AD can authenticate the identity of users and applications that exist in an organization’s directory.</span></span> <span data-ttu-id="81e02-118">SQL Server などの一部のアプリケーションとサービスではコンピューターの認証が必要になることがあり、そのような場合にこのソリューションは適していません。</span><span class="sxs-lookup"><span data-stu-id="81e02-118">Some applications and services, such as SQL Server, may require computer authentication, in which case this solution is not appropriate.</span></span>
>

<span data-ttu-id="81e02-119">その他の考慮事項については、「[オンプレミスの Active Directory を Azure と統合するためのソリューションの選択][considerations]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="81e02-119">For additional considerations, see [Choose a solution for integrating on-premises Active Directory with Azure][considerations].</span></span>

## <a name="architecture"></a><span data-ttu-id="81e02-120">アーキテクチャ</span><span class="sxs-lookup"><span data-stu-id="81e02-120">Architecture</span></span>

<span data-ttu-id="81e02-121">このアーキテクチャには次のコンポーネントがあります。</span><span class="sxs-lookup"><span data-stu-id="81e02-121">The architecture has the following components.</span></span>

- <span data-ttu-id="81e02-122">**Azure AD テナント**。</span><span class="sxs-lookup"><span data-stu-id="81e02-122">**Azure AD tenant**.</span></span> <span data-ttu-id="81e02-123">組織によって作成された [Azure AD][azure-active-directory] のインスタンス。</span><span class="sxs-lookup"><span data-stu-id="81e02-123">An instance of [Azure AD][azure-active-directory] created by your organization.</span></span> <span data-ttu-id="81e02-124">オンプレミスの Active Directory からコピーされたオブジェクトを格納することによってクラウド アプリケーションのディレクトリ サービスとして動作し、ID サービスを提供します。</span><span class="sxs-lookup"><span data-stu-id="81e02-124">It acts as a directory service for cloud applications by storing objects copied from the on-premises Active Directory and provides identity services.</span></span>
- <span data-ttu-id="81e02-125">**Web 層サブネット**。</span><span class="sxs-lookup"><span data-stu-id="81e02-125">**Web tier subnet**.</span></span> <span data-ttu-id="81e02-126">このサブネットは、Web アプリケーションを実行する VM を保持します。</span><span class="sxs-lookup"><span data-stu-id="81e02-126">This subnet holds VMs that run a web application.</span></span> <span data-ttu-id="81e02-127">Azure AD は、このアプリケーションに対する ID ブローカーとして機能できます。</span><span class="sxs-lookup"><span data-stu-id="81e02-127">Azure AD can act as an identity broker for this application.</span></span>
- <span data-ttu-id="81e02-128">**オンプレミスの AD DS サーバー**。</span><span class="sxs-lookup"><span data-stu-id="81e02-128">**On-premises AD DS server**.</span></span> <span data-ttu-id="81e02-129">オンプレミスのディレクトリおよび ID サービスです。</span><span class="sxs-lookup"><span data-stu-id="81e02-129">An on-premises directory and identity service.</span></span> <span data-ttu-id="81e02-130">AD DS ディレクトリは、Azure AD がオンプレミスのユーザーを認証できるように同期することができます。</span><span class="sxs-lookup"><span data-stu-id="81e02-130">The AD DS directory can be synchronized with Azure AD to enable it to authenticate on-premises users.</span></span>
- <span data-ttu-id="81e02-131">**Azure AD Connect 同期サーバー**。</span><span class="sxs-lookup"><span data-stu-id="81e02-131">**Azure AD Connect sync server**.</span></span> <span data-ttu-id="81e02-132">[Azure AD Connect][azure-ad-connect] 同期サービスを実行するオンプレミスのコンピューターです。</span><span class="sxs-lookup"><span data-stu-id="81e02-132">An on-premises computer that runs the [Azure AD Connect][azure-ad-connect] sync service.</span></span> <span data-ttu-id="81e02-133">このサービスは、オンプレミスの Active Directory に保持されている情報を Azure AD に同期します。</span><span class="sxs-lookup"><span data-stu-id="81e02-133">This service synchronizes information held in the on-premises Active Directory to Azure AD.</span></span> <span data-ttu-id="81e02-134">たとえば、オンプレミスのグループとユーザーをプロビジョニングまたはプロビジョニング解除すると、その変更が Azure AD に反映されます。</span><span class="sxs-lookup"><span data-stu-id="81e02-134">For example, if you provision or deprovision groups and users on-premises, these changes propagate to Azure AD.</span></span>

  > [!NOTE]
  > <span data-ttu-id="81e02-135">セキュリティ上の理由により、Azure AD はユーザーのパスワードをハッシュとして格納します。</span><span class="sxs-lookup"><span data-stu-id="81e02-135">For security reasons, Azure AD stores user's passwords as a hash.</span></span> <span data-ttu-id="81e02-136">ユーザーがパスワードをリセットする必要がある場合、オンプレミスでリセットを実行して、新しいハッシュを Azure AD に送信する必要があります。</span><span class="sxs-lookup"><span data-stu-id="81e02-136">If a user requires a password reset, this must be performed on-premises and the new hash must be sent to Azure AD.</span></span> <span data-ttu-id="81e02-137">Azure AD Premium Edition には、このタスクを自動化してユーザーが自分のパスワードをリセットできるようにする機能が含まれます。</span><span class="sxs-lookup"><span data-stu-id="81e02-137">Azure AD Premium editions include features that can automate this task to enable users to reset their own passwords.</span></span>
  >

- <span data-ttu-id="81e02-138">**N 層アプリケーション用の VM**。</span><span class="sxs-lookup"><span data-stu-id="81e02-138">**VMs for N-tier application**.</span></span> <span data-ttu-id="81e02-139">デプロイには、N 層アプリケーション用のインフラストラクチャが含まれます。</span><span class="sxs-lookup"><span data-stu-id="81e02-139">The deployment includes infrastructure for an N-tier application.</span></span> <span data-ttu-id="81e02-140">これらのリソースについて詳しくは、「[n 層アプリケーションの Windows VM を実行する][implementing-a-multi-tier-architecture-on-Azure]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="81e02-140">For more information about these resources, see [Run VMs for an N-tier architecture][implementing-a-multi-tier-architecture-on-Azure].</span></span>

## <a name="recommendations"></a><span data-ttu-id="81e02-141">Recommendations</span><span class="sxs-lookup"><span data-stu-id="81e02-141">Recommendations</span></span>

<span data-ttu-id="81e02-142">ほとんどのシナリオには、次の推奨事項が適用されます。</span><span class="sxs-lookup"><span data-stu-id="81e02-142">The following recommendations apply for most scenarios.</span></span> <span data-ttu-id="81e02-143">これらの推奨事項には、オーバーライドする特定の要件がない限り、従ってください。</span><span class="sxs-lookup"><span data-stu-id="81e02-143">Follow these recommendations unless you have a specific requirement that overrides them.</span></span>

### <a name="azure-ad-connect-sync-service"></a><span data-ttu-id="81e02-144">Azure AD Connect 同期サービス</span><span class="sxs-lookup"><span data-stu-id="81e02-144">Azure AD Connect sync service</span></span>

<span data-ttu-id="81e02-145">Azure AD Connect 同期サービスは、クラウドに格納されている ID 情報とオンプレミスに保持されている情報の整合性を保証します。</span><span class="sxs-lookup"><span data-stu-id="81e02-145">The Azure AD Connect sync service ensures that identity information stored in the cloud is consistent with that held on-premises.</span></span> <span data-ttu-id="81e02-146">このサービスは Azure AD Connect ソフトウェアを使ってインストールします。</span><span class="sxs-lookup"><span data-stu-id="81e02-146">You install this service using the Azure AD Connect software.</span></span>

<span data-ttu-id="81e02-147">Azure AD Connect 同期を実装する前に、組織の同期要件を決定します。</span><span class="sxs-lookup"><span data-stu-id="81e02-147">Before implementing Azure AD Connect sync, determine the synchronization requirements of your organization.</span></span> <span data-ttu-id="81e02-148">たとえば、同期するもの、同期元のドメイン、同期の頻度などです。</span><span class="sxs-lookup"><span data-stu-id="81e02-148">For example, what to synchronize, from which domains, and how frequently.</span></span> <span data-ttu-id="81e02-149">詳しくは、「[ディレクトリ同期要件の決定][aad-sync-requirements]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="81e02-149">For more information, see [Determine directory synchronization requirements][aad-sync-requirements].</span></span>

<span data-ttu-id="81e02-150">Azure AD Connect 同期サービスは、オンプレミスでホストされている VM またはコンピューターで実行できます。</span><span class="sxs-lookup"><span data-stu-id="81e02-150">You can run the Azure AD Connect sync service on a VM or a computer hosted on-premises.</span></span> <span data-ttu-id="81e02-151">Active Directory ディレクトリ内の情報の変動の度合いによっては、Azure AD Connect 同期サービスの負荷が、Azure AD と初期同期された後はそれほど高くならない可能性があります。</span><span class="sxs-lookup"><span data-stu-id="81e02-151">Depending on the volatility of the information in your Active Directory directory, the load on the Azure AD Connect sync service is unlikely to be high after the initial synchronization with Azure AD.</span></span> <span data-ttu-id="81e02-152">VM でサービスを実行すると、必要に応じて簡単にサーバーを拡張できます。</span><span class="sxs-lookup"><span data-stu-id="81e02-152">Running the service on a VM makes it easier to scale the server if needed.</span></span> <span data-ttu-id="81e02-153">監視に関する考慮事項のセクションで説明されているように VM でのアクティビティを監視し、拡張が必要かどうかを判断します。</span><span class="sxs-lookup"><span data-stu-id="81e02-153">Monitor the activity on the VM as described in the Monitoring considerations section to determine whether scaling is necessary.</span></span>

<span data-ttu-id="81e02-154">フォレストに複数のオンプレミス ドメインがある場合は、フォレスト全体の情報を格納して 1 つの Azure AD テナントに同期することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="81e02-154">If you have multiple on-premises domains in a forest, we recommend storing and synchronizing information for the entire forest to a single Azure AD tenant.</span></span> <span data-ttu-id="81e02-155">複数のドメインで発生する ID の情報をフィルター処理し、各 ID が Azure AD に 1 回だけ出現し、重複しないようにします。</span><span class="sxs-lookup"><span data-stu-id="81e02-155">Filter information for identities that occur in more than one domain, so that each identity appears only once in Azure AD, rather than being duplicated.</span></span> <span data-ttu-id="81e02-156">重複していると、データを同期するときに不整合が生じる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="81e02-156">Duplication can lead to inconsistencies when data is synchronized.</span></span> <span data-ttu-id="81e02-157">詳しくは、後のトポロジに関するセクションをご覧ください。</span><span class="sxs-lookup"><span data-stu-id="81e02-157">For more information, see the Topology section below.</span></span>

<span data-ttu-id="81e02-158">必要なデータだけが Azure AD に格納されるように、フィルター機能を使います。</span><span class="sxs-lookup"><span data-stu-id="81e02-158">Use filtering so that only necessary data is stored in Azure AD.</span></span> <span data-ttu-id="81e02-159">たとえば、組織によっては、Azure AD の非アクティブなアカウントに関する情報を格納したくない場合があります。</span><span class="sxs-lookup"><span data-stu-id="81e02-159">For example, your organization might not want to store information about inactive accounts in Azure AD.</span></span> <span data-ttu-id="81e02-160">フィルター処理は、グループ、ドメイン、組織単位 (OU)、または属性に基づいて行うことができます。</span><span class="sxs-lookup"><span data-stu-id="81e02-160">Filtering can be group-based, domain-based, organization unit (OU)-based, or attribute-based.</span></span> <span data-ttu-id="81e02-161">フィルターを組み合わせて、複雑なルールを生成できます。</span><span class="sxs-lookup"><span data-stu-id="81e02-161">You can combine filters to generate more complex rules.</span></span> <span data-ttu-id="81e02-162">たとえば、ドメインに保持されているオブジェクトのうち、選んだ属性が特定の値のものだけを同期できます。</span><span class="sxs-lookup"><span data-stu-id="81e02-162">For example, you could synchronize objects held in a domain that have a specific value in a selected attribute.</span></span> <span data-ttu-id="81e02-163">詳しくは、「[Azure AD Connect Sync:フィルター処理の構成][aad-filtering]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="81e02-163">For detailed information, see [Azure AD Connect sync: Configure Filtering][aad-filtering].</span></span>

<span data-ttu-id="81e02-164">AD Connect 同期サービスに高可用性を実装するには、セカンダリ ステージング サーバーを実行します。</span><span class="sxs-lookup"><span data-stu-id="81e02-164">To implement high availability for the AD Connect sync service, run a secondary staging server.</span></span> <span data-ttu-id="81e02-165">詳しくは、トポロジの推奨事項に関するセクションをご覧ください。</span><span class="sxs-lookup"><span data-stu-id="81e02-165">For more information, see the Topology recommendations section.</span></span>

### <a name="security-recommendations"></a><span data-ttu-id="81e02-166">セキュリティに関する推奨事項</span><span class="sxs-lookup"><span data-stu-id="81e02-166">Security recommendations</span></span>

<span data-ttu-id="81e02-167">**ユーザー パスワードの管理**。</span><span class="sxs-lookup"><span data-stu-id="81e02-167">**User password management**.</span></span> <span data-ttu-id="81e02-168">Azure AD Premium Edition ではパスワードの書き戻しがサポートされており、オンプレミスのユーザーは Azure Portal 内からセルフ サービスのパスワード リセットを実行できます。</span><span class="sxs-lookup"><span data-stu-id="81e02-168">The Azure AD Premium editions support password writeback, enabling your on-premises users to perform self-service password resets from within the Azure portal.</span></span> <span data-ttu-id="81e02-169">この機能は、組織のパスワード セキュリティ ポリシーを確認した後でのみ有効にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="81e02-169">This feature should only be enabled after reviewing your organization's password security policy.</span></span> <span data-ttu-id="81e02-170">たとえば、自分のパスワードを変更できるユーザーを制限したり、パスワード管理エクスペリエンスを調整したりすることができます。</span><span class="sxs-lookup"><span data-stu-id="81e02-170">For example, you can restrict which users can change their passwords, and you can tailor the password management experience.</span></span> <span data-ttu-id="81e02-171">詳しくは、「[組織ニーズに合わせたパスワード管理のカスタマイズ][aad-password-management]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="81e02-171">For more information, see [Customizing Password Management to fit your organization's needs][aad-password-management].</span></span>

<span data-ttu-id="81e02-172">**外部からアクセスできるオンプレミスのアプリケーションを保護します。**</span><span class="sxs-lookup"><span data-stu-id="81e02-172">**Protect on-premises applications that can be accessed externally.**</span></span> <span data-ttu-id="81e02-173">Azure AD アプリケーション プロキシを使って、オンプレミスの Web アプリケーションに対する、外部ユーザーによる Azure AD を介したアクセスを制御します。</span><span class="sxs-lookup"><span data-stu-id="81e02-173">Use the Azure AD Application Proxy to provide controlled access to on-premises web applications for external users through Azure AD.</span></span> <span data-ttu-id="81e02-174">Azure ディレクトリに有効な資格情報を持つユーザーにだけ、アプリケーションを使うアクセス許可が与えられます。</span><span class="sxs-lookup"><span data-stu-id="81e02-174">Only users that have valid credentials in your Azure directory have permission to use the application.</span></span> <span data-ttu-id="81e02-175">詳しくは、「[Azure Portal でアプリケーション プロキシを有効にする][aad-application-proxy]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="81e02-175">For more information, see the article [Enable Application Proxy in the Azure portal][aad-application-proxy].</span></span>

<span data-ttu-id="81e02-176">**Azure AD で不審なアクティビティの兆候を積極的に監視します。**</span><span class="sxs-lookup"><span data-stu-id="81e02-176">**Actively monitor Azure AD for signs of suspicious activity.**</span></span> <span data-ttu-id="81e02-177">Azure AD Identity Protection が含まれる Azure AD Premium P2 Edition の使用を検討します。</span><span class="sxs-lookup"><span data-stu-id="81e02-177">Consider using Azure AD Premium P2 edition, which includes Azure AD Identity Protection.</span></span> <span data-ttu-id="81e02-178">Identity Protection はアダプティブ Machine Learning アルゴリズムとヒューリスティックを使用して、ID が侵害されていることを示している可能性のある異常とリスク イベントを検出します。</span><span class="sxs-lookup"><span data-stu-id="81e02-178">Identity Protection uses adaptive machine learning algorithms and heuristics to detect anomalies and risk events that may indicate that an identity has been compromised.</span></span> <span data-ttu-id="81e02-179">たとえば、不規則なサインイン アクティビティ、不明なソースまたは疑わしいアクティビティが発生している IP アドレスからのサインイン、感染しているおそれがあるデバイスからのサインインなど、異常なアクティビティの可能性を検出できます。</span><span class="sxs-lookup"><span data-stu-id="81e02-179">For example, it can detect potentially unusual activity such as irregular sign-in activities, sign-ins from unknown sources or from IP addresses with suspicious activity, or sign-ins from devices that may be infected.</span></span> <span data-ttu-id="81e02-180">このデータを使って、Identity Protection はレポートとアラートを生成し、ユーザーがこれらのリスク イベントを調査して、適切なアクションを実行できるようにします。</span><span class="sxs-lookup"><span data-stu-id="81e02-180">Using this data, Identity Protection generates reports and alerts that enables you to investigate these risk events and take appropriate action.</span></span> <span data-ttu-id="81e02-181">詳しくは、「[Azure Active Directory Identity Protection][aad-identity-protection]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="81e02-181">For more information, see [Azure Active Directory Identity Protection][aad-identity-protection].</span></span>

<span data-ttu-id="81e02-182">Azure Portal で Azure AD のレポート機能を使って、システムで発生しているセキュリティ関連のアクティビティを監視できます。</span><span class="sxs-lookup"><span data-stu-id="81e02-182">You can use the reporting feature of Azure AD in the Azure portal to monitor security-related activities occurring in your system.</span></span> <span data-ttu-id="81e02-183">レポートの使い方について詳しくは、「[Azure Active Directory レポート ガイド][aad-reporting-guide]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="81e02-183">For more information about using these reports, see [Azure Active Directory Reporting Guide][aad-reporting-guide].</span></span>

### <a name="topology-recommendations"></a><span data-ttu-id="81e02-184">トポロジに関する推奨事項</span><span class="sxs-lookup"><span data-stu-id="81e02-184">Topology recommendations</span></span>

<span data-ttu-id="81e02-185">組織の要件に最も近いトポロジを実装するように Azure AD Connect を構成します。</span><span class="sxs-lookup"><span data-stu-id="81e02-185">Configure Azure AD Connect to implement a topology that most closely matches the requirements of your organization.</span></span> <span data-ttu-id="81e02-186">Azure AD Connect は次のようなトポロジをサポートしています。</span><span class="sxs-lookup"><span data-stu-id="81e02-186">Topologies that Azure AD Connect supports include the following:</span></span>

- <span data-ttu-id="81e02-187">**単一のフォレスト、単一の Azure AD ディレクトリ**。</span><span class="sxs-lookup"><span data-stu-id="81e02-187">**Single forest, single Azure AD directory**.</span></span> <span data-ttu-id="81e02-188">このトポロジでは、Azure AD Connect が、オンプレミスの単一のフォレストに含まれる 1 つ以上のドメインから、単一の Azure AD テナントに、オブジェクトと ID 情報を同期します。</span><span class="sxs-lookup"><span data-stu-id="81e02-188">In this topology, Azure AD Connect synchronizes objects and identity information from one or more domains in a single on-premises forest into a single Azure AD tenant.</span></span> <span data-ttu-id="81e02-189">これは、Azure AD Connect の高速インストールによって実装される既定のトポロジです。</span><span class="sxs-lookup"><span data-stu-id="81e02-189">This is the default topology implemented by the express installation of Azure AD Connect.</span></span>

  > [!NOTE]
  > <span data-ttu-id="81e02-190">後で説明するステージング モードでサーバーを実行している場合を除き、複数の Azure AD Connect 同期サーバーを使って、オンプレミスの同じフォレストに含まれる異なるドメインを、同じ Azure AD テナントに接続しないでください。</span><span class="sxs-lookup"><span data-stu-id="81e02-190">Don't use multiple Azure AD Connect sync servers to connect different domains in the same on-premises forest to the same Azure AD tenant, unless you are running a server in staging mode, described below.</span></span>
  >
  >

- <span data-ttu-id="81e02-191">**複数のフォレスト、単一の Azure AD ディレクトリ**。</span><span class="sxs-lookup"><span data-stu-id="81e02-191">**Multiple forests, single Azure AD directory**.</span></span> <span data-ttu-id="81e02-192">このトポロジの Azure AD Connect は、複数のフォレストから、単一の Azure AD テナントに、オブジェクトと ID 情報を同期します。</span><span class="sxs-lookup"><span data-stu-id="81e02-192">In this topology, Azure AD Connect synchronizes objects and identity information from multiple forests into a single Azure AD tenant.</span></span> <span data-ttu-id="81e02-193">組織にオンプレミスのフォレストが複数ある場合は、このトポロジを使います。</span><span class="sxs-lookup"><span data-stu-id="81e02-193">Use this topology if your organization has more than one on-premises forest.</span></span> <span data-ttu-id="81e02-194">同じユーザーが複数のフォレストに存在する場合でも、個々のユーザーが Azure AD ディレクトリにおいて 1 回だけ表されるように、ID 情報を統合することができます。</span><span class="sxs-lookup"><span data-stu-id="81e02-194">You can consolidate identity information so that each unique user is represented once in the Azure AD directory, even if the same user exists in more than one forest.</span></span> <span data-ttu-id="81e02-195">すべてのフォレストは、同じ Azure AD Connect 同期サーバーを使います。</span><span class="sxs-lookup"><span data-stu-id="81e02-195">All forests use the same Azure AD Connect sync server.</span></span> <span data-ttu-id="81e02-196">Azure AD Connect 同期サーバーは、ドメインの一部になっていなくてもかまいませんが、すべてのフォレストから到達可能である必要があります。</span><span class="sxs-lookup"><span data-stu-id="81e02-196">The Azure AD Connect sync server does not have to be part of any domain, but it must be reachable from all forests.</span></span>

  > [!NOTE]
  > <span data-ttu-id="81e02-197">このトポロジでは、単一の Azure AD テナントに接続するために、オンプレミスのフォレストごとに異なる Azure AD Connect 同期サーバーを使わないでください。</span><span class="sxs-lookup"><span data-stu-id="81e02-197">In this topology, don't use separate Azure AD Connect sync servers to connect each on-premises forest to a single Azure AD tenant.</span></span> <span data-ttu-id="81e02-198">このようにすると、同じユーザーが複数のフォレストに存在する場合、Azure AD に重複する ID 情報が作成されてしまいます。</span><span class="sxs-lookup"><span data-stu-id="81e02-198">This can result in duplicated identity information in Azure AD if users are present in more than one forest.</span></span>
  >

- <span data-ttu-id="81e02-199">**複数のフォレスト、分離トポロジ**。</span><span class="sxs-lookup"><span data-stu-id="81e02-199">**Multiple forests, separate topologies**.</span></span> <span data-ttu-id="81e02-200">このトポロジは、異なるフォレストからの ID 情報を単一の Azure AD テナントにマージし、すべてのフォレストを個別のエンティティとして処理します。</span><span class="sxs-lookup"><span data-stu-id="81e02-200">This topology merges identity information from separate forests into a single Azure AD tenant, treating all forests as separate entities.</span></span> <span data-ttu-id="81e02-201">このトポロジは、異なる複数の組織からフォレストを結合していて、各ユーザーの ID 情報が 1 つのフォレストにのみ保持されている場合に便利です。</span><span class="sxs-lookup"><span data-stu-id="81e02-201">This topology is useful if you are combining forests from different organizations and the identity information for each user is held in only one forest.</span></span>

  > [!NOTE]
  > <span data-ttu-id="81e02-202">各フォレストのグローバル アドレス一覧 (GAL) が同期されている場合、あるフォレストのユーザーが別のフォレストに連絡先として存在する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="81e02-202">If the global address lists (GAL) in each forest are synchronized, a user in one forest may be present in another as a contact.</span></span> <span data-ttu-id="81e02-203">このようなことは、組織が GALSync を Forefront Identity Manager 2010 または Microsoft Identity Manager 2016 で実装している場合に、発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="81e02-203">This can occur if your organization has implemented GALSync with Forefront Identity manager 2010 or Microsoft Identity Manager 2016.</span></span> <span data-ttu-id="81e02-204">このシナリオでは、ユーザーが "*メール*" 属性によって識別されるように指定できます。</span><span class="sxs-lookup"><span data-stu-id="81e02-204">In this scenario, you can specify that users should be identified by their *Mail* attribute.</span></span> <span data-ttu-id="81e02-205">また、*ObjectSID* および *msExchMasterAccountSID* 属性を使って ID を照合することもできます。</span><span class="sxs-lookup"><span data-stu-id="81e02-205">You can also match identities using the *ObjectSID* and *msExchMasterAccountSID* attributes.</span></span> <span data-ttu-id="81e02-206">これは、アカウントが無効になったリソース フォレストが存在する場合に便利です。</span><span class="sxs-lookup"><span data-stu-id="81e02-206">This is useful if you have one or more resource forests with disabled accounts.</span></span>
  >

- <span data-ttu-id="81e02-207">**ステージング サーバー**。</span><span class="sxs-lookup"><span data-stu-id="81e02-207">**Staging server**.</span></span> <span data-ttu-id="81e02-208">この構成では、Azure AD Connect 同期サーバーの第 2 のインスタンスを、第 1 のインスタンスと並行して実行します。</span><span class="sxs-lookup"><span data-stu-id="81e02-208">In this configuration, you run a second instance of the Azure AD Connect sync server in parallel with the first.</span></span> <span data-ttu-id="81e02-209">この構造は、次のようなシナリオをサポートします。</span><span class="sxs-lookup"><span data-stu-id="81e02-209">This structure supports scenarios such as:</span></span>

  - <span data-ttu-id="81e02-210">高可用性:</span><span class="sxs-lookup"><span data-stu-id="81e02-210">High availability.</span></span>
  - <span data-ttu-id="81e02-211">Azure AD Connect 同期サーバーの新しい構成のテストとデプロイ。</span><span class="sxs-lookup"><span data-stu-id="81e02-211">Testing and deploying a new configuration of the Azure AD Connect sync server.</span></span>
  - <span data-ttu-id="81e02-212">新しいサーバーの導入と前の構成の使用停止。</span><span class="sxs-lookup"><span data-stu-id="81e02-212">Introducing a new server and decommissioning an old configuration.</span></span>

    <span data-ttu-id="81e02-213">これらのシナリオでは、第 2 のインスタンスは "*ステージング モード*" で実行します。</span><span class="sxs-lookup"><span data-stu-id="81e02-213">In these scenarios, the second instance runs in *staging mode*.</span></span> <span data-ttu-id="81e02-214">サーバーは、インポートされたオブジェクトと同期データをデータベースに記録しますが、Azure AD にはデータを渡しません。</span><span class="sxs-lookup"><span data-stu-id="81e02-214">The server records imported objects and synchronization data in its database, but does not pass the data to Azure AD.</span></span> <span data-ttu-id="81e02-215">ステージング モードを無効にすると、サーバーは Azure AD へのデータの書き込みを開始し、必要に応じてオンプレミスのディレクトリへのパスワードの書き戻しを実行し始めます。</span><span class="sxs-lookup"><span data-stu-id="81e02-215">If you disable staging mode, the server starts writing data to Azure AD, and also starts performing password write-backs into the on-premises directories where appropriate.</span></span> <span data-ttu-id="81e02-216">詳しくは、「[Azure AD Connect Sync:操作タスクおよび考慮事項][aad-connect-sync-operational-tasks]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="81e02-216">For more information, see [Azure AD Connect sync: Operational tasks and considerations][aad-connect-sync-operational-tasks].</span></span>

- <span data-ttu-id="81e02-217">**複数の Azure AD ディレクトリ**。</span><span class="sxs-lookup"><span data-stu-id="81e02-217">**Multiple Azure AD directories**.</span></span> <span data-ttu-id="81e02-218">組織に対して 1 つの Azure AD ディレクトリを作成することをお勧めしますが、状況によっては、情報を異なる複数の Azure AD ディレクトリに分割することが必要になる場合があります。</span><span class="sxs-lookup"><span data-stu-id="81e02-218">It is recommended that you create a single Azure AD directory for an organization, but there may be situations where you need to partition information across separate Azure AD directories.</span></span> <span data-ttu-id="81e02-219">そのような場合は、同期とパスワードの書き戻しの問題を防ぐため、オンプレミスのフォレストの各オブジェクトが、ただ 1 つの Azure AD ディレクトリだけに含まれるようにします。</span><span class="sxs-lookup"><span data-stu-id="81e02-219">In this case, avoid synchronization and password write-back issues by ensuring that each object from the on-premises forest appears in only one Azure AD directory.</span></span> <span data-ttu-id="81e02-220">このシナリオを実装するには、Azure AD ディレクトリごとに個別の Azure AD Connect 同期サーバーを構成し、フィルターを使って、各 Azure AD Connect 同期サーバーが、相互に排他的なオブジェクトのセットを処理するようにします。</span><span class="sxs-lookup"><span data-stu-id="81e02-220">To implement this scenario, configure separate Azure AD Connect sync servers for each Azure AD directory, and use filtering so that each Azure AD Connect sync server operates on a mutually exclusive set of objects.</span></span>

<span data-ttu-id="81e02-221">これらのトポロジについて詳しくは、「[Azure AD Connect のトポロジ][aad-topologies]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="81e02-221">For more information about these topologies, see [Topologies for Azure AD Connect][aad-topologies].</span></span>

### <a name="user-authentication"></a><span data-ttu-id="81e02-222">ユーザー認証</span><span class="sxs-lookup"><span data-stu-id="81e02-222">User authentication</span></span>

<span data-ttu-id="81e02-223">既定では、Azure AD Connect 同期サーバーはオンプレミスのドメインと Azure AD の間にパスワード ハッシュ同期を構成し、Azure AD サービスは、ユーザーがオンプレミスで使っているものと同じパスワードで認証を行うものと想定されています。</span><span class="sxs-lookup"><span data-stu-id="81e02-223">By default, the Azure AD Connect sync server configures password hash synchronization between the on-premises domain and Azure AD, and the Azure AD service assumes that users authenticate by providing the same password that they use on-premises.</span></span> <span data-ttu-id="81e02-224">多くの組織にはこの方法が適していますが、組織の既存のポリシーとインフラストラクチャを考慮する必要があります。</span><span class="sxs-lookup"><span data-stu-id="81e02-224">For many organizations, this is appropriate, but you should consider your organization's existing policies and infrastructure.</span></span> <span data-ttu-id="81e02-225">例: </span><span class="sxs-lookup"><span data-stu-id="81e02-225">For example:</span></span>

- <span data-ttu-id="81e02-226">組織のセキュリティ ポリシーで、クラウドへのパスワード ハッシュの同期が禁止されている可能性があります。</span><span class="sxs-lookup"><span data-stu-id="81e02-226">The security policy of your organization may prohibit synchronizing password hashes to the cloud.</span></span> <span data-ttu-id="81e02-227">この場合は、お客様の組織が[パススルー認証](/azure/active-directory/connect/active-directory-aadconnect-pass-through-authentication)を検討する必要があります。</span><span class="sxs-lookup"><span data-stu-id="81e02-227">In this case your organization should consider [pass-through authentication](/azure/active-directory/connect/active-directory-aadconnect-pass-through-authentication).</span></span>
- <span data-ttu-id="81e02-228">ユーザーが、企業ネットワーク上のドメイン参加マシンからクラウドのリソースに、シームレスなシングル サインオン (SSO) でアクセスできるようにすることが必要な場合があります。</span><span class="sxs-lookup"><span data-stu-id="81e02-228">You might require that users experience seamless single sign-on (SSO) when accessing cloud resources from domain-joined machines on the corporate network.</span></span>
- <span data-ttu-id="81e02-229">組織によっては、Active Directory フェデレーション サービス (AD FS) またはサード パーティのフェデレーション プロバイダーが既にデプロイされている場合があります。</span><span class="sxs-lookup"><span data-stu-id="81e02-229">Your organization might already have Active Directory Federation Services (AD FS) or a third party federation provider deployed.</span></span> <span data-ttu-id="81e02-230">クラウドに保持されているパスワード情報ではなく、このインフラストラクチャを使って認証と SSO を実装するように、Azure AD を構成できます。</span><span class="sxs-lookup"><span data-stu-id="81e02-230">You can configure Azure AD to use this infrastructure to implement authentication and SSO rather than by using password information held in the cloud.</span></span>

<span data-ttu-id="81e02-231">詳しくは、「[Azure AD Connect ユーザーのサインイン オプション][aad-user-sign-in]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="81e02-231">For more information, see [Azure AD Connect User Sign on options][aad-user-sign-in].</span></span>

### <a name="azure-ad-application-proxy"></a><span data-ttu-id="81e02-232">Azure AD アプリケーション プロキシ</span><span class="sxs-lookup"><span data-stu-id="81e02-232">Azure AD application proxy</span></span>

<span data-ttu-id="81e02-233">Azure AD を使って、オンプレミスのアプリケーションにアクセスできるようにします。</span><span class="sxs-lookup"><span data-stu-id="81e02-233">Use Azure AD to provide access to on-premises applications.</span></span>

<span data-ttu-id="81e02-234">Azure AD アプリケーション プロキシ コンポーネントによって管理されるアプリケーション プロキシ コネクタを使って、オンプレミスの Web アプリケーションを公開します。</span><span class="sxs-lookup"><span data-stu-id="81e02-234">Expose your on-premises web applications using application proxy connectors managed by the Azure AD application proxy component.</span></span> <span data-ttu-id="81e02-235">アプリケーション プロキシ コネクタは Azure AD アプリケーション プロキシへの送信ネットワーク接続を開き、リモート ユーザーの要求は、この接続を介して Azure AD から Web アプリに戻るようにルーティングされます。</span><span class="sxs-lookup"><span data-stu-id="81e02-235">The application proxy connector opens an outbound network connection to the Azure AD application proxy, and remote users' requests are routed back from Azure AD through this connection to the web apps.</span></span> <span data-ttu-id="81e02-236">これにより、オンプレミスのファイアウォールで受信ポートを開く必要がなくなり、組織が攻撃にさらされている範囲が削減されます。</span><span class="sxs-lookup"><span data-stu-id="81e02-236">This removes the need to open inbound ports in the on-premises firewall and reduces the attack surface exposed by your organization.</span></span>

<span data-ttu-id="81e02-237">詳しくは、「[Azure AD アプリケーション プロキシを使用してアプリケーションを発行する][aad-application-proxy]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="81e02-237">For more information, see [Publish applications using Azure AD Application proxy][aad-application-proxy].</span></span>

### <a name="object-synchronization"></a><span data-ttu-id="81e02-238">オブジェクトの同期</span><span class="sxs-lookup"><span data-stu-id="81e02-238">Object synchronization</span></span>

<span data-ttu-id="81e02-239">Azure AD Connect の既定の構成は、「[Azure AD Connect Sync:既定の構成について][aad-connect-sync-default-rules]」で指定されている規則に基づいて、お使いのローカルな Active Directory ディレクトリからオブジェクトを同期します。</span><span class="sxs-lookup"><span data-stu-id="81e02-239">Azure AD Connect's default configuration synchronizes objects from your local Active Directory directory based on the rules specified in the article [Azure AD Connect sync: Understanding the default configuration][aad-connect-sync-default-rules].</span></span> <span data-ttu-id="81e02-240">これらの規則を満たすオブジェクトは同期され、他のすべてのオブジェクトは無視されます。</span><span class="sxs-lookup"><span data-stu-id="81e02-240">Objects that satisfy these rules are synchronized while all other objects are ignored.</span></span> <span data-ttu-id="81e02-241">規則の例を次に示します。</span><span class="sxs-lookup"><span data-stu-id="81e02-241">Some example rules:</span></span>

- <span data-ttu-id="81e02-242">ユーザー オブジェクトは、一意の *sourceAnchor* 属性を持ち、*accountEnabled* 属性が設定されている必要がある。</span><span class="sxs-lookup"><span data-stu-id="81e02-242">User objects must have a unique *sourceAnchor* attribute and the *accountEnabled* attribute must be populated.</span></span>
- <span data-ttu-id="81e02-243">ユーザー オブジェクトは、*sAMAccountName* 属性を持つ必要があり、テキスト *Azure AD_* または *MSOL_* で始まっていてはならない。</span><span class="sxs-lookup"><span data-stu-id="81e02-243">User objects must have a *sAMAccountName* attribute and cannot start with the text *Azure AD_* or *MSOL_*.</span></span>

<span data-ttu-id="81e02-244">Azure AD Connect は、User、Contact、Group、ForeignSecurityPrincipal、Computer の各オブジェクトに、複数の規則を適用します。</span><span class="sxs-lookup"><span data-stu-id="81e02-244">Azure AD Connect applies several rules to User, Contact, Group, ForeignSecurityPrincipal, and Computer objects.</span></span> <span data-ttu-id="81e02-245">既定の規則セットを変更する必要がある場合は、Azure AD Connect でインストールされる同期規則エディターを使います。</span><span class="sxs-lookup"><span data-stu-id="81e02-245">Use the Synchronization Rules Editor installed with Azure AD Connect if you need to modify the default set of rules.</span></span> <span data-ttu-id="81e02-246">詳しくは、「[Azure AD Connect Sync:既定の構成について][aad-connect-sync-default-rules]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="81e02-246">For more information, see [Azure AD Connect sync: Understanding the default configuration][aad-connect-sync-default-rules]).</span></span>

<span data-ttu-id="81e02-247">また、独自のフィルターを定義し、同期されるオブジェクトをドメインまたは OU の値で制限することができます。</span><span class="sxs-lookup"><span data-stu-id="81e02-247">You can also define your own filters to limit the objects to be synchronized by domain or OU.</span></span> <span data-ttu-id="81e02-248">または、「[Azure AD Connect Sync:フィルター処理の構成][aad-filtering]」で説明されているように、さらに複雑なカスタム フィルター処理を実装することもできます。</span><span class="sxs-lookup"><span data-stu-id="81e02-248">Alternatively, you can implement more complex custom filtering such as that described in [Azure AD Connect sync: Configure Filtering][aad-filtering].</span></span>

### <a name="monitoring"></a><span data-ttu-id="81e02-249">監視</span><span class="sxs-lookup"><span data-stu-id="81e02-249">Monitoring</span></span>

<span data-ttu-id="81e02-250">正常性の監視は、オンプレミスにインストールされる次のエージェントによって実行されます。</span><span class="sxs-lookup"><span data-stu-id="81e02-250">Health monitoring is performed by the following agents installed on-premises:</span></span>

- <span data-ttu-id="81e02-251">Azure AD Connect は、同期操作に関する情報をキャプチャするエージェントをインストールします。</span><span class="sxs-lookup"><span data-stu-id="81e02-251">Azure AD Connect installs an agent that captures information about synchronization operations.</span></span> <span data-ttu-id="81e02-252">正常性とパフォーマンスを監視するには、Azure Portal の [Azure AD Connect Health] ブレードを使います。</span><span class="sxs-lookup"><span data-stu-id="81e02-252">Use the Azure AD Connect Health blade in the Azure portal to monitor its health and performance.</span></span> <span data-ttu-id="81e02-253">詳しくは、「[Azure AD Connect Health for Sync の使用][aad-health]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="81e02-253">For more information, see [Using Azure AD Connect Health for sync][aad-health].</span></span>
- <span data-ttu-id="81e02-254">AD DS ドメインとディレクトリの正常性を Azure から監視するには、オンプレミスのドメイン内のマシンに Azure AD Connect Health for AD DS エージェントをインストールします。</span><span class="sxs-lookup"><span data-stu-id="81e02-254">To monitor the health of the AD DS domains and directories from Azure, install the Azure AD Connect Health for AD DS agent on a machine within the on-premises domain.</span></span> <span data-ttu-id="81e02-255">正常性の監視には、Azure Portal の [Azure Active Directory Connect Health] ブレードを使います。</span><span class="sxs-lookup"><span data-stu-id="81e02-255">Use the Azure Active Directory Connect Health blade in the Azure portal for health monitoring.</span></span> <span data-ttu-id="81e02-256">詳しくは、「[AD DS での Azure AD Connect Health の使用][aad-health-adds]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="81e02-256">For more information, see [Using Azure AD Connect Health with AD DS][aad-health-adds]</span></span>
- <span data-ttu-id="81e02-257">オンプレミスで実行しているサービスの正常性を監視するには Azure AD Connect Health for AD FS エージェントをインストールし、AD FS を監視するには Azure Portal の [Azure Active Directory Connect Health] ブレードを使います。</span><span class="sxs-lookup"><span data-stu-id="81e02-257">Install the Azure AD Connect Health for AD FS agent to monitor the health of services running on on-premises, and use the Azure Active Directory Connect Health blade in the Azure portal to monitor AD FS.</span></span> <span data-ttu-id="81e02-258">詳しくは、「[AD FS での Azure AD Connect Health の使用][aad-health-adfs]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="81e02-258">For more information, see [Using Azure AD Connect Health with AD FS][aad-health-adfs]</span></span>

<span data-ttu-id="81e02-259">AD Connect Health エージェントのインストールとその要件について詳しくは、「[Azure AD Connect Health エージェントのインストール][aad-agent-installation]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="81e02-259">For more information on installing the AD Connect Health agents and their requirements, see [Azure AD Connect Health Agent Installation][aad-agent-installation].</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="81e02-260">スケーラビリティに関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="81e02-260">Scalability considerations</span></span>

<span data-ttu-id="81e02-261">Azure AD サービスはレプリカに基づく拡張性をサポートし、書き込み操作を処理する 1 つのプライマリ レプリカと、複数の読み取り専用セカンダリ レプリカを使います。</span><span class="sxs-lookup"><span data-stu-id="81e02-261">The Azure AD service supports scalability based on replicas, with a single primary replica that handles write operations plus multiple read-only secondary replicas.</span></span> <span data-ttu-id="81e02-262">Azure AD は、セカンダリ レプリカに対して試みられた書き込みをプライマリ レプリカに透過的にリダイレクトして、最終的な整合性を提供します。</span><span class="sxs-lookup"><span data-stu-id="81e02-262">Azure AD transparently redirects attempted writes made against secondary replicas to the primary replica and provides eventual consistency.</span></span> <span data-ttu-id="81e02-263">プライマリ レプリカに加えられたすべての変更は、セカンダリ レプリカに伝達されます。</span><span class="sxs-lookup"><span data-stu-id="81e02-263">All changes made to the primary replica are propagated to the secondary replicas.</span></span> <span data-ttu-id="81e02-264">Azure AD に対するほとんどの操作は書き込みではなく読み取りなので、このアーキテクチャは優れた拡張性を備えています。</span><span class="sxs-lookup"><span data-stu-id="81e02-264">This architecture scales well because most operations against Azure AD are reads rather than writes.</span></span> <span data-ttu-id="81e02-265">詳しくは、[Azure AD:地理冗長で高可用性の分散クラウド ディレクトリの内部][aad-scalability]に関するページをご覧ください。</span><span class="sxs-lookup"><span data-stu-id="81e02-265">For more information, see [Azure AD: Under the hood of our geo-redundant, highly available, distributed cloud directory][aad-scalability].</span></span>

<span data-ttu-id="81e02-266">Azure AD Connect 同期サーバーの場合、ローカル ディレクトリから同期すると予想されるオブジェクトの数を決定します。</span><span class="sxs-lookup"><span data-stu-id="81e02-266">For the Azure AD Connect sync server, determine how many objects you are likely to synchronize from your local directory.</span></span> <span data-ttu-id="81e02-267">オブジェクトが 100,000 未満の場合は、Azure AD Connect に付属する既定の SQL Server Express LocalDB ソフトウェアを使うことができます。</span><span class="sxs-lookup"><span data-stu-id="81e02-267">If you have less than 100,000 objects, you can use the default SQL Server Express LocalDB software provided with Azure AD Connect.</span></span> <span data-ttu-id="81e02-268">オブジェクトの数がそれより多い場合は、運用バージョンの SQL Server をインストールし、Azure AD Connect のカスタム インストールを実行して、SQL Server の既存のインスタンスを使う必要があることを指定します。</span><span class="sxs-lookup"><span data-stu-id="81e02-268">If you have a larger number of objects, you should install a production version of SQL Server and perform a custom installation of Azure AD Connect, specifying that it should use an existing instance of SQL Server.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="81e02-269">可用性に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="81e02-269">Availability considerations</span></span>

<span data-ttu-id="81e02-270">Azure AD サービスは、地理的に分散されており、自動フェールオーバーを利用して、世界中に点在する複数のデータ センターで実行されます。</span><span class="sxs-lookup"><span data-stu-id="81e02-270">The Azure AD service is geo-distributed and runs in multiple data centers spread around the world with automated failover.</span></span> <span data-ttu-id="81e02-271">データ センターが利用できなくなった場合、Azure AD は少なくとも 2 つの他のリージョンにあるデータ センターでディレクトリ データのインスタンスにアクセスできることを保証します。</span><span class="sxs-lookup"><span data-stu-id="81e02-271">If a data center becomes unavailable, Azure AD ensures that your directory data is available for instance access in at least two more regionally dispersed data centers.</span></span>

> [!NOTE]
> <span data-ttu-id="81e02-272">Azure AD Basic および Premium サービスのサービス レベル アグリーメント (SLA) では、99.9% 以上の可用性が保証されます。</span><span class="sxs-lookup"><span data-stu-id="81e02-272">The service level agreement (SLA) for Azure AD Basic and Premium services guarantees at least 99.9% availability.</span></span> <span data-ttu-id="81e02-273">Azure AD の Free レベルには SLA はありません。</span><span class="sxs-lookup"><span data-stu-id="81e02-273">There is no SLA for the Free tier of Azure AD.</span></span> <span data-ttu-id="81e02-274">詳しくは、「[Azure Active Directory の SLA][sla-aad]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="81e02-274">For more information, see [SLA for Azure Active Directory][sla-aad].</span></span>
>

<span data-ttu-id="81e02-275">トポロジの推奨事項のセクションで説明したように、可用性を高めるには、ステージング モードで Azure AD Connect 同期サーバーの第 2 のインスタンスをプロビジョニングすることを検討してください。</span><span class="sxs-lookup"><span data-stu-id="81e02-275">Consider provisioning a second instance of Azure AD Connect sync server in staging mode to increase availability, as discussed in the topology recommendations section.</span></span>

<span data-ttu-id="81e02-276">Azure AD Connect に付属する SQL Server Express LocalDB のインスタンスを使っていない場合は、SQL のクラスタリングを使って高可用性を実現することを検討します。</span><span class="sxs-lookup"><span data-stu-id="81e02-276">If you are not using the SQL Server Express LocalDB instance that comes with Azure AD Connect, consider using SQL clustering to achieve high availability.</span></span> <span data-ttu-id="81e02-277">ミラーリングや Always On などのソリューションは、Azure AD Connect ではサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="81e02-277">Solutions such as mirroring and Always On are not supported by Azure AD Connect.</span></span>

<span data-ttu-id="81e02-278">Azure AD Connect 同期サーバーの高可用性の実現に関するその他の考慮事項と、障害発生後の復旧方法については、「[Azure AD Connect Sync:操作タスクおよび考慮事項 - ディザスター リカバリー][aad-sync-disaster-recovery]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="81e02-278">For additional considerations about achieving high availability of the Azure AD Connect sync server and also how to recover after a failure, see [Azure AD Connect sync: Operational tasks and considerations - Disaster Recovery][aad-sync-disaster-recovery].</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="81e02-279">管理容易性に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="81e02-279">Manageability considerations</span></span>

<span data-ttu-id="81e02-280">Azure AD の管理には次の 2 つの側面があります。</span><span class="sxs-lookup"><span data-stu-id="81e02-280">There are two aspects to managing Azure AD:</span></span>

- <span data-ttu-id="81e02-281">クラウドでの Azure AD の管理。</span><span class="sxs-lookup"><span data-stu-id="81e02-281">Administering Azure AD in the cloud.</span></span>
- <span data-ttu-id="81e02-282">Azure AD Connect 同期サーバーの管理。</span><span class="sxs-lookup"><span data-stu-id="81e02-282">Maintaining the Azure AD Connect sync servers.</span></span>

<span data-ttu-id="81e02-283">Azure AD では、クラウド内のドメインとディレクトリの管理に関して、次のオプションが用意されています。</span><span class="sxs-lookup"><span data-stu-id="81e02-283">Azure AD provides the following options for managing domains and directories in the cloud:</span></span>

- <span data-ttu-id="81e02-284">**Azure Active Directory PowerShell モジュール**。</span><span class="sxs-lookup"><span data-stu-id="81e02-284">**Azure Active Directory PowerShell Module**.</span></span> <span data-ttu-id="81e02-285">ユーザー管理、ドメイン管理、シングル サインオンの構成など、Azure AD でよく行われる管理タスクのスクリプトを作成する必要がある場合は、この[モジュール][aad-powershell]を使います。</span><span class="sxs-lookup"><span data-stu-id="81e02-285">Use this [module][aad-powershell] if you need to script common Azure AD administrative tasks such as user management, domain management, and configuring single sign-on.</span></span>
- <span data-ttu-id="81e02-286">**Azure Portal の Azure AD 管理ブレード**。</span><span class="sxs-lookup"><span data-stu-id="81e02-286">**Azure AD management blade in the Azure portal**.</span></span> <span data-ttu-id="81e02-287">このブレードでは、ディレクトリの対話形式の管理ビューが提供されており、Azure AD のほとんどの側面を制御および構成することができます。</span><span class="sxs-lookup"><span data-stu-id="81e02-287">This blade provides an interactive management view of the directory, and enables you to control and configure most aspects of Azure AD.</span></span>

<span data-ttu-id="81e02-288">Azure AD Connect では、オンプレミスのコンピューターから Azure AD Connect 同期サービスを維持するための、次のツールがインストールされます。</span><span class="sxs-lookup"><span data-stu-id="81e02-288">Azure AD Connect installs the following tools to maintain Azure AD Connect sync services from your on-premises machines:</span></span>

- <span data-ttu-id="81e02-289">**Microsoft Azure Active Directory Connect コンソール**。</span><span class="sxs-lookup"><span data-stu-id="81e02-289">**Microsoft Azure Active Directory Connect console**.</span></span> <span data-ttu-id="81e02-290">このツールを使うと、Azure AD Sync サーバーの構成の変更、同期方法のカスタマイズ、ステージング モードの有効化または無効化、ユーザーのサインイン モードの切り替えを行うことができます。</span><span class="sxs-lookup"><span data-stu-id="81e02-290">This tool enables you to modify the configuration of the Azure AD Sync server, customize how synchronization occurs, enable or disable staging mode, and switch the user sign-in mode.</span></span> <span data-ttu-id="81e02-291">オンプレミスのインフラストラクチャを使って Active Directory FS サインインを有効にできることにご注意ください。</span><span class="sxs-lookup"><span data-stu-id="81e02-291">Note that you can enable Active Directory FS sign-in using your on-premises infrastructure.</span></span>
- <span data-ttu-id="81e02-292">**Synchronization Service Manager**。</span><span class="sxs-lookup"><span data-stu-id="81e02-292">**Synchronization Service Manager**.</span></span> <span data-ttu-id="81e02-293">同期プロセスを管理し、プロセスのどこかが失敗したかどうかを検出するには、このツールの *[Operations]\(操作\)* タブを使います。</span><span class="sxs-lookup"><span data-stu-id="81e02-293">Use the *Operations* tab in this tool to manage the synchronization process and detect whether any parts of the process have failed.</span></span> <span data-ttu-id="81e02-294">このツールを使うと、同期を手動でトリガーできます。</span><span class="sxs-lookup"><span data-stu-id="81e02-294">You can trigger synchronizations manually using this tool.</span></span> <span data-ttu-id="81e02-295">*[Connectors]\(コネクタ\)* タブでは、同期エンジンがアタッチされているドメインに対する接続を制御することができます。</span><span class="sxs-lookup"><span data-stu-id="81e02-295">The *Connectors* tab enables you to control the connections for the domains that the synchronization engine is attached to.</span></span>
- <span data-ttu-id="81e02-296">**同期規則エディター**。</span><span class="sxs-lookup"><span data-stu-id="81e02-296">**Synchronization Rules Editor**.</span></span> <span data-ttu-id="81e02-297">このツールは、オンプレミスのディレクトリと Azure AD の間でオブジェクトがコピーされるときのオブジェクトの変換方法をカスタマイズするために使います。</span><span class="sxs-lookup"><span data-stu-id="81e02-297">Use this tool to customize the way objects are transformed when they are copied between an on-premises directory and Azure AD.</span></span> <span data-ttu-id="81e02-298">このツールを使うと、同期の追加属性とオブジェクトを指定した後、フィルターを実行して、同期の必要なオブジェクトと不要なオブジェクトを決定できます。</span><span class="sxs-lookup"><span data-stu-id="81e02-298">This tool enables you to specify additional attributes and objects for synchronization, then executes filters to determine which objects should or should not be synchronized.</span></span> <span data-ttu-id="81e02-299">詳しくは、「[Azure AD Connect Sync:既定の構成について][aad-connect-sync-default-rules]」の同期規則エディターに関するセクションをご覧ください。</span><span class="sxs-lookup"><span data-stu-id="81e02-299">For more information, see the Synchronization Rule Editor section in the document [Azure AD Connect sync: Understanding the default configuration][aad-connect-sync-default-rules].</span></span>

<span data-ttu-id="81e02-300">Azure AD Connect の管理に関する詳細とヒントについては、「[Azure AD Connect Sync:既定の構成を変更するためのベスト プラクティス][aad-sync-best-practices]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="81e02-300">For more information and tips for managing Azure AD Connect, see [Azure AD Connect sync: Best practices for changing the default configuration][aad-sync-best-practices].</span></span>

## <a name="security-considerations"></a><span data-ttu-id="81e02-301">セキュリティに関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="81e02-301">Security considerations</span></span>

<span data-ttu-id="81e02-302">予期しないソースからの認証要求を拒否するには、条件付きアクセス制御を使います。</span><span class="sxs-lookup"><span data-stu-id="81e02-302">Use conditional access control to deny authentication requests from unexpected sources:</span></span>

- <span data-ttu-id="81e02-303">信頼されたネットワークではなくインターネット経由などのように、ユーザーが信頼できない場所から接続しようとしている場合は、[Azure Multi-factor Authentication (MFA)][azure-multifactor-authentication] をトリガーします。</span><span class="sxs-lookup"><span data-stu-id="81e02-303">Trigger [Azure Multi-Factor Authentication (MFA)][azure-multifactor-authentication] if a user attempts to connect from a nontrusted location such as across the Internet instead of a trusted network.</span></span>

- <span data-ttu-id="81e02-304">ユーザーのデバイス プラットフォームの種類 (iOS、Android、Windows Mobile、Windows) を使って、アプリケーションや機能へのアクセス ポリシーを決定します。</span><span class="sxs-lookup"><span data-stu-id="81e02-304">Use the device platform type of the user (iOS, Android, Windows Mobile, Windows) to determine access policy to applications and features.</span></span>

- <span data-ttu-id="81e02-305">ユーザーのデバイスの有効/無効状態を記録し、この情報をアクセス ポリシーのチェックに組み込みます。</span><span class="sxs-lookup"><span data-stu-id="81e02-305">Record the enabled/disabled state of users' devices, and incorporate this information into the access policy checks.</span></span> <span data-ttu-id="81e02-306">たとえば、ユーザーが電話をなくしたり盗まれたりした場合は、その電話を無効と記録し、アクセスに使われないようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="81e02-306">For example, if a user's phone is lost or stolen it should be recorded as disabled to prevent it from being used to gain access.</span></span>

- <span data-ttu-id="81e02-307">グループ メンバーシップに基づいて、リソースへのユーザーのアクセスを制御します。</span><span class="sxs-lookup"><span data-stu-id="81e02-307">Control user access to resources based on group membership.</span></span> <span data-ttu-id="81e02-308">グループの管理を簡素化するには、[Azure AD 動的メンバーシップ ルール][aad-dynamic-membership-rules]を使います。</span><span class="sxs-lookup"><span data-stu-id="81e02-308">Use [Azure AD dynamic membership rules][aad-dynamic-membership-rules] to simplify group administration.</span></span> <span data-ttu-id="81e02-309">この機能の簡単な概要については、「[Introduction to Dynamic Memberships for Groups][aad-dynamic-memberships]」(グループの動的メンバーシップの概要) をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="81e02-309">For a brief overview of how this works, see [Introduction to Dynamic Memberships for Groups][aad-dynamic-memberships].</span></span>

- <span data-ttu-id="81e02-310">疑わしいサインイン アクティビティや他のイベントに基づいて高度な保護を提供するには、Azure AD Identity Protection の条件付きアクセス リスク ポリシーを使います。</span><span class="sxs-lookup"><span data-stu-id="81e02-310">Use conditional access risk policies with Azure AD Identity Protection to provide advanced protection based on unusual sign-in activities or other events.</span></span>

<span data-ttu-id="81e02-311">詳しくは、「[Azure Active Directory の条件付きアクセス][aad-conditional-access]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="81e02-311">For more information, see [Azure Active Directory conditional access][aad-conditional-access].</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="81e02-312">ソリューションのデプロイ方法</span><span class="sxs-lookup"><span data-stu-id="81e02-312">Deploy the solution</span></span>

<span data-ttu-id="81e02-313">以上の推奨事項と考慮事項を実装する参照アーキテクチャのデプロイは、GitHub で入手できます。</span><span class="sxs-lookup"><span data-stu-id="81e02-313">A deployment for a reference architecture that implements these recommendations and considerations is available on GitHub.</span></span> <span data-ttu-id="81e02-314">この参照アーキテクチャでは、シミュレートされたオンプレミスのネットワークが Azure に展開されるので、それを使ってテストや実験を行うことができます。</span><span class="sxs-lookup"><span data-stu-id="81e02-314">This reference architecture deploys a simulated on-premises network in Azure that you can use to test and experiment.</span></span> <span data-ttu-id="81e02-315">参照アーキテクチャは、次の手順に従って、Windows または Linux VM にデプロイできます。</span><span class="sxs-lookup"><span data-stu-id="81e02-315">The reference architecture can be deployed with either with Windows or Linux VMs by following the directions below:</span></span>

<!-- markdownlint-disable MD033 -->

1. <span data-ttu-id="81e02-316">下のボタンをクリックしてください。</span><span class="sxs-lookup"><span data-stu-id="81e02-316">Click the button below:</span></span><br><a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fmspnp%2Fidentity-reference-architectures%2Fmaster%2Fazure-ad%2Fazuredeploy.json" target="_blank"><img src="https://azuredeploy.net/deploybutton.png"/></a>

2. <span data-ttu-id="81e02-317">Azure Portal でリンクが開いたら、いくつかの設定に値を入力する必要があります。</span><span class="sxs-lookup"><span data-stu-id="81e02-317">Once the link has opened in the Azure portal, you must enter values for some of the settings:</span></span>
   - <span data-ttu-id="81e02-318">**リソース グループ**の名前はパラメーター ファイルで既に定義されているため、**[新規作成]** を選択し、テキスト ボックスに「`ra-aad-onpremise-rg`」と入力します。</span><span class="sxs-lookup"><span data-stu-id="81e02-318">The **Resource group** name is already defined in the parameter file, so select **Create New** and enter `ra-aad-onpremise-rg` in the text box.</span></span>
   - <span data-ttu-id="81e02-319">**[場所]** ボックスの一覧でリージョンを選択します。</span><span class="sxs-lookup"><span data-stu-id="81e02-319">Select the region from the **Location** drop down box.</span></span>
   - <span data-ttu-id="81e02-320">**[Template Root Uri (テンプレート ルート URI)]** または **[Parameter Root Uri (パラメーター ルート URI)]** ボックスは編集しないでください。</span><span class="sxs-lookup"><span data-stu-id="81e02-320">Do not edit the **Template Root Uri** or the **Parameter Root Uri** text boxes.</span></span>
   - <span data-ttu-id="81e02-321">**[OS の種類]** ボックスの一覧で、**[Windows]** または **[Linux]** を選びます。</span><span class="sxs-lookup"><span data-stu-id="81e02-321">Select **windows** or **linux** in the **Os Type** the drop down box.</span></span>
   - <span data-ttu-id="81e02-322">使用条件を確認し、**[上記の使用条件に同意する]** チェック ボックスをオンにします。</span><span class="sxs-lookup"><span data-stu-id="81e02-322">Review the terms and conditions, then click the **I agree to the terms and conditions stated above** checkbox.</span></span>
   - <span data-ttu-id="81e02-323">**[購入]** ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="81e02-323">Click the **Purchase** button.</span></span>

3. <span data-ttu-id="81e02-324">デプロイが完了するまで待ちます。</span><span class="sxs-lookup"><span data-stu-id="81e02-324">Wait for the deployment to complete.</span></span>

4. <span data-ttu-id="81e02-325">パラメーター ファイルには、ハードコーディングされた管理者のユーザー名とパスワードが含まれているため、すべての VM 上でこの両方をすぐに変更することを強くお勧めします。</span><span class="sxs-lookup"><span data-stu-id="81e02-325">The parameter files include a hard-coded administrator user names and passwords, and it is strongly recommended that you immediately change both on all the VMs.</span></span> <span data-ttu-id="81e02-326">Azure Portal で各 VM をクリックし、**[サポート + トラブルシューティング]** ブレードで **[パスワードのリセット]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="81e02-326">Click each VM in the Azure Portal then click on **Reset password** in the **Support + troubleshooting** blade.</span></span> <span data-ttu-id="81e02-327">**[モード]** ボックスの一覧の **[パスワードのリセット]** を選択し、新しい**ユーザー名**と**パスワード**を選択します。</span><span class="sxs-lookup"><span data-stu-id="81e02-327">Select **Reset password** in the **Mode** drop down box, then select a new **User name** and **Password**.</span></span> <span data-ttu-id="81e02-328">**[更新]** をクリックして、新しいユーザー名とパスワードを保持します。</span><span class="sxs-lookup"><span data-stu-id="81e02-328">Click the **Update** button to persist the new user name and password.</span></span>

<!-- markdownlint-disable MD033 -->

<!-- links -->

[implementing-a-multi-tier-architecture-on-Azure]: ../virtual-machines-windows/n-tier.md

[aad-agent-installation]: /azure/active-directory/active-directory-aadconnect-health-agent-install
[aad-application-proxy]: /azure/active-directory/active-directory-application-proxy-enable
[aad-conditional-access]: /azure/active-directory//active-directory-conditional-access
[aad-connect-sync-default-rules]: /azure/active-directory/hybrid/concept-azure-ad-connect-sync-default-configuration
[aad-connect-sync-operational-tasks]: /azure/active-directory/hybrid/how-to-connect-sync-operations
[aad-dynamic-memberships]: https://youtu.be/Tdiz2JqCl9Q
[aad-dynamic-membership-rules]: /azure/active-directory/active-directory-accessmanagement-groups-with-advanced-rules
[aad-editions]: /azure/active-directory/active-directory-editions
[aad-filtering]: /azure/active-directory/hybrid/how-to-connect-sync-configure-filtering
[aad-health]: /azure/active-directory/active-directory-aadconnect-health-sync
[aad-health-adds]: /azure/active-directory/active-directory-aadconnect-health-adds
[aad-health-adfs]: /azure/active-directory/active-directory-aadconnect-health-adfs
[aad-identity-protection]: /azure/active-directory/active-directory-identityprotection
[aad-password-management]: /azure/active-directory/active-directory-passwords-customize
[aad-powershell]: https://msdn.microsoft.com/library/azure/mt757189.aspx
[aad-reporting-guide]: /azure/active-directory/active-directory-reporting-guide
[aad-scalability]: https://blogs.technet.microsoft.com/enterprisemobility/2014/09/02/azure-ad-under-the-hood-of-our-geo-redundant-highly-available-distributed-cloud-directory/
[aad-sync-best-practices]: /azure/active-directory/hybrid/how-to-connect-sync-best-practices-changing-default-configuration
[aad-sync-disaster-recovery]: /azure/active-directory/hybrid/how-to-connect-sync-operations#disaster-recovery
[aad-sync-requirements]: /azure/active-directory/active-directory-hybrid-identity-design-considerations-directory-sync-requirements
[aad-topologies]: /azure/active-directory/hybrid/plan-connect-topologies
[aad-user-sign-in]: /azure/active-directory/hybrid/plan-connect-user-signin
[azure-active-directory]: /azure/active-directory-domain-services/active-directory-ds-overview
[azure-ad-connect]: /azure/active-directory/hybrid/whatis-hybrid-identity
[azure-multifactor-authentication]: /azure/multi-factor-authentication/multi-factor-authentication
[considerations]: ./considerations.md
[resource-manager-overview]: /azure/azure-resource-manager/resource-group-overview
[sla-aad]: https://azure.microsoft.com/support/legal/sla/active-directory
[visio-download]: https://archcenter.blob.core.windows.net/cdn/identity-architectures.vsdx
