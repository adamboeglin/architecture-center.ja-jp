---
title: メッセージ キューとイベントを使用したエンタープライズ統合
titleSuffix: Azure Reference Architectures
description: Azure Logic Apps、Azure API Management、Azure Service Bus、および Azure Event Grid を使用してエンタープライズ統合パターンを実装するための推奨アーキテクチャ。
author: mattfarm
ms.reviewer: jonfan, estfan, LADocs
ms.topic: reference-architecture
ms.date: 12/03/2018
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: integration-services
ms.openlocfilehash: 4c9d2e201bcfc077990d746a1decd55ede2f220a
ms.sourcegitcommit: c053e6edb429299a0ad9b327888d596c48859d4a
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/20/2019
ms.locfileid: "58245513"
---
# <a name="enterprise-integration-on-azure-using-message-queues-and-events"></a><span data-ttu-id="70f4f-103">メッセージ キューとイベントを使用した Azure でのエンタープライズ統合</span><span class="sxs-lookup"><span data-stu-id="70f4f-103">Enterprise integration on Azure using message queues and events</span></span>

<span data-ttu-id="70f4f-104">この参照アーキテクチャでは、スケーラビリティと信頼性を高めるためにメッセージ キューとイベントを使用してサービスを切り離し、エンタープライズ バックエンド システムを統合します。</span><span class="sxs-lookup"><span data-stu-id="70f4f-104">This reference architecture integrates enterprise backend systems, using message queues and events to decouple services for greater scalability and reliability.</span></span> <span data-ttu-id="70f4f-105">バックエンド システムには、サービスとしてのソフトウェア (SaaS) システム、Azure サービス、およびご自身の企業内の既存の Web サービスが含まれる場合があります。</span><span class="sxs-lookup"><span data-stu-id="70f4f-105">The backend systems may include software as a service (SaaS) systems, Azure services, and existing web services in your enterprise.</span></span>

![キューとイベントを使用したエンタープライズ統合の参照アーキテクチャ](./_images/enterprise-integration-queues-events.png)

## <a name="architecture"></a><span data-ttu-id="70f4f-107">アーキテクチャ</span><span class="sxs-lookup"><span data-stu-id="70f4f-107">Architecture</span></span>

<span data-ttu-id="70f4f-108">ここで示すアーキテクチャは、[基本的なエンタープライズ統合][basic-enterprise-integration]に示されている、よりシンプルなアーキテクチャに基づいています。</span><span class="sxs-lookup"><span data-stu-id="70f4f-108">The architecture shown here builds on a simpler architecture that is shown in [Basic enterprise integration][basic-enterprise-integration].</span></span> <span data-ttu-id="70f4f-109">そのアーキテクチャで使用されるのは、ワークフローを調整する [Logic Apps][logic-apps] と、API のカタログを作成する [API Management][apim] です。</span><span class="sxs-lookup"><span data-stu-id="70f4f-109">That architecture uses [Logic Apps][logic-apps] to orchestrate workflows and [API Management][apim] to create catalogs of APIs.</span></span>

<span data-ttu-id="70f4f-110">このバージョンのアーキテクチャでは、システムの信頼性とスケーラビリティを高めるうえで役立つコンポーネントが 2 つ追加されています。</span><span class="sxs-lookup"><span data-stu-id="70f4f-110">This version of the architecture adds two components that help make the system more reliable and scalable:</span></span>

- <span data-ttu-id="70f4f-111">**[Azure Service Bus][service-bus]**。</span><span class="sxs-lookup"><span data-stu-id="70f4f-111">**[Azure Service Bus][service-bus]**.</span></span> <span data-ttu-id="70f4f-112">Service Bus は、セキュリティで保護された信頼できるメッセージ ブローカーです。</span><span class="sxs-lookup"><span data-stu-id="70f4f-112">Service Bus is a secure, reliable message broker.</span></span>

- <span data-ttu-id="70f4f-113">**[Azure Event Grid][event-grid]**。</span><span class="sxs-lookup"><span data-stu-id="70f4f-113">**[Azure Event Grid][event-grid]**.</span></span> <span data-ttu-id="70f4f-114">Event Grid は、イベント ルーティング サービスです。</span><span class="sxs-lookup"><span data-stu-id="70f4f-114">Event Grid is an event routing service.</span></span> <span data-ttu-id="70f4f-115">このサービスでは、[発行/サブスクライブ](../../patterns/publisher-subscriber.md) (pub/sub) イベント モデルが使用されます。</span><span class="sxs-lookup"><span data-stu-id="70f4f-115">It uses a [publish/subscribe](../../patterns/publisher-subscriber.md) (pub/sub) eventing model.</span></span>

<span data-ttu-id="70f4f-116">メッセージ ブローカーを使用した非同期通信は、バックエンド サービスへの直接的な同期呼び出しに比べ、多くの利点があります。</span><span class="sxs-lookup"><span data-stu-id="70f4f-116">Asynchronous communication using a message broker provides a number of advantages over making direct, synchronous calls to backend services:</span></span>

- <span data-ttu-id="70f4f-117">[キューベースの負荷平準化パターン](../../patterns/queue-based-load-leveling.md)を使用して、負荷平準化を実現し、ワークロードのバーストを処理します。</span><span class="sxs-lookup"><span data-stu-id="70f4f-117">Provides load-leveling to handle bursts in workloads, using the [Queue-Based Load Leveling pattern](../../patterns/queue-based-load-leveling.md).</span></span>
- <span data-ttu-id="70f4f-118">複数のステップまたは複数のアプリケーションを含む、実行時間の長いワークフローの進行状況を確実に追跡します。</span><span class="sxs-lookup"><span data-stu-id="70f4f-118">Reliably tracks the progress of long-running workflows that involve multiple steps or multiple applications.</span></span>
- <span data-ttu-id="70f4f-119">アプリケーションを切り離すうえで役立ちます。</span><span class="sxs-lookup"><span data-stu-id="70f4f-119">Helps to decouple applications.</span></span>
- <span data-ttu-id="70f4f-120">既存のメッセージ ベースのシステムと統合します。</span><span class="sxs-lookup"><span data-stu-id="70f4f-120">Integrates with existing message-based systems.</span></span>
- <span data-ttu-id="70f4f-121">バックエンド システムが利用できない場合に作業をキューに挿入できます。</span><span class="sxs-lookup"><span data-stu-id="70f4f-121">Allows work to be queued when a backend system is not available.</span></span>

<span data-ttu-id="70f4f-122">Event Grid を使うと、システム内のさまざまなコンポーネントが、発生したイベントにすぐに対処できます。ポーリングやスケジュールされたタスクには依存しません。</span><span class="sxs-lookup"><span data-stu-id="70f4f-122">Event Grid enables the various components in the system to react to events as they happen, rather than relying on polling or scheduled tasks.</span></span> <span data-ttu-id="70f4f-123">メッセージ キューと同様、アプリケーションとサービスを切り離すうえでも役立ちます。</span><span class="sxs-lookup"><span data-stu-id="70f4f-123">As with a message queue, it helps decouple applications and services.</span></span> <span data-ttu-id="70f4f-124">アプリケーションまたはサービスがイベントを発行でき、関与しているすべてのサブスクライバーに通知されます。</span><span class="sxs-lookup"><span data-stu-id="70f4f-124">An application or service can publish events, and any interested subscribers will be notified.</span></span> <span data-ttu-id="70f4f-125">新しいサブスクライバーを追加するために、送信者を更新する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="70f4f-125">New subscribers can be added without updating the sender.</span></span>

<span data-ttu-id="70f4f-126">Event Grid へのイベント送信をサポートする Azure サービスは多数あります。</span><span class="sxs-lookup"><span data-stu-id="70f4f-126">Many Azure services support sending events to Event Grid.</span></span> <span data-ttu-id="70f4f-127">たとえば、新しいファイルが BLOB ストアに追加された場合に、ロジック アプリはイベントをリッスンできます。</span><span class="sxs-lookup"><span data-stu-id="70f4f-127">For example, a logic app can listen for an event when new files are added to a blob store.</span></span> <span data-ttu-id="70f4f-128">このパターンにより、リアクティブ ワークフローが有効になり、ファイルのアップロードやキューでのメッセージ追加によって一連のプロセスが開始されます。</span><span class="sxs-lookup"><span data-stu-id="70f4f-128">This pattern enables reactive workflows, where uploading a file or putting a message on a queue kicks off a series of processes.</span></span> <span data-ttu-id="70f4f-129">プロセスは並行して、または特定の順序で実行できます。</span><span class="sxs-lookup"><span data-stu-id="70f4f-129">The processes might be executed in parallel or in a specific sequence.</span></span>

## <a name="recommendations"></a><span data-ttu-id="70f4f-130">Recommendations</span><span class="sxs-lookup"><span data-stu-id="70f4f-130">Recommendations</span></span>

<span data-ttu-id="70f4f-131">このアーキテクチャには、[基本的なエンタープライズ統合][basic-enterprise-integration]に関するページに記載されている推奨事項が適用されます。</span><span class="sxs-lookup"><span data-stu-id="70f4f-131">The recommendations described in [Basic enterprise integration][basic-enterprise-integration] apply to this architecture.</span></span> <span data-ttu-id="70f4f-132">また、次の推奨事項も適用されます。</span><span class="sxs-lookup"><span data-stu-id="70f4f-132">The following recommendations also apply:</span></span>

### <a name="service-bus"></a><span data-ttu-id="70f4f-133">Service Bus</span><span class="sxs-lookup"><span data-stu-id="70f4f-133">Service Bus</span></span>

<span data-ttu-id="70f4f-134">Service Bus には、"*プル*" と "*プッシュ*" の 2 つの配信モードがあります。</span><span class="sxs-lookup"><span data-stu-id="70f4f-134">Service Bus has two delivery modes, *pull* or *push*.</span></span> <span data-ttu-id="70f4f-135">プル モードでは、受信側は継続的に新しいメッセージをポーリングします。</span><span class="sxs-lookup"><span data-stu-id="70f4f-135">In the pull model, the receiver continuously polls for new messages.</span></span> <span data-ttu-id="70f4f-136">ポーリングは、特に、それぞれ複数のメッセージを受信するキューが多数ある場合や、メッセージとメッセージの間にかなりの時間がある場合には、非効率になることがあります。</span><span class="sxs-lookup"><span data-stu-id="70f4f-136">Polling can be inefficient, especially if you have many queues that each receive a few messages, or if there a lot of time between messages.</span></span> <span data-ttu-id="70f4f-137">プッシュ モデルでは、新しいメッセージがあるとき、Service Bus が Event Grid を介してイベントを送信します。</span><span class="sxs-lookup"><span data-stu-id="70f4f-137">In the push model, Service Bus sends an event through Event Grid when there are new messages.</span></span> <span data-ttu-id="70f4f-138">受信側は、そのイベントをサブスクライブします。</span><span class="sxs-lookup"><span data-stu-id="70f4f-138">The receiver subscribes to the event.</span></span> <span data-ttu-id="70f4f-139">イベントがトリガーされると、受信側は Service Bus から次のメッセージ バッチをプルします。</span><span class="sxs-lookup"><span data-stu-id="70f4f-139">When the event is triggered, the receiver pulls the next batch of messages from Service Bus.</span></span>

<span data-ttu-id="70f4f-140">Service Bus メッセージを使用するためにロジック アプリを作成する場合は、Event Grid 統合でプッシュ モデルを使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="70f4f-140">When you create a logic app to consume Service Bus messages, we recommend using the push model with Event Grid integration.</span></span> <span data-ttu-id="70f4f-141">ロジック アプリで Service Bus をポーリングする必要がないため、ほとんどの場合、こちらの方がコスト効率に優れています。</span><span class="sxs-lookup"><span data-stu-id="70f4f-141">It's often more cost efficient, because the logic app doesn't need to poll Service Bus.</span></span> <span data-ttu-id="70f4f-142">詳細については、「[Azure Service Bus と Event Grid の統合の概要](/azure/service-bus-messaging/service-bus-to-event-grid-integration-concept)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="70f4f-142">For more information, see [Azure Service Bus to Event Grid integration overview](/azure/service-bus-messaging/service-bus-to-event-grid-integration-concept).</span></span> <span data-ttu-id="70f4f-143">現在、Event Grid の通知には Service Bus の [Premium レベル](https://azure.microsoft.com/pricing/details/service-bus/)が必要です。</span><span class="sxs-lookup"><span data-stu-id="70f4f-143">Currently, Service Bus [Premium tier](https://azure.microsoft.com/pricing/details/service-bus/) is required for Event Grid notifications.</span></span>

<span data-ttu-id="70f4f-144">メッセージのグループへのアクセスには、[PeekLock](/azure/service-bus-messaging/service-bus-messaging-overview#queues) を使用してください。</span><span class="sxs-lookup"><span data-stu-id="70f4f-144">Use [PeekLock](/azure/service-bus-messaging/service-bus-messaging-overview#queues) for accessing a group of messages.</span></span> <span data-ttu-id="70f4f-145">PeekLock を使用すると、ロジック アプリは、メッセージを完了または中止する前に、各メッセージを検証する手順を実行できます。</span><span class="sxs-lookup"><span data-stu-id="70f4f-145">When you use PeekLock, the logic app can perform steps to validate each message before completing or abandoning the message.</span></span> <span data-ttu-id="70f4f-146">この方法によって、メッセージの誤損失から保護します。</span><span class="sxs-lookup"><span data-stu-id="70f4f-146">This approach protects against accidental message loss.</span></span>

### <a name="event-grid"></a><span data-ttu-id="70f4f-147">Event Grid</span><span class="sxs-lookup"><span data-stu-id="70f4f-147">Event Grid</span></span>

<span data-ttu-id="70f4f-148">Event Grid トリガーが発生した場合、これは、"*少なくとも 1 つ*" のイベントが発生したことを意味します。</span><span class="sxs-lookup"><span data-stu-id="70f4f-148">When an Event Grid trigger fires, it means *at least one* event happened.</span></span> <span data-ttu-id="70f4f-149">たとえば、ロジック アプリが Service Bus メッセージに対する Event Grid トリガーを取得した場合、そのロジック アプリは、処理対象のメッセージを複数取得する可能性があると想定します。</span><span class="sxs-lookup"><span data-stu-id="70f4f-149">For example, when a logic app gets an Event Grid triggers for a Service Bus message, it should assume that several messages might be available to process.</span></span>

<span data-ttu-id="70f4f-150">Event Grid では、サーバーレス モデルを使用します。</span><span class="sxs-lookup"><span data-stu-id="70f4f-150">Event Grid uses a serverless model.</span></span> <span data-ttu-id="70f4f-151">課金は、操作 (イベントの実行) の回数に基づいて計算されます。</span><span class="sxs-lookup"><span data-stu-id="70f4f-151">Billing is calculated based on the number of operations (event executions).</span></span> <span data-ttu-id="70f4f-152">詳細については、「[Event Grid の価格](https://azure.microsoft.com/pricing/details/event-grid/)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="70f4f-152">For more information, see [Event Grid pricing](https://azure.microsoft.com/pricing/details/event-grid/).</span></span> <span data-ttu-id="70f4f-153">現在、Event Grid には、レベルに関する考慮事項はありません。</span><span class="sxs-lookup"><span data-stu-id="70f4f-153">Currently, there are no tier considerations for Event Grid.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="70f4f-154">スケーラビリティに関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="70f4f-154">Scalability considerations</span></span>

<span data-ttu-id="70f4f-155">Service Bus Premium レベルは、より高いスケーラビリティを実現するためにメッセージング ユニットの数をスケールアウトできます。</span><span class="sxs-lookup"><span data-stu-id="70f4f-155">To achieve higher scalability, the Service Bus Premium tier can scale out the number of messaging units.</span></span> <span data-ttu-id="70f4f-156">Premium レベルの構成では、1 つ、2 つ、または 4 つのメッセージング ユニットを持つことができます。</span><span class="sxs-lookup"><span data-stu-id="70f4f-156">Premium tier configurations can have one, two, or four messaging units.</span></span> <span data-ttu-id="70f4f-157">Service Bus のスケーリングの詳細については、「[Service Bus メッセージングを使用したパフォーマンス向上のためのベスト プラクティス](/azure/service-bus-messaging/service-bus-performance-improvements)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="70f4f-157">For more information about scaling Service Bus, see [Best practices for performance improvements by using Service Bus Messaging](/azure/service-bus-messaging/service-bus-performance-improvements).</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="70f4f-158">可用性に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="70f4f-158">Availability considerations</span></span>

<span data-ttu-id="70f4f-159">各サービスの SLA を確認してください。</span><span class="sxs-lookup"><span data-stu-id="70f4f-159">Review the SLA for each service:</span></span>

- <span data-ttu-id="70f4f-160">[API Management の SLA][apim-sla]</span><span class="sxs-lookup"><span data-stu-id="70f4f-160">[API Management SLA][apim-sla]</span></span>
- <span data-ttu-id="70f4f-161">[Event Grid の SLA][event-grid-sla]</span><span class="sxs-lookup"><span data-stu-id="70f4f-161">[Event Grid SLA][event-grid-sla]</span></span>
- <span data-ttu-id="70f4f-162">[Logic Apps の SLA][logic-apps-sla]</span><span class="sxs-lookup"><span data-stu-id="70f4f-162">[Logic Apps SLA][logic-apps-sla]</span></span>
- <span data-ttu-id="70f4f-163">[Service Bus の SLA][sb-sla]</span><span class="sxs-lookup"><span data-stu-id="70f4f-163">[Service Bus SLA][sb-sla]</span></span>

<span data-ttu-id="70f4f-164">重大な障害が発生した場合にフェールオーバーを有効にするために、Service Bus Premium で geo ディザスター リカバリーを実装することを検討します。</span><span class="sxs-lookup"><span data-stu-id="70f4f-164">To enable failover if a serious outage occurs, consider implementing geo-disaster recovery in Service Bus Premium.</span></span> <span data-ttu-id="70f4f-165">詳細については、「[Azure Service Bus の geo ディザスター リカバリー](/azure/service-bus-messaging/service-bus-geo-dr)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="70f4f-165">For more information, see [Azure Service Bus geo-disaster recovery](/azure/service-bus-messaging/service-bus-geo-dr).</span></span>

## <a name="security-considerations"></a><span data-ttu-id="70f4f-166">セキュリティに関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="70f4f-166">Security considerations</span></span>

<span data-ttu-id="70f4f-167">Service Bus をセキュリティで保護するには、Shared Access Signature (SAS) を使用します。</span><span class="sxs-lookup"><span data-stu-id="70f4f-167">To secure Service Bus, use shared access signature (SAS).</span></span> <span data-ttu-id="70f4f-168">[SAS 認証](/azure/service-bus-messaging/service-bus-sas)を使用して、特定の権限で、Service Bus リソースへのアクセス権をユーザーに付与できます。</span><span class="sxs-lookup"><span data-stu-id="70f4f-168">You can grant a user access to Service Bus resources with specific rights by using [SAS authentication](/azure/service-bus-messaging/service-bus-sas).</span></span> <span data-ttu-id="70f4f-169">詳細については、「[Service Bus の認証と承認](/azure/service-bus-messaging/service-bus-authentication-and-authorization)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="70f4f-169">For more information, see [Service Bus authentication and authorization](/azure/service-bus-messaging/service-bus-authentication-and-authorization).</span></span>

<span data-ttu-id="70f4f-170">Service Bus キューを HTTP エンドポイントとして公開する必要がある場合は (たとえば、新しいメッセージを投稿する場合)、API Management を使用して、エンドポイントをフロントに配置してキューをセキュリティで保護します。</span><span class="sxs-lookup"><span data-stu-id="70f4f-170">If you need to expose a Service Bus queue as an HTTP endpoint, for example, to post new messages, use API Management to secure the queue by fronting the endpoint.</span></span> <span data-ttu-id="70f4f-171">次に、必要に応じて、証明書または OAuth 認証を使用してこのエンドポイントをセキュリティ保護できます。</span><span class="sxs-lookup"><span data-stu-id="70f4f-171">You can then secure the endpoint with certificates or OAuth authentication as appropriate.</span></span> <span data-ttu-id="70f4f-172">エンドポイントをセキュリティで保護する最も簡単な方法は、HTTP 要求/応答トリガーを仲介としてロジック アプリを使用することです。</span><span class="sxs-lookup"><span data-stu-id="70f4f-172">The easiest way to secure an endpoint is using a logic app with an HTTP request/response trigger as an intermediary.</span></span>

<span data-ttu-id="70f4f-173">Event Grid サービスは、検証コードを使ってイベント配信をセキュリティで保護します。</span><span class="sxs-lookup"><span data-stu-id="70f4f-173">The Event Grid service secures event delivery through a validation code.</span></span> <span data-ttu-id="70f4f-174">Logic Apps を利用してイベントを使用する場合、検証は自動的に行われます。</span><span class="sxs-lookup"><span data-stu-id="70f4f-174">If you use Logic Apps to consume the event, validation is automatically performed.</span></span> <span data-ttu-id="70f4f-175">詳細については、「[Event Grid security and authentication](/azure/event-grid/security-authentication)」(Event Grid のセキュリティと認証) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="70f4f-175">For more information, see [Event Grid security and authentication](/azure/event-grid/security-authentication).</span></span>

[apim]: /azure/api-management
[apim-sla]: https://azure.microsoft.com/support/legal/sla/api-management/
[event-grid]: /azure/event-grid/
[event-grid-sla]: https://azure.microsoft.com/support/legal/sla/event-grid
[logic-apps]: /azure/logic-apps/logic-apps-overview
[logic-apps-sla]: https://azure.microsoft.com/support/legal/sla/logic-apps
[sb-sla]: https://azure.microsoft.com/support/legal/sla/service-bus/
[service-bus]: /azure/service-bus-messaging/
[basic-enterprise-integration]: ./basic-enterprise-integration.md
