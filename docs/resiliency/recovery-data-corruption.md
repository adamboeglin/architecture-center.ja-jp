---
title: データの破損または偶発的な削除から復旧する
description: データの破損または偶発的なデータの削除から復旧する方法、回復力のある高可用性のフォールト トレラント アプリケーションの設計、およびディザスター リカバリーの計画について説明します。
author: MikeWasson
ms.date: 11/11/2018
ms.topic: article
ms.service: architecture-center
ms.subservice: cloud-design-principles
ms.custom: resiliency
ms.openlocfilehash: e28f26683c6d7dba196d4351ef3942830c9e7fc2
ms.sourcegitcommit: c053e6edb429299a0ad9b327888d596c48859d4a
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/20/2019
ms.locfileid: "58242783"
---
# <a name="recover-from-data-corruption-or-accidental-deletion"></a><span data-ttu-id="5e076-103">データの破損または偶発的な削除から復旧する</span><span class="sxs-lookup"><span data-stu-id="5e076-103">Recover from data corruption or accidental deletion</span></span>

<span data-ttu-id="5e076-104">堅牢なビジネス継続性計画の一環として、データが破損した場合や誤って削除された場合に備えた計画を作成します。</span><span class="sxs-lookup"><span data-stu-id="5e076-104">Part of a robust business continuity plan is having a plan if your data gets corrupted or accidentally deleted.</span></span> <span data-ttu-id="5e076-105">以下に、アプリケーション エラーによってデータが破損したか、オペレーターのエラーによってデータが誤って削除された後の復旧に関する情報を示します。</span><span class="sxs-lookup"><span data-stu-id="5e076-105">The following is information about recovery after data has been corrupted or accidentally deleted, due to application errors or operator error.</span></span>

## <a name="virtual-machines"></a><span data-ttu-id="5e076-106">Virtual Machines</span><span class="sxs-lookup"><span data-stu-id="5e076-106">Virtual Machines</span></span>

<span data-ttu-id="5e076-107">Azure Virtual Machines (VM) をアプリケーション エラーや誤削除から保護するには、[Azure Backup](/azure/backup/) を使用します。</span><span class="sxs-lookup"><span data-stu-id="5e076-107">To protect Azure Virtual Machines (VMs) from application errors or accidental deletion, use [Azure Backup](/azure/backup/).</span></span> <span data-ttu-id="5e076-108">Azure Backup を使用すると、複数の VM ディスク間で一貫性のあるバックアップを作成できます。</span><span class="sxs-lookup"><span data-stu-id="5e076-108">Azure Backup enables the creation of backups that are consistent across multiple VM disks.</span></span> <span data-ttu-id="5e076-109">さらに、バックアップ コンテナーをリージョン間でレプリケートし、リージョン損失からの復旧に備えることができます。</span><span class="sxs-lookup"><span data-stu-id="5e076-109">In addition, the Backup Vault can be replicated across regions to provide recovery from region loss.</span></span>

## <a name="storage"></a><span data-ttu-id="5e076-110">Storage</span><span class="sxs-lookup"><span data-stu-id="5e076-110">Storage</span></span>

<span data-ttu-id="5e076-111">Azure Storage は、自動レプリカによるデータ回復性を備えています。</span><span class="sxs-lookup"><span data-stu-id="5e076-111">Azure Storage provides data resiliency through automated replicas.</span></span> <span data-ttu-id="5e076-112">ただし、アプリケーション コードやユーザーが、誤ってまたは悪意を持ってデータを破損させるのを防ぐことはできません。</span><span class="sxs-lookup"><span data-stu-id="5e076-112">However, this does not prevent application code or users from corrupting data, whether accidentally or maliciously.</span></span> <span data-ttu-id="5e076-113">アプリケーション エラーやユーザー エラーが発生した場合にデータの忠実性を維持するには、監査ログと共にセカンダリ ストレージの場所にデータをコピーするなどの高度な手法が必要です。</span><span class="sxs-lookup"><span data-stu-id="5e076-113">Maintaining data fidelity in the face of application or user error requires more advanced techniques, such as copying the data to a secondary storage location with an audit log.</span></span>

- <span data-ttu-id="5e076-114">**ブロック BLOB**: </span><span class="sxs-lookup"><span data-stu-id="5e076-114">**Block blobs**.</span></span> <span data-ttu-id="5e076-115">各ブロック BLOB の特定時点のスナップショットを作成します。</span><span class="sxs-lookup"><span data-stu-id="5e076-115">Create a point-in-time snapshot of each block blob.</span></span> <span data-ttu-id="5e076-116">詳細については、「 [BLOB のスナップショットの作成](/rest/api/storageservices/creating-a-snapshot-of-a-blob)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="5e076-116">For more information, see [Creating a Snapshot of a Blob](/rest/api/storageservices/creating-a-snapshot-of-a-blob).</span></span> <span data-ttu-id="5e076-117">各スナップショットについて、BLOB 内で前回のスナップショットの状態との差分を保存するために必要なストレージのみに課金されます。</span><span class="sxs-lookup"><span data-stu-id="5e076-117">For each snapshot, you are only charged for the storage required to store the differences within the blob since the last snapshot state.</span></span> <span data-ttu-id="5e076-118">スナップショットには、差分を取るための基になる BLOB が存在している必要があるため、別の BLOB または別のストレージ アカウントにコピーすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="5e076-118">The snapshots are dependent on the existence of the original blob they are based on, so a copy operation to another blob or even another storage account is advisable.</span></span> <span data-ttu-id="5e076-119">これにより、バックアップ データを誤って削除してしまうことから確実に保護できます。</span><span class="sxs-lookup"><span data-stu-id="5e076-119">This ensures that backup data is properly protected against accidental deletion.</span></span> <span data-ttu-id="5e076-120">[AzCopy](/azure/storage/common/storage-use-azcopy) または [Azure PowerShell](/azure/storage/common/storage-powershell-guide-full) を使用して、別のストレージ アカウントに BLOB をコピーできます。</span><span class="sxs-lookup"><span data-stu-id="5e076-120">You can use [AzCopy](/azure/storage/common/storage-use-azcopy) or [Azure PowerShell](/azure/storage/common/storage-powershell-guide-full) to copy the blobs to another storage account.</span></span>

- <span data-ttu-id="5e076-121">**ファイル**: </span><span class="sxs-lookup"><span data-stu-id="5e076-121">**Files**.</span></span> <span data-ttu-id="5e076-122">[共有のスナップショット](/azure/storage/files/storage-snapshots-files)を使用するか、AzCopy または PowerShell を使用して別のストレージ アカウントにファイルをコピーします。</span><span class="sxs-lookup"><span data-stu-id="5e076-122">Use [share snapshots](/azure/storage/files/storage-snapshots-files), or use AzCopy or PowerShell to copy your files to another storage account.</span></span>

- <span data-ttu-id="5e076-123">**テーブル**: </span><span class="sxs-lookup"><span data-stu-id="5e076-123">**Tables**.</span></span> <span data-ttu-id="5e076-124">AzCopy を使用して、他のリージョンの別のストレージ アカウントにテーブル データをエクスポートします。</span><span class="sxs-lookup"><span data-stu-id="5e076-124">Use AzCopy to export the table data into another storage account in another region.</span></span>

## <a name="database"></a><span data-ttu-id="5e076-125">Database</span><span class="sxs-lookup"><span data-stu-id="5e076-125">Database</span></span>

### <a name="azure-sql-database"></a><span data-ttu-id="5e076-126">Azure SQL Database</span><span class="sxs-lookup"><span data-stu-id="5e076-126">Azure SQL Database</span></span>

<span data-ttu-id="5e076-127">SQL Database は、データ損失からビジネスを守るために、データベースの完全バックアップ (毎週)、データベースの差分バックアップ (1 時間ごと)、およびトランザクション ログのバックアップ (5 ～ 10 分ごと) を組み合わせて自動的に実行します。</span><span class="sxs-lookup"><span data-stu-id="5e076-127">SQL Database automatically performs a combination of full database backups weekly, differential database backups hourly, and transaction log backups every five - ten minutes to protect your business from data loss.</span></span> <span data-ttu-id="5e076-128">ポイントインタイム リストアを使用して、データベースを以前の状態に復元します。</span><span class="sxs-lookup"><span data-stu-id="5e076-128">Use point-in-time restore to restore a database to an earlier time.</span></span> <span data-ttu-id="5e076-129">詳細については、次を参照してください。</span><span class="sxs-lookup"><span data-stu-id="5e076-129">For more information, see:</span></span>

- [<span data-ttu-id="5e076-130">データベースの自動バックアップを使用した Azure SQL Database の復旧</span><span class="sxs-lookup"><span data-stu-id="5e076-130">Recover an Azure SQL database using automated database backups</span></span>](/azure/sql-database/sql-database-recovery-using-backups)

- [<span data-ttu-id="5e076-131">Azure SQL Database によるビジネス継続性の概要</span><span class="sxs-lookup"><span data-stu-id="5e076-131">Overview of business continuity with Azure SQL Database</span></span>](/azure/sql-database/sql-database-business-continuity)

### <a name="sql-server-on-vms"></a><span data-ttu-id="5e076-132">VM 上の SQL Server</span><span class="sxs-lookup"><span data-stu-id="5e076-132">SQL Server on VMs</span></span>

<span data-ttu-id="5e076-133">VM 上で実行される SQL Server の場合、従来のバックアップとログ配布の 2 つのオプションがあります。</span><span class="sxs-lookup"><span data-stu-id="5e076-133">For SQL Server running on VMs, there are two options: traditional backups and log shipping.</span></span> <span data-ttu-id="5e076-134">従来のバックアップを使用すると、特定の時点の状態に復元できますが、回復プロセスに時間がかかります。</span><span class="sxs-lookup"><span data-stu-id="5e076-134">Traditional backups enables you to restore to a specific point in time, but the recovery process is slow.</span></span> <span data-ttu-id="5e076-135">従来のバックアップを復元するには、最初に完全バックアップから開始し、その後にそれ以降に作成されたバックアップを適用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5e076-135">Restoring traditional backups requires starting with an initial full backup, and then applying any backups taken after that.</span></span> <span data-ttu-id="5e076-136">2 番目のオプションでは、ログ バックアップの復元を (たとえば 2 時間) 遅延するログ配布セッションを構成します。</span><span class="sxs-lookup"><span data-stu-id="5e076-136">The second option is to configure a log shipping session to delay the restore of log backups (for example, by two hours).</span></span> <span data-ttu-id="5e076-137">これにより、プライマリで発生したエラーから回復するための時間が確保されます。</span><span class="sxs-lookup"><span data-stu-id="5e076-137">This provides a window to recover from errors made on the primary.</span></span>

### <a name="azure-cosmos-db"></a><span data-ttu-id="5e076-138">Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="5e076-138">Azure Cosmos DB</span></span>

<span data-ttu-id="5e076-139">Azure Cosmos DB では、一定の間隔でバックアップを自動的に作成します。</span><span class="sxs-lookup"><span data-stu-id="5e076-139">Azure Cosmos DB automatically takes backups at regular intervals.</span></span> <span data-ttu-id="5e076-140">バックアップは別のストレージ サービスに個別に保存されます。これらのバックアップは、リージョンの障害に対する回復性を確保するためにグローバルにレプリケートされます。</span><span class="sxs-lookup"><span data-stu-id="5e076-140">Backups are stored separately in another storage service, and those backups are globally replicated for resiliency against regional disasters.</span></span> <span data-ttu-id="5e076-141">データベースまたはコレクションを誤って削除した場合は、サポート チケットを申請するか、Azure サポートに連絡して、最新の自動バックアップからデータを復元できます。</span><span class="sxs-lookup"><span data-stu-id="5e076-141">If you accidentally delete your database or collection, you can file a support ticket or call Azure support to restore the data from the last automatic backup.</span></span> <span data-ttu-id="5e076-142">詳細については、「[Azure Cosmos DB での自動オンライン バックアップと復元](/azure/cosmos-db/online-backup-and-restore)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="5e076-142">For more information, see [Automatic online backup and restore with Azure Cosmos DB](/azure/cosmos-db/online-backup-and-restore).</span></span>

### <a name="azure-database-for-mysql-azure-database-for-postgresql"></a><span data-ttu-id="5e076-143">Azure Database for MySQL、Azure Database for PostgreSQL</span><span class="sxs-lookup"><span data-stu-id="5e076-143">Azure Database for MySQL, Azure Database for PostgreSQL</span></span>

<span data-ttu-id="5e076-144">Azure Database for MySQL または Azure Database for PostgreSQL を使用すると、データベース サービスで 5 分ごとにサービスのバックアップが自動的に作成されます。</span><span class="sxs-lookup"><span data-stu-id="5e076-144">When using Azure Database for MySQL or Azure Database for PostgreSQL, the database service automatically makes a backup of the service every five minutes.</span></span> <span data-ttu-id="5e076-145">自動バックアップ機能を使用して、過去の特定の時点までサーバーとそのサーバーのすべてのデータベースを新しいサーバーに復元できます。</span><span class="sxs-lookup"><span data-stu-id="5e076-145">Using this automatic backup feature you may restore the server and all its databases into a new server to an earlier point-in-time.</span></span> <span data-ttu-id="5e076-146">詳細については、次を参照してください。</span><span class="sxs-lookup"><span data-stu-id="5e076-146">For more information, see:</span></span>

- [<span data-ttu-id="5e076-147">Azure Portal を使用して Azure Database for MySQL サーバーのバックアップと復元を行う方法</span><span class="sxs-lookup"><span data-stu-id="5e076-147">How to back up and restore a server in Azure Database for MySQL by using the Azure portal</span></span>](/azure/mysql/howto-restore-server-portal)

- [<span data-ttu-id="5e076-148">Azure Portal を使用した Azure Database for PostgreSQL サーバーのバックアップと復元方法</span><span class="sxs-lookup"><span data-stu-id="5e076-148">How to backup and restore a server in Azure Database for PostgreSQL using the Azure portal</span></span>](/azure/postgresql/howto-restore-server-portal)
