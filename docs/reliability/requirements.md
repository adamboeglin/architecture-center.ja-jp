---
title: 回復性がある Azure アプリケーションの要件を定義する
description: Azure アプリケーションの可用性および回復性の要件の収集の概要
author: MikeWasson
ms.date: 04/10/2019
ms.topic: article
ms.service: architecture-center
ms.subservice: cloud-design-principles
ms.openlocfilehash: 2af2ce4200c285abfda1395862d21efc3c17e577
ms.sourcegitcommit: 579c39ff4b776704ead17a006bf24cd4cdc65edd
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/17/2019
ms.locfileid: "59642874"
---
# <a name="developing-requirements-for-resilient-azure-applications"></a><span data-ttu-id="60be3-103">回復性がある Azure アプリケーションの要件を作成する</span><span class="sxs-lookup"><span data-stu-id="60be3-103">Developing requirements for resilient Azure applications</span></span>

<span data-ttu-id="60be3-104">*回復性* (障害からの回復) と*可用性* (大幅なダウンタイムがなく正常な状態で実行) をアプリに組み込むには、要件を収集することから開始します。</span><span class="sxs-lookup"><span data-stu-id="60be3-104">Building *resiliency* (recovering from failures) and *availability* (running in a healthy state without significant downtime) into your apps begins with gathering requirements.</span></span> <span data-ttu-id="60be3-105">たとえば、どの程度のダウンタイムを許容できるのでしょうか?</span><span class="sxs-lookup"><span data-stu-id="60be3-105">For example, how much downtime is acceptable?</span></span> <span data-ttu-id="60be3-106">起こり得るダウンタイムによって貴社のビジネスが被るコストはいくらになるでしょうか?</span><span class="sxs-lookup"><span data-stu-id="60be3-106">How much does potential downtime cost your business?</span></span> <span data-ttu-id="60be3-107">顧客の可用性の要件はどのようなものでしょうか?</span><span class="sxs-lookup"><span data-stu-id="60be3-107">What are your customer's availability requirements?</span></span> <span data-ttu-id="60be3-108">ご利用のアプリケーションの可用性を高めることにいくら投資しますか?</span><span class="sxs-lookup"><span data-stu-id="60be3-108">How much do you invest in making your application highly available?</span></span> <span data-ttu-id="60be3-109">コストとリスクの比較はどのようになります?</span><span class="sxs-lookup"><span data-stu-id="60be3-109">What is the risk versus the cost?</span></span>

## <a name="identify-distinct-workloads"></a><span data-ttu-id="60be3-110">個別のワークロードを識別する</span><span class="sxs-lookup"><span data-stu-id="60be3-110">Identify distinct workloads</span></span>

<span data-ttu-id="60be3-111">クラウド ソリューションは、通常、複数のアプリケーション *ワークロード*で構成されます。</span><span class="sxs-lookup"><span data-stu-id="60be3-111">Cloud solutions typically consist of multiple application *workloads*.</span></span> <span data-ttu-id="60be3-112">ワークロードとは、ビジネス ロジックとデータ ストレージの要件の観点から、他のタスクとは論理的に区別される独特な機能またはタスクです。</span><span class="sxs-lookup"><span data-stu-id="60be3-112">A workload is a distinct capability or task that is logically separated from other tasks in terms of business logic and data storage requirements.</span></span> <span data-ttu-id="60be3-113">たとえば、eコマース アプリには次のようなワークロードがあります。</span><span class="sxs-lookup"><span data-stu-id="60be3-113">For example, an e-commerce app might have the following workloads:</span></span>

- <span data-ttu-id="60be3-114">製品カタログの閲覧と検索。</span><span class="sxs-lookup"><span data-stu-id="60be3-114">Browse and search a product catalog.</span></span>
- <span data-ttu-id="60be3-115">注文の作成と追跡。</span><span class="sxs-lookup"><span data-stu-id="60be3-115">Create and track orders.</span></span>
- <span data-ttu-id="60be3-116">推奨事項の表示。</span><span class="sxs-lookup"><span data-stu-id="60be3-116">View recommendations.</span></span>

<span data-ttu-id="60be3-117">各ワークロードでは、可用性、スケーラビリティ、データの一貫性、およびディザスター リカバリーの要件がそれぞれ異なります。</span><span class="sxs-lookup"><span data-stu-id="60be3-117">Each workload has different requirements for availability, scalability, data consistency, and disaster recovery.</span></span> <span data-ttu-id="60be3-118">ワークロードごとにコストとリスクのバランスを考慮することで、ビジネス上の意思決定を行います。</span><span class="sxs-lookup"><span data-stu-id="60be3-118">Make your business decisions by balancing cost versus risk for each workload.</span></span>

<span data-ttu-id="60be3-119">また、サービス レベル目標に基づいてワークロードを分解します。</span><span class="sxs-lookup"><span data-stu-id="60be3-119">Also decompose workloads by service-level objective.</span></span> <span data-ttu-id="60be3-120">サービスが重要なワークロードとあまり重要ではないワークロードで構成されている場合は、それらを異なる方法で管理し、それぞれの可用性の要件を満たすのに必要なサービスの機能とインスタンスの数を指定します。</span><span class="sxs-lookup"><span data-stu-id="60be3-120">If a service is composed of critical and less-critical workloads, manage them differently and specify the service features and number of instances needed to meet their availability requirements.</span></span>

## <a name="plan-for-usage-patterns"></a><span data-ttu-id="60be3-121">使用状況パターンについて計画する</span><span class="sxs-lookup"><span data-stu-id="60be3-121">Plan for usage patterns</span></span>

<span data-ttu-id="60be3-122">重要な期間と重大でない期間中での要件の違いを特定します。</span><span class="sxs-lookup"><span data-stu-id="60be3-122">Identify differences in requirements during critical and non-critical periods.</span></span> <span data-ttu-id="60be3-123">システムが使用可能である必要がある特定の重要な期間はありますか。</span><span class="sxs-lookup"><span data-stu-id="60be3-123">Are there certain critical periods when the system must be available?</span></span> <span data-ttu-id="60be3-124">たとえば、申告期間中に納税申告アプリケーションで障害が発生してはならないし、ライブ イベント中にはビデオ ストリーミング サービスに遅延が発生すべきではありません。</span><span class="sxs-lookup"><span data-stu-id="60be3-124">For example, a tax-filing application can't fail during a filing deadline and a video streaming service shouldn't lag during a live event.</span></span> <span data-ttu-id="60be3-125">このような状況では、リスクとコストを比較検討します。</span><span class="sxs-lookup"><span data-stu-id="60be3-125">In these situations, weigh the cost against the risk.</span></span>

- <span data-ttu-id="60be3-126">重要な期間に稼働時間を確保し、サービス レベル アグリーメント (SLA) を満たすには、コストが増加したとしても、1 つのリージョンが失敗した場合に備えていくつかのリージョン間で冗長性を計画します。</span><span class="sxs-lookup"><span data-stu-id="60be3-126">To ensure uptime and meet service-level agreements (SLAs) in critical periods, plan redundancy across several regions in case one fails, even if it costs more.</span></span>
- <span data-ttu-id="60be3-127">逆に、重大でない期間中は、ご利用のアプリケーションを 1 つのリージョンで実行して、コストを最小限に抑えます。</span><span class="sxs-lookup"><span data-stu-id="60be3-127">Conversely, during non-critical periods, run your application in a single region to minimize costs.</span></span>
- <span data-ttu-id="60be3-128">場合によっては、消費ベースで課金が行われる最新のサーバーレス手法を使用して、追加の費用を軽減することができます。</span><span class="sxs-lookup"><span data-stu-id="60be3-128">In some cases, you can mitigate additional expenses by using modern serverless techniques that have consumption-based billing.</span></span>

## <a name="establish-availability-and-recovery-metrics"></a><span data-ttu-id="60be3-129">可用性および復旧のメトリックを確定する</span><span class="sxs-lookup"><span data-stu-id="60be3-129">Establish availability and recovery metrics</span></span>

<span data-ttu-id="60be3-130">要件プロセスの一部として、2 つのメトリック セットのためにベースライン数値を作成します。</span><span class="sxs-lookup"><span data-stu-id="60be3-130">Create baseline numbers for two sets of metrics as part of the requirements process.</span></span> <span data-ttu-id="60be3-131">最初のセットは、クラウド サービスへの冗長性を追加する場所および顧客に提供する SLA を決定するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="60be3-131">The first set helps you determine where to add redundancy to cloud services and which SLAs to provide to customers.</span></span> <span data-ttu-id="60be3-132">2 つ目のセットは、使用するディザスター リカバリーを計画するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="60be3-132">The second set helps you plan your disaster recovery.</span></span>

### <a name="availability-metrics"></a><span data-ttu-id="60be3-133">可用性のメトリック</span><span class="sxs-lookup"><span data-stu-id="60be3-133">Availability metrics</span></span>

<span data-ttu-id="60be3-134">これらのメジャーを使用して、冗長性を計画し、顧客の SLA を決定します。</span><span class="sxs-lookup"><span data-stu-id="60be3-134">Use these measures to plan for redundancy and determine customer SLAs.</span></span>

- <span data-ttu-id="60be3-135">**平均復旧時間** (MTTR) とは、障害発生後にコンポーネントを復旧するためにかかる平均時間です。</span><span class="sxs-lookup"><span data-stu-id="60be3-135">**Mean time to recover (MTTR)** is the average time it takes to restore a component after a failure.</span></span>
- <span data-ttu-id="60be3-136">**平均故障間隔**(MTBF) とは、次の障害が発生するまでに合理的に予期されるコンポーネントの稼働時間です。</span><span class="sxs-lookup"><span data-stu-id="60be3-136">**Mean time between failures (MTBF)** is the how long a component can reasonably expect to last between outages.</span></span>

### <a name="recovery-metrics"></a><span data-ttu-id="60be3-137">回復のメトリック</span><span class="sxs-lookup"><span data-stu-id="60be3-137">Recovery metrics</span></span>

<span data-ttu-id="60be3-138">これらの値を取得するには、リスクの評価を実施して、ダウンタイムとデータ損失におけるコストとリスクを確実に把握してください。</span><span class="sxs-lookup"><span data-stu-id="60be3-138">Derive these values by conducting a risk assessment, and make sure you understand the cost and risk of downtime and data loss.</span></span> <span data-ttu-id="60be3-139">これらはシステムの機能要件ではなく、ビジネス要件によって決定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="60be3-139">These are nonfunctional requirements of a system and should be dictated by business requirements.</span></span>

- <span data-ttu-id="60be3-140">**目標復旧時間** (RTO) は、インシデントが発生した後に、アプリケーションに許容する使用不能状態の最大時間です。</span><span class="sxs-lookup"><span data-stu-id="60be3-140">**Recovery time objective (RTO)** is the maximum acceptable time an application is unavailable after an incident.</span></span>
- <span data-ttu-id="60be3-141">**回復ポイントの目標** (RPO) は、災害発生時に許容できるデータ損失の最大期間です。</span><span class="sxs-lookup"><span data-stu-id="60be3-141">**Recovery point objective (RPO)** is the maximum duration of data loss that's acceptable during a disaster.</span></span>

<span data-ttu-id="60be3-142">高可用性の設定内の*任意*の重要なコンポーネントの MTTR 値がシステム RTO を超えた場合、システム内の障害によって、許容できないビジネスの中断が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="60be3-142">If the MTTR value of *any* critical component in a highly available setup exceeds the system RTO, a failure in the system might cause an unacceptable business disruption.</span></span> <span data-ttu-id="60be3-143">つまり、定義されている RTO 内でシステムを復元することができなくなります。</span><span class="sxs-lookup"><span data-stu-id="60be3-143">That is, you can't restore the system within the defined RTO.</span></span>

## <a name="determine-workload-availability-targets"></a><span data-ttu-id="60be3-144">ワークロードの可用性の目標を決定する</span><span class="sxs-lookup"><span data-stu-id="60be3-144">Determine workload availability targets</span></span>

<span data-ttu-id="60be3-145">使用するソリューション内のワークロードごとに独自のターゲット SLA を定義すれば、アーキテクチャがビジネス要件を満たしているかどうかを判定できます。</span><span class="sxs-lookup"><span data-stu-id="60be3-145">Define your own target SLAs for each workload in your solution so you can determine whether the architecture meets the business requirements.</span></span>

### <a name="consider-cost-and-complexity"></a><span data-ttu-id="60be3-146">コストと複雑さを検討する</span><span class="sxs-lookup"><span data-stu-id="60be3-146">Consider cost and complexity</span></span>

<span data-ttu-id="60be3-147">他の項目がすべて同じ場合は、可用性が高いほど望ましくなります。</span><span class="sxs-lookup"><span data-stu-id="60be3-147">Everything else being equal, higher availability is better.</span></span> <span data-ttu-id="60be3-148">しかし、9 の個数を増やすことを目指すと、コストと複雑さが増大します。</span><span class="sxs-lookup"><span data-stu-id="60be3-148">But as you strive for more nines, the cost and complexity grow.</span></span> <span data-ttu-id="60be3-149">99.99% のアップタイムは、月あたりの合計ダウンタイムの約 5 分に換算されます。</span><span class="sxs-lookup"><span data-stu-id="60be3-149">An uptime of 99.99% translates to about five minutes of total downtime per month.</span></span> <span data-ttu-id="60be3-150">ファイブ ナイン (99.999%) の実現に、複雑さとコストが増大する価値はありますか?</span><span class="sxs-lookup"><span data-stu-id="60be3-150">Is it worth the additional complexity and cost to reach five nines?</span></span> <span data-ttu-id="60be3-151">その答えはビジネス要件によって変わります。</span><span class="sxs-lookup"><span data-stu-id="60be3-151">The answer depends on the business requirements.</span></span>

<span data-ttu-id="60be3-152">SLA を定義する場合の他の考慮事項を次に示します。</span><span class="sxs-lookup"><span data-stu-id="60be3-152">Here are some other considerations when defining an SLA:</span></span>

- <span data-ttu-id="60be3-153">4 つの 9 (99.99%) を実現するには、手動操作による障害からの復旧には依存できません。</span><span class="sxs-lookup"><span data-stu-id="60be3-153">To achieve four nines (99.99%), you can't rely on manual intervention to recover from failures.</span></span> <span data-ttu-id="60be3-154">アプリケーションには自己診断機能と自己復旧機能が必要です。</span><span class="sxs-lookup"><span data-stu-id="60be3-154">The application must be self-diagnosing and self-healing.</span></span>
- <span data-ttu-id="60be3-155">4 つの 9 を超えると、SLA を満たすことができるほど迅速に障害を検出することは困難です。</span><span class="sxs-lookup"><span data-stu-id="60be3-155">Beyond four nines, it's challenging to detect outages quickly enough to meet the SLA.</span></span>
- <span data-ttu-id="60be3-156">SLA を測定する時間枠について考慮します。</span><span class="sxs-lookup"><span data-stu-id="60be3-156">Think about the time window that your SLA is measured against.</span></span> <span data-ttu-id="60be3-157">この時間枠を短くするほど、許容度は厳格になります。</span><span class="sxs-lookup"><span data-stu-id="60be3-157">The smaller the window, the tighter the tolerances.</span></span> <span data-ttu-id="60be3-158">時間単位または日単位のアップタイムという観点で SLA を定義することは意味がありません。</span><span class="sxs-lookup"><span data-stu-id="60be3-158">It doesn't make sense to define your SLA in terms of hourly or daily uptime.</span></span>
- <span data-ttu-id="60be3-159">MTBF と MTTR の測定値を考慮します。</span><span class="sxs-lookup"><span data-stu-id="60be3-159">Consider the MTBF and MTTR measurements.</span></span> <span data-ttu-id="60be3-160">SLA が高ければ高いほど、サービスがダウンする可能性は低くなり、サービスをより短時間で回復させる必要があります。</span><span class="sxs-lookup"><span data-stu-id="60be3-160">The higher your SLA, the less frequently the service can go down and the quicker the service must recover.</span></span>
- <span data-ttu-id="60be3-161">アプリケーションの各部分の可用性の目標について顧客から合意を得て、それをドキュメント化します。</span><span class="sxs-lookup"><span data-stu-id="60be3-161">Get agreement from your customers for the availability targets of each piece of your application, and document it.</span></span> <span data-ttu-id="60be3-162">そうしないと、顧客の期待を満たす設計にすることはできません。</span><span class="sxs-lookup"><span data-stu-id="60be3-162">Otherwise, your design may not meet the customers' expectations.</span></span>

### <a name="identify-dependencies"></a><span data-ttu-id="60be3-163">依存関係を識別する</span><span class="sxs-lookup"><span data-stu-id="60be3-163">Identify dependencies</span></span>

<span data-ttu-id="60be3-164">依存関係マッピングの演習を行って、内部依存関係と外部依存関係を識別します。</span><span class="sxs-lookup"><span data-stu-id="60be3-164">Perform dependency-mapping exercises to identify internal and external dependencies.</span></span> <span data-ttu-id="60be3-165">たとえば、セキュリティまたは ID (Active Directory など) や、サード パーティーのサービス (支払プロバイダーや電子メール メッセージ サービスなど) に関連する依存関係があります。</span><span class="sxs-lookup"><span data-stu-id="60be3-165">Examples include dependencies relating to security or identity, such as Active Directory, or third-party services such as a payment provider or e-mail messaging service.</span></span>

<span data-ttu-id="60be3-166">単一障害点になったり、ボトルネックを生じさせたりする可能性がある外部依存関係には、特に注意を払ってください。</span><span class="sxs-lookup"><span data-stu-id="60be3-166">Pay particular attention to external dependencies that might be a single point of failure or cause bottlenecks.</span></span> <span data-ttu-id="60be3-167">ワークロードのアップタイム要件が 99.99% で、SLA が 99.9% のサービスに依存している場合、そのサービスをシステムの単一障害点にしてはなりません。</span><span class="sxs-lookup"><span data-stu-id="60be3-167">If a workload requires 99.99% uptime but depends on a service with a 99.9% SLA, that service can't be a single point of failure in the system.</span></span> <span data-ttu-id="60be3-168">1 つの救済方法として、サービスが失敗した場合に備えてフォールバック パスを用意します。</span><span class="sxs-lookup"><span data-stu-id="60be3-168">One remedy is to have a fallback path in case the service fails.</span></span> <span data-ttu-id="60be3-169">あるいは、そのサービス内の障害から復旧するためのその他の手段を実行します。</span><span class="sxs-lookup"><span data-stu-id="60be3-169">Alternatively, take other measures to recover from a failure in that service.</span></span>

<span data-ttu-id="60be3-170">次の表は、さまざまな SLA レベルで考えられる累積的なダウンタイムの一覧です。</span><span class="sxs-lookup"><span data-stu-id="60be3-170">The following table shows the potential cumulative downtime for various SLA levels.</span></span>

| <span data-ttu-id="60be3-171">**SLA**</span><span class="sxs-lookup"><span data-stu-id="60be3-171">**SLA**</span></span> | <span data-ttu-id="60be3-172">**週あたりのダウンタイム**</span><span class="sxs-lookup"><span data-stu-id="60be3-172">**Downtime per week**</span></span> | <span data-ttu-id="60be3-173">**月あたりのダウンタイム**</span><span class="sxs-lookup"><span data-stu-id="60be3-173">**Downtime per month**</span></span> | <span data-ttu-id="60be3-174">**年あたりのダウンタイム**</span><span class="sxs-lookup"><span data-stu-id="60be3-174">**Downtime per year**</span></span> |
|---------|-----------------------|------------------------|-----------------------|
| <span data-ttu-id="60be3-175">99%</span><span class="sxs-lookup"><span data-stu-id="60be3-175">99%</span></span>     | <span data-ttu-id="60be3-176">1.68 時間</span><span class="sxs-lookup"><span data-stu-id="60be3-176">1.68 hours</span></span>            | <span data-ttu-id="60be3-177">7.2 時間</span><span class="sxs-lookup"><span data-stu-id="60be3-177">7.2 hours</span></span>              | <span data-ttu-id="60be3-178">3.65 日</span><span class="sxs-lookup"><span data-stu-id="60be3-178">3.65 days</span></span>             |
| <span data-ttu-id="60be3-179">99.9%</span><span class="sxs-lookup"><span data-stu-id="60be3-179">99.9%</span></span>   | <span data-ttu-id="60be3-180">10.1 分</span><span class="sxs-lookup"><span data-stu-id="60be3-180">10.1 minutes</span></span>          | <span data-ttu-id="60be3-181">43.2 分</span><span class="sxs-lookup"><span data-stu-id="60be3-181">43.2 minutes</span></span>           | <span data-ttu-id="60be3-182">8.76 時間</span><span class="sxs-lookup"><span data-stu-id="60be3-182">8.76 hours</span></span>            |
| <span data-ttu-id="60be3-183">99.95%</span><span class="sxs-lookup"><span data-stu-id="60be3-183">99.95%</span></span>  | <span data-ttu-id="60be3-184">5 分</span><span class="sxs-lookup"><span data-stu-id="60be3-184">5 minutes</span></span>             | <span data-ttu-id="60be3-185">21.6 分</span><span class="sxs-lookup"><span data-stu-id="60be3-185">21.6 minutes</span></span>           | <span data-ttu-id="60be3-186">4.38 時間</span><span class="sxs-lookup"><span data-stu-id="60be3-186">4.38 hours</span></span>            |
| <span data-ttu-id="60be3-187">99.99%</span><span class="sxs-lookup"><span data-stu-id="60be3-187">99.99%</span></span>  | <span data-ttu-id="60be3-188">1.01 分</span><span class="sxs-lookup"><span data-stu-id="60be3-188">1.01 minutes</span></span>          | <span data-ttu-id="60be3-189">4.32 分</span><span class="sxs-lookup"><span data-stu-id="60be3-189">4.32 minutes</span></span>           | <span data-ttu-id="60be3-190">52.56 分</span><span class="sxs-lookup"><span data-stu-id="60be3-190">52.56 minutes</span></span>         |
| <span data-ttu-id="60be3-191">99.999%</span><span class="sxs-lookup"><span data-stu-id="60be3-191">99.999%</span></span> | <span data-ttu-id="60be3-192">6 秒</span><span class="sxs-lookup"><span data-stu-id="60be3-192">6 seconds</span></span>             | <span data-ttu-id="60be3-193">25.9 秒</span><span class="sxs-lookup"><span data-stu-id="60be3-193">25.9 seconds</span></span>           | <span data-ttu-id="60be3-194">5.26 分</span><span class="sxs-lookup"><span data-stu-id="60be3-194">5.26 minutes</span></span>          |

## <a name="understand-service-level-agreements"></a><span data-ttu-id="60be3-195">サービス レベル アグリーメントを理解する</span><span class="sxs-lookup"><span data-stu-id="60be3-195">Understand service-level agreements</span></span>

<span data-ttu-id="60be3-196">Azure では、[サービス レベル アグリーメント](https://azure.microsoft.com/en-us/support/legal/sla/)に、アップタイムと接続性について Microsoft のコミットメントが示されています。</span><span class="sxs-lookup"><span data-stu-id="60be3-196">In Azure, the [Service Level Agreement](https://azure.microsoft.com/en-us/support/legal/sla/) describes Microsoft's commitments for uptime and connectivity.</span></span> <span data-ttu-id="60be3-197">特定のサービスの SLA が 99.9% の場合は、そのサービスを 99.9% の時間、使用可能であることが期待できます。</span><span class="sxs-lookup"><span data-stu-id="60be3-197">If the SLA for a particular service is 99.9%, you should expect the service to be available 99.9% of the time.</span></span> <span data-ttu-id="60be3-198">サービスの種類によって、SLA もそれぞれ異なります。</span><span class="sxs-lookup"><span data-stu-id="60be3-198">Different services have different SLAs.</span></span>

<span data-ttu-id="60be3-199">また、Azure SLA には、SLA が満たされない場合にサービス クレジットを取得するための規定と、各サービスの *可用性* の詳細な定義も含まれています。</span><span class="sxs-lookup"><span data-stu-id="60be3-199">The Azure SLA also includes provisions for obtaining a service credit if the SLA is not met, along with specific definitions of *availability* for each service.</span></span> <span data-ttu-id="60be3-200">SLA のこの側面は、強制ポリシーとして機能します。</span><span class="sxs-lookup"><span data-stu-id="60be3-200">That aspect of the SLA acts as an enforcement policy.</span></span>

### <a name="composite-slas"></a><span data-ttu-id="60be3-201">複合 SLA</span><span class="sxs-lookup"><span data-stu-id="60be3-201">Composite SLAs</span></span>

<span data-ttu-id="60be3-202">*複合 SLA* では、それぞれの可用性レベルが異なる複数のサービスで、1 つのアプリケーションをサポートする必要があります。</span><span class="sxs-lookup"><span data-stu-id="60be3-202">*Composite SLAs* involve multiple services supporting an application, each with differing levels of availability.</span></span> <span data-ttu-id="60be3-203">たとえば、Azure SQL Database に書き込む App Service Web アプリについて検討します。</span><span class="sxs-lookup"><span data-stu-id="60be3-203">For example, consider an App Service web app that writes to Azure SQL Database.</span></span> <span data-ttu-id="60be3-204">この記事の執筆時点で、このような Azure サービスには次の SLA があります。</span><span class="sxs-lookup"><span data-stu-id="60be3-204">At the time of this writing, these Azure services have the following SLAs:</span></span>

- <span data-ttu-id="60be3-205">App Service Web アプリ = 99.95%</span><span class="sxs-lookup"><span data-stu-id="60be3-205">App Service web apps = 99.95%</span></span>
- <span data-ttu-id="60be3-206">SQL Database = 99.99%</span><span class="sxs-lookup"><span data-stu-id="60be3-206">SQL Database = 99.99%</span></span>

<span data-ttu-id="60be3-207">このアプリケーションで予想される最大ダウンタイムはどのくらいですか。</span><span class="sxs-lookup"><span data-stu-id="60be3-207">What is the maximum downtime you would expect for this application?</span></span> <span data-ttu-id="60be3-208">いずれかのサービスで障害が発生すると、アプリケーション全体で障害が発生します。</span><span class="sxs-lookup"><span data-stu-id="60be3-208">If either service fails, the whole application fails.</span></span> <span data-ttu-id="60be3-209">各サービスで障害が発生する可能性は独立しているため、このアプリケーションの複合 SLA は 99.95% x 99.99% = 99.94% です。</span><span class="sxs-lookup"><span data-stu-id="60be3-209">The probability of each service failing is independent, so the composite SLA for this application is 99.95% × 99.99% = 99.94%.</span></span> <span data-ttu-id="60be3-210">これは個々の SLA よりも低い値です。複数のサービスに依存するアプリケーションは潜在的な障害点が多くなるため、これは驚くことではありません。</span><span class="sxs-lookup"><span data-stu-id="60be3-210">That's lower than the individual SLAs, which isn't surprising because an application that relies on multiple services has more potential failure points.</span></span>

<span data-ttu-id="60be3-211">複合 SLA を改善するには、独立したフォールバック パスを作成する方法があります。</span><span class="sxs-lookup"><span data-stu-id="60be3-211">You can improve the composite SLA by creating independent fallback paths.</span></span> <span data-ttu-id="60be3-212">たとえば、SQL Database が使用できない場合は、後で処理できるようにトランザクションをキューに格納します。</span><span class="sxs-lookup"><span data-stu-id="60be3-212">For example, if SQL Database is unavailable, put transactions into a queue to be processed later.</span></span>

![複合 SLA](_images/composite-sla.png)

<span data-ttu-id="60be3-214">この設計の場合、データベースに接続できない場合でも、アプリケーションは使用可能な状態です。</span><span class="sxs-lookup"><span data-stu-id="60be3-214">With this design, the application is still available even if it can't connect to the database.</span></span> <span data-ttu-id="60be3-215">ただし、データベースとキューの両方で同時に障害が発生すると、アプリケーションは使用できなくなります。</span><span class="sxs-lookup"><span data-stu-id="60be3-215">However, it fails if the database and the queue both fail at the same time.</span></span> <span data-ttu-id="60be3-216">同時に障害が発生する時間の予測される割合は 0.0001 x 0.001 なので、この組み合わせのパスに関する複合 SLA は次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="60be3-216">The expected percentage of time for a simultaneous failure is 0.0001 × 0.001, so the composite SLA for this combined path is:</span></span>

- <span data-ttu-id="60be3-217">データベース *or* キュー = 1.0 − (0.0001 × 0.001) = 99.99999%</span><span class="sxs-lookup"><span data-stu-id="60be3-217">Database *or* queue = 1.0 − (0.0001 × 0.001) = 99.99999%</span></span>

<span data-ttu-id="60be3-218">合計複合 SLA は次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="60be3-218">The total composite SLA is:</span></span>

- <span data-ttu-id="60be3-219">Web アプリ *and* (データベース *or* キュー) = 99.95% × 99.99999% = \~99.95%</span><span class="sxs-lookup"><span data-stu-id="60be3-219">Web app *and* (database *or* queue) = 99.95% × 99.99999% = \~99.95%</span></span>

<span data-ttu-id="60be3-220">この方法にはトレードオフがあります。</span><span class="sxs-lookup"><span data-stu-id="60be3-220">There are tradeoffs to this approach.</span></span> <span data-ttu-id="60be3-221">アプリケーション ロジックは複雑になり、キューのコストがかかり、データの一貫性に関する問題も考慮する必要があります。</span><span class="sxs-lookup"><span data-stu-id="60be3-221">The application logic is more complex, you are paying for the queue, and you need to consider data consistency issues.</span></span>

### <a name="slas-for-multiregion-deployments"></a><span data-ttu-id="60be3-222">複数リージョン デプロイの SLA</span><span class="sxs-lookup"><span data-stu-id="60be3-222">SLAs for multiregion deployments</span></span>

<span data-ttu-id="60be3-223">"*複数リージョン デプロイの SLA*" では、アプリケーションを複数のリージョンにデプロイすることで、1 つのリージョンのアプリケーションで障害が発生した場合に Azure Traffic Manager を使用してフェールオーバーできるようにする高可用性の方法が必要です。</span><span class="sxs-lookup"><span data-stu-id="60be3-223">*SLAs for multiregion deployments* involve a high-availability technique to deploy the application in more than one region and use Azure Traffic Manager to fail over if the application fails in one region.</span></span>

<span data-ttu-id="60be3-224">マルチリージョン デプロイの場合の複合 SLA は次のように計算されます。</span><span class="sxs-lookup"><span data-stu-id="60be3-224">The composite SLA for a multiregion deployment is calculated as follows:</span></span>

- <span data-ttu-id="60be3-225">*N* は、1 つのリージョンにデプロイされているアプリケーション用の複合 SLA です。</span><span class="sxs-lookup"><span data-stu-id="60be3-225">*N* is the composite SLA for the application deployed in one region.</span></span>
- <span data-ttu-id="60be3-226">*R* は、アプリケーションがデプロイされているリージョンの数です。</span><span class="sxs-lookup"><span data-stu-id="60be3-226">*R* is the number of regions where the application is deployed.</span></span>

<span data-ttu-id="60be3-227">すべてのリージョンでアプリケーションの障害が発生する可能性は ((1 − N) \^ R) と予測されます。</span><span class="sxs-lookup"><span data-stu-id="60be3-227">The expected chance that the application fails in all regions at the same time is ((1 − N) \^ R).</span></span> <span data-ttu-id="60be3-228">たとえば、1 つのリージョンの SLA が 99.95% の場合は次のようになります。</span><span class="sxs-lookup"><span data-stu-id="60be3-228">For example, if the single-region SLA is 99.95%:</span></span>

- <span data-ttu-id="60be3-229">2 つのリージョンの複合 SLA = (1 − (1 − 0.9995) \^ 2) = 99.999975%</span><span class="sxs-lookup"><span data-stu-id="60be3-229">The combined SLA for two regions = (1 − (1 − 0.9995) \^ 2) = 99.999975%</span></span>
- <span data-ttu-id="60be3-230">4 つのリージョンの複合 SLA =  (1 − (1 − 0.9995) \^ 4)  = 99.999999%</span><span class="sxs-lookup"><span data-stu-id="60be3-230">The combined SLA for four regions =  (1 − (1 − 0.9995) \^ 4)  = 99.999999%</span></span>

<span data-ttu-id="60be3-231">[Traffic Manager の SLA](https://azure.microsoft.com/en-us/support/legal/sla/traffic-manager/v1_0/) も要因になります。</span><span class="sxs-lookup"><span data-stu-id="60be3-231">The [SLA for Traffic Manager](https://azure.microsoft.com/en-us/support/legal/sla/traffic-manager/v1_0/) is also a factor.</span></span> <span data-ttu-id="60be3-232">アクティブ/パッシブ構成ではフェールオーバーは瞬時に完了しないので、フェールオーバー時にはダウンタイムが発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="60be3-232">Failing over is not instantaneous in active-passive configurations, which can result in downtime during a failover.</span></span> <span data-ttu-id="60be3-233">[Traffic Manager エンドポイントの監視とフェールオーバー](/azure/traffic-manager/traffic-manager-monitoring)に関するページを参照してください。</span><span class="sxs-lookup"><span data-stu-id="60be3-233">See [Traffic Manager endpoint monitoring and failover](/azure/traffic-manager/traffic-manager-monitoring).</span></span>

## <a name="next-steps"></a><span data-ttu-id="60be3-234">次の手順</span><span class="sxs-lookup"><span data-stu-id="60be3-234">Next steps</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="60be3-235">回復性と可用性を考慮した設計</span><span class="sxs-lookup"><span data-stu-id="60be3-235">Architect for resiliency and availability</span></span>](./architect.md)
