---
title: 回復性と可用性のための Azure アプリケーションのデプロイ
description: Azure で信頼性の高いデプロイを作成するための手法の概要
author: MikeWasson
ms.date: 04/10/2019
ms.topic: article
ms.service: architecture-center
ms.subservice: cloud-design-principles
ms.openlocfilehash: d8df3fe1c3353c60462959a625ba13ae47b96cf8
ms.sourcegitcommit: 579c39ff4b776704ead17a006bf24cd4cdc65edd
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/17/2019
ms.locfileid: "59642876"
---
# <a name="deploying-azure-applications-for-resiliency-and-availability"></a><span data-ttu-id="19fd8-103">回復性と可用性のための Azure アプリケーションのデプロイ</span><span class="sxs-lookup"><span data-stu-id="19fd8-103">Deploying Azure applications for resiliency and availability</span></span>

<span data-ttu-id="19fd8-104">Azure リソース、アプリケーション コード、および構成設定をプロビジョニングして更新する際は、反復可能で予測可能なプロセスがエラーとダウンタイムの回避に役立ちます。</span><span class="sxs-lookup"><span data-stu-id="19fd8-104">As you provision and update Azure resources, application code, and configuration settings, a repeatable and predictable process will help you avoid errors and downtime.</span></span> <span data-ttu-id="19fd8-105">オンデマンドで実行し、エラーが発生した場合には再実行できる自動プロセスでデプロイすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="19fd8-105">We recommend automated processes for deployment that you can run on demand and rerun if something fails.</span></span> <span data-ttu-id="19fd8-106">円滑に実行されたデプロイ プロセスは、プロセスのドキュメントにその方法を保存することができます。</span><span class="sxs-lookup"><span data-stu-id="19fd8-106">After your deployment processes are running smoothly, process documentation can keep them that way.</span></span>

## <a name="automate-processes"></a><span data-ttu-id="19fd8-107">プロセスを自動化する</span><span class="sxs-lookup"><span data-stu-id="19fd8-107">Automate processes</span></span>

<span data-ttu-id="19fd8-108">リソースをオンデマンドでアクティブ化し、ソリューションをすばやくデプロイし、人的エラーを最小限に抑え、一貫性があり反復可能な結果を生成するには、デプロイと更新を自動化してください。</span><span class="sxs-lookup"><span data-stu-id="19fd8-108">To activate resources on demand, deploy solutions rapidly, minimize human error, and produce consistent and repeatable results, be sure to automate deployments and updates.</span></span>

### <a name="automate-as-many-processes-as-possible"></a><span data-ttu-id="19fd8-109">可能な限り多くのプロセスを自動化する</span><span class="sxs-lookup"><span data-stu-id="19fd8-109">Automate as many processes as possible</span></span>

<span data-ttu-id="19fd8-110">最も信頼性の高いデプロイ プロセスが自動化され、*べき等*&mdash;になります。つまり同じ結果を繰り返し生成できます。</span><span class="sxs-lookup"><span data-stu-id="19fd8-110">The most reliable deployment processes are automated and *idempotent* &mdash; that is, repeatable to produce the same results.</span></span>

- <span data-ttu-id="19fd8-111">Azure リソースのプロビジョニングを自動化するために、[Terraform](/azure/virtual-machines/windows/infrastructure-automation#terraform)、[Ansible](/azure/virtual-machines/windows/infrastructure-automation#ansible)、[Chef](/azure/virtual-machines/windows/infrastructure-automation#chef)、[Puppet](/azure/virtual-machines/windows/infrastructure-automation#puppet)、[Azure PowerShell](/powershell/azure/overview)、 [Azure コマンドライン インターフェイス (CLI)](/cli/azure)、または  [Azure Resource Manager テンプレート](/azure/azure-resource-manager/resource-group-overview#template-deployment)を使用できます。</span><span class="sxs-lookup"><span data-stu-id="19fd8-111">To automate provisioning of Azure resources, you can use [Terraform](/azure/virtual-machines/windows/infrastructure-automation#terraform),   [Ansible](/azure/virtual-machines/windows/infrastructure-automation#ansible), [Chef](/azure/virtual-machines/windows/infrastructure-automation#chef), [Puppet](/azure/virtual-machines/windows/infrastructure-automation#puppet),   [Azure PowerShell](/powershell/azure/overview), [Azure command-line interface (CLI)](/cli/azure), or [Azure Resource Manager templates](/azure/azure-resource-manager/resource-group-overview#template-deployment).</span></span>
- <span data-ttu-id="19fd8-112">VM を構成するには、 [cloud-init](/azure/virtual-machines/windows/infrastructure-automation#cloud-init)  (Linux VM の場合)、または  [Azure Automation State Configuration](/azure/automation/automation-dsc-overview) (DSC) を使用できます。</span><span class="sxs-lookup"><span data-stu-id="19fd8-112">To configure VMs, you can use [cloud-init](/azure/virtual-machines/windows/infrastructure-automation#cloud-init) (for Linux VMs) or [Azure Automation State Configuration](/azure/automation/automation-dsc-overview) (DSC).</span></span>
- <span data-ttu-id="19fd8-113">アプリケーションのデプロイを自動化するには、 [Azure DevOps Services](/azure/virtual-machines/windows/infrastructure-automation#azure-devops-services)、 [Jenkins](/azure/virtual-machines/windows/infrastructure-automation#jenkins)、またはその他の CI/CD ソリューションを使用できます。</span><span class="sxs-lookup"><span data-stu-id="19fd8-113">To automate application deployment, you can use [Azure DevOps Services](/azure/virtual-machines/windows/infrastructure-automation#azure-devops-services), [Jenkins](/azure/virtual-machines/windows/infrastructure-automation#jenkins), or other CI/CD solutions.</span></span>

<span data-ttu-id="19fd8-114">ベスト プラクティスとして、パラメーターとスクリプトの使用例の説明が記載され、すばやくアクセスできる、カテゴリ化された自動化スクリプトのリポジトリを作成します。</span><span class="sxs-lookup"><span data-stu-id="19fd8-114">As a best practice, create a repository of categorized automation scripts for quick access, documented with explanations of parameters and examples of script use.</span></span> <span data-ttu-id="19fd8-115">このドキュメントが自分の Azure デプロイと常に同期されるようにし、リポジトリを管理するプライマリ ユーザーを指定します。</span><span class="sxs-lookup"><span data-stu-id="19fd8-115">Keep this documentation in sync with your Azure deployments, and designate a primary person to manage the repository.</span></span>

<span data-ttu-id="19fd8-116">自動化スクリプトを使用すると、ディザスター リカバリーのためにオンデマンドでリソースをアクティブ化することもできます。</span><span class="sxs-lookup"><span data-stu-id="19fd8-116">Automation scripts can also activate resources on demand for disaster recovery.</span></span>

### <a name="use-code-to-provision-and-configure-infrastructure"></a><span data-ttu-id="19fd8-117">プロビジョニングするコードの使用とインフラストラクチャの構成</span><span class="sxs-lookup"><span data-stu-id="19fd8-117">Use code to provision and configure infrastructure</span></span>

<span data-ttu-id="19fd8-118">この*コードとしてのインフラストラクチャ*と呼ばれる演習には、宣言型の方法、命令型の方法 (またはその両方の組み合わせ) を使用することができます。</span><span class="sxs-lookup"><span data-stu-id="19fd8-118">This practice, called *infrastructure as code,* may use a declarative approach or an imperative approach (or a combination of both).</span></span>

- <span data-ttu-id="19fd8-119">宣言型の方法の例として、[Resource Manager テンプレート](/azure/azure-resource-manager/resource-group-overview#template-deployment)があります。</span><span class="sxs-lookup"><span data-stu-id="19fd8-119">[Resource Manager templates](/azure/azure-resource-manager/resource-group-overview#template-deployment) are an example of a declarative approach.</span></span>
- <span data-ttu-id="19fd8-120">[PowerShell](/powershell/azure/overview) スクリプトは、命令型の方法の一例です。</span><span class="sxs-lookup"><span data-stu-id="19fd8-120">[PowerShell](/powershell/azure/overview) scripts are an example of an imperative approach.</span></span>

### <a name="practice-immutable-infrastructure"></a><span data-ttu-id="19fd8-121">イミュータブル インフラストラクチャを実践する</span><span class="sxs-lookup"><span data-stu-id="19fd8-121">Practice immutable infrastructure</span></span>

<span data-ttu-id="19fd8-122">つまり、運用環境にデプロイされた後はインフラストラクチャを変更しないでください。</span><span class="sxs-lookup"><span data-stu-id="19fd8-122">In other words, don't modify infrastructure after it's deployed to production.</span></span> <span data-ttu-id="19fd8-123">アドホックの変更が適用された後、正確な変更内容がわからないと、システムのトラブルシューティングが難しいことがあります。</span><span class="sxs-lookup"><span data-stu-id="19fd8-123">After ad hoc changes have been applied, you might not know exactly what has changed, so it can be difficult to troubleshoot the system.</span></span>

### <a name="automate-and-test-deployment-and-maintenance-tasks"></a><span data-ttu-id="19fd8-124">デプロイおよび保守のタスクを自動化してテストする</span><span class="sxs-lookup"><span data-stu-id="19fd8-124">Automate and test deployment and maintenance tasks</span></span>

<span data-ttu-id="19fd8-125">分散アプリケーションは、連携して動作する必要がある、複数の部分で構成されます。</span><span class="sxs-lookup"><span data-stu-id="19fd8-125">Distributed applications consist of multiple parts that must work together.</span></span> <span data-ttu-id="19fd8-126">デプロイでは、スクリプトのような実証済みのメカニズムを利用して構成の更新と検証を行ったり、デプロイ プロセスを自動化したりできます。</span><span class="sxs-lookup"><span data-stu-id="19fd8-126">Deployment should take advantage of proven mechanisms, such as scripts, that can update and validate configuration and automate the deployment process.</span></span> <span data-ttu-id="19fd8-127">エラーによってさらにダウンタイムが確実に発生しないようにするため、すべてのプロセスを完全にテストしてください。</span><span class="sxs-lookup"><span data-stu-id="19fd8-127">Test all processes fully to ensure that errors don't cause additional downtime.</span></span>

### <a name="implement-deployment-security-measures"></a><span data-ttu-id="19fd8-128">デプロイのセキュリティ対策を実装する</span><span class="sxs-lookup"><span data-stu-id="19fd8-128">Implement deployment security measures</span></span>

<span data-ttu-id="19fd8-129">すべてのデプロイ ツールに、デプロイされたアプリケーションを保護するセキュリティ制限を組み込む必要があります。</span><span class="sxs-lookup"><span data-stu-id="19fd8-129">All deployment tools must incorporate security restrictions to protect the deployed application.</span></span> <span data-ttu-id="19fd8-130">デプロイ ポリシーを慎重に定義して適用し、人間の介入の必要性を最小限に抑えます。</span><span class="sxs-lookup"><span data-stu-id="19fd8-130">Define and enforce deployment policies carefully, and minimize the need for human intervention.</span></span>

## <a name="deploy-to-multiple-regions-and-instances"></a><span data-ttu-id="19fd8-131">複数のリージョンとインスタンスにデプロイする</span><span class="sxs-lookup"><span data-stu-id="19fd8-131">Deploy to multiple regions and instances</span></span>

<span data-ttu-id="19fd8-132">サービスの 1 つのインスタンスに依存するアプリケーションでは、単一障害点が発生します。</span><span class="sxs-lookup"><span data-stu-id="19fd8-132">An application that depends on a single instance of a service creates a single point of failure.</span></span> <span data-ttu-id="19fd8-133">回復性とスケーラビリティを改善するには、複数のインスタンスをプロビジョニングします。</span><span class="sxs-lookup"><span data-stu-id="19fd8-133">To improve resiliency and scalability, provision multiple instances.</span></span>

- <span data-ttu-id="19fd8-134">[Azure App Service](/azure/app-service/app-service-value-prop-what-is/) の場合は、複数のインスタンスを提供する [App Service プラン](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/)を選択してください。</span><span class="sxs-lookup"><span data-stu-id="19fd8-134">For [Azure App Service](/azure/app-service/app-service-value-prop-what-is/), select an [App Service plan](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/) that offers multiple instances.</span></span>
- <span data-ttu-id="19fd8-135">[Azure Cloud Services](/azure/cloud-services/cloud-services-choose-me) の場合は、[複数インスタンス](/azure/cloud-services/cloud-services-choose-me/#scaling-and-management)を使用するように各ロールを構成してください。</span><span class="sxs-lookup"><span data-stu-id="19fd8-135">For [Azure Cloud Services](/azure/cloud-services/cloud-services-choose-me), configure each of your roles to use [multiple instances](/azure/cloud-services/cloud-services-choose-me/#scaling-and-management).</span></span>
- <span data-ttu-id="19fd8-136">[Azure Virtual Machines](/azure/virtual-machines/virtual-machines-windows-about/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) の場合は、確実にアーキテクチャに 1 つ以上の VM が含まれ、[可用性セット](/azure/virtual-machines/virtual-machines-windows-manage-availability/)に各 VM が含まれるようにします。</span><span class="sxs-lookup"><span data-stu-id="19fd8-136">For [Azure Virtual Machines](/azure/virtual-machines/virtual-machines-windows-about/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json), ensure that your architecture includes more than one VM and that each VM is included in an [availability set](/azure/virtual-machines/virtual-machines-windows-manage-availability/).</span></span>

### <a name="consider-deploying-across-multiple-regions"></a><span data-ttu-id="19fd8-137">複数のリージョンにわたるデプロイを検討する</span><span class="sxs-lookup"><span data-stu-id="19fd8-137">Consider deploying across multiple regions</span></span>

<span data-ttu-id="19fd8-138">少なくともクリティカルなアプリケーションとアプリケーションのサービスを複数のリージョンにデプロイすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="19fd8-138">We recommend deploying all but the least critical applications and application services across multiple regions.</span></span> <span data-ttu-id="19fd8-139">アプリケーションが 1 つのリージョンにデプロイされている場合は、まれにリージョン全体が使用できなくなった場合に、アプリケーションも使用できなくなります。</span><span class="sxs-lookup"><span data-stu-id="19fd8-139">If your application is deployed to a single region, in the rare event that the entire region becomes unavailable, the application will also be unavailable.</span></span>

<span data-ttu-id="19fd8-140">1 つのリージョンにデプロイする場合は、予期しない障害への対応として、セカンダリ リージョンへの再デプロイの準備を検討してください。</span><span class="sxs-lookup"><span data-stu-id="19fd8-140">If you choose to deploy to a single region, consider preparing to redeploy to a secondary region as a response to an unexpected failure.</span></span>

### <a name="redeploy-to-a-secondary-region"></a><span data-ttu-id="19fd8-141">セカンダリ リージョンに再デプロイする</span><span class="sxs-lookup"><span data-stu-id="19fd8-141">Redeploy to a secondary region</span></span>

<span data-ttu-id="19fd8-142">レプリケーションのない 1 つのプライマリ リージョンでアプリケーションとデータベースを実行すると、復旧戦略により別のリージョンに再デプロイされることがあります。</span><span class="sxs-lookup"><span data-stu-id="19fd8-142">If you run applications and databases in a single, primary region with no replication, your recovery strategy might be to redeploy to another region.</span></span> <span data-ttu-id="19fd8-143">このソリューションは手頃な価格ですが、最も適しているのは長い復旧時間を許容できる、クリティカルでないアプリケーションです。</span><span class="sxs-lookup"><span data-stu-id="19fd8-143">This solution is affordable but most appropriate for non-critical applications that can tolerate longer recovery times.</span></span>

<span data-ttu-id="19fd8-144">この戦略を選択する場合は、可能な限り、再デプロイ プロセスを自動化し、障害対応のテストに再デプロイのシナリオを含めます。</span><span class="sxs-lookup"><span data-stu-id="19fd8-144">If you choose this strategy, automate the redeployment process as much as possible and include redeployment scenarios in your disaster response testing.</span></span>

<span data-ttu-id="19fd8-145">再デプロイ プロセスを自動化する場合は、[Azure Site Recovery](/azure/site-recovery/) の使用を検討してください。</span><span class="sxs-lookup"><span data-stu-id="19fd8-145">To automate your redeployment process, consider using [Azure Site Recovery](/azure/site-recovery/).</span></span>

## <a name="use-staging-and-production-environments"></a><span data-ttu-id="19fd8-146">ステージングと運用環境を使用する</span><span class="sxs-lookup"><span data-stu-id="19fd8-146">Use staging and production environments</span></span>

<span data-ttu-id="19fd8-147">ステージングと運用環境を適切に使用することで、高度に制御された方法で更新プログラムを運用環境にプッシュし、予期しないデプロイの問題による中断を最小限に抑えることができます。</span><span class="sxs-lookup"><span data-stu-id="19fd8-147">With good use of staging and production environments, you can push updates to the production environment in a highly controlled way and minimize disruption from unanticipated deployment issues.</span></span>

- <span data-ttu-id="19fd8-148">[*Blue/Green デプロイ*](https://martinfowler.com/bliki/BlueGreenDeployment.html) では、ライブ アプリケーションとは別の運用環境に更新プログラムをデプロイする必要があります。</span><span class="sxs-lookup"><span data-stu-id="19fd8-148">[*Blue-green deployment*](https://martinfowler.com/bliki/BlueGreenDeployment.html) involves deploying an update into a production environment that's separate from the live application.</span></span> <span data-ttu-id="19fd8-149">デプロイの検証が完了したら、トラフィック ルーティングを更新されたバージョンに切り替えます。</span><span class="sxs-lookup"><span data-stu-id="19fd8-149">After you validate the deployment, switch the traffic routing to the updated version.</span></span> <span data-ttu-id="19fd8-150">これを実行する方法の 1 つが、Azure App Service で使用できる[ステージング スロット](/azure/app-service/web-sites-staged-publishing)を使用して、運用環境に移動する前にデプロイをステージングすることです。</span><span class="sxs-lookup"><span data-stu-id="19fd8-150">One way to do this is to use the [staging slots](/azure/app-service/web-sites-staged-publishing) available in Azure App Service to stage a deployment before moving it to production.</span></span>
- <span data-ttu-id="19fd8-151">[*カナリア リリース*](https://martinfowler.com/bliki/CanaryRelease.html) は、Blue/Green デプロイと似ています。</span><span class="sxs-lookup"><span data-stu-id="19fd8-151">[*Canary releases*](https://martinfowler.com/bliki/CanaryRelease.html) are similar to blue-green deployments.</span></span> <span data-ttu-id="19fd8-152">すべてのトラフィックを更新されたアプリケーションに切り替える代わりに、トラフィックのごく一部のみを新しいデプロイにルーティングします。</span><span class="sxs-lookup"><span data-stu-id="19fd8-152">Instead of switching all traffic to the updated application, you route only a small portion of the traffic to the new deployment.</span></span> <span data-ttu-id="19fd8-153">問題が発生した場合は、以前のデプロイに戻します。</span><span class="sxs-lookup"><span data-stu-id="19fd8-153">If there's a problem, revert to the old deployment.</span></span> <span data-ttu-id="19fd8-154">そうでない場合は、より多くのトラフィックを段階的に新しいバージョンにルーティングします。</span><span class="sxs-lookup"><span data-stu-id="19fd8-154">If not, gradually route more traffic to the new version.</span></span> <span data-ttu-id="19fd8-155">Azure App Service を使用している場合は、運用環境でのテスト機能を使用してカナリア リリースを管理することができます。</span><span class="sxs-lookup"><span data-stu-id="19fd8-155">If you're using Azure App Service, you can use the Testing in production feature to manage a canary release.</span></span>

## <a name="create-a-rollback-plan-for-deployment-and-updates"></a><span data-ttu-id="19fd8-156">デプロイと更新のためのロールバック計画を作成する</span><span class="sxs-lookup"><span data-stu-id="19fd8-156">Create a rollback plan for deployment and updates</span></span>

<span data-ttu-id="19fd8-157">デプロイに失敗した場合、アプリケーションが使用できなくなる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="19fd8-157">If a deployment fails, your application could become unavailable.</span></span> <span data-ttu-id="19fd8-158">ダウンタイムを最小限に抑えるため、直前の正常なバージョンに戻すためのロールバック プロセスを設計します。</span><span class="sxs-lookup"><span data-stu-id="19fd8-158">To minimize downtime, design a rollback process to go back to a last-known good version.</span></span> <span data-ttu-id="19fd8-159">アプリが依存しているデータベースとその他のサービスの変更をロールバックする戦略を含めます。</span><span class="sxs-lookup"><span data-stu-id="19fd8-159">Include a strategy to roll back changes to databases and any other services your app depends on.</span></span>

<span data-ttu-id="19fd8-160">Azure App Service を使用している場合は、直前の正常なサイト スロットを設定し、これを使用して Web または API アプリのデプロイからロールバックできます。</span><span class="sxs-lookup"><span data-stu-id="19fd8-160">If you're using Azure App Service, you can set up a last-known good site slot and use it to roll back from a web or API app deployment.</span></span>

## <a name="log-and-audit-deployments"></a><span data-ttu-id="19fd8-161">デプロイのログを記録して監査する</span><span class="sxs-lookup"><span data-stu-id="19fd8-161">Log and audit deployments</span></span>

<span data-ttu-id="19fd8-162">できるだけ多くのバージョン固有の情報を把握するため、確実なログ記録の方法を実装してください。</span><span class="sxs-lookup"><span data-stu-id="19fd8-162">To capture as much version-specific information as possible, implement a robust logging strategy.</span></span> <span data-ttu-id="19fd8-163">ステージング デプロイ手法を使用する場合、運用環境では複数のバージョンのアプリケーションが実行されることになります。</span><span class="sxs-lookup"><span data-stu-id="19fd8-163">If you use staged deployment techniques, more than one version of your application will be running in production.</span></span> <span data-ttu-id="19fd8-164">問題が発生した場合は、どのバージョンが原因かを決定します。</span><span class="sxs-lookup"><span data-stu-id="19fd8-164">If a problem occurs, determine which version is causing it.</span></span>

## <a name="document-release-processes"></a><span data-ttu-id="19fd8-165">リリース プロセスのドキュメント</span><span class="sxs-lookup"><span data-stu-id="19fd8-165">Document release processes</span></span>

<span data-ttu-id="19fd8-166">詳細なリリース プロセスのドキュメントがなければ、オペレーターが不適切な更新プログラムやアプリケーションに不適切な構成設定をデプロイする可能性があります。</span><span class="sxs-lookup"><span data-stu-id="19fd8-166">Without detailed release process documentation, an operator might deploy a bad update or might improperly configure settings for your application.</span></span> <span data-ttu-id="19fd8-167">リリース プロセスを明確に定義して文書化し、オペレーション チーム全体が確実に利用できるようにしてください。</span><span class="sxs-lookup"><span data-stu-id="19fd8-167">Clearly define and document your release process, and ensure that it's available to the entire operations team.</span></span>

## <a name="next-steps"></a><span data-ttu-id="19fd8-168">次の手順</span><span class="sxs-lookup"><span data-stu-id="19fd8-168">Next steps</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="19fd8-169">信頼性に対するアプリケーションの正常性を監視する</span><span class="sxs-lookup"><span data-stu-id="19fd8-169">Monitor application health for reliability</span></span>](./monitoring.md)
