---
title: Azure で信頼性に対するアプリケーションの正常性を監視する
description: Azure で監視を使用してアプリケーションの信頼性を向上させる方法
author: MikeWasson
ms.date: 04/10/2019
ms.topic: article
ms.service: architecture-center
ms.subservice: cloud-design-principles
ms.openlocfilehash: 46f9f3fb623a2facf4b9f9c6ec57376ae59e41dc
ms.sourcegitcommit: 579c39ff4b776704ead17a006bf24cd4cdc65edd
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/17/2019
ms.locfileid: "59642887"
---
# <a name="monitoring-application-health-for-reliability-in-azure"></a><span data-ttu-id="39daa-103">Azure で信頼性に対するアプリケーションの正常性を監視する</span><span class="sxs-lookup"><span data-stu-id="39daa-103">Monitoring application health for reliability in Azure</span></span>

<span data-ttu-id="39daa-104">監視と診断は回復性にとって非常に重要です。</span><span class="sxs-lookup"><span data-stu-id="39daa-104">Monitoring and diagnostics are crucial for resiliency.</span></span> <span data-ttu-id="39daa-105">何かが失敗した場合、失敗した "*こと*"、失敗した "*とき*"、失敗した "*理由*" を知る必要があります。</span><span class="sxs-lookup"><span data-stu-id="39daa-105">If something fails, you need to know *that* it failed, *when* it failed &mdash; and *why*.</span></span>

<span data-ttu-id="39daa-106">"*監視*" は "*障害の検出*" と同じではありません。</span><span class="sxs-lookup"><span data-stu-id="39daa-106">*Monitoring* is not the same as *failure detection*.</span></span> <span data-ttu-id="39daa-107">たとえば、アプリケーションでは、一時的なエラーを検出して再試行し、ダウンタイムを回避することがあります。</span><span class="sxs-lookup"><span data-stu-id="39daa-107">For example, your application might detect a transient error and retry, avoiding downtime.</span></span> <span data-ttu-id="39daa-108">それでも、再試行操作をログに記録して、エラー率を監視し、アプリケーションの正常性の全体像を把握できるようにすることも必要です。</span><span class="sxs-lookup"><span data-stu-id="39daa-108">But it should also log the retry operation so that you can monitor the error rate to get an overall picture of application health.</span></span>

<span data-ttu-id="39daa-109">監視と診断のプロセスは、4 つの異なるステージがあるパイプラインと考えることができます: インストルメンテーション、収集と保存、分析と診断、視覚化とアラート。</span><span class="sxs-lookup"><span data-stu-id="39daa-109">Think of the monitoring and diagnostics process as a pipeline with four distinct stages: Instrumentation, collection and storage, analysis and diagnosis, and visualization and alerts.</span></span>

## <a name="instrumentation"></a><span data-ttu-id="39daa-110">インストルメンテーション</span><span class="sxs-lookup"><span data-stu-id="39daa-110">Instrumentation</span></span>

<span data-ttu-id="39daa-111">アプリケーションを直接監視するのは実際的ではないので、インストルメンテーションが重要です。</span><span class="sxs-lookup"><span data-stu-id="39daa-111">It's not practical to monitor your application directly, so instrumentation is key.</span></span> <span data-ttu-id="39daa-112">大規模な分散システムでは、数十の仮想マシン (VM) で実行され、時間と共にそれが追加されたり削除されたりする可能性があります。</span><span class="sxs-lookup"><span data-stu-id="39daa-112">A large-scale distributed system might run on dozens of virtual machines (VMs), which are added and removed over time.</span></span> <span data-ttu-id="39daa-113">同様に、クラウド アプリケーションでは、多数のデータ ストアが使用され、1 つのユーザー アクションが複数のサブシステムにまたがる場合があります。</span><span class="sxs-lookup"><span data-stu-id="39daa-113">Likewise, a cloud application might use a number of data stores and a single user action might span multiple subsystems.</span></span>

<span data-ttu-id="39daa-114">リッチなインストルメンテーションを提供します。</span><span class="sxs-lookup"><span data-stu-id="39daa-114">Provide rich instrumentation:</span></span>

- <span data-ttu-id="39daa-115">可能性は高いけれども、まだ発生していない障害については、原因を特定し、状況を緩和して、システムを引き続き使用できるようにするのに十分なデータを提供します。</span><span class="sxs-lookup"><span data-stu-id="39daa-115">For failures that are likely but have not yet occurred, provide enough data to determine the cause, mitigate the situation, and ensure that the system remains available.</span></span>
- <span data-ttu-id="39daa-116">既に発生している障害については、アプリケーションでユーザーに適切なエラー メッセージを返しながらも、低下した機能であっても実行の継続を試みる必要があります。</span><span class="sxs-lookup"><span data-stu-id="39daa-116">For failures that have already occurred, the application should return an appropriate error message to the user but should attempt to continue running, albeit with reduced functionality.</span></span>

<span data-ttu-id="39daa-117">監視システムでは、包括的な詳細をキャプチャして、アプリケーションを効率的に復元できるようにし、必要な場合は、設計者や開発者が状況の再発を防ぐためにシステムを変更できるようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="39daa-117">Monitoring systems should capture comprehensive details so that applications can be restored efficiently and, if necessary, designers and developers can modify the system to prevent the situation from recurring.</span></span>

<span data-ttu-id="39daa-118">監視用の生データは、次のようなさまざまなソースから取得できます。</span><span class="sxs-lookup"><span data-stu-id="39daa-118">The raw data for monitoring can come from a variety of sources, including:</span></span>

- <span data-ttu-id="39daa-119">アプリケーション ログ。[Azure Application Insights](/azure/azure-monitor/app/app-insights-overview) サービスによって生成されるものなど。</span><span class="sxs-lookup"><span data-stu-id="39daa-119">Application logs, such as those produced by the [Azure Application Insights](/azure/azure-monitor/app/app-insights-overview) service.</span></span>
- <span data-ttu-id="39daa-120">[Azure 監視エージェント](/azure/azure-monitor/platform/agents-overview)によって収集されるオペレーティング システムのパフォーマンス メトリック。</span><span class="sxs-lookup"><span data-stu-id="39daa-120">Operating system performance metrics collected by [Azure monitoring agents](/azure/azure-monitor/platform/agents-overview).</span></span>
- <span data-ttu-id="39daa-121">[Azure リソース](/azure/azure-monitor/platform/metrics-supported)。Azure Monitor によって収集されるメトリックなど。</span><span class="sxs-lookup"><span data-stu-id="39daa-121">[Azure resources](/azure/azure-monitor/platform/metrics-supported), including metrics collected by Azure Monitor.</span></span>
- <span data-ttu-id="39daa-122">[Azure Service Health](/azure/service-health/service-health-overview)。アクティブなイベントの追跡に役立つダッシュボードが提供されます。</span><span class="sxs-lookup"><span data-stu-id="39daa-122">[Azure Service Health](/azure/service-health/service-health-overview), which offers a dashboard to help you track active events.</span></span>
- <span data-ttu-id="39daa-123">Azure プラットフォームに組み込まれている [Azure AD ログ](/azure/active-directory/reports-monitoring/howto-integrate-activity-logs-with-log-analytics) 。</span><span class="sxs-lookup"><span data-stu-id="39daa-123">[Azure AD logs](/azure/active-directory/reports-monitoring/howto-integrate-activity-logs-with-log-analytics) built into the Azure platform.</span></span>

<span data-ttu-id="39daa-124">ほとんどの Azure サービスにはメトリックと診断機能があり、問題の原因を分析して特定するために構成できます。</span><span class="sxs-lookup"><span data-stu-id="39daa-124">Most Azure services have metrics and diagnostics that you can configure to analyze and determine the cause of problems.</span></span> <span data-ttu-id="39daa-125">詳細については、[Azure Monitor によって収集される監視データ](/azure/azure-monitor/platform/data-collection)に関する記事を参照してください。</span><span class="sxs-lookup"><span data-stu-id="39daa-125">To learn more, see [Monitoring data collected by Azure Monitor](/azure/azure-monitor/platform/data-collection).</span></span>

## <a name="collection-and-storage"></a><span data-ttu-id="39daa-126">収集と保存</span><span class="sxs-lookup"><span data-stu-id="39daa-126">Collection and storage</span></span>

<span data-ttu-id="39daa-127">生のインストルメンテーション データは、次のようなさまざまな場所と形式で保持できます。</span><span class="sxs-lookup"><span data-stu-id="39daa-127">Raw instrumentation data can be held in various locations and formats, including:</span></span>

- <span data-ttu-id="39daa-128">アプリケーション トレース ログ</span><span class="sxs-lookup"><span data-stu-id="39daa-128">Application trace logs</span></span>
- <span data-ttu-id="39daa-129">IIS ログ</span><span class="sxs-lookup"><span data-stu-id="39daa-129">IIS logs</span></span>
- <span data-ttu-id="39daa-130">パフォーマンス カウンター</span><span class="sxs-lookup"><span data-stu-id="39daa-130">Performance counters</span></span>

<span data-ttu-id="39daa-131">これらのさまざまなソースは収集され、統合されて、Application Insights、Azure Monitor メトリック、Service Health、ストレージ アカウント、Azure Log Analytics など、Azure 内の信頼できるデータ ストアに配置されます。</span><span class="sxs-lookup"><span data-stu-id="39daa-131">These disparate sources are collected, consolidated, and placed in reliable data stores in Azure, such as Application Insights, Azure Monitor metrics, Service Health, storage accounts, and Azure Log Analytics.</span></span>

## <a name="analysis-and-diagnosis"></a><span data-ttu-id="39daa-132">分析と診断</span><span class="sxs-lookup"><span data-stu-id="39daa-132">Analysis and diagnosis</span></span>

<span data-ttu-id="39daa-133">これらのデータ ストアに統合されたデータを分析して、問題のトラブルシューティングを行い、アプリケーションの正常性の全体像を把握します。</span><span class="sxs-lookup"><span data-stu-id="39daa-133">Analyze data consolidated in these data stores to troubleshoot issues and gain an overall view of application health.</span></span> <span data-ttu-id="39daa-134">一般に、Kusto クエリを使って Application Insights や Log Analytics 内のデータを[検索して分析](/azure/azure-monitor/log-query/log-query-overview)したり、 [管理ソリューション](/azure/azure-monitor/insights/solutions-inventory)を使って事前構成済みのグラフを表示したりできます。</span><span class="sxs-lookup"><span data-stu-id="39daa-134">Generally, you can [search for and analyze](/azure/azure-monitor/log-query/log-query-overview) the data in Application Insights and Log Analytics using Kusto queries or view preconfigured graphs using [management solutions](/azure/azure-monitor/insights/solutions-inventory).</span></span> <span data-ttu-id="39daa-135">または、Azure Advisor を使って、[回復性](/azure/advisor/advisor-high-availability-recommendations)と[パフォーマンス](/azure/advisor/advisor-performance-recommendations)に重点を置いた推奨事項を表示します。</span><span class="sxs-lookup"><span data-stu-id="39daa-135">Or use Azure Advisor to view recommendations with a focus on [resiliency](/azure/advisor/advisor-high-availability-recommendations) and [performance](/azure/advisor/advisor-performance-recommendations).</span></span>

## <a name="visualization-and-alerts"></a><span data-ttu-id="39daa-136">視覚化とアラート</span><span class="sxs-lookup"><span data-stu-id="39daa-136">Visualization and alerts</span></span>

<span data-ttu-id="39daa-137">ダッシュボードやメール アラートなど、オペレーターが簡単に問題や傾向を把握できる形式でテレメトリ データを提供します。</span><span class="sxs-lookup"><span data-stu-id="39daa-137">Present telemetry data in a format that makes it easy for an operator to notice problems or trends quickly, such as a dashboard or email alert.</span></span>

<span data-ttu-id="39daa-138"> [Azure ダッシュボード](/azure/azure-portal/azure-portal-dashboards)を使ってアプリケーションの状態のフルスタック ビューを取得し、Application Insights、Log Analytics、Azure Monitor のメトリック、Service Health から監視グラフの統合ビューを作成します。</span><span class="sxs-lookup"><span data-stu-id="39daa-138">Get a full-stack view of application state by using [Azure dashboards](/azure/azure-portal/azure-portal-dashboards) to create a consolidated view of monitoring graphs from Application Insights, Log Analytics, Azure Monitor metrics, and Service Health.</span></span> <span data-ttu-id="39daa-139">そして、 [Azure Monitor のアラート](/azure/azure-monitor/platform/alerts-overview)を使って、Service Health、リソースの正常性、Azure Monitor のメトリック、Log Analytics のログ、Application Insights についての通知を作成します。</span><span class="sxs-lookup"><span data-stu-id="39daa-139">And use [Azure Monitor alerts](/azure/azure-monitor/platform/alerts-overview) to create notifications on Service Health, resource health, Azure Monitor metrics, logs in Log Analytics, and Application Insights.</span></span>

<span data-ttu-id="39daa-140">監視と診断の詳細については、「[監視と診断](../best-practices/monitoring.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="39daa-140">For more information about monitoring and diagnostics, see [Monitoring and diagnostics](../best-practices/monitoring.md).</span></span>

## <a name="health-probes-and-check-functions"></a><span data-ttu-id="39daa-141">正常性プローブとチェック機能</span><span class="sxs-lookup"><span data-stu-id="39daa-141">Health probes and check functions</span></span>

<span data-ttu-id="39daa-142">アプリケーションの正常性とパフォーマンスは、時間の経過と共に低下することがあり、アプリケーションで障害が発生するまで低下に気づかない場合があります。</span><span class="sxs-lookup"><span data-stu-id="39daa-142">The health and performance of an application can degrade over time, and degradation might not be noticeable until the application fails.</span></span>

<span data-ttu-id="39daa-143">プローブまたはチェック機能を実装し、アプリケーションの外部から定期的にそれらを実行します。</span><span class="sxs-lookup"><span data-stu-id="39daa-143">Implement probes or check functions, and run them regularly from outside the application.</span></span> <span data-ttu-id="39daa-144">このようなチェックは、アプリケーション全体、アプリケーションの個々の部分、アプリケーションで使用する特定のサービス、または個別のコンポーネントについての、応答時間を測定するような簡単なものの場合もあります。</span><span class="sxs-lookup"><span data-stu-id="39daa-144">These checks can be as simple as measuring response time for the application as a whole, for individual parts of the application, for specific services that the application uses, or for separate components.</span></span>

<span data-ttu-id="39daa-145">チェック機能では、プロセスを実行することで、有効な結果が生成されることを確認したり、待機時間の測定や可用性の確認を行ったり、システムから情報を抽出したりできます。</span><span class="sxs-lookup"><span data-stu-id="39daa-145">Check functions can run processes to ensure that they produce valid results, measure latency and check availability, and extract information from the system.</span></span>

## <a name="long-running-workflow-failures"></a><span data-ttu-id="39daa-146">実行時間の長いワークフローの障害</span><span class="sxs-lookup"><span data-stu-id="39daa-146">Long-running workflow failures</span></span>

<span data-ttu-id="39daa-147">実行時間の長いワークフローには、それぞれが独立している必要のある複数のステップが含まれることがよくあります。</span><span class="sxs-lookup"><span data-stu-id="39daa-147">Long-running workflows often include multiple steps, each of which should be independent.</span></span>

<span data-ttu-id="39daa-148">実行時間の長いプロセスの進行を監視して、ワークフロー全体のロールバックが必要になる可能性、または複数の補正トランザクションの実行が必要になる可能性を、最小限に抑えます。</span><span class="sxs-lookup"><span data-stu-id="39daa-148">Track the progress of long-running processes to minimize the likelihood that the entire workflow will need to be rolled back or that multiple compensating transactions will need to be executed.</span></span>

>[!TIP]
> <span data-ttu-id="39daa-149">[Scheduler Agent Supervisor](../patterns/scheduler-agent-supervisor.md) などのパターンを実装して、実行時間の長いワークフローの進行状況を監視し、管理します。</span><span class="sxs-lookup"><span data-stu-id="39daa-149">Monitor and manage the progress of long-running workflows by implementing a pattern such as [Scheduler Agent Supervisor](../patterns/scheduler-agent-supervisor.md).</span></span>

## <a name="application-logs"></a><span data-ttu-id="39daa-150">アプリケーション ログ</span><span class="sxs-lookup"><span data-stu-id="39daa-150">Application logs</span></span>

<span data-ttu-id="39daa-151">アプリケーション ログは、診断データの重要なソースです。</span><span class="sxs-lookup"><span data-stu-id="39daa-151">Application logs are an important source of diagnostics data.</span></span> <span data-ttu-id="39daa-152">最も必要なときに分析情報を取得するには、アプリケーション ログ記録のベスト プラクティスに従います。</span><span class="sxs-lookup"><span data-stu-id="39daa-152">To gain insight when you need it most, follow best practices for application logging.</span></span>

### <a name="log-data-in-the-production-environment"></a><span data-ttu-id="39daa-153">運用環境のデータのログを記録する</span><span class="sxs-lookup"><span data-stu-id="39daa-153">Log data in the production environment</span></span>

<span data-ttu-id="39daa-154">運用状態で問題の原因を診断するのに十分な情報が得られるように、運用環境でアプリケーションを実行しながら、確実な利用統計情報をキャプチャします。</span><span class="sxs-lookup"><span data-stu-id="39daa-154">Capture robust telemetry data while the application is running in the production environment, so you have sufficient information to diagnose the cause of issues in the production state.</span></span>

### <a name="log-events-at-service-boundaries"></a><span data-ttu-id="39daa-155">サービスの境界でイベントのログを記録する</span><span class="sxs-lookup"><span data-stu-id="39daa-155">Log events at service boundaries</span></span>

<span data-ttu-id="39daa-156">フローがサービス境界をまたがる関連付け ID を含めます。</span><span class="sxs-lookup"><span data-stu-id="39daa-156">Include a correlation ID that flows across service boundaries.</span></span> <span data-ttu-id="39daa-157">トランザクション フローが複数のサービスを経由し、そのいずれかが失敗した場合、関連付け ID は、アプリケーション全体で要求を追跡し、トランザクションが失敗した理由を特定するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="39daa-157">If a transaction flows through multiple services and one of them fails, the correlation ID helps you track requests across your application and pinpoints why the transaction failed.</span></span>

### <a name="use-semantic-structured-logging"></a><span data-ttu-id="39daa-158">セマンティックの (構造化された) ログ記録を使用する</span><span class="sxs-lookup"><span data-stu-id="39daa-158">Use semantic (structured) logging</span></span>

<span data-ttu-id="39daa-159">構造化されたログを使用すると、ログ データの使用と分析の自動化が容易になり、クラウド スケールではそれが特に重要です。</span><span class="sxs-lookup"><span data-stu-id="39daa-159">With structured logs, it's easier to automate the consumption and analysis of the log data, which is especially important at cloud scale.</span></span> <span data-ttu-id="39daa-160">一般に、Azure リソースのメトリックと診断データを格納するには、ストレージ アカウントではなく、Log Analytics ワークスペースをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="39daa-160">Generally, we recommend storing Azure resources metrics and diagnostics data in a Log Analytics workspace rather than in a storage account.</span></span> <span data-ttu-id="39daa-161">これにより、Kusto クエリを使って、必要なデータを迅速に構造化された形式で取得できます。</span><span class="sxs-lookup"><span data-stu-id="39daa-161">This way, you can use Kusto queries to obtain the data you want quickly and in a structured format.</span></span> <span data-ttu-id="39daa-162">また、Azure Monitor API と Azure Log Analytics API を使うこともできます。</span><span class="sxs-lookup"><span data-stu-id="39daa-162">You can also use Azure Monitor APIs and Azure Log Analytics APIs.</span></span>

### <a name="use-asynchronous-logging"></a><span data-ttu-id="39daa-163">非同期のログ記録を使用する</span><span class="sxs-lookup"><span data-stu-id="39daa-163">Use asynchronous logging</span></span>

<span data-ttu-id="39daa-164">同期ログ記録操作では、アプリケーションのコードがブロックされることがあり、ログが書き込まれると、バックアップが要求されます。</span><span class="sxs-lookup"><span data-stu-id="39daa-164">Synchronous logging operations sometimes block your application code, causing requests to back up as logs are written.</span></span> <span data-ttu-id="39daa-165">アプリケーションのログ記録の間に可用性を維持するには、非同期のログ記録を使います。</span><span class="sxs-lookup"><span data-stu-id="39daa-165">Use asynchronous logging to preserve availability during application logging.</span></span>

### <a name="separate-application-logging-from-auditing"></a><span data-ttu-id="39daa-166">アプリケーションのログと監査を分ける</span><span class="sxs-lookup"><span data-stu-id="39daa-166">Separate application logging from auditing</span></span>

<span data-ttu-id="39daa-167">一般に、監査レコードはコンプライアンスまたは法的要件のために保持され、完全なものである必要があります。</span><span class="sxs-lookup"><span data-stu-id="39daa-167">Audit records are commonly maintained for compliance or regulatory requirements and must be complete.</span></span> <span data-ttu-id="39daa-168">トランザクションが破棄されるのを避けるには、診断ログとは別に監査ログを維持します。</span><span class="sxs-lookup"><span data-stu-id="39daa-168">To avoid dropped transactions, maintain audit logs separately from diagnostic logs.</span></span>

## <a name="remote-call-statistics"></a><span data-ttu-id="39daa-169">リモート呼び出しの統計情報</span><span class="sxs-lookup"><span data-stu-id="39daa-169">Remote call statistics</span></span>

<span data-ttu-id="39daa-170">リモート呼び出しの統計情報をリアルタイムで追跡してレポートし、この情報を確認する簡単な方法を用意して、運用チームがアプリケーションの正常性を即座に確認できるようにします。</span><span class="sxs-lookup"><span data-stu-id="39daa-170">Track and report remote call statistics in real time and provide an easy way to review this information, so the operations team has an instantaneous view into the health of your application.</span></span> <span data-ttu-id="39daa-171">待機時間、スループット、および 99 および 95 パーセンタイルのエラーなど、リモート呼び出しのメトリックをまとめます。</span><span class="sxs-lookup"><span data-stu-id="39daa-171">Summarize remote call metrics, such as latency, throughput, and errors in the 99 and 95 percentiles.</span></span>

## <a name="transient-exceptions-and-retries"></a><span data-ttu-id="39daa-172">一時的な例外と再試行</span><span class="sxs-lookup"><span data-stu-id="39daa-172">Transient exceptions and retries</span></span>

<span data-ttu-id="39daa-173">時間をかけて一時的な例外と再試行の数を追跡し、アプリケーションの再試行ロジックにおけるエラーや障害を明らかにします。</span><span class="sxs-lookup"><span data-stu-id="39daa-173">Track the number of transient exceptions and retries over time to uncover issues or failures in your application's retry logic.</span></span> <span data-ttu-id="39daa-174">時間とともに例外が増加する傾向は、サービスに問題があり、失敗する可能性があることを示している場合があります。</span><span class="sxs-lookup"><span data-stu-id="39daa-174">A trend of increasing exceptions over time may indicate that the service is having an issue and may fail.</span></span> <span data-ttu-id="39daa-175">詳細については、「 [再試行サービス固有のガイダンス](../best-practices/retry-service-specific.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="39daa-175">For more information, see [Retry service specific guidance](../best-practices/retry-service-specific.md).</span></span>

## <a name="early-warning-system"></a><span data-ttu-id="39daa-176">早期警告システム</span><span class="sxs-lookup"><span data-stu-id="39daa-176">Early warning system</span></span>

<span data-ttu-id="39daa-177">アプリケーションで、積極的な介入が必要な可能性がある警告の兆候を監視します。</span><span class="sxs-lookup"><span data-stu-id="39daa-177">Monitor your application for warning signs that might require proactive intervention.</span></span> <span data-ttu-id="39daa-178">アプリケーションの全体的な正常性とその依存関係を評価するツールは、システムまたはそのコンポーネントが突然使用できなくなったことを迅速に認識するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="39daa-178">Tools that assess the overall health of the application and its dependencies help you to recognize quickly when a system or its components suddenly become unavailable.</span></span> <span data-ttu-id="39daa-179">それらを使って、早期警告システムを実装します。</span><span class="sxs-lookup"><span data-stu-id="39daa-179">Use them to implement an early warning system.</span></span>

1. <span data-ttu-id="39daa-180">一時的な例外やリモート呼び出しの待機時間など、アプリケーションの正常性の主要なパフォーマンス指標を明らかにします。</span><span class="sxs-lookup"><span data-stu-id="39daa-180">Identify the key performance indicators of your application's health, such as transient exceptions and remote call latency.</span></span>
1. <span data-ttu-id="39daa-181">問題が重大になり、復旧対応が必要になる前に、問題が特定されるレベルで、しきい値を設定します。</span><span class="sxs-lookup"><span data-stu-id="39daa-181">Set thresholds at levels that identify issues before they become critical and require a recovery response.</span></span>
1. <span data-ttu-id="39daa-182">しきい値に達したときに、操作にアラートを送信します。</span><span class="sxs-lookup"><span data-stu-id="39daa-182">Send an alert to operations when the threshold value is reached.</span></span>

<span data-ttu-id="39daa-183">[Microsoft System Center 2016](https://www.microsoft.com/cloud-platform/system-center) またはサード パーティ製のツールを使って、監視機能を提供することを検討します。</span><span class="sxs-lookup"><span data-stu-id="39daa-183">Consider [Microsoft System Center 2016](https://www.microsoft.com/cloud-platform/system-center) or third-party tools to provide monitoring capabilities.</span></span> <span data-ttu-id="39daa-184">ほとんどの監視ソリューションは、主要なパフォーマンス カウンターとサービスの可用性を追跡します。</span><span class="sxs-lookup"><span data-stu-id="39daa-184">Most monitoring solutions track key performance counters and service availability.</span></span> <span data-ttu-id="39daa-185">[Azure Resource Health](/azure/service-health/resource-health-checks-resource-types) では組み込みの正常性状態チェックがいくつか提供されており、Azure サービスの調整の診断に役立ちます。</span><span class="sxs-lookup"><span data-stu-id="39daa-185">[Azure resource health](/azure/service-health/resource-health-checks-resource-types) provides some built-in health status checks, which can help diagnose throttling of Azure services.</span></span>

## <a name="subscription-and-service-limitations"></a><span data-ttu-id="39daa-186">サブスクリプションとサービスの制限</span><span class="sxs-lookup"><span data-stu-id="39daa-186">Subscription and service limitations</span></span>

<span data-ttu-id="39daa-187">Azure サブスクリプションには、リソース グループの数、コアの数、ストレージ アカウントの数など、特定のリソースの種類に対する制限があります。</span><span class="sxs-lookup"><span data-stu-id="39daa-187">Azure subscriptions have limits on certain resource types, such as number of resource groups, cores, and storage accounts.</span></span> <span data-ttu-id="39daa-188">アプリケーションが Azure サブスクリプションの制限に達しないようにするには、制限やクォータに近づいているサービスをポーリングするアラートを作成します。</span><span class="sxs-lookup"><span data-stu-id="39daa-188">To ensure that your application doesn't run up against Azure subscription limits, create alerts that poll for services nearing their limits and quotas.</span></span>

<span data-ttu-id="39daa-189">次のサブスクリプション制限にアラートで対処します。</span><span class="sxs-lookup"><span data-stu-id="39daa-189">Address the following subscription limits with alerts.</span></span>

### <a name="individual-services"></a><span data-ttu-id="39daa-190">個別サービス</span><span class="sxs-lookup"><span data-stu-id="39daa-190">Individual services</span></span>

<span data-ttu-id="39daa-191">個々の Azure サービスには、ストレージ、スループット、接続数、秒あたりの要求数、その他のメトリックに関して、消費量に制限があります。</span><span class="sxs-lookup"><span data-stu-id="39daa-191">Individual Azure services have consumption limits on storage, throughput, number of connections, requests per second, and other metrics.</span></span> <span data-ttu-id="39daa-192">これらの制限を超えてリソースを使おうとするとアプリケーションは失敗し、サービスの調整が行われて、ダウンタイムが発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="39daa-192">Your application will fail if it attempts to use resources beyond these limits, resulting in service throttling and possible downtime.</span></span>

<span data-ttu-id="39daa-193">特定のサービスおよびアプリケーションの要件に応じて、多くの場合、スケールアップ (たとえば、別の価格レベルの選択) またはスケールアウト (新しいインスタンスの追加) により、これらの制限を超えないようにすることができます。</span><span class="sxs-lookup"><span data-stu-id="39daa-193">Depending on the specific service and your application requirements, you can often stay under these limits by scaling up (choosing another pricing tier, for example) or scaling out (adding new instances).</span></span>

### <a name="azure-storage-scalability-and-performance-targets"></a><span data-ttu-id="39daa-194">Azure Storage のスケーラビリティおよびパフォーマンスのターゲット</span><span class="sxs-lookup"><span data-stu-id="39daa-194">Azure storage scalability and performance targets</span></span>

<span data-ttu-id="39daa-195">Azure には、サブスクリプションごとに許可されるストレージ アカウントの最大数があります。</span><span class="sxs-lookup"><span data-stu-id="39daa-195">Azure allows a maximum number of storage accounts per subscription.</span></span> <span data-ttu-id="39daa-196">現在のサブスクリプションで使用可能な数より多くのストレージ アカウントがアプリケーションで必要な場合は、新しいサブスクリプションを作成してストレージ アカウントを追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="39daa-196">If your application requires more storage accounts than are currently available in your subscription, create a new subscription with additional storage accounts.</span></span> <span data-ttu-id="39daa-197">詳細については、「[Azure サブスクリプションとサービスの制限、クォータ、制約](/azure/azure-subscription-service-limits/#storage-limits)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="39daa-197">For more information, see [Azure subscription and service limits, quotas, and constraints](/azure/azure-subscription-service-limits/#storage-limits).</span></span>

<span data-ttu-id="39daa-198">Azure Storage のスケーラビリティとパフォーマンスのターゲットを超える場合は、アプリケーションでストレージが調整されます。</span><span class="sxs-lookup"><span data-stu-id="39daa-198">If you exceed Azure storage scalability and performance targets, your application will experience storage throttling.</span></span> <span data-ttu-id="39daa-199">詳細については、「[Azure Storage のスケーラビリティおよびパフォーマンスのターゲット](/azure/storage/storage-scalability-targets/)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="39daa-199">For more information, see [Azure Storage scalability and performance targets](/azure/storage/storage-scalability-targets/).</span></span>

### <a name="scalability-targets-for-virtual-machine-disks"></a><span data-ttu-id="39daa-200">仮想マシンのディスクのスケーラビリティ ターゲット</span><span class="sxs-lookup"><span data-stu-id="39daa-200">Scalability targets for virtual machine disks</span></span>

<span data-ttu-id="39daa-201">Azure のサービスとしてのインフラストラクチャ (IaaS) VM では、VM のサイズやストレージ アカウントの種類など、いくつかの要因に応じた数のデータ ディスクの接続がサポートされています。</span><span class="sxs-lookup"><span data-stu-id="39daa-201">An Azure infrastructure as a service (IaaS) VM supports attaching a number of data disks, depending on several factors, including the VM size and the type of storage account.</span></span> <span data-ttu-id="39daa-202">アプリケーションが仮想マシンのディスクのスケーラビリティのターゲットを超える場合は、追加のストレージ アカウントをプロビジョニングし、そこに仮想マシンのディスクを作成してください。</span><span class="sxs-lookup"><span data-stu-id="39daa-202">If your application exceeds the scalability targets for virtual machine disks, provision additional storage accounts and create the virtual machine disks there.</span></span> <span data-ttu-id="39daa-203">詳細については、「[Azure Storage のスケーラビリティおよびパフォーマンスのターゲット](/azure/storage/storage-scalability-targets/#scalability-targets-for-virtual-machine-disks)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="39daa-203">For more information, see [Azure Storage scalability and performance targets](/azure/storage/storage-scalability-targets/#scalability-targets-for-virtual-machine-disks).</span></span>

### <a name="vm-size"></a><span data-ttu-id="39daa-204">VM サイズ</span><span class="sxs-lookup"><span data-stu-id="39daa-204">VM size</span></span>

<span data-ttu-id="39daa-205">VM の実際の CPU、メモリ、ディスク、I/O が VM サイズの制限に近づいている場合、アプリケーションでキャパシティの問題が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="39daa-205">If the actual CPU, memory, disk, and I/O of your VMs approach the limits of the VM size, your application may experience capacity issues.</span></span> <span data-ttu-id="39daa-206">問題を修正するには、VM のサイズを増やします。</span><span class="sxs-lookup"><span data-stu-id="39daa-206">To correct the issues, increase the VM size.</span></span> <span data-ttu-id="39daa-207">VM のサイズについては、「[Azure の Windows 仮想マシンのサイズ](/azure/virtual-machines/virtual-machines-windows-sizes/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="39daa-207">VM sizes are described in [Sizes for virtual machines in Azure](/azure/virtual-machines/virtual-machines-windows-sizes/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>

<span data-ttu-id="39daa-208">時間と共にワークロードが変動する場合は、仮想マシン スケール セットを使って VM インスタンスの数を自動的にスケーリングすることを検討します。</span><span class="sxs-lookup"><span data-stu-id="39daa-208">If your workload fluctuates over time, consider using virtual machine scale sets to automatically scale the number of VM instances.</span></span> <span data-ttu-id="39daa-209">そうしないと、VM の数を手動で増減することが必要になります。</span><span class="sxs-lookup"><span data-stu-id="39daa-209">Otherwise, you need to manually increase or decrease the number of VMs.</span></span> <span data-ttu-id="39daa-210">詳細については、[仮想マシン スケール セットの概要](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview/)に関する記事を参照してください。</span><span class="sxs-lookup"><span data-stu-id="39daa-210">For more information, see the [virtual machine scale sets overview](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview/).</span></span>

### <a name="azure-sql-database"></a><span data-ttu-id="39daa-211">Azure SQL Database</span><span class="sxs-lookup"><span data-stu-id="39daa-211">Azure SQL Database</span></span>

<span data-ttu-id="39daa-212">アプリケーションのデータベース トランザクション ユニット (DTU) の要件を処理するのに、Azure SQL Database のレベルが適切ではない場合、データの使用が調整されます。</span><span class="sxs-lookup"><span data-stu-id="39daa-212">If your Azure SQL Database tier isn't adequate to handle your application's Database Transaction Unit (DTU) requirements, your data use will be throttled.</span></span> <span data-ttu-id="39daa-213">適切なサービス プランの選択の詳細については、「[Azure SQL Database の購入モデル](/azure/sql-database/sql-database-service-tiers/)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="39daa-213">For more information on selecting the correct service plan, see [Azure SQL Database purchasing models](/azure/sql-database/sql-database-service-tiers/).</span></span>

## <a name="third-party-services"></a><span data-ttu-id="39daa-214">サード パーティーのサービス</span><span class="sxs-lookup"><span data-stu-id="39daa-214">Third-party services</span></span>

<span data-ttu-id="39daa-215">アプリケーションがサード パーティのサービスに依存している場合は、それらのサービスがどのように失敗する可能性があるか、およびアプリケーションに対する障害の影響を明らかにします。</span><span class="sxs-lookup"><span data-stu-id="39daa-215">If your application has dependencies on third-party services, identify how these services can fail and what effect failures will have on your application.</span></span>

<span data-ttu-id="39daa-216">サード パーティのサービスには、監視と診断が含まれない可能性があります。</span><span class="sxs-lookup"><span data-stu-id="39daa-216">A third-party service might not include monitoring and diagnostics.</span></span> <span data-ttu-id="39daa-217">そのようなサービスに対する呼び出しをログに記録し、一意の識別子を使って、それらをアプリケーションの正常性と診断のログに関連付けます。</span><span class="sxs-lookup"><span data-stu-id="39daa-217">Log calls to these services and correlate them with your application's health and diagnostic logging using a unique identifier.</span></span> <span data-ttu-id="39daa-218">監視と診断の実証された方法については、[監査と診断のガイダンス](../best-practices/monitoring.md)に関する記事をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="39daa-218">For more information on proven practices for monitoring and diagnostics, see [Monitoring and diagnostics guidance](../best-practices/monitoring.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="39daa-219">次の手順</span><span class="sxs-lookup"><span data-stu-id="39daa-219">Next steps</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="39daa-220">ディザスター リカバリーを計画する</span><span class="sxs-lookup"><span data-stu-id="39daa-220">Plan for disaster recovery</span></span>](./disaster-recovery.md)
