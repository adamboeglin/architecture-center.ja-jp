---
title: 回復性と可用性に対応するように Azure アプリケーションを設計する
description: Azure アプリケーションに回復性と可用性を組み込みます
author: MikeWasson
ms.date: 04/10/2019
ms.topic: article
ms.service: architecture-center
ms.subservice: cloud-design-principles
ms.openlocfilehash: ee4bb5b4a85e48fe0ff017297c31823c93a48f04
ms.sourcegitcommit: 579c39ff4b776704ead17a006bf24cd4cdc65edd
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/17/2019
ms.locfileid: "59642886"
---
# <a name="architecting-azure-applications-for-resiliency-and-availability"></a><span data-ttu-id="f3424-103">回復性と可用性に対応するように Azure アプリケーションを設計する</span><span class="sxs-lookup"><span data-stu-id="f3424-103">Architecting Azure applications for resiliency and availability</span></span>

<span data-ttu-id="f3424-104">アプリケーションの要件を開発した後の次のステップは、そこに回復性と可用性を組み込むことです。</span><span class="sxs-lookup"><span data-stu-id="f3424-104">After you've developed the requirements for your application, the next step is to build resiliency and availability into it.</span></span> <span data-ttu-id="f3424-105">これらの属性を最後に追加することはできません。アーキテクチャに組み込む必要があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-105">These qualities can't be added at the end &mdash; you must design them into the architecture.</span></span>

## <a name="conduct-a-failure-mode-analysis"></a><span data-ttu-id="f3424-106">障害モード分析を実行する</span><span class="sxs-lookup"><span data-stu-id="f3424-106">Conduct a failure mode analysis</span></span>

<span data-ttu-id="f3424-107">"*障害モード分析*" (FMA) では、可能性のある障害点を特定し、アプリケーションでそれらの障害にどのように対応するかを定義することによって、システムに回復性を持たせます。</span><span class="sxs-lookup"><span data-stu-id="f3424-107">*Failure mode analysis* (FMA) builds resiliency into a system by identifying possible failure points and defining how the application responds to those failures.</span></span> <span data-ttu-id="f3424-108">FMA をアーキテクチャおよび設計のフェーズで行って、最初からシステムに障害復旧が組み込まれるようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-108">The FMA should be part of the architecture and design phases, so failure recovery is built into the system from the beginning.</span></span> <span data-ttu-id="f3424-109">FMA の目標は次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="f3424-109">The goals of an FMA are to:</span></span>

- <span data-ttu-id="f3424-110">アプリケーションで発生する可能性がある障害の種類と、アプリケーションでそれらの障害を検出する方法を決定します。</span><span class="sxs-lookup"><span data-stu-id="f3424-110">Determine what types of failures an application might experience and how the application detects those failures.</span></span>
- <span data-ttu-id="f3424-111">障害の種類ごとに潜在的な影響を把握し、アプリでの対応方法を決定します。</span><span class="sxs-lookup"><span data-stu-id="f3424-111">Capture the potential effects of each type of failure and determine how the app responds.</span></span>
- <span data-ttu-id="f3424-112">障害のログ記録と監視を計画し、復旧の戦略を明らかにします。</span><span class="sxs-lookup"><span data-stu-id="f3424-112">Plan for logging and monitoring the failure and identify recovery strategies.</span></span>

<span data-ttu-id="f3424-113">次に示すのは、外部 Web サービスの呼び出しという特定の障害点に対する障害モードと検出戦略の例です。</span><span class="sxs-lookup"><span data-stu-id="f3424-113">Here are some examples of failure modes and detection strategies for a specific failure point &mdash; a call to an external web service:</span></span>

| <span data-ttu-id="f3424-114">障害モード</span><span class="sxs-lookup"><span data-stu-id="f3424-114">Failure mode</span></span>           | <span data-ttu-id="f3424-115">検出戦略</span><span class="sxs-lookup"><span data-stu-id="f3424-115">Detection strategy</span></span>           |
|------------------------|------------------------------|
| <span data-ttu-id="f3424-116">サービスを使用できない</span><span class="sxs-lookup"><span data-stu-id="f3424-116">Service is unavailable</span></span> | <span data-ttu-id="f3424-117">HTTP 5xx</span><span class="sxs-lookup"><span data-stu-id="f3424-117">HTTP 5xx</span></span>                     |
| <span data-ttu-id="f3424-118">Throttling</span><span class="sxs-lookup"><span data-stu-id="f3424-118">Throttling</span></span>             | <span data-ttu-id="f3424-119">HTTP 429 (要求が多すぎます)</span><span class="sxs-lookup"><span data-stu-id="f3424-119">HTTP 429 (Too Many Requests)</span></span> |
| <span data-ttu-id="f3424-120">Authentication</span><span class="sxs-lookup"><span data-stu-id="f3424-120">Authentication</span></span>         | <span data-ttu-id="f3424-121">HTTP 401 (権限がありません)</span><span class="sxs-lookup"><span data-stu-id="f3424-121">HTTP 401 (Unauthorized)</span></span>      |
| <span data-ttu-id="f3424-122">遅い応答</span><span class="sxs-lookup"><span data-stu-id="f3424-122">Slow response</span></span>          | <span data-ttu-id="f3424-123">要求のタイムアウト</span><span class="sxs-lookup"><span data-stu-id="f3424-123">Request times out</span></span>            |

<span data-ttu-id="f3424-124">FMA プロセスの詳細と、Azure 固有の推奨事項については、[障害モード分析](../resiliency/failure-mode-analysis.md)に関するセクションをご覧ください。</span><span class="sxs-lookup"><span data-stu-id="f3424-124">For more information about the FMA process, with specific recommendations for Azure, see [Failure mode analysis](../resiliency/failure-mode-analysis.md).</span></span>

## <a name="plan-for-redundancy"></a><span data-ttu-id="f3424-125">冗長性を計画する</span><span class="sxs-lookup"><span data-stu-id="f3424-125">Plan for redundancy</span></span>

<span data-ttu-id="f3424-126">障害によって影響の範囲が異なります。</span><span class="sxs-lookup"><span data-stu-id="f3424-126">Failures vary in scope of impact.</span></span> <span data-ttu-id="f3424-127">たとえば、ディスク障害などの一部のハードウェア障害は、1 台のホスト コンピューターに影響を及ぼします。</span><span class="sxs-lookup"><span data-stu-id="f3424-127">Some hardware failures, such as a failed disk, affect a single host machine.</span></span> <span data-ttu-id="f3424-128">ネットワーク スイッチで障害が発生すると、サーバー ラック全体に影響する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-128">A failed network switch could affect an entire server rack.</span></span> <span data-ttu-id="f3424-129">停電などのあまり発生しない障害では、データセンター全体が停止します。</span><span class="sxs-lookup"><span data-stu-id="f3424-129">Less common failures, such as loss of power, disrupt a whole datacenter.</span></span> <span data-ttu-id="f3424-130">リージョン全体が利用できなくなることはほとんどありません。</span><span class="sxs-lookup"><span data-stu-id="f3424-130">Rarely, an entire region becomes unavailable.</span></span>

<span data-ttu-id="f3424-131">冗長性は、回復性があるアプリケーションにする方法の 1 つです。</span><span class="sxs-lookup"><span data-stu-id="f3424-131">Redundancy is one way to make an application resilient.</span></span> <span data-ttu-id="f3424-132">冗長性のレベルは、ビジネス要件によって異なります。すべてのアプリケーションで、リージョン障害に備えるためのリージョン間の冗長性が必要なわけではありません。</span><span class="sxs-lookup"><span data-stu-id="f3424-132">The level of redundancy depends on your business requirements &mdash; not every application needs redundancy across regions to guard against a regional outage.</span></span> <span data-ttu-id="f3424-133">一般に、冗長性と信頼性を高めると、コストと複雑さが増すというトレードオフがあります。</span><span class="sxs-lookup"><span data-stu-id="f3424-133">In general, there's a tradeoff between greater redundancy and reliability versus higher costs and complexity.</span></span>

### <a name="review-azure-redundancy-features"></a><span data-ttu-id="f3424-134">Azure の冗長性機能を確認する</span><span class="sxs-lookup"><span data-stu-id="f3424-134">Review Azure redundancy features</span></span>

<span data-ttu-id="f3424-135">Azure には、個別の仮想マシン (VM) からリージョン全体まで、すべての障害レベルに複数の冗長性機能があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-135">Azure has a number of redundancy features at every level of failure, from an individual virtual machine (VM) to an entire region.</span></span>

- <span data-ttu-id="f3424-136">**1 つの VM** には、Azure によって[稼働時間のサービス レベル アグリーメント (SLA)](https://azure.microsoft.com/support/legal/sla/virtual-machines) が提供されています。</span><span class="sxs-lookup"><span data-stu-id="f3424-136">**Single VMs** have an [uptime service level agreement (SLA)](https://azure.microsoft.com/support/legal/sla/virtual-machines) provided by Azure.</span></span> <span data-ttu-id="f3424-137">(VM では、すべてのオペレーティング システム ディスクとデータ ディスクに対して Premium Storage を使用する必要があります。)2 つ以上の VM を実行すると高い SLA を得られますが、ワークロードによっては単一の VM で十分な信頼性が得られる場合もあります。</span><span class="sxs-lookup"><span data-stu-id="f3424-137">(The VM must use premium storage for all operating system disks and data disks.) Although you can get a higher SLA by running two or more VMs, a single VM may be reliable enough for some workloads.</span></span> <span data-ttu-id="f3424-138">ただし、運用環境のワークロードの場合は、2 台以上の VM を使用して冗長性を確保することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="f3424-138">For production workloads, however, we recommend using two or more VMs for redundancy.</span></span>
- <span data-ttu-id="f3424-139">**可用性セット**では、ディスクやネットワーク スイッチの障害など、局所的なハードウェア障害に対して保護されます。</span><span class="sxs-lookup"><span data-stu-id="f3424-139">**Availability sets** protect against localized hardware failures, such as a disk or network switch failing.</span></span> <span data-ttu-id="f3424-140">可用性セット内の VM は、最大で 3 つの "*障害ドメイン*" 間に分散されます。</span><span class="sxs-lookup"><span data-stu-id="f3424-140">VMs in an availability set are distributed across up to three *fault domains*.</span></span> <span data-ttu-id="f3424-141">障害ドメインでは、共通の電源とネットワーク スイッチを共有する VM のグループが定義されています。</span><span class="sxs-lookup"><span data-stu-id="f3424-141">A fault domains defines a group of VMs that share a common power source and network switch.</span></span> <span data-ttu-id="f3424-142">ハードウェア障害の影響を受ける障害ドメインが 1 つの場合、ネットワーク トラフィックは他の障害ドメイン内の VM にルーティングされます。</span><span class="sxs-lookup"><span data-stu-id="f3424-142">If a hardware failure affects one fault domain, network traffic is routed to VMs in the other fault domains.</span></span> <span data-ttu-id="f3424-143">可用性セットの詳細については、「[Azure での Windows 仮想マシンの可用性の管理](/azure/virtual-machines/windows/manage-availability)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f3424-143">For more information about availability sets, see [Manage the availability of Windows virtual machines in Azure](/azure/virtual-machines/windows/manage-availability).</span></span>
- <span data-ttu-id="f3424-144">**Availability Zones** は、Azure リージョン内の物理的に分離されたゾーンです。</span><span class="sxs-lookup"><span data-stu-id="f3424-144">**Availability Zones** are physically separate zones within an Azure region.</span></span> <span data-ttu-id="f3424-145">可用性ゾーンはそれぞれ異なる電源、ネットワーク、および冷却装置を持ちます。</span><span class="sxs-lookup"><span data-stu-id="f3424-145">Each Availability Zone has a distinct power source, network, and cooling.</span></span> <span data-ttu-id="f3424-146">Availability Zones に VM をデプロイすると、データセンター全体の障害からアプリケーションを保護するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="f3424-146">Deploying VMs across Availability Zones helps to protect an application against datacenter-wide failures.</span></span> <span data-ttu-id="f3424-147">Availability Zones は、すべてのリージョンでサポートされているわけではありません。</span><span class="sxs-lookup"><span data-stu-id="f3424-147">Not all regions support Availability Zones.</span></span> <span data-ttu-id="f3424-148">サポートされているリージョンとサービスの一覧については、「[Azure の可用性ゾーンの概要](/azure/availability-zones/az-overview)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f3424-148">For a list of supported regions and services, see [What are Availability Zones in Azure?](/azure/availability-zones/az-overview).</span></span>

    <span data-ttu-id="f3424-149">デプロイで Availability Zones を使用する予定がある場合は、アプリケーションのアーキテクチャとコード ベースでこの構成がサポートされていることを最初に確認してください。</span><span class="sxs-lookup"><span data-stu-id="f3424-149">If you plan to use Availability Zones in your deployment, first validate that your application architecture and codebase support this configuration.</span></span> <span data-ttu-id="f3424-150">市販のソフトウェアをデプロイする場合は、ソフトウェア ベンダーに問い合わせて、運用環境にデプロイする前に十分にテストしてください。</span><span class="sxs-lookup"><span data-stu-id="f3424-150">If you deploy commercial software, consult with the software vendor and test adequately before deploying into production.</span></span> <span data-ttu-id="f3424-151">アプリケーションでは、構成されたゾーン内での停止の間に、状態を維持し、データの消失を防ぐ必要があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-151">An application must maintain state and prevent loss of data during an outage within the configured zone.</span></span> <span data-ttu-id="f3424-152">アプリケーションでは、インフラストラクチャのコンポーネントをハード コーディングせずに、エラスティックな分散されたインフラストラクチャでの実行をサポートする必要があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-152">The application must support running in an elastic and distributed infrastructure with no hard-coded infrastructure components.</span></span>
- <span data-ttu-id="f3424-153">**Azure Site Recovery** では、ビジネス継続性 (BC) とディザスター リカバリー (DR) のニーズに応じて、Azure Virtual Machines が別の Azure リージョンにレプリケートされます。</span><span class="sxs-lookup"><span data-stu-id="f3424-153">**Azure Site Recovery** replicates Azure Virtual Machines to another Azure region for business continuity (BC) and disaster recovery (DR) needs.</span></span> <span data-ttu-id="f3424-154">ディザスター リカバリーの訓練を定期的に行って、コンプライアンス ニーズが満たされていることを確認できます。</span><span class="sxs-lookup"><span data-stu-id="f3424-154">You can conduct periodic DR drills to ensure that you meet the compliance needs.</span></span> <span data-ttu-id="f3424-155">ソース リージョンで停止が発生した場合にアプリケーションを復旧できるように、VM は指定した設定で選択したリージョンにレプリケートされます。</span><span class="sxs-lookup"><span data-stu-id="f3424-155">The VM is replicated with the specified settings to the selected region so you can recover your applications in the event of outages in the source region.</span></span> <span data-ttu-id="f3424-156">詳細については、「[Azure VM のセカンダリ Azure リージョンへのディザスター リカバリーの設定](/azure/site-recovery/azure-to-azure-quickstart/)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f3424-156">For more information, see [Set up disaster recovery to a secondary Azure region for an Azure VM](/azure/site-recovery/azure-to-azure-quickstart/).</span></span>

    <span data-ttu-id="f3424-157">テストの間に、"*目標復旧時間*" (RTO) と "*目標復旧時点*" (RPO) が要件を満たすことを確認します。</span><span class="sxs-lookup"><span data-stu-id="f3424-157">During testing, verify that the *recovery time objective* (RTO) and *recovery point objective* (RPO) meet your needs.</span></span> <span data-ttu-id="f3424-158">RTO はインシデント発生後にアプリケーションが使用不可能になる最大時間であり、RPO は障害の間にデータが失われる最大期間です。</span><span class="sxs-lookup"><span data-stu-id="f3424-158">RTO is the maximum time an application is unavailable after an incident, and RPO is the maximum duration of data loss during a disaster.</span></span>
- <span data-ttu-id="f3424-159">**ペアのリージョン**は、異なるリージョンにインターネット トラフィックを分散することによって、リージョン停止からアプリケーションを保護するため、Azure Traffic Manager を使って作成します。</span><span class="sxs-lookup"><span data-stu-id="f3424-159">**Paired regions** are created using Azure Traffic Manager to distribute Internet traffic to different regions, protecting an application against a regional outage.</span></span> <span data-ttu-id="f3424-160">各 Azure リージョンは別のリージョンとペアになります。</span><span class="sxs-lookup"><span data-stu-id="f3424-160">Each Azure region is paired with another region.</span></span> <span data-ttu-id="f3424-161">これらのリージョンにより、[*リージョン ペア*](/azure/best-practices-availability-paired-regions)が形成されます。</span><span class="sxs-lookup"><span data-stu-id="f3424-161">Together, these regions form a [*regional pair*](/azure/best-practices-availability-paired-regions).</span></span> <span data-ttu-id="f3424-162">税および法の執行を目的としたデータ常駐要件を満たすため、リージョン ペアは同じ地理的場所に配置されます (ブラジル南部を除きます)。</span><span class="sxs-lookup"><span data-stu-id="f3424-162">To meet data residency requirements for tax and law enforcement jurisdiction purposes, regional pairs are located within the same geography (with the exception of Brazil South).</span></span>

    <span data-ttu-id="f3424-163">アプリケーションの回復性を高めるため、Azure ではプラットフォームの更新 (計画メンテナンス) は各リージョンのペアで順番に実行されるようになっており、一度に 1 つのペアになったリージョンだけが更新されます。</span><span class="sxs-lookup"><span data-stu-id="f3424-163">To improve application resiliency, Azure serializes platform updates (planned maintenance) across each region pair, so only one paired region is updated at a time.</span></span>
- <span data-ttu-id="f3424-164">複数リージョンのアプリケーションを設計するときは、リージョン間のネットワーク待機時間は、リージョン内の待機時間より長くなることを考慮してください。</span><span class="sxs-lookup"><span data-stu-id="f3424-164">When you design a multiregion application, take into account that network latency across regions is higher than within a region.</span></span> <span data-ttu-id="f3424-165">たとえば、フェールオーバーを有効にするためにデータベースをレプリケートする場合は、リージョン間の非同期データ レプリケーションではなく、リージョン内の同期データ レプリケーションを使います。</span><span class="sxs-lookup"><span data-stu-id="f3424-165">For example, if you replicate a database to enable failover, use synchronous data replication within a region but asynchronous data replication across regions.</span></span>

<span data-ttu-id="f3424-166">次の表は、さまざまな回復性戦略の間で冗長性要因を比較したものです。</span><span class="sxs-lookup"><span data-stu-id="f3424-166">The following table compares the redundancy factors across several resiliency strategies:</span></span>

| &nbsp; | <span data-ttu-id="f3424-167">可用性セット</span><span class="sxs-lookup"><span data-stu-id="f3424-167">Availability set</span></span> | <span data-ttu-id="f3424-168">可用性ゾーン</span><span class="sxs-lookup"><span data-stu-id="f3424-168">Availability Zone</span></span> | <span data-ttu-id="f3424-169">Azure Site Recovery/ペアのリージョン</span><span class="sxs-lookup"><span data-stu-id="f3424-169">Azure Site Recovery/Paired region</span></span> |
|--------|------------------|-------------------|-----------------------------------|
| <span data-ttu-id="f3424-170">障害の範囲</span><span class="sxs-lookup"><span data-stu-id="f3424-170">Scope of failure</span></span> | <span data-ttu-id="f3424-171">ラック</span><span class="sxs-lookup"><span data-stu-id="f3424-171">Rack</span></span>                  | <span data-ttu-id="f3424-172">データセンター</span><span class="sxs-lookup"><span data-stu-id="f3424-172">Datacenter</span></span>               | <span data-ttu-id="f3424-173">リージョン</span><span class="sxs-lookup"><span data-stu-id="f3424-173">Region</span></span>                               |
| <span data-ttu-id="f3424-174">要求のルーティング</span><span class="sxs-lookup"><span data-stu-id="f3424-174">Request routing</span></span>  | <span data-ttu-id="f3424-175">Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="f3424-175">Azure Load Balancer</span></span>   | <span data-ttu-id="f3424-176">クロスゾーン ロード バランサー</span><span class="sxs-lookup"><span data-stu-id="f3424-176">Cross-zone Load Balancer</span></span> | <span data-ttu-id="f3424-177">Azure の Traffic Manager</span><span class="sxs-lookup"><span data-stu-id="f3424-177">Azure Traffic Manager</span></span>                |
| <span data-ttu-id="f3424-178">ネットワーク待ち時間</span><span class="sxs-lookup"><span data-stu-id="f3424-178">Network latency</span></span>  | <span data-ttu-id="f3424-179">非常に低い</span><span class="sxs-lookup"><span data-stu-id="f3424-179">Very low</span></span>              | <span data-ttu-id="f3424-180">低</span><span class="sxs-lookup"><span data-stu-id="f3424-180">Low</span></span>                      | <span data-ttu-id="f3424-181">中～高</span><span class="sxs-lookup"><span data-stu-id="f3424-181">Mid to high</span></span>                          |
| <span data-ttu-id="f3424-182">仮想ネットワーク</span><span class="sxs-lookup"><span data-stu-id="f3424-182">Virtual network</span></span>  | <span data-ttu-id="f3424-183">Azure Virtual Network</span><span class="sxs-lookup"><span data-stu-id="f3424-183">Azure Virtual Network</span></span> | <span data-ttu-id="f3424-184">Azure Virtual Network</span><span class="sxs-lookup"><span data-stu-id="f3424-184">Azure Virtual Network</span></span>          | <span data-ttu-id="f3424-185">リージョン間の Virtual Network ピアリング</span><span class="sxs-lookup"><span data-stu-id="f3424-185">Cross-region Virtual Network peering</span></span> |

### <a name="complete-azure-redundancy-tasks"></a><span data-ttu-id="f3424-186">Azure の冗長性のタスクを完了する</span><span class="sxs-lookup"><span data-stu-id="f3424-186">Complete Azure redundancy tasks</span></span>

<span data-ttu-id="f3424-187">冗長性の要件を満たすには以下のタスクを使用します。</span><span class="sxs-lookup"><span data-stu-id="f3424-187">Use the following tasks to meet redundancy requirements:</span></span>

- <span data-ttu-id="f3424-188">**複数のインスタンスのサービスをデプロイします。**</span><span class="sxs-lookup"><span data-stu-id="f3424-188">**Deploy multiple instances of services.**</span></span> <span data-ttu-id="f3424-189">アプリケーションがサービスの 1 つのインスタンスに依存する場合は、単一障害点が発生します。</span><span class="sxs-lookup"><span data-stu-id="f3424-189">If your application depends on a single instance of a service, it creates a single point of failure.</span></span> <span data-ttu-id="f3424-190">複数のインスタンスをプロビジョニングすると、回復性とスケーラビリティの両方が改善されます。</span><span class="sxs-lookup"><span data-stu-id="f3424-190">Provisioning multiple instances improves both resiliency and scalability.</span></span> <span data-ttu-id="f3424-191">[Azure App Service](/azure/app-service/app-service-value-prop-what-is/) の場合は、複数のインスタンスを提供する [App Service プラン](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/)を選択してください。</span><span class="sxs-lookup"><span data-stu-id="f3424-191">For [Azure App Service](/azure/app-service/app-service-value-prop-what-is/), select an [App Service plan](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/) that offers multiple instances.</span></span> <span data-ttu-id="f3424-192">[Azure Virtual Machines](/azure/virtual-machines/virtual-machines-windows-about/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) の場合は、アーキテクチャに 1 つ以上の VM が含まれていることと、[可用性セット](/azure/virtual-machines/virtual-machines-windows-manage-availability/)に各 VM が含まれていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="f3424-192">For [Azure Virtual Machines](/azure/virtual-machines/virtual-machines-windows-about/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json), ensure that your architecture has more than one VM and that each VM is included in an [availability set](/azure/virtual-machines/virtual-machines-windows-manage-availability/).</span></span>

- <span data-ttu-id="f3424-193">**Azure Site Recovery を使用して VM をレプリケートします。**</span><span class="sxs-lookup"><span data-stu-id="f3424-193">**Replicate VMs using Azure Site Recovery.**</span></span> <span data-ttu-id="f3424-194">[Site Recovery](/azure/site-recovery/) を使用して Azure VM をレプリケートすると、すべての VM ディスクが、ターゲット リージョンに継続的かつ非同期的にレプリケートされます。</span><span class="sxs-lookup"><span data-stu-id="f3424-194">When you replicate Azure VMs using [Site Recovery](/azure/site-recovery/), all the VM disks are continuously replicated to the target region asynchronously.</span></span> <span data-ttu-id="f3424-195">復旧ポイントが数分ごとに作成されて、分単位の RPO が提供されます。</span><span class="sxs-lookup"><span data-stu-id="f3424-195">The recovery points are created every few minutes, giving an RPO on the order of minutes.</span></span>

- <span data-ttu-id="f3424-196">**アプリケーションを複数のリージョンにデプロイすることを検討します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-196">**Consider deploying your application across multiple regions.**</span></span> <span data-ttu-id="f3424-197">アプリケーションが 1 つのリージョンにデプロイされている場合、リージョンが使用できなくなると、アプリケーションも使用できなくなります。</span><span class="sxs-lookup"><span data-stu-id="f3424-197">If your application is deployed to a single region, and the region becomes unavailable, your application will also be unavailable.</span></span> <span data-ttu-id="f3424-198">これは、アプリケーションの SLA の条件の下では許容できないことがあります。</span><span class="sxs-lookup"><span data-stu-id="f3424-198">This may be unacceptable under the terms of your application's SLA.</span></span> <span data-ttu-id="f3424-199">その場合は、アプリケーションとそのサービスを複数のリージョンにデプロイすることを検討してください。</span><span class="sxs-lookup"><span data-stu-id="f3424-199">If so, consider deploying your application and its services across multiple regions.</span></span> <span data-ttu-id="f3424-200">マルチリージョンのデプロイでは、"*アクティブ/アクティブ*" または "*アクティブ/パッシブ*" の構成を使うことができます。</span><span class="sxs-lookup"><span data-stu-id="f3424-200">A multiregion deployment can use an *active-active* or *active-passive* configuration.</span></span> <span data-ttu-id="f3424-201">アクティブ/アクティブ構成では、要求は複数のアクティブなリージョンに分散されます。</span><span class="sxs-lookup"><span data-stu-id="f3424-201">An active-active configuration distributes requests across multiple active regions.</span></span> <span data-ttu-id="f3424-202">アクティブ/パッシブ構成では、セカンダリ リージョンにウォーム インスタンスが保持されていますが、プライマリ リージョンで障害が発生しない限り、そこにトラフィックが送信されることはありません。</span><span class="sxs-lookup"><span data-stu-id="f3424-202">An active-passive configuration keeps warm instances in the secondary region, but doesn't send traffic there unless the primary region fails.</span></span> <span data-ttu-id="f3424-203">マルチリージョンのデプロイでは、上で説明したペアのリージョンにデプロイすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="f3424-203">For multiregion deployments, we recommend deploying to paired regions, described above.</span></span> <span data-ttu-id="f3424-204">詳しくは、「[ビジネス継続性とディザスター リカバリー (BCDR):Azure のペアになっているリージョン](/azure/best-practices-availability-paired-regions)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="f3424-204">For more information, see [Business continuity and disaster recovery (BCDR): Azure Paired Regions](/azure/best-practices-availability-paired-regions).</span></span>

- <span data-ttu-id="f3424-205">**Azure Traffic Manager を使用して、アプリケーションのトラフィックをさまざまなリージョンにルーティングします。**</span><span class="sxs-lookup"><span data-stu-id="f3424-205">**Use Azure Traffic Manager to route your application's traffic to different regions.**</span></span> <span data-ttu-id="f3424-206">[Azure Traffic Manager](/azure/traffic-manager/traffic-manager-overview/) では、DNS レベルで負荷分散が実行され、[トラフィック ルーティング](/azure/traffic-manager/traffic-manager-routing-methods/)の方法とアプリケーションのエンドポイントの正常性に基づいて、トラフィックが異なるリージョンにルーティングされます。</span><span class="sxs-lookup"><span data-stu-id="f3424-206">[Azure Traffic Manager](/azure/traffic-manager/traffic-manager-overview/) performs load-balancing at the DNS level and routes traffic to different regions based on the [traffic routing](/azure/traffic-manager/traffic-manager-routing-methods/) method and the health of your application's endpoints.</span></span> <span data-ttu-id="f3424-207">Traffic Manager を使用しないと、デプロイできるのは 1 つのリージョンに制限されるので、スケールが制約され、一部のユーザーの待機時間が増加し、リージョン全体のサービスが停止した場合に、アプリケーションのダウンタイムが発生します。</span><span class="sxs-lookup"><span data-stu-id="f3424-207">Without Traffic Manager, you are limited to a single region for your deployment, which constrains scale, increases latency for some users, and causes application downtime, in the case of a region-wide service disruption.</span></span>

- <span data-ttu-id="f3424-208">**複数のインスタンスを使用するように Azure Application Gateway を構成します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-208">**Configure Azure Application Gateway to use multiple instances.**</span></span> <span data-ttu-id="f3424-209">アプリケーションの要件によっては、アプリケーションのサービスに対する要求の分散には、[Azure Application Gateway](/azure/application-gateway/application-gateway-introduction/) のほうが適している場合があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-209">Depending on your application's requirements, an [Azure Application Gateway](/azure/application-gateway/application-gateway-introduction/) may be better suited to distributing requests to your application's services.</span></span> <span data-ttu-id="f3424-210">ただし、Application Gateway サービスの単一インスタンスは SLA によって保証されないため、Application Gateway のインスタンスが失敗した場合はアプリケーションが失敗する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-210">However, single instances of the Application Gateway service are not guaranteed by an SLA, so it's possible that your application could fail if the Application Gateway instance fails.</span></span> <span data-ttu-id="f3424-211">[Application Gateway SLA](https://azure.microsoft.com/support/legal/sla/application-gateway/) の条件に基づいてサービスの可用性を保証するには、複数の中規模以上のインスタンスをプロビジョニングしてください。</span><span class="sxs-lookup"><span data-stu-id="f3424-211">Provision more than one medium or larger instance to guarantee availability of the service under the terms of the [Application Gateway SLA](https://azure.microsoft.com/support/legal/sla/application-gateway/).</span></span>

## <a name="design-for-scalability"></a><span data-ttu-id="f3424-212">スケーラビリティのための設計</span><span class="sxs-lookup"><span data-stu-id="f3424-212">Design for scalability</span></span>

<span data-ttu-id="f3424-213">"*スケーラビリティ*" とは、増加した負荷を処理するシステムの能力であり、[ソフトウェア品質の重要な要素](../guide/pillars.md)の 1 つです。</span><span class="sxs-lookup"><span data-stu-id="f3424-213">*Scalability* is the ability of a system to handle increased load and is one of the [pillars of software quality](../guide/pillars.md).</span></span> <span data-ttu-id="f3424-214">設計フェーズ中には次のようなスケーラビリティ タスクがあります。</span><span class="sxs-lookup"><span data-stu-id="f3424-214">Scalability tasks during the architecting phase include:</span></span>

- <span data-ttu-id="f3424-215">**ワークロードをパーティション分割します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-215">**Partition workloads.**</span></span> <span data-ttu-id="f3424-216">プロセスのパーツを別個に分解できるように設計します。</span><span class="sxs-lookup"><span data-stu-id="f3424-216">Design parts of the process to be discrete and decomposable.</span></span> <span data-ttu-id="f3424-217">各パーツのサイズを最小限に抑えます。</span><span class="sxs-lookup"><span data-stu-id="f3424-217">Minimize the size of each part.</span></span> <span data-ttu-id="f3424-218">これにより、各コンピューティング ユニットを最大限に使用できるようにコンポーネントのパーツを分散できます。</span><span class="sxs-lookup"><span data-stu-id="f3424-218">This allows the component parts to be distributed in a way that maximizes use of each compute unit.</span></span> <span data-ttu-id="f3424-219">また、特定のリソースのインスタンスを追加することで、アプリケーションのスケーリングが容易になります。</span><span class="sxs-lookup"><span data-stu-id="f3424-219">It also makes it easier to scale the application by adding instances of specific resources.</span></span> <span data-ttu-id="f3424-220">複雑なドメインの場合、[マイクロサービス アーキテクチャ](../guide/architecture-styles/microservices.md)の採用を検討してください。</span><span class="sxs-lookup"><span data-stu-id="f3424-220">For complex domains, consider adopting a [microservices architecture](../guide/architecture-styles/microservices.md).</span></span>
- <span data-ttu-id="f3424-221">**スケーリングを考慮して設計します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-221">**Design for scaling.**</span></span> <span data-ttu-id="f3424-222">スケーリングにより、アプリケーションは、ロール、キュー、および他のサービスのインスタンスの数を増減することで、変動負荷に対応できます。</span><span class="sxs-lookup"><span data-stu-id="f3424-222">Scaling allows applications to react to variable load by increasing and decreasing the number of instances of roles, queues, and other services.</span></span> <span data-ttu-id="f3424-223">ただし、アプリケーションを設計する際には、次の点を考慮に入れる必要があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-223">However, the application must be designed with this in mind.</span></span> <span data-ttu-id="f3424-224">たとえば、アプリケーションとそれが使用するサービスをステートレスにして、要求をどのインスタンスにもルーティングできるようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-224">For example, the application and the services it uses must be stateless to allow requests to be routed to any instance.</span></span> <span data-ttu-id="f3424-225">また、サービスをステートレスにすると、インスタンスを追加または削除しても現在のユーザーに悪影響がありません。</span><span class="sxs-lookup"><span data-stu-id="f3424-225">Having stateless services also means that adding or removing an instance does not adversely impact current users.</span></span>
- <span data-ttu-id="f3424-226">**スケール ユニットで成長を計画します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-226">**Plan for growth with scale units.**</span></span> <span data-ttu-id="f3424-227">リソースごとに、スケーリングの上限を確認し、シャーディングまたは分解を使用して、これらの限度を超える必要があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-227">For each resource, know the upper scaling limits, and use sharding or decomposition to go beyond those limits.</span></span> <span data-ttu-id="f3424-228">1 つ以上のスケール ユニットを追加することでスケーリングが容易になるように、アプリケーションを設計してください。</span><span class="sxs-lookup"><span data-stu-id="f3424-228">Design the application so that it's easily scaled by adding one or more scale units.</span></span> <span data-ttu-id="f3424-229">明確に定義されたリソースのセットを単位として、システムのスケール ユニットを判別します。</span><span class="sxs-lookup"><span data-stu-id="f3424-229">Determine the scale units for the system in terms of well-defined sets of resources.</span></span> <span data-ttu-id="f3424-230">これにより、スケールアウト操作の適用が容易になるだけでなく、システム全体の一部分でのリソース不足による悪影響を避けることができます。</span><span class="sxs-lookup"><span data-stu-id="f3424-230">This makes applying scale-out operations easier and less prone to negative impact caused by a lack of resources in some part of the overall system.</span></span> <span data-ttu-id="f3424-231">たとえば、*X* 個のフロントエンド VM を追加すると、追加のワークロードを処理するために、*Y* 個の追加キューおよび *Z* 個のストレージ アカウントが必要になる場合があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-231">For example, adding *X* number of front-end VMs might require *Y* number of additional queues and *Z* number of storage accounts to handle the additional workload.</span></span> <span data-ttu-id="f3424-232">したがって、*X* 個の VM インスタンス、*Y* 個のキュー、*Z* 個のストレージ アカウントで、スケール ユニットを構成できます。</span><span class="sxs-lookup"><span data-stu-id="f3424-232">So a scale unit could consist of *X* VM instances, *Y* queues, and *Z* storage accounts.</span></span>
- <span data-ttu-id="f3424-233">**クライアント アフィニティを回避します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-233">**Avoid client affinity.**</span></span> <span data-ttu-id="f3424-234">可能であれば、アプリケーションでアフィニティが必要にならないようにします。</span><span class="sxs-lookup"><span data-stu-id="f3424-234">Where possible, ensure that the application doesn't require affinity.</span></span> <span data-ttu-id="f3424-235">そうすれば、どのインスタンスにも要求をルーティングでき、インスタンスの数に影響されずに済みます。</span><span class="sxs-lookup"><span data-stu-id="f3424-235">Requests can then be routed to any instance, and the number of instances is irrelevant.</span></span> <span data-ttu-id="f3424-236">これにより、各ユーザーの状態情報を格納、取得、保守するためのオーバーヘッドが生じることもなくなります。</span><span class="sxs-lookup"><span data-stu-id="f3424-236">This also avoids the overhead of storing, retrieving, and maintaining state information for each user.</span></span>
- <span data-ttu-id="f3424-237">**プラットフォームの自動スケーリング機能を利用します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-237">**Take advantage of platform autoscaling features.**</span></span> <span data-ttu-id="f3424-238">可能であれば、カスタムまたはサードパーティのメカニズムではなく、組み込みの自動スケーリング機能を使います。</span><span class="sxs-lookup"><span data-stu-id="f3424-238">Use built-in autoscaling features when possible, rather than custom or third-party mechanisms.</span></span> <span data-ttu-id="f3424-239">可能な限り、スケジュールされたスケーリング ルールを使用し、起動時の遅延なしでリソースを使用可能にします。ただし、必要に応じてリアクティブな自動スケーリングをルールに追加し、予期しない要求の変化に対応します。</span><span class="sxs-lookup"><span data-stu-id="f3424-239">Use scheduled scaling rules, where possible, to ensure that resources are available without a startup delay, but add reactive autoscaling to the rules, where appropriate, to cope with unexpected changes in demand.</span></span> <span data-ttu-id="f3424-240">詳しくは、「[自動スケール](../best-practices/auto-scaling.md)」のガイダンスをご覧ください。</span><span class="sxs-lookup"><span data-stu-id="f3424-240">For more information, see [Autoscaling guidance](../best-practices/auto-scaling.md).</span></span>  

  <span data-ttu-id="f3424-241">負荷が増したときに自動的にスケールアウトするようにアプリケーションが構成されていない場合は、ユーザーの要求で飽和状態になるとアプリケーションのサービスが失敗する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-241">If your application isn't configured to scale out automatically as load increases, it's possible that your application's services will fail if they become saturated with user requests.</span></span> <span data-ttu-id="f3424-242">詳細については、次の記事を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f3424-242">For more information, see the following articles:</span></span>

  - <span data-ttu-id="f3424-243">全般:[スケーラビリティのチェックリスト](../checklist/scalability.md)</span><span class="sxs-lookup"><span data-stu-id="f3424-243">General: [Scalability checklist](../checklist/scalability.md)</span></span>
  - <span data-ttu-id="f3424-244">Azure App Service:[手動または自動によるインスタンス数のスケール変更](/azure/monitoring-and-diagnostics/insights-how-to-scale/)</span><span class="sxs-lookup"><span data-stu-id="f3424-244">Azure App Service: [Scale instance count manually or automatically](/azure/monitoring-and-diagnostics/insights-how-to-scale/)</span></span>
  - <span data-ttu-id="f3424-245">クラウド サービス:[クラウド サービスを自動スケーリングする方法](/azure/cloud-services/cloud-services-how-to-scale/)</span><span class="sxs-lookup"><span data-stu-id="f3424-245">Cloud Services: [How to autoscale a Cloud Service](/azure/cloud-services/cloud-services-how-to-scale/)</span></span>
  - <span data-ttu-id="f3424-246">仮想マシン:[自動スケールと仮想マシン スケール セット](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-autoscale-overview/)</span><span class="sxs-lookup"><span data-stu-id="f3424-246">Virtual machines: [Automatic scaling and virtual machine scale sets](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-autoscale-overview/)</span></span>

- <span data-ttu-id="f3424-247">**負荷の高い CPU/IO タスクをバックグラウンド タスクとしてオフロードします。**</span><span class="sxs-lookup"><span data-stu-id="f3424-247">**Offload intensive CPU/IO tasks as background tasks.**</span></span> <span data-ttu-id="f3424-248">サービスへの要求の実行に長時間かかったり、かなりのリソースを消費したりすることが予想される場合は、処理を別のタスクにオフロードします。</span><span class="sxs-lookup"><span data-stu-id="f3424-248">If a request to a service is expected to take a long time to run or may absorb considerable resources, offload the processing to a separate task.</span></span> <span data-ttu-id="f3424-249">バックグラウンド ジョブを使って、これらのタスクを実行します。</span><span class="sxs-lookup"><span data-stu-id="f3424-249">Use background jobs to execute these tasks.</span></span> <span data-ttu-id="f3424-250">この戦略を使用すると、サービスはさらに多くの要求を引き続き受信したり、即座に対応したりすることが可能になります。</span><span class="sxs-lookup"><span data-stu-id="f3424-250">This strategy enables the service to continue receiving further requests and to remain responsive.</span></span> <span data-ttu-id="f3424-251">詳細については、「 [Background jobs guidance (バックグラウンド ジョブのガイダンス)](../best-practices/background-jobs.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f3424-251">For more information, see [Background jobs guidance](../best-practices/background-jobs.md).</span></span>
- <span data-ttu-id="f3424-252">**バックグラウンド タスクのワークロードを分散します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-252">**Distribute the workload for background tasks.**</span></span> <span data-ttu-id="f3424-253">多くのバックグラウンド タスクがある場合、またはタスクの実行に相当の時間かリソースが必要な場合、複数のコンピューティング ユニットに作業を分散します。</span><span class="sxs-lookup"><span data-stu-id="f3424-253">If there are many background tasks or if the tasks require considerable time or resources, spread the work across multiple compute units.</span></span> <span data-ttu-id="f3424-254">考えられる解決策の 1 つについては、[競合コンシューマー パターン](../patterns/competing-consumers.md)に関するページを参照してください。</span><span class="sxs-lookup"><span data-stu-id="f3424-254">For one possible solution, see the [Competing Consumers pattern](../patterns/competing-consumers.md).</span></span>
- <span data-ttu-id="f3424-255">**"*シェアード ナッシング*" アーキテクチャの使用を検討します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-255">**Consider moving toward a *shared-nothing* architecture.**</span></span> <span data-ttu-id="f3424-256">このアーキテクチャでは、単一競合点 (共有サービスや共有ストレージなど) を持たない、独立した自己充足的なノードが使われます。</span><span class="sxs-lookup"><span data-stu-id="f3424-256">This architecture uses independent, self-sufficient nodes that have no single point of contention (such as shared services or storage).</span></span> <span data-ttu-id="f3424-257">理論上、そのようなシステムはほぼ無制限にスケールできます。</span><span class="sxs-lookup"><span data-stu-id="f3424-257">In theory, such a system can scale almost indefinitely.</span></span> <span data-ttu-id="f3424-258">通常、完全なシェアード ナッシング アプローチは実用的ではありませんが、スケーラビリティの向上を考慮した設計には適している場合があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-258">Although a fully shared-nothing approach is usually not practical, it may provide opportunities to design for better scalability.</span></span> <span data-ttu-id="f3424-259">データをパーティション分割し、サーバー側のセッション状態やクライアント アフィニティを避けるのは、シェアード ナッシング アーキテクチャを目指す場合のよい例です。</span><span class="sxs-lookup"><span data-stu-id="f3424-259">Good examples of moving toward a shared-nothing architecture include partitioning data and avoiding the use of server-side session state and client affinity.</span></span>
- <span data-ttu-id="f3424-260">**アプリケーションのストレージ要件を、Azure Storage のスケーラビリティとパフォーマンスのターゲットの範囲に入るように設計します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-260">**Design your application's storage requirements to fall within Azure Storage scalability and performance targets.**</span></span> <span data-ttu-id="f3424-261">Azure Storage は、事前定義済みのスケーラビリティとパフォーマンスのターゲットの中で機能するように設計されているため、それらのターゲットの中でストレージを使うようにアプリケーションを設計します。</span><span class="sxs-lookup"><span data-stu-id="f3424-261">Azure Storage is designed to function within predefined scalability and performance targets, so design your application to use storage within those targets.</span></span> <span data-ttu-id="f3424-262">これらのターゲットを上回ると、アプリケーションでストレージが調整されます。</span><span class="sxs-lookup"><span data-stu-id="f3424-262">If you exceed these targets, your application will experience storage throttling.</span></span> <span data-ttu-id="f3424-263">調整されないようにするには、追加のストレージ アカウントをプロビジョニングします。</span><span class="sxs-lookup"><span data-stu-id="f3424-263">To avoid throttling, provision additional storage accounts.</span></span> <span data-ttu-id="f3424-264">ストレージ アカウントの制限に達する場合は、追加の Azure サブスクリプションをプロビジョニングしてから、そこに追加のストレージ アカウントをプロビジョニングします。</span><span class="sxs-lookup"><span data-stu-id="f3424-264">If you run up against the storage account limit, provision additional Azure subscriptions and then provision additional storage accounts there.</span></span> <span data-ttu-id="f3424-265">詳細については、「[Azure Storage のスケーラビリティおよびパフォーマンスのターゲット](/azure/storage/storage-scalability-targets/)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f3424-265">For more information, see [Azure Storage scalability and performance targets](/azure/storage/storage-scalability-targets/).</span></span>
- <span data-ttu-id="f3424-266">**アプリケーションに適した VM サイズを選択します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-266">**Select the right VM size for your application.**</span></span> <span data-ttu-id="f3424-267">運用環境の VM の実際の CPU、メモリ、ディスク、および I/O を測定し、選択した VM のサイズが十分であることを確認します。</span><span class="sxs-lookup"><span data-stu-id="f3424-267">Measure the actual CPU, memory, disk, and I/O of your VMs in production, and verify that the VM size you've selected is sufficient.</span></span> <span data-ttu-id="f3424-268">そうでない場合は、VM がその制限に近くなると、アプリケーションで容量の問題が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-268">If not, your application may experience capacity issues as the VMs approach their limits.</span></span> <span data-ttu-id="f3424-269">VM のサイズについては、「[Azure の仮想マシンのサイズ](/azure/virtual-machines/virtual-machines-windows-sizes/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="f3424-269">VM sizes are described in detail in [Sizes for virtual machines in Azure](/azure/virtual-machines/virtual-machines-windows-sizes/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>

## <a name="determine-subscription-and-service-requirements"></a><span data-ttu-id="f3424-270">サブスクリプションとサービスの要件を決定する</span><span class="sxs-lookup"><span data-stu-id="f3424-270">Determine subscription and service requirements</span></span>

<span data-ttu-id="f3424-271">以下のタスクを行って、アプリに適したサブスクリプションとサービスの機能を選択します。</span><span class="sxs-lookup"><span data-stu-id="f3424-271">Choose the right subscription and service features for your app by working through these tasks:</span></span>

- <span data-ttu-id="f3424-272">**[Azure のサブスクリプションとサービスの制限](/azure/azure-subscription-service-limits/)に対して要件を評価します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-272">**Evaluate requirements against [Azure subscription and service limits](/azure/azure-subscription-service-limits/).**</span></span> <span data-ttu-id="f3424-273">"*Azure サブスクリプション*" には、リソース グループの数、コアの数、ストレージ アカウントの数など、特定のリソースの種類に対する制限があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-273">*Azure subscriptions* have limits on certain resource types, such as number of resource groups, cores, and storage accounts.</span></span> <span data-ttu-id="f3424-274">アプリケーションの要件が Azure サブスクリプションの制限を超えた場合は、別の Azure サブスクリプションを作成し、そこに十分なリソースをプロビジョニングしてください。</span><span class="sxs-lookup"><span data-stu-id="f3424-274">If your application requirements exceed Azure subscription limits, create another Azure subscription and provision sufficient resources there.</span></span> <span data-ttu-id="f3424-275">個々 の Azure サービスには消費量に制限があります。たとえば、ストレージ、スループット、接続数、秒あたりの要求、およびその他のメトリックに関する制限です。</span><span class="sxs-lookup"><span data-stu-id="f3424-275">Individual Azure services have consumption limits &mdash; for example, limits on storage, throughput, number of connections, requests per second, and other metrics.</span></span> <span data-ttu-id="f3424-276">これらの制限を超えてリソースを使おうとするとアプリケーションは失敗し、サービスの調整が行われて、影響を受けたユーザーにダウンタイムが発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-276">Your application will fail if it attempts to use resources beyond these limits, resulting in service throttling and possible downtime for affected users.</span></span> <span data-ttu-id="f3424-277">特定のサービスとアプリケーションの要件に応じて、スケールアップ (たとえば、別の価格層の選択) するか、スケールアウト (新しいインスタンスの追加など) することで、多くの場合はこれらの制限を回避できます。</span><span class="sxs-lookup"><span data-stu-id="f3424-277">Depending on the specific service and your application requirements, you can often avoid these limits by scaling up (for example, choosing another pricing tier) or scaling out (such as adding new instances).</span></span>
- <span data-ttu-id="f3424-278">**必要なストレージ アカウントの数を決定します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-278">**Determine how many storage accounts you need.**</span></span> <span data-ttu-id="f3424-279">Azure では、サブスクリプションあたり特定の数のストレージ アカウントが許可されます。</span><span class="sxs-lookup"><span data-stu-id="f3424-279">Azure allows a specific number of storage accounts per subscription.</span></span> <span data-ttu-id="f3424-280">詳細については、「[Azure サブスクリプションとサービスの制限、クォータ、制約](/azure/azure-subscription-service-limits/#storage-limits)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="f3424-280">For more information, see [Azure subscription and service limits, quotas, and constraints](/azure/azure-subscription-service-limits/#storage-limits).</span></span>
- <span data-ttu-id="f3424-281">**Azure SQL Database に適したサービス層を選択します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-281">**Select the right service tier for Azure SQL Database.**</span></span> <span data-ttu-id="f3424-282">アプリケーションで Azure SQL Database を使う場合は、適切なサービス レベルを選択します。</span><span class="sxs-lookup"><span data-stu-id="f3424-282">If your application uses Azure SQL Database, select the appropriate service tier.</span></span> <span data-ttu-id="f3424-283">アプリケーションのデータベース トランザクション ユニット (DTU) の要件を処理できないレベルでは、データの使用が調整されます。</span><span class="sxs-lookup"><span data-stu-id="f3424-283">If the tier cannot handle your application's database transaction unit (DTU) requirements, your data use will be throttled.</span></span> <span data-ttu-id="f3424-284">適切なサービス プランの選択の詳細については、「[SQL Database のオプションとパフォーマンス:各サービス階層で使用できる内容について理解します](/azure/sql-database/sql-database-service-tiers/)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="f3424-284">For more information on selecting the correct service plan, see [SQL Database options and performance: Understand what's available in each service tier](/azure/sql-database/sql-database-service-tiers/).</span></span>
- <span data-ttu-id="f3424-285">**Azure Cosmos DB で十分な要求ユニット (RU) をプロビジョニングします**。</span><span class="sxs-lookup"><span data-stu-id="f3424-285">**Provision sufficient request units (RUs) in Azure Cosmos DB**.</span></span> <span data-ttu-id="f3424-286">Azure Cosmos DB では、プロビジョニングするスループットおよび消費するストレージに対して時間単位で支払います。</span><span class="sxs-lookup"><span data-stu-id="f3424-286">With Azure Cosmos DB, you pay for the throughput you provision and the storage you consume on an hourly basis.</span></span> <span data-ttu-id="f3424-287">すべてのデータベース操作のコストは RU として正規化され、CPU、IOPS、メモリなどのシステム リソースが抽象化されます。</span><span class="sxs-lookup"><span data-stu-id="f3424-287">The cost of all database operations is normalized as RUs, which abstracts the system resources such as CPU, IOPS, and memory.</span></span> <span data-ttu-id="f3424-288">詳細については、「[Azure Cosmos DB の要求ユニット](/azure/cosmos-db/request-units)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="f3424-288">For more information, see [Request Units in Azure Cosmos DB](/azure/cosmos-db/request-units).</span></span>

## <a name="load-balance-as-needed"></a><span data-ttu-id="f3424-289">必要に応じて負荷分散する</span><span class="sxs-lookup"><span data-stu-id="f3424-289">Load-balance as needed</span></span>

<span data-ttu-id="f3424-290">適切に負荷分散すると、可用性の要件を満たし、可用性に関連するコストを最小限にできます。</span><span class="sxs-lookup"><span data-stu-id="f3424-290">Proper load-balancing allows you to meet availability requirements and to minimize costs associated with availability.</span></span>

- <span data-ttu-id="f3424-291">**負荷分散を使用して要求を分散します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-291">**Use load-balancing to distribute requests.**</span></span> <span data-ttu-id="f3424-292">負荷分散は、正常でないインスタンスをローテーションから除去することで、アプリケーションの要求を正常なサービス インスタンスに分散します。</span><span class="sxs-lookup"><span data-stu-id="f3424-292">Load-balancing distributes your application's requests to healthy service instances by removing unhealthy instances from rotation.</span></span> <span data-ttu-id="f3424-293">サービスで Azure App Service または Azure Cloud Services が使われている場合は、既に負荷が分散されています。</span><span class="sxs-lookup"><span data-stu-id="f3424-293">If your service uses Azure App Service or Azure Cloud Services, it's already load-balanced for you.</span></span> <span data-ttu-id="f3424-294">ただし、アプリケーションが Azure VM を使用している場合は、ロード バランサーをプロビジョニングする必要があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-294">However, if your application uses Azure VMs, you need to provision a load-balancer.</span></span> <span data-ttu-id="f3424-295">詳細については、「[Azure Load Balancer の概要](/azure/load-balancer/load-balancer-overview/)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f3424-295">For more information, see [What is Azure Load Balancer?](/azure/load-balancer/load-balancer-overview/)</span></span>

  <span data-ttu-id="f3424-296">Azure Load Balancer を使って次のことができます。</span><span class="sxs-lookup"><span data-stu-id="f3424-296">You can use Azure Load Balancer to:</span></span>

  - <span data-ttu-id="f3424-297">受信インターネット トラフィックを VM に負荷分散します。</span><span class="sxs-lookup"><span data-stu-id="f3424-297">Load-balance incoming Internet traffic to your VMs.</span></span> <span data-ttu-id="f3424-298">この構成は、[*パブリック ロード バランサー*](/azure/load-balancer/load-balancer-overview#publicloadbalancer)と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="f3424-298">This configuration is known as a [*public Load Balancer*](/azure/load-balancer/load-balancer-overview#publicloadbalancer).</span></span>
  - <span data-ttu-id="f3424-299">仮想ネットワーク内の VM 間にトラフィックを負荷分散します。</span><span class="sxs-lookup"><span data-stu-id="f3424-299">Load-balance traffic across VMs inside a virtual network.</span></span> <span data-ttu-id="f3424-300">ハイブリッド シナリオでは、オンプレミスのネットワークから Load Balancer フロントエンドに到達することもできます。</span><span class="sxs-lookup"><span data-stu-id="f3424-300">You can also reach a Load Balancer front end from an on-premises network in a hybrid scenario.</span></span> <span data-ttu-id="f3424-301">どちらのシナリオでも、[*内部ロード バランサー*](/azure/load-balancer/load-balancer-overview#internalloadbalancer)と呼ばれる構成が使われます。</span><span class="sxs-lookup"><span data-stu-id="f3424-301">Both scenarios use a configuration that is known as an [*internal Load Balancer*](/azure/load-balancer/load-balancer-overview#internalloadbalancer).</span></span>
  - <span data-ttu-id="f3424-302">受信ネットワーク アドレス変換 (NAT) 規則を使って、特定の VM 上の列挙されたポートに、トラフィックをポート転送します。</span><span class="sxs-lookup"><span data-stu-id="f3424-302">Port forward traffic to an itemized port on specific VMs with inbound network address translation (NAT) rules.</span></span>
  - <span data-ttu-id="f3424-303">パブリック ロード バランサー を使って、仮想ネットワーク内の VM に[送信接続](/azure/load-balancer/load-balancer-outbound-connections)を提供します。</span><span class="sxs-lookup"><span data-stu-id="f3424-303">Provide [outbound connectivity](/azure/load-balancer/load-balancer-outbound-connections) for VMs inside your virtual network by using a public Load Balancer.</span></span>

- <span data-ttu-id="f3424-304">**Azure Traffic Manager などのトラフィック マネージャーで、リージョン間に負荷を分散します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-304">**Balance loads across regions with a traffic manager, such as Azure Traffic Manager.**</span></span> <span data-ttu-id="f3424-305">リージョン間でトラフィックの負荷分散を行うためには、トラフィック管理ソリューションが必要であり、Azure では [Traffic Manager](https://azure.microsoft.com/services/traffic-manager/) が提供されています。</span><span class="sxs-lookup"><span data-stu-id="f3424-305">To load-balance traffic across regions requires a traffic management solution, and Azure provides [Traffic Manager](https://azure.microsoft.com/services/traffic-manager/).</span></span> <span data-ttu-id="f3424-306">また、同様のトラフィック管理機能が提供されているサードパーティのサービスを利用することもできます。</span><span class="sxs-lookup"><span data-stu-id="f3424-306">You can also take advantage of third-party services that provide similar traffic-management capabilities.</span></span>

## <a name="implement-resiliency-strategies"></a><span data-ttu-id="f3424-307">回復性戦略を実装する</span><span class="sxs-lookup"><span data-stu-id="f3424-307">Implement resiliency strategies</span></span>

<span data-ttu-id="f3424-308">このセクションでは、いくつかの一般的な回復性戦略について説明します。</span><span class="sxs-lookup"><span data-stu-id="f3424-308">This section describes some common resiliency strategies.</span></span> <span data-ttu-id="f3424-309">これらの戦略のほとんどは、特定のテクノロジに限定されていません。</span><span class="sxs-lookup"><span data-stu-id="f3424-309">Most of these strategies are not limited to a particular technology.</span></span> <span data-ttu-id="f3424-310">説明では、各手法の背後にある一般的な考えがまとめられており、詳細なドキュメントへのリンクが含まれます。</span><span class="sxs-lookup"><span data-stu-id="f3424-310">The descriptions summarize the general idea behind each technique and include links to further reading.</span></span>

- <span data-ttu-id="f3424-311">必要に応じて、リモート操作に対する**回復性パターンを実装します**。</span><span class="sxs-lookup"><span data-stu-id="f3424-311">**Implement resiliency patterns** for remote operations, where appropriate.</span></span> <span data-ttu-id="f3424-312">アプリケーションがリモート サービス間の通信に依存する場合は、一時的な障害に対処するための[設計パターン](../patterns/category/resiliency.md)に従います。</span><span class="sxs-lookup"><span data-stu-id="f3424-312">If your application depends on communication between remote services, follow [design patterns](../patterns/category/resiliency.md) for dealing with transient failures.</span></span>

- <span data-ttu-id="f3424-313">**一時的な障害を再試行します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-313">**Retry transient failures.**</span></span> <span data-ttu-id="f3424-314">これらは、ネットワーク接続の一時的な喪失、データベース接続の欠落、またはサービスがビジー状態のときのタイムアウトが原因で発生します。</span><span class="sxs-lookup"><span data-stu-id="f3424-314">These can be caused by momentary loss of network connectivity, a dropped database connection, or a timeout when a service is busy.</span></span> <span data-ttu-id="f3424-315">多くの場合、一時的な障害は、要求を再試行することで解決できます。</span><span class="sxs-lookup"><span data-stu-id="f3424-315">Often, a transient failure can be resolved by retrying the request.</span></span>

  - <span data-ttu-id="f3424-316">多くの Azure サービスでは、クライアント ソフトウェア開発キット (SDK) において、呼び出し元には認識されない方法で自動再試行が実装されています。</span><span class="sxs-lookup"><span data-stu-id="f3424-316">For many Azure services, the client software development kit (SDK) implements automatic retries in a way that is transparent to the caller.</span></span> <span data-ttu-id="f3424-317">「[Retry guidance for specific services](../best-practices/retry-service-specific.md)」(特定のサービスの再試行ガイダンス) をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="f3424-317">See [Retry guidance for specific services](../best-practices/retry-service-specific.md).</span></span>
  - <span data-ttu-id="f3424-318">または、[再試行パターン](../patterns/retry.md)を実装して、サービスまたはネットワーク リソースへの接続を試みるときに予想される一時エラーをアプリケーションで透過的に処理するのに役立てます。</span><span class="sxs-lookup"><span data-stu-id="f3424-318">Or implement the [Retry pattern](../patterns/retry.md) to help the application handle anticipated, temporary failures transparently when it tries to connect to a service or network resource.</span></span>

- <span data-ttu-id="f3424-319">**サーキット ブレーカーを使って**、解決に要する時間が一定ではない場合がある障害を処理します。</span><span class="sxs-lookup"><span data-stu-id="f3424-319">**Use a circuit breaker** to handle faults that might take a variable amount of time to fix.</span></span> <span data-ttu-id="f3424-320">[サーキット ブレーカー](../patterns/circuit-breaker.md) パターンを使用すると、失敗する可能性のある操作がアプリケーションで繰り返し再試行されるのを回避できます。</span><span class="sxs-lookup"><span data-stu-id="f3424-320">The [Circuit Breaker pattern](../patterns/circuit-breaker.md) can prevent an application from repeatedly trying an operation that is likely to fail.</span></span> <span data-ttu-id="f3424-321">サーキット ブレーカーはサービスの呼び出しをラップし、最近発生したエラーの数を追跡します。</span><span class="sxs-lookup"><span data-stu-id="f3424-321">The circuit breaker wraps calls to a service and tracks the number of recent failures.</span></span> <span data-ttu-id="f3424-322">エラーの数がしきい値を超えると、サーキット ブレーカーはサービスを呼び出さずに、エラー コードを返し始めます。</span><span class="sxs-lookup"><span data-stu-id="f3424-322">If the failure count exceeds a threshold, the circuit breaker starts returning an error code without calling the service.</span></span> <span data-ttu-id="f3424-323">これにより、復旧のための時間がサービスに提供され、障害の連鎖を回避するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="f3424-323">This gives the service time to recover and helps avoid cascading failures.</span></span>
- <span data-ttu-id="f3424-324">**重要なリソースを分離します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-324">**Isolate critical resources.**</span></span> <span data-ttu-id="f3424-325">1 つのサブシステムで複数の障害が連鎖した結果、アプリケーションの他の部分で障害が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-325">Failures in one subsystem can sometimes cascade, resulting in failures in other parts of the application.</span></span> <span data-ttu-id="f3424-326">このようなことが起きる可能性があるのは、障害によってスレッドやソケットなどのリソースが解放されず、リソースが枯渇する場合です。</span><span class="sxs-lookup"><span data-stu-id="f3424-326">This can happen if a failure prevents resources such as threads or sockets from being freed, leading to resource exhaustion.</span></span> <span data-ttu-id="f3424-327">これを回避すため、システムを複数の分離したグループにパーティション分割し、1 つのパーティションでの障害によりシステム全体がダウンしないようにできます。</span><span class="sxs-lookup"><span data-stu-id="f3424-327">To avoid this, you can partition a system into isolated groups so that a failure in one partition does not bring down the entire system.</span></span>

    <span data-ttu-id="f3424-328">この手法の例をいくつか示します。これは、[バルクヘッド パターン](../patterns/bulkhead.md)と呼ばれることがあります。</span><span class="sxs-lookup"><span data-stu-id="f3424-328">Here are some examples of this technique, which is sometimes called the [Bulkhead pattern](../patterns/bulkhead.md):</span></span>

  - <span data-ttu-id="f3424-329">データベースをパーティション分割し (テナント別など)、各パーティションに Web サーバー インスタンスの個別のプールを割り当てます。</span><span class="sxs-lookup"><span data-stu-id="f3424-329">Partition a database (for example, by tenant), and assign a separate pool of web server instances for each partition.</span></span>
  - <span data-ttu-id="f3424-330">個別のスレッド プールを使用して、異なるサービスの呼び出しを分離します。</span><span class="sxs-lookup"><span data-stu-id="f3424-330">Use separate thread pools to isolate calls to different services.</span></span> <span data-ttu-id="f3424-331">こうすることで、いずれかのサービスで障害が発生した場合の障害の連鎖を回避できます。</span><span class="sxs-lookup"><span data-stu-id="f3424-331">This helps to prevent cascading failures if one of the services fails.</span></span> <span data-ttu-id="f3424-332">例については、Netflix の [Hystrix ライブラリ](https://medium.com/netflix-techblog/introducing-hystrix-for-resiliency-engineering-13531c1ab362)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f3424-332">For an example, see the Netflix [Hystrix library](https://medium.com/netflix-techblog/introducing-hystrix-for-resiliency-engineering-13531c1ab362).</span></span>
  - <span data-ttu-id="f3424-333">[コンテナー](https://en.wikipedia.org/wiki/Operating-system-level_virtualization)を使って、特定のサブシステムに使用できるリソースを制限します。</span><span class="sxs-lookup"><span data-stu-id="f3424-333">Use [containers](https://en.wikipedia.org/wiki/Operating-system-level_virtualization) to limit the resources available to a particular subsystem.</span></span>

      ![バルクヘッド パターンの図](_images/bulkhead.png)

- <span data-ttu-id="f3424-335">**[*補正トランザクション*](../patterns/compensating-transaction.md)を適用します**。</span><span class="sxs-lookup"><span data-stu-id="f3424-335">**Apply [*compensating transactions*](../patterns/compensating-transaction.md)**.</span></span> <span data-ttu-id="f3424-336">補正トランザクションは、別の完了したトランザクションの影響を元に戻すトランザクションです。</span><span class="sxs-lookup"><span data-stu-id="f3424-336">A compensating transaction is a transaction that undoes the effects of another completed transaction.</span></span> <span data-ttu-id="f3424-337">分散システムでは、厳密なトランザクションの一貫性を実現することが困難な場合があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-337">In a distributed system, it can be difficult to achieve strong transactional consistency.</span></span> <span data-ttu-id="f3424-338">補正トランザクションは、各手順で元に戻すことができる一連の小規模な個別トランザクションを使用することで、一貫性を実現するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="f3424-338">Compensating transactions help to achieve consistency by using a series of smaller, individual transactions that can be undone at each step.</span></span> <span data-ttu-id="f3424-339">たとえば、旅行を予約する場合、ユーザーは車、ホテルの客室、航空便を予約する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-339">For example, to book a trip, a customer might reserve a car, a hotel room, and a flight.</span></span> <span data-ttu-id="f3424-340">これらのステップの 1 つが失敗した場合、操作全体が失敗します。</span><span class="sxs-lookup"><span data-stu-id="f3424-340">If one of these steps fails, the entire operation fails.</span></span> <span data-ttu-id="f3424-341">操作全体に単一の分散トランザクションを使用するのではなく、各手順に補正トランザクションを定義することができます。</span><span class="sxs-lookup"><span data-stu-id="f3424-341">Instead of trying to use a single distributed transaction for the entire operation, you can define a compensating transaction for each step.</span></span>
- <span data-ttu-id="f3424-342">**可能な限り、非同期操作を実装します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-342">**Implement asynchronous operations, whenever possible.**</span></span> <span data-ttu-id="f3424-343">同期操作は、呼び出し元がプロセスの完了を待機している間はリソースを独占でき、その他の操作をブロックすることができます。</span><span class="sxs-lookup"><span data-stu-id="f3424-343">Synchronous operations can monopolize resources and block other operations while the caller waits for the process to complete.</span></span> <span data-ttu-id="f3424-344">可能な場合は常に、アプリケーションの各部分を、非同期操作が可能なように設計します。</span><span class="sxs-lookup"><span data-stu-id="f3424-344">Design each part of your application to allow for asynchronous operations, whenever possible.</span></span> <span data-ttu-id="f3424-345">C\# での非同期プログラミングの実装方法の詳細については、「[非同期プログラミング](/dotnet/articles/csharp/async)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="f3424-345">For more information on how to implement asynchronous programming in C\#, see [Asynchronous Programming](/dotnet/articles/csharp/async).</span></span>

## <a name="ensure-that-availability-meets-slas"></a><span data-ttu-id="f3424-346">可用性が SLA を満たしていることを確認する</span><span class="sxs-lookup"><span data-stu-id="f3424-346">Ensure that availability meets SLAs</span></span>

<span data-ttu-id="f3424-347">"*可用性*" とは、システムが機能し、動作している時間の割合であり、[ソフトウェア品質の重要な要素](../guide/pillars.md)の 1 つです。</span><span class="sxs-lookup"><span data-stu-id="f3424-347">*Availability* is the proportion of time that a system is functional and working, and it is one of the [pillars of software quality](../guide/pillars.md).</span></span> <span data-ttu-id="f3424-348">このセクションのタスクを使って、ご自分のアプリケーション アーキテクチャを可用性の観点から見直し、可用性が SLA を満たしていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="f3424-348">Use the tasks in this section to review your application architecture from an availability standpoint to make sure that your availability meets your SLAs.</span></span>

- <span data-ttu-id="f3424-349">**すべての単一障害点を回避します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-349">**Avoid any single point of failure.**</span></span> <span data-ttu-id="f3424-350"> 単一障害点が可用性に影響することを防ぐため、すべてのコンポーネント、サービス、リソース、およびコンピューティング インスタンスを複数のインスタンスとして展開する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-350">All components, services, resources, and compute instances should be deployed as multiple instances to prevent a single point of failure from affecting availability.</span></span> <span data-ttu-id="f3424-351">認証メカニズムも単一障害点になる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-351">Authentication mechanisms can also be a single point of failure.</span></span> <span data-ttu-id="f3424-352">複数のインスタンスを使用するよう構成ができるように、そして自動的に障害を検出して要求を障害のないインスタンスにリダイレクトするように (プラットフォームで自動的に行われない場合)、アプリケーションを設計します。</span><span class="sxs-lookup"><span data-stu-id="f3424-352">Design the application to be configurable to use multiple instances and to automatically detect failures and redirect requests to non-failed instances, if the platform doesn't do this automatically.</span></span>
- <span data-ttu-id="f3424-353">**サービス レベル目標に基づいてワークロードを分解します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-353">**Decompose workloads by service-level objective.**</span></span> <span data-ttu-id="f3424-354"> サービスが重要なワークロードとあまり重要ではないワークロードで構成されている場合は、それらを異なる方法で管理し、それぞれの可用性の要件を満たすようにサービスの機能とインスタンスの数を指定します。</span><span class="sxs-lookup"><span data-stu-id="f3424-354">If a service is composed of critical and less-critical workloads, manage them differently and specify the service features and number of instances to meet their availability requirements.</span></span>
- <span data-ttu-id="f3424-355">**サービスの依存関係を最少化し、把握します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-355">**Minimize and understand service dependencies.**</span></span> <span data-ttu-id="f3424-356">可能な限り、使用される異なるサービスの数を最小限に抑えます。</span><span class="sxs-lookup"><span data-stu-id="f3424-356">Minimize the number of different services used, where possible.</span></span> <span data-ttu-id="f3424-357">システムに存在するすべての機能とサービスの依存関係を理解していることを確認します。</span><span class="sxs-lookup"><span data-stu-id="f3424-357">Ensure that you understand all the feature and service dependencies that exist in the system.</span></span> <span data-ttu-id="f3424-358">特に、各依存関係での障害またはパフォーマンス低下の全体的な影響を理解します。</span><span class="sxs-lookup"><span data-stu-id="f3424-358">In particular, understand the overall impact of failure or reduced performance in each dependency.</span></span>
- <span data-ttu-id="f3424-359">**可能な限り、タスクとメッセージが "*べき等*" になるように設計します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-359">**Design tasks and messages to be *idempotent*, where possible.**</span></span> <span data-ttu-id="f3424-360">操作を複数回繰り返し、同じ結果を生成できる場合、その操作はべき等です。</span><span class="sxs-lookup"><span data-stu-id="f3424-360">An operation is idempotent if it can be repeated multiple times and produce the same result.</span></span> <span data-ttu-id="f3424-361">これにより、重複した要求による問題の発生を防ぐことができます。</span><span class="sxs-lookup"><span data-stu-id="f3424-361">This can ensure that duplicated requests don't cause problems.</span></span> <span data-ttu-id="f3424-362">前に実行された操作を繰り返すことで結果が無効にならないように、メッセージ コンシューマーとコンシューマーが実行する操作がべき等である必要があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-362">Message consumers and the operations they carry out should be idempotent so that repeating a previously executed operation does not render the results invalid.</span></span> <span data-ttu-id="f3424-363">これは、重複したメッセージの検出、または競合処理のためのオプティミスティックな方法を使用した一貫性の確認を意味する場合があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-363">This may mean detecting duplicated messages or ensuring consistency by using an optimistic approach to handling conflicts.</span></span>
- <span data-ttu-id="f3424-364">**要求タイムアウトを構成します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-364">**Configure request timeouts.**</span></span> <span data-ttu-id="f3424-365">サービスとリソースが使用不可能になり、要求が失敗する原因となる場合があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-365">Services and resources may become unavailable, causing requests to fail.</span></span> <span data-ttu-id="f3424-366">適用するタイムアウトが、各サービスまたはリソースと、それらにアクセスしているクライアントに対して、適切であることを確認します。</span><span class="sxs-lookup"><span data-stu-id="f3424-366">Ensure that the timeouts you apply are appropriate for each service or resource and for the client that is accessing them.</span></span> <span data-ttu-id="f3424-367">コンテキストやクライアントが実行しているアクションによっては、クライアントの特定のインスタンスのタイムアウトを長くすることができる場合もあります。</span><span class="sxs-lookup"><span data-stu-id="f3424-367">In some cases, you might allow a longer timeout for a particular instance of a client, depending on the context and other actions that the client is performing.</span></span> <span data-ttu-id="f3424-368">タイムアウトが短いと、待機時間が非常に長いサービスとリソースで過剰な再試行操作が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-368">Short timeouts may cause excessive retry operations for services and resources that have considerable latency.</span></span> <span data-ttu-id="f3424-369">また、タイムアウトが長いと、大量の要求がキューにあり、サービスまたはリソースの応答を待機している場合にブロックが発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-369">Long timeouts can cause blocking, if a large number of requests are queued, waiting for a service or resource to respond.</span></span>
- <span data-ttu-id="f3424-370">**重要なトランザクションの高可用性を実装する、メッセージ ブローカーを使用します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-370">**Use a message broker that implements high availability for critical transactions.**</span></span> <span data-ttu-id="f3424-371">多くのクラウド アプリケーションでは、非同期タスクをトリガーするためにメッセージングが使われます。</span><span class="sxs-lookup"><span data-stu-id="f3424-371">Many cloud applications use messaging to trigger asynchronous tasks.</span></span> <span data-ttu-id="f3424-372">メッセージの配信を保証するために、このメッセージング システムは高可用性を実現する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-372">To guarantee delivery of messages, the messaging system should provide high availability.</span></span> <span data-ttu-id="f3424-373">[Azure Service Bus メッセージング](/azure/service-bus-messaging)では、"*1 回以上*" というセマンティクスが実装されています。これは、メッセージが少なくとも 1 回は配信されることが保証されることを意味します。</span><span class="sxs-lookup"><span data-stu-id="f3424-373">[Azure Service Bus messaging](/azure/service-bus-messaging) implements *at least once* semantics, which means that a message is guaranteed to be delivered at least once.</span></span> <span data-ttu-id="f3424-374">特定の状況では、重複するメッセージが配信される可能性があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-374">Duplicate messages may be delivered under certain circumstances.</span></span> <span data-ttu-id="f3424-375">メッセージの処理がべき等である場合 (前の項目を参照)、繰り返しの配信は問題にはなりません。</span><span class="sxs-lookup"><span data-stu-id="f3424-375">If message processing is idempotent (see the previous item), repeated delivery should not be a problem.</span></span>
- <span data-ttu-id="f3424-376">**高負荷のユーザーを調整します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-376">**Throttle high-volume users.**</span></span> <span data-ttu-id="f3424-377">少数のユーザーによって過剰な負荷が発生することがあります。</span><span class="sxs-lookup"><span data-stu-id="f3424-377">Sometimes, a small number of users creates excessive load.</span></span> <span data-ttu-id="f3424-378">これにより、他のユーザーが影響を受け、アプリケーションの全体的な可用性が低下する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-378">This can have an impact on other users and can reduce the overall availability of your application.</span></span> <span data-ttu-id="f3424-379">単一のクライアントが大量の要求を行った場合、一定期間、アプリケーションはクライアントを調整することができます。</span><span class="sxs-lookup"><span data-stu-id="f3424-379">When a single client makes an excessive number of requests, the application might throttle the client for a certain period.</span></span> <span data-ttu-id="f3424-380">この調整期間、アプリケーションはそのクライアントからの要求の一部またはすべてを拒否します。</span><span class="sxs-lookup"><span data-stu-id="f3424-380">During the throttling period, the application refuses some or all of the requests from that client.</span></span> <span data-ttu-id="f3424-381">調整のしきい値は、多くの場合、お客様のサービス レベルに依存します。</span><span class="sxs-lookup"><span data-stu-id="f3424-381">The threshold for throttling often depends on the customer's service tier.</span></span> <span data-ttu-id="f3424-382">詳細については、「[調整パターン](../patterns/throttling.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f3424-382">For more information, see [Throttling pattern](../patterns/throttling.md).</span></span>

    <span data-ttu-id="f3424-383">調整は、クライアントが悪意を持って実行したことを必ずしも意味するものではありません。サービス クォータを超えたことだけを意味します。</span><span class="sxs-lookup"><span data-stu-id="f3424-383">Throttling does not imply that the client was necessarily acting maliciously &mdash; only that it exceeded its service quota.</span></span> <span data-ttu-id="f3424-384">場合によっては、コンシューマーが常にクォータを超えているか、動作が正しくない可能性があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-384">In some cases, a consumer might consistently exceed their quota or otherwise behave badly.</span></span> <span data-ttu-id="f3424-385">この場合は、さらにユーザーをブロックすることがあります。</span><span class="sxs-lookup"><span data-stu-id="f3424-385">In that case, you might go further and block the user.</span></span> <span data-ttu-id="f3424-386">通常、このブロックを行うには、API キーまたは IP アドレス範囲をブロックします。</span><span class="sxs-lookup"><span data-stu-id="f3424-386">Typically, this is done by blocking an API key or an IP address range.</span></span>
- <span data-ttu-id="f3424-387">**グレースフル デグラデーションを実現するようにアプリケーションを設計します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-387">**Design applications to gracefully degrade.**</span></span> <span data-ttu-id="f3424-388">アプリケーションの負荷が 1 つ以上の部分の容量を超えたことによって、可用性が低下し、接続が失敗する場合があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-388">The load on an application may exceed the capacity of one or more parts, causing reduced availability and failed connections.</span></span> <span data-ttu-id="f3424-389">この問題を軽減するにはスケーリングが役立ちますが、リソースの可用性やコストなどのその他の要因によって制限に到達する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-389">Scaling can mitigate this problem, but it may reach a limit imposed by other factors, such as resource availability or cost.</span></span> <span data-ttu-id="f3424-390">アプリケーションがリソースの上限に達したときに、適切なアクションを実行してユーザーへの影響を最小限に抑える必要があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-390">When an application reaches a resource limit, it should take appropriate action to minimize the impact for the user.</span></span> <span data-ttu-id="f3424-391">たとえば、eコマース システムで注文処理サブシステムに負荷がかかっている場合やエラーが発生した場合は、サブシステムを一時的に無効にし、他の機能 (製品カタログの参照など) を続行することができます。</span><span class="sxs-lookup"><span data-stu-id="f3424-391">For example, in an e-commerce system, if the order-processing subsystem is under strain or fails, it can be temporarily disabled while allowing other functionality, such as browsing the product catalog.</span></span> <span data-ttu-id="f3424-392">エラーが発生しているサブシステムへの要求を遅らせることが適切な場合があります。たとえば、顧客が注文を送信し、その注文を注文サブシステムが再度使用可能になったら後で処理できるように保存することができます。</span><span class="sxs-lookup"><span data-stu-id="f3424-392">It might be appropriate to postpone requests to a failing subsystem &mdash; for example, still enabling customers to submit orders but saving them for later processing, when the orders subsystem is available again.</span></span>
- <span data-ttu-id="f3424-393">**急速なバースト イベントを適切に処理します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-393">**Gracefully handle rapid burst events.**</span></span> <span data-ttu-id="f3424-394">ほとんどのアプリケーションでは、経時的に変化するワークロードを処理する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-394">Most applications need to handle varying workloads over time.</span></span> <span data-ttu-id="f3424-395">自動スケーリングは負荷の処理に役立ちますが、追加のインスタンスがオンラインになり、要求を処理するまでに時間がかかる場合があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-395">Autoscaling can help to handle the load, but it may take some time for additional instances to come online and handle requests.</span></span> <span data-ttu-id="f3424-396">アクティビティのバーストによってアプリケーションが過負荷にならないようにするには、使用するサービスに対するキューに要求を入れ、キューが容量に近づいたら適切に機能が低下するように設計します。</span><span class="sxs-lookup"><span data-stu-id="f3424-396">To prevent bursts of activity from overwhelming the application, design it to queue requests to the services it uses and to degrade gracefully when queues are near capacity.</span></span> <span data-ttu-id="f3424-397">バーストがない状況では、キューをドレインして未処理の要求を処理するのに十分なパフォーマンスと容量が確保されるようにします。</span><span class="sxs-lookup"><span data-stu-id="f3424-397">Ensure there is sufficient performance and capacity available under non-burst conditions to drain the queues and handle outstanding requests.</span></span> <span data-ttu-id="f3424-398">詳細については、「[キュー ベースの負荷平準化パターン](../patterns/queue-based-load-leveling.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f3424-398">For more information, see the [Queue-Based Load Leveling pattern](../patterns/queue-based-load-leveling.md).</span></span>
- <span data-ttu-id="f3424-399">**複数のコンポーネントを構成するか、複数のコンポーネントにフォールバックします。**</span><span class="sxs-lookup"><span data-stu-id="f3424-399">**Compose or fail back to multiple components.**</span></span> <span data-ttu-id="f3424-400">可能な限り、操作や既存の接続に影響を与えずに複数のインスタンスを使用するように、アプリケーションを設計します。</span><span class="sxs-lookup"><span data-stu-id="f3424-400">Design applications to use multiple instances without affecting operation and existing connections, where possible.</span></span> <span data-ttu-id="f3424-401">可用性を最大にするには、複数のインスタンスを使用してそれらの間に要求を分散させ、障害が発生したインスタンスを検出して、それに要求が送信されないようにします。</span><span class="sxs-lookup"><span data-stu-id="f3424-401">To maximize availability, use multiple instances and distribute requests between them, and detect and avoid sending requests to failed instances.</span></span>
- <span data-ttu-id="f3424-402">**別のサービスまたはワークフローにフォールバックします。**</span><span class="sxs-lookup"><span data-stu-id="f3424-402">**Fail back to a different service or workflow.**</span></span> <span data-ttu-id="f3424-403">たとえば、SQL Database への書き込みに失敗した場合は、一時的にデータを Blob Storage または Redis Cache に保存します。</span><span class="sxs-lookup"><span data-stu-id="f3424-403">For example, if writing to SQL Database fails, temporarily store data in Blob storage or Redis Cache.</span></span> <span data-ttu-id="f3424-404">サービスが利用可能になったときに SQL Database への書き込みを再生する方法を提供します。</span><span class="sxs-lookup"><span data-stu-id="f3424-404">Provide a way to replay the writes to SQL Database when the service becomes available.</span></span> <span data-ttu-id="f3424-405">場合によっては、失敗した操作に、コンポーネントまたはサービスで障害が発生してもアプリケーションが動作し続けられるような、代替のアクションが存在することがあります。</span><span class="sxs-lookup"><span data-stu-id="f3424-405">In some cases, a failed operation may have an alternative action that allows the application to continue to work, even when a component or service fails.</span></span> <span data-ttu-id="f3424-406">可能であれば、障害を検出し、プライマリ サービスがオフラインの間は、他のサービスに要求をリダイレクトします。</span><span class="sxs-lookup"><span data-stu-id="f3424-406">If possible, detect failures and redirect requests to other services while the primary service is offline.</span></span>
- <span data-ttu-id="f3424-407">**負荷平準化を使用してトラフィックの急増をなくします。**</span><span class="sxs-lookup"><span data-stu-id="f3424-407">**Use load leveling to smooth out spikes in traffic.**</span></span> <span data-ttu-id="f3424-408">アプリケーションではトラフィックが急増することがあり、これによってバックエンドのサービスに大きな負荷がかかる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-408">Applications may experience sudden spikes in traffic, which can overwhelm services on the back end.</span></span> <span data-ttu-id="f3424-409">バックエンド サービスが十分にすばやく要求に応答できない場合、保留中の要求が蓄積したり、サービスによってアプリケーションが調整されたりすることがあります。</span><span class="sxs-lookup"><span data-stu-id="f3424-409">If a back-end service cannot respond to requests quickly enough, the pending requests may accumulate or the service may throttle the application.</span></span> <span data-ttu-id="f3424-410">この状況を回避するために、バッファーとしてキューを使用することができます。</span><span class="sxs-lookup"><span data-stu-id="f3424-410">To avoid this, you can use a queue as a buffer.</span></span> <span data-ttu-id="f3424-411">新しい作業項目がある場合、バックエンド サービスをすぐに呼び出すのではなく、アプリケーションで作業項目をキューに格納して非同期に実行します。</span><span class="sxs-lookup"><span data-stu-id="f3424-411">When there is a new work item, instead of calling the back-end service immediately, the application queues a work item to run asynchronously.</span></span> <span data-ttu-id="f3424-412">キューは、負荷のピークを平準化するバッファーとして機能します。</span><span class="sxs-lookup"><span data-stu-id="f3424-412">The queue acts as a buffer that smooths out peaks in the load.</span></span> <span data-ttu-id="f3424-413">詳細については、「[キュー ベースの負荷平準化パターン](../patterns/queue-based-load-leveling.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f3424-413">For more information, see [Queue-Based Load Leveling pattern](../patterns/queue-based-load-leveling.md).</span></span>

## <a name="manage-your-data"></a><span data-ttu-id="f3424-414">データを管理する</span><span class="sxs-lookup"><span data-stu-id="f3424-414">Manage your data</span></span>

<span data-ttu-id="f3424-415">データを管理する方法は、アプリケーションの可用性に直接関係します。</span><span class="sxs-lookup"><span data-stu-id="f3424-415">How you manage your data plays directly into the availability of your application.</span></span> <span data-ttu-id="f3424-416">このセクションのタスクは、可用性を確保の役立つ管理計画の作成に役立てることができます。</span><span class="sxs-lookup"><span data-stu-id="f3424-416">The tasks in this section can help you create a management plan to help ensure availability.</span></span>

- <span data-ttu-id="f3424-417">**データをレプリケートし、アプリケーションのデータ ストアのレプリケーション方法を理解します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-417">**Replicate data and understand the replication methods for your application's data stores.**</span></span> <span data-ttu-id="f3424-418">データのレプリケートは、データ ストアの一時的ではない障害を処理する場合の一般的な戦略です。</span><span class="sxs-lookup"><span data-stu-id="f3424-418">Replicating data is a general strategy for handling non-transient failures in a data store.</span></span> <span data-ttu-id="f3424-419">読み取りパスと書き込みパスの両方を考慮します。</span><span class="sxs-lookup"><span data-stu-id="f3424-419">Consider both the read and write paths.</span></span> <span data-ttu-id="f3424-420">ストレージのテクノロジに応じて、複数の書き込み可能レプリカがある場合、または単一の書き込み可能レプリカと複数の読み取り専用レプリカがある場合があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-420">Depending on the storage technology, you might have multiple writable replicas or you might have a single writable replica and multiple read-only replicas.</span></span> <span data-ttu-id="f3424-421">可用性を最大限にするために、レプリカを複数のリージョンに配置する方法もあります。</span><span class="sxs-lookup"><span data-stu-id="f3424-421">To maximize availability, replicas can be placed in multiple regions.</span></span> <span data-ttu-id="f3424-422">ただし、このアプローチでは、データをレプリケートするときの待機時間が長くなります。</span><span class="sxs-lookup"><span data-stu-id="f3424-422">However, this approach increases the latency when replicating the data.</span></span> <span data-ttu-id="f3424-423">通常、複数リージョンをまたがるレプリケートは非同期に行われます。これは最終的な整合性モデルであり、レプリカで障害が発生した場合にはデータ損失が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-423">Typically, replicating across regions is done asynchronously, which implies an eventual consistency model and potential data loss if a replica fails.</span></span>  

  <span data-ttu-id="f3424-424">[Azure Site Recovery](/azure/site-recovery/azure-to-azure-quickstart/) を使って、異なるリージョン間で Azure Virtual Machines をレプリケートすることができます。</span><span class="sxs-lookup"><span data-stu-id="f3424-424">You can use [Azure Site Recovery](/azure/site-recovery/azure-to-azure-quickstart/) to replicate Azure Virtual Machines from one region to another.</span></span> <span data-ttu-id="f3424-425">Site Recovery では、ターゲット リージョンに、データが継続的にレプリケートされます。</span><span class="sxs-lookup"><span data-stu-id="f3424-425">Site Recovery replicates data continuously to the target region.</span></span> <span data-ttu-id="f3424-426">プライマリ サイトで障害が発生した場合は、セカンダリの場所にフェールオーバーします。</span><span class="sxs-lookup"><span data-stu-id="f3424-426">When an outage occurs at your primary site, you fail over to a secondary location.</span></span>

- <span data-ttu-id="f3424-427">**1 つのユーザー アカウントで運用データとバックアップ データの両方にアクセスできることがないようにします。**</span><span class="sxs-lookup"><span data-stu-id="f3424-427">**Ensure that no single user account has access to both production and backup data.**</span></span> <span data-ttu-id="f3424-428">1 つのユーザー アカウントに運用とバックアップの両方のソースの両方に書き込みアクセス許可があると、データのバックアップが侵害されます。</span><span class="sxs-lookup"><span data-stu-id="f3424-428">Your data backups are compromised if one single user account has permission to write to both production and backup sources.</span></span> <span data-ttu-id="f3424-429">悪意のあるユーザーはすべてのデータを意図的に削除する可能性があり、正規のユーザーは誤って削除する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-429">A malicious user could purposely delete all your data, and a regular user could accidentally delete it.</span></span> <span data-ttu-id="f3424-430">各ユーザー アカウントのアクセス許可を制限するようにアプリケーションを設計します。</span><span class="sxs-lookup"><span data-stu-id="f3424-430">Design your application to limit the permissions of each user account.</span></span> <span data-ttu-id="f3424-431">書き込みが必要なユーザーだけに、書き込みアクセスを許可します。また、運用環境またはバックアップ環境のどちらか一方に対するアクセスだけを許可し、両方へのアクセスを許可しないようにします。</span><span class="sxs-lookup"><span data-stu-id="f3424-431">Only grant write access to users who require it, and grant access to either production or backup, but not both.</span></span>
- <span data-ttu-id="f3424-432">**データ ストアのフェールオーバーおよびフェールバックのプロセスをドキュメント化してテストします。**</span><span class="sxs-lookup"><span data-stu-id="f3424-432">**Document and test your data store failover and failback process.**</span></span> <span data-ttu-id="f3424-433">データ ストアで壊滅的な障害が発生した場合、人間のオペレーターは、文書化されている手順に従って、新しいデータ ストアにフェールオーバーする必要があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-433">If a data store fails catastrophically, a human operator must follow a set of documented instructions to fail over to a new data store.</span></span> <span data-ttu-id="f3424-434">文書化されている手順に誤りがあると、オペレーターは適切にそれに従うことができず、リソースをフェールオーバーできなくなります。</span><span class="sxs-lookup"><span data-stu-id="f3424-434">If the documented steps have errors, an operator won't be able to successfully follow them and to fail over the resource.</span></span> <span data-ttu-id="f3424-435">手順の指示を定期的にテストし、ドキュメントに従うオペレーターが正常にフェールオーバーおよびフェールバックできることを確認します。</span><span class="sxs-lookup"><span data-stu-id="f3424-435">Regularly test the instruction steps to verify that an operator who follows the documentation can successfully fail over and fail back.</span></span>
- <span data-ttu-id="f3424-436">**データをバックアップして、データのバックアップを検証します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-436">**Back up your data and validate your data backups.**</span></span> <span data-ttu-id="f3424-437">定期的にスクリプトを実行してデータ整合性、スキーマ、クエリを検証し、バックアップ データが期待どおりのものであることを確認します。</span><span class="sxs-lookup"><span data-stu-id="f3424-437">Regularly run a script to validate data integrity, schema, and queries to ensure that backup data is what you expect.</span></span> <span data-ttu-id="f3424-438">バックアップ サービスを修復できるよう、不一致を記録し、レポートしてください。</span><span class="sxs-lookup"><span data-stu-id="f3424-438">Log and report any inconsistencies so the backup service can be repaired.</span></span>
- <span data-ttu-id="f3424-439">**定期的なバックアップと特定時点への復元を使用します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-439">**Use periodic backup and point-in-time restore.**</span></span> <span data-ttu-id="f3424-440">どこにも保持されていないデータを、定期的かつ自動的にバックアップします。</span><span class="sxs-lookup"><span data-stu-id="f3424-440">Regularly and automatically back up data that is not preserved elsewhere.</span></span> <span data-ttu-id="f3424-441">障害が発生した場合に、データとアプリケーション自体の両方を確実に復元できることを確認します。</span><span class="sxs-lookup"><span data-stu-id="f3424-441">Verify that you can reliably restore both the data and the application itself if failure occurs.</span></span> <span data-ttu-id="f3424-442">バックアップが、RPO を満たしていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="f3424-442">Ensure that backups meet your RPO.</span></span> <span data-ttu-id="f3424-443">データ レプリケーションはバックアップ機能ではありません。人為的なミスや悪意のある操作によって、すべてのレプリカでデータが破損する可能性があるためです。</span><span class="sxs-lookup"><span data-stu-id="f3424-443">Data replication isn't a backup feature, because human error or malicious operations can corrupt data across all the replicas.</span></span> <span data-ttu-id="f3424-444">バックアップ プロセスは、転送中のデータと格納中のデータを保護するため、セキュリティで保護する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-444">The backup process must be secure to protect the data in transit and in storage.</span></span> <span data-ttu-id="f3424-445">データベースは通常、トランザクション ログを使用して前の時点まで復旧することができます。</span><span class="sxs-lookup"><span data-stu-id="f3424-445">Databases can usually be recovered to a previous point in time by using transaction logs.</span></span> <span data-ttu-id="f3424-446">詳細については、「[データの破損または偶発的な削除から復旧する](../resiliency/recovery-data-corruption.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f3424-446">For more information, see [Recover from data corruption or accidental deletion](../resiliency/recovery-data-corruption.md).</span></span>
- <span data-ttu-id="f3424-447">**geo 冗長ストレージ アカウントの使用を検討します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-447">**Consider using a geo-redundant storage account.**</span></span> <span data-ttu-id="f3424-448">Azure Storage アカウントに格納されているデータは、常にローカルでレプリケートされます。</span><span class="sxs-lookup"><span data-stu-id="f3424-448">Data stored in an Azure Storage account is always replicated locally.</span></span> <span data-ttu-id="f3424-449">ただし、ストレージ アカウントをプロビジョニングするときに選択するレプリケーション戦略は複数あります。</span><span class="sxs-lookup"><span data-stu-id="f3424-449">However, there are multiple replication strategies to choose from when a storage account is provisioned.</span></span> <span data-ttu-id="f3424-450">まれに発生するリージョン全体が使用できなくなったときに備えてアプリケーション データを保護するには、[Azure の読み取りアクセス geo 冗長ストレージ (RA-GRS)](/azure/storage/storage-redundancy/#read-access-geo-redundant-storage) を選択します。</span><span class="sxs-lookup"><span data-stu-id="f3424-450">To protect your application data against the rare case when an entire region becomes unavailable, select [Azure Read-Access Geo-Redundant Storage (RA-GRS)](/azure/storage/storage-redundancy/#read-access-geo-redundant-storage).</span></span>  

    > [!NOTE]
    > <span data-ttu-id="f3424-451">VM の場合は、RA-GRS レプリケーションを利用して VM ディスク (VHD ファイル) を復元しないでください。</span><span class="sxs-lookup"><span data-stu-id="f3424-451">For VMs, do not rely on RA-GRS replication to restore the VM disks (VHD files).</span></span> <span data-ttu-id="f3424-452">代わりに、[Azure Backup](/azure/backup) を使用してください。</span><span class="sxs-lookup"><span data-stu-id="f3424-452">Instead, use [Azure Backup](/azure/backup).</span></span>

- <span data-ttu-id="f3424-453">**参照データを複数のリージョンにデプロイすることを検討します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-453">**Consider deploying reference data to multiple regions.**</span></span> <span data-ttu-id="f3424-454">参照データはアプリケーションの機能をサポートする読み取り専用のデータです。</span><span class="sxs-lookup"><span data-stu-id="f3424-454">Reference data is read-only data that supports application functionality.</span></span> <span data-ttu-id="f3424-455">通常、頻繁に変更されることはありません。</span><span class="sxs-lookup"><span data-stu-id="f3424-455">It typically doesn't change often.</span></span> <span data-ttu-id="f3424-456">バックアップからの復元はリージョン全体にわたるサービス中断を処理する 1 つの方法ですが、RTO は比較的長くなります。</span><span class="sxs-lookup"><span data-stu-id="f3424-456">Although restoring from backup is one way to handle region-wide service disruptions, the RTO is relatively long.</span></span> <span data-ttu-id="f3424-457">セカンダリ リージョンにアプリケーションをデプロイする場合、参照データの RTO を改善する方法がいくつかあります。</span><span class="sxs-lookup"><span data-stu-id="f3424-457">When you deploy the application to a secondary region, some strategies can improve the RTO for reference data.</span></span>

    <span data-ttu-id="f3424-458">参照データは頻繁に変化しないので、永続的なコピーをセカンダリ リージョンに保持することで、RTO を改善できます。</span><span class="sxs-lookup"><span data-stu-id="f3424-458">Because reference data changes infrequently, you can improve the RTO by maintaining a permanent copy in the secondary region.</span></span> <span data-ttu-id="f3424-459">これにより、障害の後で時間をかけてバックアップを復元する必要がなくなります。</span><span class="sxs-lookup"><span data-stu-id="f3424-459">This eliminates the time required to restore backups after a disaster.</span></span> <span data-ttu-id="f3424-460">複数リージョンのディザスター リカバリーの要件を満たすには、アプリケーションと参照データを一緒に複数のリージョンにデプロイする必要があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-460">To meet the multiple-region disaster recovery requirements, you must deploy the application and the reference data together in multiple regions.</span></span>

- <span data-ttu-id="f3424-461">**オプティミスティック同時実行制御と最終的な整合性を使用します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-461">**Use optimistic concurrency and eventual consistency.**</span></span> <span data-ttu-id="f3424-462">ロックによってリソースへのアクセスをブロックするトランザクション (*ペシミスティック同時実行制御*) では、パフォーマンスと可用性が低下する場合があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-462">Transactions that block access to resources through locking (*pessimistic concurrency*) can cause poor performance and reduce availability.</span></span> <span data-ttu-id="f3424-463">これらの問題は、分散システムで特に深刻になります。</span><span class="sxs-lookup"><span data-stu-id="f3424-463">These problems can become especially acute in distributed systems.</span></span> <span data-ttu-id="f3424-464">多くの場合、パーティション分割などの入念な設計や技法によって、更新の競合が発生する可能性を最小限に抑えることができます。</span><span class="sxs-lookup"><span data-stu-id="f3424-464">In many cases, careful design and techniques, such as partitioning, can minimize the chances of conflicting updates occurring.</span></span> <span data-ttu-id="f3424-465">データがレプリケートされたり、個別に更新されたスコアから読み取られたりする場合は、データは最終段階でのみ整合性が確保されます。</span><span class="sxs-lookup"><span data-stu-id="f3424-465">If data is replicated or read from a separately updated store, the data will only be eventually consistent.</span></span> <span data-ttu-id="f3424-466">ただし、通常、その利点は、トランザクションを使用して即時整合性を保証することの可用性に対する影響を大きく上回ります。</span><span class="sxs-lookup"><span data-stu-id="f3424-466">But the advantages usually outweigh the impact on availability of using transactions to ensure immediate consistency.</span></span>
- <span data-ttu-id="f3424-467">**SQL Database 用のアクティブ geo レプリケーションを使用して、変更をセカンダリ データベースにレプリケートします。**</span><span class="sxs-lookup"><span data-stu-id="f3424-467">**Use active geo-replication for SQL Database to replicate changes to a secondary database.**</span></span> <span data-ttu-id="f3424-468">SQL Database 用のアクティブ geo レプリケーションでは、データベースの変更が、同じリージョンまたは別のリージョンのセカンダリ データベースに、自動的にレプリケートされます。</span><span class="sxs-lookup"><span data-stu-id="f3424-468">Active geo-replication for SQL Database automatically replicates database changes to secondary databases in the same region or a different region.</span></span> <span data-ttu-id="f3424-469">詳細については、「[アクティブ geo レプリケーションの作成と使用](/azure/sql-database/sql-database-active-geo-replication)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f3424-469">For more information, see [Creating and using active geo-replication](/azure/sql-database/sql-database-active-geo-replication).</span></span>

  <span data-ttu-id="f3424-470">または、**DATABASE COPY** コマンドを使ってトランザクションの一貫性を保つデータベースのバックアップ コピーを作成するという、より手動的なアプローチを使用できます。</span><span class="sxs-lookup"><span data-stu-id="f3424-470">Alternatively, you can take a more manual approach by using the **DATABASE COPY** command to create a backup copy of the database with transactional consistency.</span></span> <span data-ttu-id="f3424-471">Azure SQL Database のインポート/エクスポート サービスを使用することもできます。このサービスでは、Azure Blob Storage に格納されている BACPAC ファイル (ご利用のデータベース スキーマおよび関連するデータを含む圧縮されたファイル) へのデータベースのエクスポートをサポートします。</span><span class="sxs-lookup"><span data-stu-id="f3424-471">You can also use the import/export service of Azure SQL Database, which supports exporting databases to BACPAC files (compressed files containing your database schema and associated data) that are stored in Azure Blob storage.</span></span> <span data-ttu-id="f3424-472">Azure Storage では、バックアップ ファイルの 2 個のレプリカが同じリージョンに作成されます。</span><span class="sxs-lookup"><span data-stu-id="f3424-472">Azure Storage creates two replicas of the backup file in the same region.</span></span> <span data-ttu-id="f3424-473">ただし、バックアップ プロセスの頻度により、障害シナリオで失われる可能性があるデータ量を表す RPO が決まります。</span><span class="sxs-lookup"><span data-stu-id="f3424-473">However, the frequency of the backup process determines your RPO, which is the amount of data you might lose in disaster scenarios.</span></span> <span data-ttu-id="f3424-474">たとえば、1 時間ごとにデータをバックアップする場合、バックアップの 2 分前に障害が発生すると、58 分間のデータが失われます。</span><span class="sxs-lookup"><span data-stu-id="f3424-474">For example, if you back up data every hour, and a disaster occurs two minutes before the backup, you will lose 58 minutes of data.</span></span> <span data-ttu-id="f3424-475">また、リージョン全体のサービス中断を防ぐには、BACPAC ファイルを代替リージョンにコピーする必要があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-475">Also, to protect against a region-wide service disruption, you should copy the BACPAC files to an alternate region.</span></span> <span data-ttu-id="f3424-476">詳細については、「[Azure SQL Database によるビジネス継続性の概要](/azure/sql-database/sql-database-business-continuity)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f3424-476">For more information, see [Overview of business continuity with Azure SQL Database](/azure/sql-database/sql-database-business-continuity).</span></span>

- <span data-ttu-id="f3424-477">**SQL Data Warehouse の geo バックアップを使用します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-477">**Use geo-backups for SQL Data Warehouse.**</span></span> <span data-ttu-id="f3424-478">SQL Data Warehouse については、[geo バックアップ](/azure/sql-data-warehouse/backup-and-restore)を使用して、ディザスター リカバリー用のペア リージョンに復元します。</span><span class="sxs-lookup"><span data-stu-id="f3424-478">For SQL Data Warehouse, use [geo-backups](/azure/sql-data-warehouse/backup-and-restore) to restore to a paired region for disaster recovery.</span></span> <span data-ttu-id="f3424-479">これらのバックアップは、24 時間ごとに作成され、20 分以内にペア リージョンに復元できます。</span><span class="sxs-lookup"><span data-stu-id="f3424-479">These backups are taken every 24 hours and can be restored within 20 minutes in the paired region.</span></span> <span data-ttu-id="f3424-480">この機能は、すべての SQL Data Warehouse インスタンスに対して既定で有効になります。</span><span class="sxs-lookup"><span data-stu-id="f3424-480">This feature is on by default for all SQL Data Warehouse instances.</span></span> <span data-ttu-id="f3424-481">データ ウェアハウスを復元する方法の詳細については、「[PowerShell を使用して Azure 地理的リージョンから復元する](/azure/sql-data-warehouse/sql-data-warehouse-restore)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f3424-481">For more information on how to restore your data warehouse, see [Restore from an Azure geographical region using PowerShell.](/azure/sql-data-warehouse/sql-data-warehouse-restore)</span></span>

- <span data-ttu-id="f3424-482">**Azure Site Recovery を使用して VM ディスクをレプリケートします。**</span><span class="sxs-lookup"><span data-stu-id="f3424-482">**Replicate VM disks using Azure Site Recovery.**</span></span> <span data-ttu-id="f3424-483">[Site Recovery](/azure/site-recovery/) を使用して Azure VM をレプリケートすると、すべての VM ディスクが、ターゲット リージョンに継続的かつ非同期的にレプリケートされます。</span><span class="sxs-lookup"><span data-stu-id="f3424-483">When you replicate Azure VMs using [Site Recovery](/azure/site-recovery/), all the VM disks are continuously replicated to the target region asynchronously.</span></span> <span data-ttu-id="f3424-484">復旧ポイントは数分ごとに作成されます。</span><span class="sxs-lookup"><span data-stu-id="f3424-484">The recovery points are created every few minutes.</span></span> <span data-ttu-id="f3424-485">これにより、RPO は分単位になります。</span><span class="sxs-lookup"><span data-stu-id="f3424-485">This gives you an RPO on the order of minutes.</span></span>
- <span data-ttu-id="f3424-486">**VM で実行されている SQL Server をバックアップするか、またはログ配布セッションを構成します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-486">**Back up SQL Server running on VMs or configure a log-shipping session.**</span></span> <span data-ttu-id="f3424-487">VM 上で実行される SQL Server の場合、従来のバックアップとログ配布の 2 つのオプションがあります。</span><span class="sxs-lookup"><span data-stu-id="f3424-487">For SQL Server running on VMs, there are two options: traditional backups and log shipping.</span></span> <span data-ttu-id="f3424-488">従来のバックアップを使用すると、特定の時点の状態に復元できますが、復旧プロセスに時間がかかります。</span><span class="sxs-lookup"><span data-stu-id="f3424-488">Traditional backups enable you to restore to a specific point in time, but the recovery process is slow.</span></span> <span data-ttu-id="f3424-489">従来のバックアップを復元するには、最初に完全バックアップから開始し、その後にそれ以降に作成されたバックアップを適用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-489">Restoring traditional backups requires that you start with an initial full backup and then apply any backups taken after that.</span></span> <span data-ttu-id="f3424-490">2 番目のオプションでは、ログ バックアップの復元を (たとえば 2 時間) 遅延するログ配布セッションを構成します。</span><span class="sxs-lookup"><span data-stu-id="f3424-490">The second option is to configure a log-shipping session to delay the restore of log backups (for example, by two hours).</span></span> <span data-ttu-id="f3424-491">これにより、プライマリで発生したエラーから回復するための時間が確保されます。</span><span class="sxs-lookup"><span data-stu-id="f3424-491">This provides a window to recover from errors made on the primary.</span></span>
- <span data-ttu-id="f3424-492">**Azure Storage のバックアップに対してカスタム プロセスまたはサード パーティ製ツールを使用します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-492">**Use a custom process or third-party tool for Azure Storage backup.**</span></span> <span data-ttu-id="f3424-493">Azure Storage の場合、カスタム バックアップ プロセスを開発したり、サード パーティ製のバックアップ ツールを使用したりすることができます。</span><span class="sxs-lookup"><span data-stu-id="f3424-493">For Azure Storage, you can develop a custom backup process or use a third-party backup tool.</span></span> <span data-ttu-id="f3424-494">ほとんどのアプリケーション設計では、ストレージ リソース間の相互参照によって複雑さが増します。</span><span class="sxs-lookup"><span data-stu-id="f3424-494">Most application designs have additional complexities, in which storage resources reference each other.</span></span> <span data-ttu-id="f3424-495">たとえば、Azure Storage の BLOB にリンクしている列を含む SQL データベースがあるものとします。</span><span class="sxs-lookup"><span data-stu-id="f3424-495">For example, consider a SQL database with a column that links to a blob in Azure Storage.</span></span> <span data-ttu-id="f3424-496">バックアップが同時に実行されない場合、データベースには、障害発生前にバックアップされなかった BLOB へのポインターが含まれる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-496">If the backups do not happen simultaneously, the database might have a pointer to a blob that was not backed up before the failure.</span></span> <span data-ttu-id="f3424-497">アプリケーションまたはディザスター リカバリー計画では、復旧後のこのような不整合を処理するプロセスを実装する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-497">The application or disaster recovery plan must implement processes to handle this inconsistency after a recovery.</span></span>
- <span data-ttu-id="f3424-498">**VM でホストされている他のデータ プラットフォームに対してネイティブのレプリケーション機能またはスナップショット機能を使用します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-498">**Use the native replication or snapshot capabilities for other data platforms hosted on VMs.**</span></span> <span data-ttu-id="f3424-499">Elasticsearch や MongoDB など、他のデータ プラットフォームには、バックアップと復元の統合プロセスを作成するときに、独自の機能および考慮事項があります。</span><span class="sxs-lookup"><span data-stu-id="f3424-499">Other data platforms, such as Elasticsearch or MongoDB, have their own capabilities and considerations when creating an integrated backup and restore process.</span></span> <span data-ttu-id="f3424-500">これらのデータ プラットフォームに対して、一般に、ネイティブの、または利用可能な統合に基づく、レプリケーション機能またはスナップショット機能を使うことをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="f3424-500">For these data platforms, the general recommendation is to use any native or available integration-based replication or snapshot capabilities.</span></span> <span data-ttu-id="f3424-501">そのような機能が存在しないか、または適切でない場合は、Azure Backup サービスまたはディスク スナップショットを使って、アプリケーション データの特定時点のコピーを作成することを検討します。</span><span class="sxs-lookup"><span data-stu-id="f3424-501">If those capabilities don't exist or aren't suitable, consider using Azure Backup or disk snapshots to create a point-in-time copy of application data.</span></span> <span data-ttu-id="f3424-502">すべてのケースにおいて、一貫性のあるバックアップを実現する方法を決定することが重要です。これは、アプリケーション データが複数のファイル システムにまたがる場合や、複数のドライブが 1 つのファイル システムに結合されている場合に特に重要です。</span><span class="sxs-lookup"><span data-stu-id="f3424-502">In all cases, it's important to determine how to achieve consistent backups, especially when application data spans multiple files systems or multiple drives are combined into a single file system.</span></span>
- <span data-ttu-id="f3424-503">**アプリケーションのデータ ソースのレプリケーション方法を理解します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-503">**Understand the replication methods for your application's data sources.**</span></span> <span data-ttu-id="f3424-504">アプリケーション データは、さまざまなデータ ソースに格納され、さまざまな可用性の要件を持ちます。</span><span class="sxs-lookup"><span data-stu-id="f3424-504">Your application data will be stored in different data sources and will have varied availability requirements.</span></span> <span data-ttu-id="f3424-505">アプリケーションのデータ要件が確実に満たされるように、[Azure Storage の冗長性](/azure/storage/storage-redundancy/)や [SQL Database のアクティブ geo レプリケーション](/azure/sql-database/sql-database-geo-replication-overview/)など、Azure のデータ ストレージの種類ごとに、レプリケーションの方法を評価します。</span><span class="sxs-lookup"><span data-stu-id="f3424-505">Evaluate the replication methods for each type of data storage in Azure, including [Azure Storage redundancy](/azure/storage/storage-redundancy/) and [SQL Database active geo-replication](/azure/sql-database/sql-database-geo-replication-overview/) to ensure that your application's data requirements are satisfied.</span></span> <span data-ttu-id="f3424-506">[Site Recovery](/azure/site-recovery/) を使って Azure VM をレプリケートすると、すべての VM ディスクが、ターゲット リージョンに継続的かつ非同期的にレプリケートされます。</span><span class="sxs-lookup"><span data-stu-id="f3424-506">If you replicate Azure VMs using [Site Recovery](/azure/site-recovery/), all the VM disks are continuously replicated to the target region asynchronously.</span></span> <span data-ttu-id="f3424-507">復旧ポイントは数分ごとに作成されます。</span><span class="sxs-lookup"><span data-stu-id="f3424-507">The recovery points are created every few minutes.</span></span>
- <span data-ttu-id="f3424-508">**ディザスター リカバリーのためのデータ戦略を確立します。**</span><span class="sxs-lookup"><span data-stu-id="f3424-508">**Establish data strategies for disaster recovery.**</span></span> <span data-ttu-id="f3424-509">適切なデータ処理は、すべてのディザスター リカバリー計画における難しい課題です。</span><span class="sxs-lookup"><span data-stu-id="f3424-509">Proper data handling is a challenging aspect of any disaster recovery plan.</span></span> <span data-ttu-id="f3424-510">通常、回復プロセス中はデータの復元に最も時間がかかります。</span><span class="sxs-lookup"><span data-stu-id="f3424-510">During the recovery process, data restoration typically takes the most time.</span></span> <span data-ttu-id="f3424-511">機能を削減するためのさまざまな選択肢は、データ復旧および一貫性に対する困難な課題になります。</span><span class="sxs-lookup"><span data-stu-id="f3424-511">Different choices for reducing functionality result in difficult challenges for data recovery and consistency.</span></span>

## <a name="next-steps"></a><span data-ttu-id="f3424-512">次の手順</span><span class="sxs-lookup"><span data-stu-id="f3424-512">Next steps</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="f3424-513">回復性と可用性をテストする</span><span class="sxs-lookup"><span data-stu-id="f3424-513">Test for resiliency and availability</span></span>](./testing.md)
