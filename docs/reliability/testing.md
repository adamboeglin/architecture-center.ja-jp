---
title: Azure アプリケーションの回復性と可用性のテスト
description: Azure のアプリケーションの信頼性をテストする方法
author: MikeWasson
ms.date: 04/10/2019
ms.topic: article
ms.service: architecture-center
ms.subservice: cloud-design-principles
ms.openlocfilehash: cf33a859540810279b1cb85be5a6fb2ebe4500dc
ms.sourcegitcommit: 579c39ff4b776704ead17a006bf24cd4cdc65edd
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/17/2019
ms.locfileid: "59642875"
---
# <a name="testing-azure-applications-for-resiliency-and-availability"></a>Azure アプリケーションの回復性と可用性のテスト

回復性をテストするには、断続的に障害が発生する状況下でエンドツーエンドのワークロードがどのように実行されるかを確認する必要があります。

人工的なユーザー データと実際のユーザー データの両方を使用して、運用環境でテストを実行します。 テストと運用はほとんど同じですので、[Blue/Green](https://martinfowler.com/bliki/BlueGreenDeployment.html) または[カナリア デプロイ](https://martinfowler.com/bliki/CanaryRelease.html)を使用し、運用環境でアプリケーションを検証することが重要です。 これにより、実際の条件でアプリケーションをテストし、完全にデプロイされているときにアプリケーションが予期したとおりに動作することを確認できます。

テスト計画の一環として、次を含めます。

- 自動デプロイ前テスト
- フォールト挿入テスト
- ピーク ロード テスト
- ディザスター リカバリー テスト
- サードパーティー サービス テスト

テストは反復的なプロセスです。 アプリケーションをテストし、結果を測定し、結果のすべてのエラーを分析して対応し、プロセスを繰り返します。

## <a name="perform-fault-injection-testing"></a>フォールト挿入テストを実行する

フォールト挿入テストでは、実際の障害をトリガーするまたはシミュレートすることによって、システムの障害への回復性を確認します。 次のような方法で障害を再現します。

- 仮想マシン (VM) インスタンスのシャットダウン。
- プロセスのクラッシュ。
- 証明書の期限切れ。
- アクセス キーの変更。
- ドメイン コントローラー上の DNS サービスのシャットダウン。
- RAM やスレッド数など、使用可能なシステム リソースの制限。
- ディスクのマウント解除。
- VM の再デプロイ。

テスト計画には、一般的な障害のシナリオだけでなく、デザイン フェーズ中に特定される可能性がある障害点を組み込む必要があります。

- アプリケーションは可能な限り運用に近い環境でテストします。
- 障害を組み合わせてテストします。
- 回復時間を測定し、ビジネス要件を満たしていることを確認します。
- 障害が連鎖しないこと、分離された方法で処理されることを確認します。

障害のシナリオの詳細については、「[Failure and disaster recovery for Azure applications](./disaster-recovery.md)」 (Azure アプリケーションの障害とディザスター リカバリー) を参照してください。

## <a name="test-under-peak-loads"></a>ピーク負荷でテストする

ロード テストは、過負荷状態またはサービスの調整が行われているバックエンド データベースなど、負荷がかかった状態でのみ発生する障害を特定するために重要です。 運用データまたは運用データに可能な限り近い人工的なデータを使用して、ピーク負荷と、ピーク負荷で予想される増加をテストします。 目標は、実際の条件下でアプリケーションがどのように動作するかを確認することです。

## <a name="conduct-disaster-recovery-drills"></a>ディザスター リカバリー訓練を実施する

適切なディザスター リカバリー計画から開始し、それを定期的にテストして、機能することを確認します。

Azure Virtual Machines については、[Azure Site Recovery](/azure/site-recovery/azure-to-azure-quickstart/) を使用することで、運用アプリケーションや進行中のレプリケーションに影響を与えることなく、レプリケーションおよび[ディザスター リカバリー訓練を実施](/azure/site-recovery/azure-to-azure-tutorial-dr-drill/)できます。

### <a name="failover-and-failback-testing"></a>フェールオーバーとフェールバックのテスト

フェールオーバーとフェールバックをテストして、お使いのアプリケーションの依存サービスがディザスター リカバリー中に同期的にバックアップされることを確認します。 システムおよび操作の変更はフェールオーバーおよびフォールバック機能に影響を与える可能性がありますが、その影響はメインのシステムで障害が発生するか、オーバーロードが発生するまで検出されない場合があります。 フェールオーバー機能は、実際に起きている問題の補正で必要になる*前に*テストします。 また、依存サービスのフェールオーバーとフェールバックが、確実に正しい順序で行われるようにしてください。

[Azure Site Recovery](/azure/site-recovery/) を使用して VM をレプリケートする場合は、テスト フェールオーバーを実行してディザスター リカバリー訓練を定期的に実行し、レプリケーション戦略を検証します。 テスト フェールオーバーは、実行中の VM レプリケーションや運用環境に影響を与えません。 詳細については、「[Azure へのディザスター リカバリー訓練を実行する](/azure/site-recovery/site-recovery-test-failover-to-azure)」を参照してください。

### <a name="simulation-testing"></a>シミュレーション テスト

シミュレーション テストには、小規模の実際の状況の作成が必要です。 シミュレーションでは、復旧計画のソリューションの有効性を実証し、適切に対処されないすべての問題を明らかにします。

シミュレーション テストを実行する際は、次のベスト プラクティスに従います。

- 実際の業務は中断しないが、実際の状況に近い方法でシミュレーションを実施します。
- シミュレートされるシナリオは、完全に制御できる必要があります。 復旧計画が失敗したと思われる場合、損害を発生させずに状況を正常な状態に戻せる必要があります。
- シミュレーションを実施する時期と方法について管理者に通知します。 計画では、シミュレーション中に影響を受ける時間帯とリソースを具体的に示す必要があります。

## <a name="test-health-probes-for-load-balancers-and-traffic-managers"></a>ロード バランサーとトラフィック マネージャーの正常性プローブをテストする

ロード バランサーとトラフィック マネージャーの正常性プローブを構成し、テストします。 正常性エンドポイントによりシステムの重要な部分が確実にチェックされ、適切に応答するようにします。

- [Azure Traffic Manager](/azure/traffic-manager/traffic-manager-overview/) の場合、正常性プローブは別のリージョンにフェールオーバーするかどうかを決定します。 正常性エンドポイントは、同じリージョン内にデプロイされるすべてのクリティカルな依存関係を確認する必要があります。
- [Azure Load Balancer](/azure/load-balancer/load-balancer-overview/) の場合、VM をローテーションから除去するかどうかを決定します。 正常性エンドポイントが VM の正常性をレポートします。 その他の階層または外部サービスを含めないでください。 そうしないと、VM の外部で発生する障害によってロード バランサーがローテーションから VM を除去することになります。

アプリケーションに正常性の監視を実装する方法については、「[正常性エンドポイント監視パターン](../patterns/health-endpoint-monitoring.md)」をご覧ください。

## <a name="test-monitoring-systems"></a>監視システムをテストする

テスト計画に監視システムを含めます。 自動フェールオーバーとフェールバックのシステムは、監視とインストルメンテーションが正しく動作するかどうかに依存します。 システムの正常性と演算子のアラートを視覚化するダッシュボードも、正確な監視とインストルメンテーションがあるかどうかに依存します。 これらの要素で障害、重要な情報の不足、不適切なデータの報告が発生すると、オペレーターはシステムが正常でないことやシステムで障害が発生していることに気付かない可能性があります。

## <a name="include-third-party-services-in-test-scenarios"></a>テスト シナリオにサード パーティーのサービスを含める

アプリケーションがサード パーティーのサービスに依存している場合は、それらのサード パーティーのサービスがどこでどのように失敗する可能性があるのかと、それらの障害がアプリケーションにどのような影響を与えるかを特定してください。 サード パーティーのサービスのサービス レベル アグリーメント (SLA) とそれがディザスター リカバリー計画に及ぼす影響を考慮してください。

サード パーティーのサービスでは監視と診断の機能が提供されないことがあるため、それらの呼び出しをログに記録し、一意の識別子を使用してアプリケーションの正常性と診断のログと関連付けることが重要です。 監視と診断の実証された方法については、[監視と診断のガイダンス](../best-practices/monitoring.md)に関するページをご覧ください。

## <a name="next-steps"></a>次の手順

> [!div class="nextstepaction"]
> [回復性と可用性のためのデプロイ](./deploy.md)
