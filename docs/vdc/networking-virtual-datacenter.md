---
title: Azure 仮想データセンター:ネットワーク パースペクティブ
description: Azure で仮想データセンターを構築する方法について説明します
author: tracsman
manager: rossort
tags: azure-resource-manager
ms.topic: guide
ms.service: architecture-center
ms.subservice: enterprise-cloud-adoption
ms.custom: virtual-network
ms.date: 11/28/2018
ms.author: jonor
ms.openlocfilehash: 8941195c5342036521d5176bfd5420b538dfa4a7
ms.sourcegitcommit: c053e6edb429299a0ad9b327888d596c48859d4a
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/20/2019
ms.locfileid: "58245353"
---
# <a name="azure-virtual-datacenter-a-network-perspective"></a>Azure 仮想データセンター:ネットワーク パースペクティブ

## <a name="overview"></a>概要

オンプレミスのアプリケーションを Azure に移行すると、最小限の変更でアプリケーションを移行した場合でも、セキュリティで保護されたコスト効率の高いインフラストラクチャのメリットが組織にもたらされます。 ただし、クラウド コンピューティングで可能な俊敏性を最大限に活用するには、Azure の機能を利用するように企業のアーキテクチャを進化させる必要があります。 

Microsoft Azure では、ハイパースケールのサービスとインフラストラクチャ、エンタープライズ レベルの機能と信頼性が提供されています。 これらのサービスとインフラストラクチャには、ハイブリッド接続でさまざまな選択肢が用意されているため、パブリック インターネット経由またはプライベート Azure ExpressRoute 接続経由でアクセスすることができます。 また、Microsoft のパートナーも、Azure で実行するために最適化されたセキュリティ サービスと仮想アプライアンスにより、強化された機能を提供しています。

お客様は、これらのクラウド サービスにインターネット経由でアクセスするか、プライベート ネットワーク接続を提供する Azure ExpressRoute を使ってアクセスするかを選択できます。 Microsoft Azure プラットフォームを使用すると、インフラストラクチャをクラウドにシームレスに拡張し、多層アーキテクチャを構築できます。 また、Microsoft のパートナーも、Azure で実行するために最適化されたセキュリティ サービスと仮想アプライアンスにより、強化された機能を提供しています。

## <a name="what-is-the-virtual-datacenter"></a>仮想データセンターとは

クラウドは、初期段階では一般に公開されているアプリケーションをホストするためのプラットフォームでした。 企業はクラウドの価値を理解し始め、社内の基幹業務アプリケーションをクラウドに移行し始めました。 このような種類のアプリケーションによってセキュリティ、信頼性、パフォーマンス、およびコストの考慮事項が増えたため、クラウド サービスの提供方法をさらに柔軟にする必要がありました。 その結果、このような柔軟性を実現するように設計された新しいインフラストラクチャとネットワーク サービスだけでなく、スケール、ディザスター リカバリーなどの考慮事項に対応する新しい機能への道が開かれました。

## <a name="what-is-a-virtual-datacenter"></a>仮想データセンターとは
当初、クラウド ソリューションは、パブリック領域で単一の比較的独立したアプリケーションをホストするように設計されていました。 この方法は、数年間はうまくいっていました。 その後、クラウド ソリューションの利点が明らかになり、複数の大規模なワークロードがクラウドでホストされるようになりました。 クラウド サービスのライフ サイクル全体を通じて、1 つ以上のリージョンでのデプロイのセキュリティ、信頼性、パフォーマンス、コストの問題に対処することが不可欠になりました。

次のクラウド配置ダイアグラムでは、**赤色のボックス**にセキュリティ ギャップの例を示しています。 **黄色のボックス**は、ワークロード間での最適化ネットワーク仮想アプライアンスの余地を示しています。

[![0]][0]

仮想データ センター (VDC) は、エンタープライズ ワークロードをサポートするためのスケーリングの必要性から生まれた概念であり、パブリック クラウドで大規模なアプリケーションをサポートするときに発生する問題に対処する必要性ともバランスが取られています。

VDC 実装とは、クラウド内のアプリケーション ワークロードだけでなく、ネットワーク、セキュリティ、管理、インフラストラクチャ (DNS やディレクトリ サービスなど) でもあります。 Azure に移行する企業のワークロードの増加に伴って、これらのワークロードが配置されるサポート インフラストラクチャおよびオブジェクトについて考えることが重要になります。 リソースの構成方法について慎重に考えることで、データ フロー、セキュリティ モデル、コンプライアンスに関する課題が異なり個別に管理する必要のある多数の "ワークロード アイランド" が増殖するのを防ぐことができます。

VDC の概念は、共通のサポート機能とインフラストラクチャを備えた、独立していながら関連性のあるエンティティのコレクションを実装するための一連の推奨事項とベスト プラクティスで構成されています。 ワークロードを VDC のレンズを通して見ることで、運用、管理、コンプライアンス監査が容易になるだけでなく、スケールの経済性およびコンポーネントとデータ フローの一元化によるセキュリティの最適化によってコスト削減を実現できます。

> [!NOTE]
> VDC は Azure の独立した製品では**なく**、厳しい要件を満たすためのさまざまな機能の組み合わせであることを理解しておくことが重要です。 VDC は、クラウドのリソースと能力を最大限にするための、ワークロードと Azure の使用方法についての考え方です。 これは企業の組織的な役割と責任範囲を考慮しながら Azure での IT サービスを構築するモジュール方式のアプローチです。

VDC 実装は、企業が次のシナリオでワークロードとアプリケーションを Azure に移行する際に役立ちます。

-   関連する複数のワークロードをホストする。
-   オンプレミス環境から Azure にワークロードを移行する。
-   複数のワークロード間に、共有または一元化されたセキュリティとアクセスの要件を実装する。
-   大企業向けに Azure DevOps と一元化された IT を適切に組み合わせる。

VDC の利点を実現する鍵となるのは、次のような Azure サービスの機能を組み合わせた集中型のハブとスポークのネットワーク トポロジです。

* [Azure Virtual Network][VNet]、
* [ネットワーク セキュリティ グループ][NSG]、
* [仮想ネットワーク ピアリング][VNetPeering]、
* [ユーザー定義ルート (UDR)][UDR]、および
* [ロールベースのアクセス制御 (RBAC)][RBAC] を使用した Azure ID と、必要に応じて [Azure Firewall][AzFW]、[Azure DNS][DNS]、[Azure Front Door][AFD]、および [Azure Virtual WAN][vWAN]。

## <a name="who-should-implement-a-virtual-datacenter"></a>仮想データセンターを実装する必要があるお客様

クラウドの採用を決定した Azure をご利用のお客様は、すべてのアプリケーションから共通して使用される一連のリソースの効率的な構成を活用できるようになります。 規模によっては、単一のアプリケーションであっても、VDC 実装の構築に使用されるパターンとコンポーネントを利用することでメリットが得られます。

組織に一元化された IT、ネットワーク、セキュリティ、コンプライアンスのチーム/部門がある場合、VDC を実装することで、ポリシー ポイントの適用、職務の分離、基になる共通コンポーネントの統一性の確保を実現しながら、要件に適した最大限の自由と制御をアプリケーション チームに提供することができます。

また、DevOps を検討している組織では、VDC の概念を利用して、Azure リソースの承認されたポケットを提供し、そのグループ (サブスクリプションまたは共通サブスクリプション内のリソース グループ) 内での完全な制御を確保することもできます。その一方で、ネットワークとセキュリティの境界は、ハブの VNet とリソース グループの一元的ポリシーによる定義に従って準拠を維持します。

## <a name="considerations-for-implementing-a-virtual-datacenter"></a>仮想データ センターの実装に関する考慮事項

VDC 実装を設計するときは、考慮すべき非常に重要な問題がいくつかあります。

### <a name="identity-and-directory-service"></a>ID とディレクトリ サービス

ID とディレクトリ サービスは、オンプレミスとクラウドの両方のすべてのデータセンターの重要な側面です。 ID は、VDC 実装内のサービスへのアクセスと承認のすべての側面に関連しています。 承認されたユーザーおよびプロセスのみが Azure アカウントとリソースにアクセスできるようにするため、Azure は複数の種類の資格情報を認証に使います。 これには、パスワード (Azure アカウントへのアクセス)、暗号化キー、デジタル署名、および証明書が含まれます。 [Azure Multi-Factor Authentication (MFA)][MFA] は、Azure サービスへのアクセスに対する追加セキュリティ レイヤーです。 Azure MFA は、&mdash;電話、テキスト メッセージ、モバイル アプリ通知&mdash;などの各種の簡単な確認オプションにより認証を強化し、顧客に最も合った方法を提供します。

大規模な企業では、VDC 実装内または VDC 実装間での個々の ID とその認証、承認、ロール、権限の管理について説明する ID 管理プロセスを定義する必要があります。 このプロセスの目的は、コスト、ダウンタイム、および手作業の反復を減らしながら、セキュリティと生産性を向上させることです。

企業/組織ではさまざまな基幹業務 (LOB) に必要なサービスの組み合わせに対する要求が厳しい場合があり、従業員は異なるプロジェクトに異なるロールで関係することがよくあります。 VDC では、適切なガバナンスでシステムを実行するために、それぞれ特定のロール定義を使用するさまざまなチーム間の良好な協力が必要です。 責任、アクセス、権限のマトリックスは複雑になる可能性があります。 VDC の ID 管理は、[*Azure Active Directory* (Azure AD)][AAD] とロールベースのアクセス制御 (RBAC) を使用して実装されます。

ディレクトリ サービスは、日常的な項目とネットワーク リソースを検索、管理、整理するための共有情報インフラストラクチャです。 これらのリソースには、ボリューム、フォルダー、ファイル、プリンター、ユーザー、グループ、デバイス、その他のオブジェクトが含まれます。 ネットワーク上の各リソースは、ディレクトリ サーバーによってオブジェクトと見なされます。 リソースに関する情報は、そのリソースまたはオブジェクトに関連付けられた属性のコレクションとして格納されます。

すべての Microsoft オンライン ビジネス サービスは、サインインや他の ID のニーズに対応するために、Azure Active Directory (Azure AD) に依存しています。 Azure Active Directory は、統合的で可用性の高い ID とアクセス管理のクラウド ソリューションであり、コアのディレクトリ サービス、高度な ID ガバナンス、およびアプリケーション アクセス管理を組み合わせたものです。 Azure AD をオンプレミスの Active Directory と統合することで、クラウドベースのアプリケーションとローカルでホストされているオンプレミス アプリケーションのシングル サインオンを有効にすることができます。 オンプレミスの Active Directory のユーザー属性は、Azure AD に自動的に同期できます。

1 人のグローバル管理者が、VDC 実装のすべてのアクセス許可を割り当てる必要があるわけではありません。 代わりに、特定の各部門、ユーザーのグループ、またはディレクトリ サービス内のサービスが、VDC 実装内の各自のリソースを管理するために必要なアクセス許可を持つことができます。 アクセス許可を構成するにはバランスが必要です。 アクセス許可が多すぎるとパフォーマンス効率が妨げられ、アクセス許可が少なすぎたり緩すぎたりするとセキュリティ リスクが高まります。 Azure のロールベースのアクセス制御 (RBAC) は、VDC 実装内のリソースに対してきめ細かいアクセス管理を実現することで、この問題への対処を支援します。

#### <a name="security-infrastructure"></a>セキュリティ インフラストラクチャ

セキュリティ インフラストラクチャとは、VDC 実装の特定の仮想ネットワーク セグメントにおけるトラフィックの分離を指します。 このインフラストラクチャで、VDC 実装内のイングレスとエグレスを制御する方法を指定します。 Azure の基になっているマルチ テナント アーキテクチャは、Virtual Network (VNet) の分離、アクセス制御リスト (ACL)、ロード バランサー、IP フィルター、トラフィック フロー ポリシーを使って、デプロイ間の許可されていない非意図的なトラフィックを防止します。 ネットワーク アドレス変換 (NAT) は、内部ネットワーク トラフィックを外部トラフィックから分離します。

Azure ファブリックは、テナントのワークロードにインフラストラクチャ リソースを割り当て、仮想マシン (VM) との間の通信を管理します。 Azure ハイパーバイザーは、VM 間のメモリおよびプロセスの分離を強制し、ネットワーク トラフィックをゲスト OS テナントに安全にルーティングします。

#### <a name="connectivity-to-the-cloud"></a>クラウドへの接続

VDC 実装には、顧客、パートナー、社内ユーザーにサービスを提供するために、外部ネットワークとの接続が必要です。 この接続の必要性は、インターネットへの接続だけでなく、オンプレミスのネットワークとデータセンターへの接続も指します。

[Azure Firewall][AzFW] または他の種類のネットワーク仮想アプライアンス (NVA)、[ユーザー定義ルート][UDR]を使用したカスタム ルーティング ポリシー、[ネットワーク セキュリティ グループ][NSG]を使用したネットワーク フィルタリングを使って、パブリック インターネットと双方向にアクセスできるサービスを制御できます。 インターネットに接続するすべてのリソースを、[Azure DDoS Protection Standard][DDOS] で保護することもお勧めします。

企業によっては、VDC 実装をオンプレミスのデータセンターや他のリソースに接続する必要があります。 この Azure とオンプレミス ネットワーク間の接続は、効果的なアーキテクチャを設計するときに不可欠な要素となります。 この相互接続を作成するには、インターネット経由とプライベート直接接続の 2 とおりの方法があります。

[**Azure のサイト間 VPN**][VPN] は、セキュリティで保護された暗号化接続 (IPsec/IKE トンネル) によって確立される、オンプレミスのネットワークと VDC 実装間のインターネットを介した相互接続サービスです。 Azure のサイト間接続は、すべての接続がインターネット経由で接続するため、柔軟で、すばやく作成でき、追加調達の必要がありません。

多くの VPN 接続において、[**Azure Virtual WAN**][vWAN] は、Azure を介してブランチ間接続を最適化し、自動化するネットワーク サービスです。 Virtual WAN を使用すると、ブランチ デバイスを接続および構成して Azure と通信できます。 接続と構成は、手動で行うことも、Virtual WAN パートナーを通じて推奨プロバイダー デバイスを使用して行うこともできます。 推奨プロバイダー デバイスを使用すると、使いやすさ、接続の簡素化、および構成管理を実現できます。 Azure WAN の組み込みダッシュボードにはすぐに使用できるトラブルシューティング用分析情報が用意されているため、時間を節約でき、大規模なサイト間接続を簡単に表示することができます。

Azure の接続サービスである [**ExpressRoute**][ExR] を使用すると、VDC 実装とすべてのオンプレミス ネットワーク間のプライベート接続が可能になります。 ExpressRoute 接続はパブリック インターネットを使わず、高いセキュリティ、信頼性、速度 (最大 10 Gbps)、および一貫した待機時間を提供します。 ExpressRoute のお客様はプライベート接続に関連付けられたコンプライアンス ルールの利点が得られるので、ExpressRoute は VDC 実装に適しています。 より広い帯域幅が必要なお客様の場合、[ExpressRoute Direct][ExRD] を使用すると、100 Gbps で Microsoft ルーターに直接接続することができます。

通常、ExpressRoute 接続のデプロイでは、ExpressRoute サービス プロバイダーと連携する必要があります。 短時間で使い始める必要がある顧客の場合は、通常、最初にサイト間 VPN を使って VDC 実装とオンプレミスのリソース間の接続を確立した後、サービス プロバイダーとの物理相互接続の完了時に ExpressRoute 接続に移行します。

#### <a name="connectivity-within-the-cloud"></a>*クラウド内の接続*

[VNet][VNet] と [VNet ピアリング][VNetPeering]は、VDC 実装内の基本的なネットワーク接続サービスです。 VNet は VDC リソースの分離の自然な境界を保証し、VNet ピアリングは同じ Azure リージョン内またはリージョンをまたがる異なる VNet 間の相互通信を可能にします。 VNet 内および VNet 間のトラフィック制御では、アクセス制御リスト ([ネットワーク セキュリティ グループ][NSG])、[ネットワーク仮想アプライアンス][NVA]、およびカスタム ルーティング テーブル ([UDR][UDR]) によって指定されたセキュリティ ルールのセットを一致させる必要があります。

## <a name="virtual-datacenter-overview"></a>仮想データセンターの概要

### <a name="topology"></a>トポロジ

_ハブとスポーク_は、仮想データセンター実装のネットワーク トポロジを設計するためのモデルです。 

[![1]][1]

ハブは、異なるゾーン (インターネット、オンプレミス、スポーク) 間のイングレスまたはエグレス トラフィックを制御および検査する中央ネットワーク ゾーンです。 ハブとスポークのトポロジでは、IT 部門は一元化された場所でセキュリティ ポリシーを効率的に適用できます。 また、構成の誤りや露出の可能性も低減されます。

ハブには、スポークによって消費される共通のサービス コンポーネントが含まれます。 共通の中央サービスの例を次に示します。

-   信頼されていないネットワークからアクセスするサード パーティがスポーク内のワークロードにアクセスする前のユーザー認証に必要な Windows Active Directory インフラストラクチャ。 これには、関連する Active Directory フェデレーション サービス (AD FS) が含まれます。
-   オンプレミスおよびインターネット上のリソースにアクセスするための、スポーク内のワークロードの名前付けを解決する DNS サービス ([Azure DNS][DNS] が使用されていない場合)。
-   ワークロードにシングル サインオンを実装するための公開キー基盤 (PKI)。
-   スポーク ネットワーク ゾーンとインターネット間の TCP/UDP トラフィックのフロー制御。
-   スポークとオンプレミス間のフロー制御。
-   (必要に応じて) スポーク間のフロー制御。

VDC では、複数のスポーク間で共有ハブ インフラストラクチャを使用することで、全体的なコストを削減します。

各スポークのロールは、異なる種類のワークロードをホストできます。 スポークは、同じワークロードの反復可能なデプロイのためのモジュール方式のアプローチも提供します。 例として、開発とテスト、ユーザー受け入れテスト、運用前環境、運用環境があります。 スポークでは、組織内のさまざまなグループを分離して有効にすることもできます。 例として Azure DevOps グループがあります。 スポーク内には、基本的なワークロードや、階層間のトラフィック制御を伴う複雑な多層ワークロードをデプロイできます。

#### <a name="subscription-limits-and-multiple-hubs"></a>サブスクリプションの制限と複数のハブ

Azure では、種類に関係なくすべてのコンポーネントが、Azure サブスクリプションにデプロイされます。 異なる Azure サブスクリプションに Azure コンポーネントを分離することで、差別化されたレベルのアクセスと承認の設定など、異なる LOB の要件を満たすことができます。

1 つの VDC 実装で多数のスポークにスケールアップできますが、他の IT システムと同様に、プラットフォームの制限があります。 ハブのデプロイは特定の Azure サブスクリプションにバインドされ、サブスクリプションには制限事項と上限があります (たとえば、VNet ピアリングの最大数、詳しくは「[Azure サブスクリプションとサービスの制限、クォータ、制約][Limits]」を参照)。 制限が問題になる可能性がある場合は、単一のハブとスポークからハブとスポークのクラスターにモデルを拡張することによって、アーキテクチャをさらに拡張できます。 1 つまたは複数の Azure リージョン内の複数のハブを、VNet ピアリング、ExpressRoute、Virtual WAN、サイト間 VPN を使って相互に接続できます。

[![2]][2]

複数のハブを導入すると、システムのコストと管理作業が増加します。 複数のハブの導入が妥当なのは、スケーラビリティ (システムの制限や冗長性など) とリージョン レプリケーション (エンドユーザーのパフォーマンスやディザスター リカバリーなど) が必要な場合だけです。 複数のハブが必要なシナリオでは、運用を容易にするため、すべてのハブで同じサービスのセットを提供する必要があります。

#### <a name="interconnection-between-spokes"></a>スポーク間の相互接続

1 つのスポーク内に、複雑な多階層のワークロードを実装することができます。 多階層の構成は、同じ VNet 内のサブネット (すべての階層に対して 1 つ) を使い、NSG を使ってフローをフィルター処理することによって、実装できます。

アーキテクトは、複数の仮想ネットワークに多層ワークロードをデプロイできます。 仮想ネットワーク ピアリングにより、スポークは同じハブまたは異なるハブの他のスポークに接続できます。 このシナリオの一般的な例は、アプリケーション処理サーバーが 1 つのスポーク (仮想ネットワーク) にあるケースです。 データベースは別のスポーク (仮想ネットワーク) にデプロイされています。 この場合、仮想ネットワーク ピアリングでスポークを相互接続することによって、ハブの通過を簡単に回避できます。 ハブをバイパスすることで、ハブにしか存在しない重要なセキュリティ ポイントや監査ポイントがバイパスされることがないように、アーキテクチャとセキュリティを慎重に見直す必要があります。

[![3]][3]

スポークは、ハブとして機能するスポークに相互接続することもできます。 この方法では 2 レベルの階層が作成され、上位レベル (レベル 0) のスポークが、階層の下位レベル (レベル 1) のスポークのハブになります。 VDC 実装のスポークは、トラフィックがオンプレミス ネットワークまたはパブリック インターネットのいずれかで送信先に到達できるように、中央のハブにトラフィックを転送する必要があります。 2 レベルのハブのアーキテクチャでは複雑なルーティングが導入され、単純なハブ スポーク関係のメリットが失われます。

Azure では複雑なトポロジを構成できますが、VDC の概念の中核となる原則の 1 つは再現性と単純さです。 管理作業を最小限に抑えるために、単純なハブ スポーク設計が、推奨される VDC 参照アーキテクチャです。

### <a name="components"></a>コンポーネント

仮想データセンターは、4 種類の基本的なコンポーネントで構成されています。**インフラストラクチャ**、**境界ネットワーク**、**ワークロード**、および**監視**です。

各コンポーネントの種類は、さまざまな Azure の機能とリソースで構成されます。 VDC 実装は、複数のコンポーネントの種類のインスタンスと、同じコンポーネントの種類の複数のバリエーションで構成されます。 たとえば、異なるアプリケーションを表す多数の異なる論理的に分離されたワークロード インスタンスを使うことができます。 これらのさまざまなコンポーネントの種類とインスタンスを使って、最終的に VDC を構築します。

[![4]][4]

VDC の上記のおおまかな概念アーキテクチャでは、ハブ スポーク トポロジのさまざまなゾーンで使用されるさまざまなコンポーネントの種類が示されています。 図では、アーキテクチャのさまざまな部分にインフラストラクチャ コンポーネントが示されています。

一般的には、アクセス権と特権をグループ ベースにすることをお勧めします。 個々のユーザーではなくグループを扱い、チーム間に一貫した管理方法を用意することで、アクセス ポリシーの保守が容易になります。  また、構成エラーを最小限に抑えるために役立ちます。 適切なグループにユーザーを割り当てたり、グループからユーザーを削除することで、特定のユーザーの権限を最新に保つことができます。

各ロール グループの名前には、一意のプレフィックスが必要です。 このプレフィックスにより、グループとワークロードの関連付けを識別しやすくなります。 たとえば、認証サービスをホストしているワークロードでは、グループに **AuthServiceNetOps**、**AuthServiceSecOps**、**AuthServiceDevOps**、**AuthServiceInfraOps** という名前を付けます。 一元化されたロール (特定のサービスに関係しないロール) には、**Corp** というプレフィックスを付けます (例: **CorpNetOps**)。

多くの組織では、次のグループのバリエーションを使って、ロールが大きく分類されています。

-   中央 IT グループ (**Corp**) は、インフラストラクチャ コンポーネントを制御するための所有者権限を持ちます。 コンポーネントの例として、ネットワークとセキュリティがあります。 このグループには、サブスクリプションの共同作業者のロールとスポークのネットワーク共同作成者権限が必要であり、ハブを制御できる必要があります。 多くの場合、大規模な組織では、これらの管理責任を複数のチームが分担します。 たとえば、ネットワーク運用 (**CorpNetOps**) グループはネットワークだけを担当し、セキュリティ運用 (**CorpSecOps**) グループはファイアウォールとセキュリティ ポリシーを担当します。 この場合、カスタム ロールの割り当て用に 2 つの異なるグループを作成する必要があります。
-   開発とテスト (**AppDevOps**) グループは、アプリまたはサービス ワークロードをデプロイする役割を担います。 このグループには、IaaS デプロイの仮想マシン共同作成者のロール、または 1 つ以上の PaaS 共同作成者のロールが割り当てられます。 「[Azure リソースの組み込みロール][Roles]」をご覧ください。 場合によっては、開発とテスト チームは、ハブまたは特定のスポーク内のセキュリティ ポリシー、NSG、ルーティング ポリシー、UDR を表示できる必要があります。 その場合、このグループには、ワークロードの共同作成者のロールに加え、ネットワーク閲覧者のロールも必要になります。
-   運用とメンテナンス グループ (**CorpInfraOps** または **AppInfraOps**) は、運用環境のワークロードを管理する役割を担います。 このグループは、運用サブスクリプションのワークロードのサブスクリプション共同作成者である必要があります。 一部の組織では、運用環境のサブスクリプション共同作成者のロールと中央ハブ サブスクリプションを持つ、追加のエスカレーション サポート チーム グループが必要かどうかを評価することもあります。 この追加のグループは、運用環境における潜在的な構成の問題を修正します。

VDC は、ハブを管理する中央の IT グループ用に作成されたグループがワークロード レベルで対応するグループを持つように設計されています。 ハブ リソースを管理するだけでなくは、中央 IT グループのみが、サブスクリプションでの外部アクセスと最上位レベルのアクセス許可を制御することができます。 また、ワークロード グループは、中央 IT でそれぞれの VNet のリソースとアクセス許可を独立して制御することもできます。

VDC は、さまざまな基幹業務 (LOB) の複数のプロジェクトを安全にホストできるようにパーティション分割されています。 すべてのプロジェクトには、異なる分離環境 (開発、UAT、運用) が必要です。 これらの環境ごとに Azure サブスクリプションを分けると、自然な分離が提供されます。

[![5]][5]

上記の図は、組織のプロジェクト、ユーザー、グループ間の関係と、Azure のコンポーネントがデプロイされている環境を示しています。

通常、IT の環境 (または階層) は、複数のアプリケーションがデプロイされて実行されるシステムです。 大規模な企業では、開発環境 (変更が行われてテストされる場所) と運用環境 (エンドユーザーが使うもの) が使われます。 これらの環境は分離され、多くの場合、その間に複数のステージング環境があり、段階的にデプロイ (ロールアウト)、テスト、および問題が発生した場合のロールバックを行うことができます。 デプロイ アーキテクチャは大きく異なりますが、通常、開発 (DEV) で始まって運用 (PROD) で終わる基本的なプロセスは同じです。

この種の多層環境の一般的なアーキテクチャは、開発およびテスト用の Azure DevOps、ステージング用の UAT、運用環境で構成されます。 組織では、1 つまたは複数の Azure AD テナントを利用して、これらの環境に対するアクセスと権限を定義できます。 前の図は、Azure DevOps および UAT 用と運用専用の 2 つの異なる Azure AD テナントが使用されているケースを示しています。

異なる Azure AD テナントが存在すると、必然的に環境間が分離されます。 同じユーザー グループ (中央 IT など) が、プロジェクトの Azure DevOps または運用環境のロールやアクセス許可を変更するために Azure AD テナントにアクセスするときは、テナントごとに異なる URI を使用して認証する必要があります。 環境にアクセスするときに、環境ごとに異なるユーザー認証が存在すると、人的エラーが原因で発生する可能性のある停止や他の問題が減少します。

#### <a name="component-type-infrastructure"></a>コンポーネントの種類:インフラストラクチャ

このコンポーネントの種類には、ほとんどのサポート インフラストラクチャが存在します。 また、中央 IT、セキュリティ、コンプライアンスのチームが最も多くの時間を費やす場所でもあります。

[![6]][6]

インフラストラクチャ コンポーネントは、VDC 実装のさまざまなコンポーネントに相互接続を提供し、ハブとスポークの両方に存在します。 インフラストラクチャ コンポーネントを管理および保守する責任は、通常、中央 IT およびセキュリティ チームに割り当てられます。

IT インフラストラクチャ チームの主要なタスクの 1 つは、企業全体にわたって一貫した IP アドレス スキーマを保証することです。 VDC 実装に割り当てられたプライベート IP アドレス空間は、一貫性があり、オンプレミスのネットワークで割り当てられたプライベート IP アドレスと重複していない必要があります。

オンプレミスのエッジ ルーター上または Azure 環境内の NAT は、IP アドレスの競合を回避できますが、インフラストラクチャ コンポーネントが複雑になります。 管理の簡単さが VDC の主な目標の 1 つなので、NAT を使って IP の問題を処理することは推奨されるソリューションではありません。

インフラストラクチャ コンポーネントは次の機能を備えています。

-   [**ID とディレクトリ サービス**][AAD]。 Azure のすべてのリソース種類へのアクセスは、ディレクトリ サービスに格納された ID によって制御されます。 ディレクトリ サービスは、ユーザーのリストだけでなく、特定の Azure サブスクリプション内のリソースへのアクセス権も格納しています。 これらのサービスは、クラウドのみに存在することも、Active Directory に格納されたオンプレミスの ID と同期することもできます。
-   [**Virtual Network**][VPN]。 Virtual Network は、VDC の主要コンポーネントの 1 つであり、Azure プラットフォーム上にトラフィックの分離境界を作成できるようにします。 Virtual Network は、1 つまたは複数の仮想ネットワーク セグメントで構成され、それぞれが特定の IP ネットワーク プレフィックス (サブネット) を持ちます。 Virtual Network では、IaaS 仮想マシンと PaaS サービスがプライベート通信を確立できる、内部の境界領域が定義されています。 ある仮想ネットワーク内のVM (および PaaS サービス) と異なる仮想ネットワーク内の VM (および PaaS サービス) は、両方の仮想ネットワークが同じ顧客によって同じサブスクリプション下で作成された場合でも、直接通信することはできません。 分離は、顧客の VM と通信が仮想ネットワーク内でプライベートであることを保証する重要な特性です。
-   [**UDR**][UDR]。 Virtual Network 内のトラフィックは、システム ルーティング テーブルに基づいて既定でルーティングされます。 ユーザー定義ルートはカスタム ルーティング テーブルであり、ネットワーク管理者はそれを 1 つまたは複数のサブネットに関連付けることで、システム ルーティング テーブルの動作を上書きし、仮想ネットワーク内の通信パスを定義することができます。 UDR が存在すると、スポークからのエグレス トラフィックが特定のカスタム VM を通過し、ネットワーク仮想アプライアンスとロード バランサーがハブとスポークに存在することが保証されます。
-   [**NSG**][NSG]。 ネットワーク セキュリティ グループは、IP 送信元、IP 送信先、プロトコル、IP 送信元ポート、および IP 送信先ポートのフィルタリングとして動作するセキュリティ規則のリストです。 NSG は、サブネットと、Azure VM に関連付けられた仮想 NIC カードの、どちらか一方または両方に適用できます。 NSG は、ハブとスポークに正しいフロー制御を実装するうえで不可欠です。 NSG によって提供されるセキュリティのレベルは、どのポートをどのような目的で開くかによって決まります。 お客様は、IPtables や Windows ファイアウォールなどのホストベースのファイアウォールで、VM ごとの追加フィルターを適用する必要があります。
-   [**DNS**][DNS]。 VDC 実装の VNet 内のリソースの名前解決は、DNS によって提供されます。 Azure は、[パブリック][DNS]と[プライベート][PrivateDNS]の両方の名前解決に DNS サービスを提供します。 プライベート ゾーンは、仮想ネットワーク内での名前解決と仮想ネットワーク間での名前解決を両方提供します。 プライベート ゾーンは、同じリージョンの複数の仮想ネットワークをまたぐだけでなく、複数のリージョンおよびサブスクリプションをまたぐことができます。 パブリック解決の場合、Azure DNS は、DNS ドメインのホスティング サービスであり、Microsoft Azure インフラストラクチャを使用した名前解決を提供します。 Azure でドメインをホストすることで、その他の Azure サービスと同じ資格情報、API、ツール、課金情報を使用して DNS レコードを管理できます。
-   [**サブスクリプション**][SubMgmt]と[**リソース グループ管理**][RGMgmt]。 サブスクリプションでは、Azure にリソースの複数のグループを作成する自然な境界が定義されています。 サブスクリプション内のリソースは、リソース グループと呼ばれる論理コンテナーにまとめられています。 リソース グループは、VDC 実装のリソースを整理するための論理グループを表します。
-   [**RBAC**][RBAC]。 RBAC を使うと、組織のロールと特定の Azure リソースにアクセスするための権限をマップすることができ、ユーザーをアクションの特定のサブセットのみに制限することができます。 RBAC では、関連するスコープ内のユーザー、グループ、アプリケーションに適切なロールを割り当てることで、アクセス権を付与できます。 ロール割り当てのスコープには、Azure サブスクリプション、リソース グループ、または単独のリソースを指定できます。 RBAC では、アクセス許可を継承できます。 親スコープでロールが割り当てられると、その親に含まれる子へのアクセス権も付与されます。 RBAC を使って、職務を分離し、職務に必要なアクセス許可のみをユーザーに付与することができます。 たとえば、RBAC を使って、ある従業員にはサブスクリプションで仮想マシンを管理できるようにし、他の従業員にも同じサブスクリプション内で SQL DB を管理できるようにします。
-   [**VNet ピアリング**][VNetPeering]。 VDC のインフラストラクチャの作成に使用される基本的な機能は、VNet ピアリングです。これは、Azure データ センターのネットワークを介して、あるいはリージョンをまたがる Azure の世界規模のバックボーンを使用して、同じリージョンの 2 つの仮想ネットワーク (VNet) を接続するメカニズムです。

#### <a name="component-type-perimeter-networks"></a>コンポーネントの種類:境界ネットワーク

[境界ネットワーク][DMZ] コンポーネントを使用すると、オンプレミス ネットワークまたは物理データセンター ネットワーク間のネットワーク接続だけでなく、インターネットとの間の双方向の接続も提供できます。 このコンポーネントは、ネットワークおよびセキュリティ チームが最も多くの時間を費やす場所でもあります。

受信パケットは、スポーク内のバックエンド サーバーに到達する前に、ハブのセキュリティ アプライアンスを通過する必要があります。 セキュリティ アプライアンスの例として、ファイアウォール、IDS、IPS があります。 ワークロードからインターネットへのパケットも、ネットワークから送信される前に、境界ネットワーク内のセキュリティ アプライアンスを通過する必要があります。 このフローは、ポリシーの適用、検査、監査を目的としています。

境界ネットワーク コンポーネントは、次の機能を提供します。

-   [仮想ネットワーク][VNet]、[UDR][UDR]、[NSG][NSG]
-   [ネットワーク仮想アプライアンス][NVA]
-   [Azure Load Balancer][ALB]
-   [Azure Application Gateway][AppGW] と [Web アプリケーション ファイアウォール (WAF)][WAF]
-   [パブリック IP][PIP]
-   [Azure Front Door][AFD]
-   [Azure Firewall][AzFW]

通常、中央 IT チームとセキュリティ チームは、境界ネットワークの要件の定義と運用を担当します。

[![7]][7]

上の図は、インターネットとオンプレミスのネットワークにアクセスする 2 つの境界の適用を示しており、どちらも DMZ ハブおよび vWAN ハブに存在します。 DMZ ハブでは、Web アプリケーション ファイアウォール (WAF) および/または Azure Firewall の複数のファームを使って、多数の LOB をサポートするようにインターネットへの境界ネットワークをスケールアップできます。 vWAN ハブでは、ブランチ間およびブランチから Azure への非常にスケーラブルな接続が、必要に応じて VPN または ExpressRoute 経由で実行されます。

[**仮想ネットワーク**][VNet]。 通常、ハブは複数のサブネットを含む仮想ネットワーク上に構築され、NVA、WAF、Azure Application Gateway インスタンスを介してインターネットとの間でやり取りされるトラフィックをフィルター処理および検査するさまざまな種類のサービスをホストします。

[**UDR**][UDR] UDR を使うと、ファイアウォール、IDS/IPS、その他の仮想アプライアンスをデプロイし、これらのセキュリティ アプライアンスを介してネットワーク トラフィックをルーティングすることで、セキュリティ境界ポリシーを適用、監査、検査することができます。 UDR はハブとスポークのどちらにでも作成でき、VDC 実装で使用される特定のカスタム VM、ネットワーク仮想アプライアンス、ロード バランサーをトラフィックが通過することを保証します。 スポーク内に存在する VM から生成されたトラフィックが正しい仮想アプライアンスに転送されることを保証するには、次ホップとして内部ロード バランサーのフロントエンド IP アドレスを設定することで、スポークのサブネットに UDR を設定する必要があります。 内部ロード バランサーは、内部トラフィックを仮想アプライアンス (ロード バランサーのバックエンド プール) に分散させます。

[**Azure Firewall**][AzFW] は、Azure Virtual Network リソースを保護するクラウドベースのマネージド ネットワーク セキュリティ サービスです。 組み込みの高可用性とクラウドの無制限のスケーラビリティを備えた、完全にステートフルなサービスとしてのファイアウォールです。 サブスクリプションと仮想ネットワークをまたいでアプリケーションとネットワークの接続ポリシーを一元的に作成、適用、記録できます。 Azure Firewall では、仮想ネットワーク リソースに静的パブリック IP アドレスが使用されます。 これにより、仮想ネットワークから送信されるトラフィックを外部のファイアウォールで識別できます。 サービスはログ記録と分析を行うために Azure Monitor と完全に統合されます。

[**ネットワーク仮想アプライアンス**][NVA]。 ハブでは、インターネットにアクセスする境界ネットワークは、通常、Azure Firewall インスタンスあるいはファイアウォールまたは Web アプリケーション ファイアウォール (WAF) のファームによって管理されます。

一般に、さまざまな LOB で多くの Web アプリケーションが使用されます。 これらのアプリケーションは、さまざまな脆弱性や潜在的な悪用の影響を受ける傾向があります。 Web アプリケーション ファイアウォールは、Web アプリケーション (HTTP/HTTPS) に対する攻撃を汎用ファイアウォールよりも詳細に検出するために使用される特殊な種類の製品です。 従来のファイアウォール テクノロジと比較すると、WAF は脅威から内部 Web サーバーを保護するための特定の機能セットを備えています。

Azure Firewall または NVA ファイアウォールはいずれも共通管理プレーンを使用し、一連のセキュリティ規則により、スポークでホストされているワークロードを保護し、オンプレミスのネットワークへのアクセスを制御します。 Azure Firewall にはスケーラビリティが組み込まれているのに対し、NVA ファイアウォールはロード バランサーの背後で手動でスケーリングすることができます。 一般に、ファイアウォール ファームは WAF ほど特化したソフトウェアではありませんが、エグレスおよびイングレスのあらゆる種類のトラフィックをフィルター処理して検査する、より広範なアプリケーション スコープを備えています。 これは、NVA アプローチが使用されている場合に、Azure Marketplace から検索してデプロイすることができます。

インターネットから送信されるトラフィックとオンプレミスから送信されるトラフィックには、それぞれ異なる Azure Firewall (または NVA) のセットを使用してください。 両方にただ 1 つのファイアウォールのセットを使うと、2 つのネットワーク トラフィック セットの間にセキュリティ境界が提供されないため、セキュリティ リスクになります。 異なるファイアウォール レイヤーを使うと、セキュリティ規則のチェックの複雑さが軽減され、規則と受信ネットワーク要求の対応が明確になります。

インターネットから送信されるトラフィックには、Azure Firewall インスタンスまたは NVA の特定のセットを使用することをお勧めします。 オンプレミスから送信されるトラフィックには、別のセットを使用します。 両方にファイアウォールの同じセットを使用すると、2 つのネットワーク トラフィック セットの間にセキュリティ境界が提供されないため、セキュリティ リスクになります。 個別のファイアウォール レイヤーを使用すると、セキュリティ規則のチェックの複雑さが軽減され、規則と受信ネットワーク要求の対応が明確になります。

[**Azure Load Balancer**][ALB] が提供する高可用性レイヤー 4 (TCP、UDP) サービスは、負荷分散セットで定義されているサービス インスタンス間に受信トラフィックを分散できます。 フロントエンド エンドポイント (パブリック IP エンドポイントまたはプライベート IP エンドポイント) からロード バランサーに送信されたトラフィックは、アドレス変換をして、またはしないで、バックエンド IP アドレス プール (例: ネットワーク仮想アプライアンスまたは VM) のセットに再配信できます。

Azure Load Balancer は、さまざまなサーバー インスタンスの正常性をプローブすることもでき、プローブが応答に失敗した場合、ロード バランサーは異常なインスタンスへのトラフィック送信を停止します。 VDC では、外部ロード バランサーがハブとスポークにデプロイされています。 ハブでは、スポーク内のサービスにトラフィックを効率的にルーティングするためにロード バランサーが使用され、スポークでは、アプリケーション トラフィックを管理するためにロード バランサーが使用されています。

[**Azure Front Door**][AFD] (AFD) は、Microsoft による高可用性かつスケーラブルな Web アプリケーション アクセラレーション プラットフォーム、グローバル HTTP ロード バランサー、アプリケーション保護、コンテンツ配信ネットワークです。 AFD は、Microsoft のグローバル ネットワークのエッジの 100 を超える箇所で動作し、動的 Web アプリケーションと静的コンテンツを構築、操作、スケールアウトできるようにします。 AFD を使用すれば、世界レベルのエンドユーザー パフォーマンス、統一されたリージョン/スタンプのメンテナンス自動化、BCDR の自動化、統一されたクライアント/ユーザー情報、キャッシュ、サービスの分析情報がアプリケーションに提供されます。 このプラットフォームは、パフォーマンス、信頼性、サポートの SLA やコンプライアンス認定資格に加え、Azure でネイティブに開発、運用、サポートされている監査可能なセキュリティ プラクティスを提供します。

[**Application Gateway**][AppGW] Microsoft Azure Application Gateway は、アプリケーション配信コントローラー (ADC) をサービスとして提供する専用仮想アプライアンスで、さまざまなレイヤー 7 負荷分散機能をアプリケーションで利用できるようにします。 これにより、CPU を集中的に使用する SSL 終了を Application Gateway にオフロードし、Web ファームの生産性を最適化できます。 また、着信トラフィックのラウンド ロビン分散、Cookie ベースのセッション アフィニティ、URL パス ベースのルーティング、単一の Application Gateway の背後で複数の Web サイトをホストする機能など、その他のレイヤー 7 ルーティング機能も用意されています。 アプリケーション ゲートウェイの WAF SKU の一部として、Web アプリケーション ファイアウォール (WAF) も提供されます。 この SKU は、一般的な Web の脆弱性や悪用から Web アプリケーションを保護します。 Application Gateway は、インターネット接続ゲートウェイ、または内部的にのみ使用されるゲートウェイのいずれかとして構成できるほか、この両方を組み合わせて使用することも可能です。 

[**パブリック IP**][PIP]。 Azure の一部の機能を使用すると、サービス エンドポイントをパブリック IP アドレスに関連付けることができるので、インターネットからリソースにアクセスできます。 このエンドポイントでは、ネットワーク アドレス変換 (NAT) を使用して、Azure 仮想ネットワーク上の内部アドレスとポートにトラフィックをルーティングします。 これは、外部トラフィックが仮想ネットワークに到達するための主な経路です。 パブリック IP アドレスを構成することで、仮想ネットワークに渡されるトラフィックと、そのトラフィックが仮想ネットワークのどこでどのように変換されるのかを決定することができます。

[**Azure DDoS Protection Standard**][DDOS] は、[Basic サービス][DDOS] レベルに加えて、特に Azure Virtual Network リソースに対してチューニングされた追加の軽減機能を提供します。 DDoS Protection Standard の有効化は簡単であり、アプリケーションの変更は不要です。 保護ポリシーは、専用のトラフィック監視および機械学習アルゴリズムによってチューニングされます。 ポリシーは、仮想ネットワークにデプロイされたリソースに関連付けられているパブリック IP アドレスに適用されます。 リソースの例として、Azure Load Balancer、Azure Application Gateway、Azure Service Fabric のインスタンスがあります。 攻撃中および履歴の表示のために、Azure Monitor ビューからリアルタイムのテレメトリを使用できます。 アプリケーション レイヤー保護は、Azure Application Gateway Web アプリケーション ファイアウォールによって追加できます。 IPv4 の Azure パブリック IP アドレスに対して保護が提供されます。

#### <a name="component-type-monitoring"></a>コンポーネントの種類:監視

監視コンポーネントは、他のすべてのコンポーネントの種類からの可視性とアラートを提供します。 すべてのチームは、アクセスできるコンポーネントとサービスに対する監視にアクセスできる必要があります。 一元的なヘルプ デスクまたは運用チームは、これらのコンポーネントによって提供されるデータへの統合アクセスが必要です。

Azure では、Azure がホストするリソースの動作を追跡するために、さまざまな種類のログ サービスと監視サービスが提供されています。 Azure でのワークロードのガバナンスと制御は、ログ データの収集だけでなく、報告された特定のイベントに基づいてアクションをトリガーする機能にも基づいています。

[**Azure Monitor**][Monitor]。 Azure には、監視領域において特定の役割やタスクを個別に実行するサービスが複数用意されています。 また、これらのサービスが組み合わされた包括的なソリューションを使用すれば、アプリケーションやそれらのサービスを支える Azure リソースからテレメトリを収集、分析し、それに基づいて対処できます。 また、オンプレミスの重要なリソースを監視して、ハイブリッド監視環境を構築することもできます。 アプリケーションの包括的な監視戦略を策定するための最初のステップは、利用可能なツールとデータの把握です。

Azure の主要なログの種類は次の 2 つです。

-   [Azure アクティビティ ログ][ActLog] (以前の名称は**操作ログ**) では、Azure サブスクリプションのリソースに対して実行された操作を把握できます。 これらのログは、サブスクリプションのコントロールプレーン イベントを報告します。 すべての Azure リソースで監査ログが生成されます。

-   [Azure Monitor 診断ログ][DiagLog]は、リソースによって生成されるログであり、そのリソースの操作に関する豊富なデータを提供します。 これらのログの内容は、リソースの種類によって異なります。

[![9]][9]

NSG ログの特に次の情報を追跡することが重要です。

-   [イベント ログ][NSGLog]: MAC アドレスに基づいて VM とインスタンス ロールに適用される NSG ルールに関する情報が提供されます。
-   [カウンター ログ][NSGLog]: トラフィックを拒否または許可するために各 NSG ルールが実行された回数を追跡します。

監査、スタティック分析、またはバックアップのために、すべてのログを Azure ストレージ アカウントに保存できます。 Azure ストレージ アカウントにログを保存すると、さまざまな種類のフレームワークを使用してこのデータを取得、準備、分析、視覚化し、クラウド リソースの状態と正常性を報告できます。 

大企業では、オンプレミス システムの監視用に標準的なフレームワークを既に利用していると考えられます。 そのフレームワークを拡張して、クラウド デプロイによって生成されたログを統合できます。 組織では、[Azure Log Analytics](/azure/log-analytics/log-analytics-queries) を使用して、すべてのログをクラウドに保持できます。 Log Analytics は、クラウドベースのサービスとして実装されます。 そのため、インフラストラクチャ サービスへの投資を最小限に抑えて、このサービスをすぐに稼働させることができます。 Log Analytics は、System Center Operations Manager などの System Center のコンポーネントと統合して、管理のための既存の投資をクラウドに拡張することもできます。 

Log Analytics は、オペレーティング システム、アプリケーション、インフラストラクチャ クラウド コンポーネントによって生成されたログおよびパフォーマンス データを収集、関連付け、検索、操作するための、Azure のサービスです。 統合された検索およびカスタム ダッシュボードを使って、VDC 実装のすべてのワークロードのすべてのレコードを分析するためのリアルタイムの運用分析情報を提供します。

[Azure Network Watcher][NetWatch] は、Azure 仮想ネットワーク内のリソースの監視、診断、メトリックの表示、ログの有効化/無効化を行うツールを提供します。 これは、次のような機能を提供する多面的なサービスです。
-    仮想マシンとエンドポイント間の通信を監視する。
-    仮想ネットワーク内のリソースとそれらの関係を表示する。
-    VM との間で発生するネットワーク トラフィック フィルターの問題を診断する。
-    VM からのネットワーク ルーティングの問題を診断する。
-    VM からの送信接続を診断する。
-    VM との間のパケットをキャプチャする。
-    Azure 仮想ネットワーク ゲートウェイと接続に関する問題を診断する。
-    Azure リージョンとインターネット サービス プロバイダー間の相対待ち時間を確認する。
-    ネットワーク インターフェイスのセキュリティ規則を表示する。
-    ネットワーク メトリックを表示する。
-    ネットワーク セキュリティ グループとの間のトラフィックを分析する。
-    ネットワーク リソースの診断ログを表示する。

Operations Management Suite 内の [Network Performance Monitor][NPM] ソリューションは、ネットワークの詳細情報をエンド ツー エンドで提供できます。 この情報には、Azure ネットワークとオンプレミス ネットワークの単一ビューが含まれます。 このソリューションには、ExpressRoute とパブリック サービスの固有のモニターがあります。

#### <a name="component-type-workloads"></a>コンポーネントの種類:ワークロード

ワークロード コンポーネントは、実際のアプリケーションとサービスが存在する場所です。 アプリケーション開発チームはここで最も多くの時間を費やします。

ワークロードの可能性は無限です。 次に示すのは可能なワークロードの種類のほんの一部です。

**内部 LOB アプリケーション**:基幹業務アプリケーションは、企業の現在の経営にとって重要なコンピューター アプリケーションです。 LOB アプリケーションには、いくつかの一般的な特性があります。

-   **本質的に対話型** -  データを入力すると、結果またはレポートが返されます。
-   **データ ドリブン** - データベースや他のストレージに頻繁にアクセスするデータ集約型です。
-   **統合型** - 組織の内外の他のシステムと統合されます。

**顧客向け Web サイト (インターネットまたは内部接続)**:インターネットと対話するほとんどのアプリケーションは Web サイトです。 Azure は、IaaS VM 上または [Azure Web Apps][WebApps] サイト (PaaS) から Web サイトを実行する機能を提供します。 Azure Web Apps は VNet との統合をサポートし、ネットワーク ゾーンのスポークに Web アプリをデプロイできます。 プライベートの VNet からは、インターネット経由でルーティングできないプライベート アドレスを介してリソースにアクセスできるので、社内向け Web サイトでパブリック インターネット エンドポイントを公開する必要はありません。

**ビッグ データ/分析**:データを膨大な量に拡張する必要があるときに、データベースが適切にスケールアップされない場合があります。 Hadoop テクノロジは、多数のノードで分散クエリを並列に実行するシステムを提供します。 ユーザーは、データ ワークロードを IaaS VM または PaaS ([HDInsight][HDI]) で実行することを選択できます。 HDInsight は、場所ベースの VNet へのデプロイをサポートし、VDC のスポーク内のクラスターにデプロイできます。

**イベントとメッセージング**:[Azure Event Hubs][EventHubs] は、数百万のイベントを収集、変換、保存する、ハイパースケールのテレメトリ インジェスト サービスです。 分散型のストリーミング プラットフォームとして、遅延時間が短く、保持時間を設定可能なため、膨大な量のテレメトリを Azure に送信し、複数のアプリケーションからデータを読み込むことができます。 Event Hubs では、1 つのストリームでリアルタイム パイプラインとバッチ ベースのパイプラインの両方をサポートできます。

[Azure Service Bus][ServiceBus] により、アプリケーションとサービス間に信頼性の高いクラウド メッセージング サービスを実装できます。 Azure Service Bus は、クライアントとサーバー間の非同期のブローカー メッセージング、構造化された先入れ先出し (FIFO) メッセージング、および発行機能とサブスクライブ機能を提供します。

[![10]][10]

### <a name="making-the-vdc-highly-available-multiple-vdcs"></a>VDC の可用性を高める: 複数の VDC

ここまで、この記事では、単一の VDC の設計に注目し、回復性に寄与する基本的なコンポーネントとアーキテクチャについて説明してきました。 Azure には、Azure Load Balancer、NVA、可用性セット、スケール セット、そして運用サービスに確実な SLA レベルを構築できるシステムに寄与する他のメカニズムなどの機能があります。

ただし、単一の VDC は一般的に単一のリージョン内でホストされるため、そのリージョン全体に影響を与える大規模な停止に対して脆弱な場合があります。 高い SLA が必要なお客様は、異なるリージョンに配置された 2 つ(またはそれ以上) の VDC 実装に同じプロジェクトをデプロイして、サービスを保護する必要があります。

SLA の問題に加え、複数の VDC 実装をデプロイすることに意味がある一般的なシナリオがいくつかあります。

-   リージョンまたはグローバル プレゼンス
-   ディザスター リカバリー
-   データセンター間でトラフィックを転送するメカニズム

#### <a name="regionalglobal-presence"></a>リージョンへの配置/グローバルな配置

Azure データセンターは世界中の多数のリージョンに存在します。 複数の Azure データセンターを選択するとき、ユーザーは地理的な距離と待機時間という関連する 2 つの要因を考慮する必要があります。 最良のユーザー エクスペリエンスを提供するには、各 VDC 実装間の地理的な距離と、各 VDC 実装とエンド ユーザー間の距離を評価してください。

VDC 実装がホストされているリージョンは、組織が運営されている法的管轄によって定められた規制要件に準拠している必要があります。

#### <a name="disaster-recovery"></a>障害復旧

ディザスター リカバリー計画の設計は、ワークロードの種類と、さまざまな VDC 実装間でワークロードの状態を同期する機能によって変わります。 ほとんどのお客様は高速フェールオーバー メカニズムを望んでおり、そのためには、状況に応じて複数の VDC 実装を実行するデプロイ間でアプリケーション データを同期する必要があります。 ただし、ディザスター リカバリー計画を設計する場合は、ほとんどのアプリケーションがこのようなデータの同期によって発生する可能性がある待機時間の影響を受けやすい点を考慮することが重要です。

異なる VDC 実装内のアプリケーションの同期とハートビート監視には、ネットワークを介した通信が必要です。 異なるリージョンの 2 つの VDC 実装は、次の方法で接続できます。

-   VNet ピアリング - VNet ピアリングはリージョンをまたいでハブを接続できます
-   ExpressRoute のプライベート ピアリング (各 VDC 実装内のハブが同じ ExpressRoute 回線に接続されている場合)
-   企業バックボーン経由で接続されている複数の ExpressRoute 回線と、ExpressRoute 回線に接続された複数の VDC 実装
-   各 Azure リージョン内の VDC 実装のハブ ゾーン間のサイト間 VPN 接続。

Microsoft バックボーン経由の通過では、高い帯域幅と一貫性のある待機時間レベルなので、VNet ピアリングまたは ExpressRoute の接続が通常は好ましい種類のネットワーク接続です。

このような接続の待機時間と帯域幅を確認し、その結果に基づいて同期または非同期のデータ レプリケーションが適切かどうかを判断するために、ネットワーク認定テストを実行することをお勧めします。 また、最適な目標復旧時間 (RTO) の観点からこれらの結果を比較検討することも重要です。

#### <a name="disaster-recovery-diverting-traffic-from-one-region-to-another"></a>ディザスター リカバリー: あるリージョンから別のリージョンへのトラフィックの転送

[Azure Traffic Manager][TM] では、異なる VDC 実装のパブリック エンドポイントのサービス正常性が定期的にチェックされ、対象のエンドポイントに障害が発生した場合は、ドメイン ネーム システム (DNS) を使用してセカンダリ VDC に自動的にルーティングされます。 

DNS が使用されるため、Traffic Manager は Azure パブリック エンドポイントにのみ使用できます。  通常、このサービスは、VDC 実装の正常なインスタンスで Azure VM および Web アプリへのトラフィックを制御または転送するために使用されます。 Traffic Manager は、Azure リージョン全体で障害が発生した場合でも回復性があり、複数の条件に基づいて、異なる VDC 内のサービス エンドポイントに対するユーザー トラフィックの分散を制御できます。 たとえば、特定の VDC のサービスの障害や、クライアントのネットワーク待機時間が最も短い VDC の選択などです。

### <a name="summary"></a>まとめ

仮想データ センターは、クラウド リソースの使用を最大化し、コストを削減し、システムのガバナンスを簡素化するスケーラブルなアーキテクチャを Azure で作成するためのデータ センター移行のアプローチです。 VDC 実装の概念はハブとスポークのトポロジに基づいており、ハブで共通の共有サービスを提供し、スポークで特定のアプリケーション/ワークロードを実行できます。 また、VDC は、さまざまな部門 (中央 IT、DevOps、運用、メンテナンス) すべてが協力すると同時に各部門の役割を果たすという、会社の役割の構造にも対応しています。 VDC は、"リフト アンド シフト" 移行の要件を満たしますが、ネイティブなクラウド デプロイにも多くの利点をもたらします。

## <a name="references"></a>参照

このドキュメントでは以下の機能について説明しました。 詳細については、次のリンクを参照してください。

| | | |
|-|-|-|
|ネットワーク機能|負荷分散|接続|
|[Azure Virtual Network][VNet]</br>[ネットワーク セキュリティ グループ][NSG]</br>[NSG ログ][NSGLog]</br>[ユーザー定義ルーティング][UDR]</br>[ネットワーク仮想アプライアンス][NVA]</br>[Public IP Addresses][PIP]</br>[Azure DDOS][DDOS]</br>[Azure Firewall][AzFW]</br>[Azure DNS][DNS]|[Azure Front Door][AFD]</br>[Azure Load Balancer (L3) ][ALB]</br>[Application Gateway (L7) ][AppGW]</br>[Web アプリケーション ファイアウォール][WAF]</br>[Azure Traffic Manager][TM]</br></br></br></br></br> |[VNet ピアリング][VNetPeering]</br>[仮想プライベート ネットワーク][VPN]</br>[Virtual WAN][vWAN]</br>[ExpressRoute][ExR]</br>[ExpressRoute Direct][ExRD]</br></br></br></br></br>
|ID</br>|監視</br>|ベスト プラクティス</br>|
|[Azure Active Directory][AAD]</br>[Multi-Factor Authentication][MFA]</br>[ロールベースのアクセス制御][RBAC]</br>[Azure AD の既定の役割][Roles]</br></br></br> |[Network Watcher][NetWatch]</br>[Azure Monitor][Monitor]</br>[アクティビティ ログ][ActLog]</br>[診断ログ][DiagLog]</br>[Microsoft Operations Management Suite][OMS]</br>[Network Performance Monitor][NPM]|[境界ネットワークのベスト プラクティス][DMZ]</br>[サブスクリプション管理][SubMgmt]</br>[リソース グループの管理][RGMgmt]</br>[Azure サブスクリプションの制限][Limits] </br></br></br>|
|その他の Azure サービス|
|[Azure Web Apps][WebApps]</br>[HDInsights (Hadoop) ][HDI]</br>[Event Hubs][EventHubs]</br>[Service Bus][ServiceBus]|

## <a name="next-steps"></a>次の手順

 - VDC のハブとスポークの設計の基礎となるテクノロジである [VNet ピアリング][VNetPeering]の詳細を確認します
 - [Azure AD][AAD] を実装して [RBAC][RBAC] の調査を始めます
 - 組織の構造、要件、ポリシーに対応する、サブスクリプションおよびリソース管理モデルと RBAC モデルを開発します。 最も重要なアクティビティは計画です。 再編成、合併、新製品ラインなどの場合は、可能な限り計画してください。

<!--Image References-->
[0]: ./images/networking-redundant-equipment.png "コンポーネントのオーバーラップの例" 
[1]: ./images/networking-vdc-high-level.png "ハブとスポークの VDC の高度な例"
[2]: ./images/networking-hub-spokes-cluster.png "ハブとスポークのクラスター"
[3]: ./images/networking-spoke-to-spoke.png "スポーク間"
[4]: ./images/networking-vdc-block-level-diagram.png "VDC のブロック レベルの図"
[5]: ./images/networking-users-groups-subsciptions.png "ユーザー、グループ、サブスクリプション、プロジェクト"
[6]: ./images/networking-infrastructure-high-level.png "インフラストラクチャの概要図"
[7]: ./images/networking-highlevel-perimeter-networks.png "インフラストラクチャの概要図"
[8]: ./images/networking-vnet-peering-perimeter-neworks.png "VNet ピアリングと境界ネットワーク"
[9]: ./images/networking-high-level-diagram-monitoring.png "監視の概要図"
[10]: ./images/networking-high-level-workloads.png "ワークロードの概要図"

<!--Link References-->
[Limits]: /azure/azure-subscription-service-limits
[Roles]: /azure/role-based-access-control/built-in-roles
[VNet]: /azure/virtual-network/virtual-networks-overview
[NSG]: /azure/virtual-network/virtual-networks-nsg
[DNS]: /azure/dns/dns-overview
[PrivateDNS]: /azure/dns/private-dns-overview
[VNetPeering]: /azure/virtual-network/virtual-network-peering-overview 
[UDR]: /azure/virtual-network/virtual-networks-udr-overview 
[RBAC]: /azure/role-based-access-control/overview
[MFA]: /azure/multi-factor-authentication/multi-factor-authentication
[AAD]: /azure/active-directory/active-directory-whatis
[VPN]: /azure/vpn-gateway/vpn-gateway-about-vpngateways 
[ExR]: /azure/expressroute/expressroute-introduction
[ExRD]: /azure/expressroute/expressroute-erdirect-about
[vWAN]: /azure/virtual-wan/virtual-wan-about
[NVA]: /azure/architecture/reference-architectures/dmz/nva-ha
[AzFW]: /azure/firewall/overview
[SubMgmt]: /azure/architecture/cloud-adoption/appendix/azure-scaffold 
[RGMgmt]: /azure/azure-resource-manager/resource-group-overview
[DMZ]: /azure/best-practices-network-security
[ALB]: /azure/load-balancer/load-balancer-overview
[DDOS]: /azure/virtual-network/ddos-protection-overview
[PIP]: /azure/virtual-network/resource-groups-networking#public-ip-address
[AFD]: /azure/frontdoor/front-door-overview
[AppGW]: /azure/application-gateway/application-gateway-introduction
[WAF]: /azure/application-gateway/application-gateway-web-application-firewall-overview
[Monitor]: /azure/monitoring-and-diagnostics/
[ActLog]: /azure/monitoring-and-diagnostics/monitoring-overview-activity-logs 
[DiagLog]: /azure/monitoring-and-diagnostics/monitoring-overview-of-diagnostic-logs
[NSGLog]: /azure/virtual-network/virtual-network-nsg-manage-log
[OMS]: /azure/operations-management-suite/operations-management-suite-overview
[NPM]: /azure/log-analytics/log-analytics-network-performance-monitor
[NetWatch]: /azure/network-watcher/network-watcher-monitoring-overview
[WebApps]: /azure/app-service/
[HDI]: /azure/hdinsight/hdinsight-hadoop-introduction
[EventHubs]: /azure/event-hubs/event-hubs-what-is-event-hubs 
[ServiceBus]: /azure/service-bus-messaging/service-bus-messaging-overview
[TM]: /azure/traffic-manager/traffic-manager-overview
