---
title: ゲートキーパー パターン
titleSuffix: Cloud Design Patterns
description: 専用のホスト インスタンスを使用して、アプリケーションとサービスを保護します。このホスト インスタンスは、クライアントとアプリケーションまたはサービスの間でブローカーとして機能し、要求を検証して不要部分を削除し、クライアントとアプリケーションまたはサービスの間で要求とデータを渡します。
keywords: 設計パターン
author: dragon119
ms.date: 06/23/2017
ms.topic: design-pattern
ms.service: architecture-center
ms.subservice: cloud-fundamentals
ms.custom: seodec18
ms.openlocfilehash: 99d3f1f3e4ea1f189fbdfc4cb9d9b3d18e8551a2
ms.sourcegitcommit: c053e6edb429299a0ad9b327888d596c48859d4a
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/20/2019
ms.locfileid: "58242293"
---
# <a name="gatekeeper-pattern"></a><span data-ttu-id="0162d-104">ゲートキーパー パターン</span><span class="sxs-lookup"><span data-stu-id="0162d-104">Gatekeeper pattern</span></span>

[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="0162d-105">専用のホスト インスタンスを使用して、アプリケーションとサービスを保護します。このホスト インスタンスは、クライアントとアプリケーションまたはサービスの間でブローカーとして機能し、要求を検証して不要部分を削除し、クライアントとアプリケーションまたはサービスの間で要求とデータを渡します。</span><span class="sxs-lookup"><span data-stu-id="0162d-105">Protect applications and services by using a dedicated host instance that acts as a broker between clients and the application or service, validates and sanitizes requests, and passes requests and data between them.</span></span> <span data-ttu-id="0162d-106">セキュリティの追加の層を提供し、システムの攻撃対象領域を制限することができます。</span><span class="sxs-lookup"><span data-stu-id="0162d-106">This can provide an additional layer of security, and limit the attack surface of the system.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="0162d-107">コンテキストと問題</span><span class="sxs-lookup"><span data-stu-id="0162d-107">Context and problem</span></span>

<span data-ttu-id="0162d-108">アプリケーションは、要求を受信し処理することで、クライアントに機能を公開します。</span><span class="sxs-lookup"><span data-stu-id="0162d-108">Applications expose their functionality to clients by accepting and processing requests.</span></span> <span data-ttu-id="0162d-109">クラウド ホスト型のシナリオでは、アプリケーションはクライアントが接続するエンドポイントを公開し、通常は、クライアントからの要求を処理するコードを含みます。</span><span class="sxs-lookup"><span data-stu-id="0162d-109">In cloud-hosted scenarios, applications expose endpoints clients connect to, and typically include the code to handle the requests from clients.</span></span> <span data-ttu-id="0162d-110">このコードは、認証と検証、一部またはすべての要求処理を実行し、クライアントに代わってストレージおよびその他のサービスにアクセスする可能性があります。</span><span class="sxs-lookup"><span data-stu-id="0162d-110">This code performs authentication and validation, some or all request processing, and is likely to accesses storage and other services on behalf of the client.</span></span>

<span data-ttu-id="0162d-111">悪意のあるユーザーがシステムを侵害しアプリケーションがホストしている環境にアクセスできると、資格情報とストレージ キー、アクセスするサービスとデータなどの、システムが使用するセキュリティ メカニズムが公開されてしまいます。</span><span class="sxs-lookup"><span data-stu-id="0162d-111">If a malicious user is able to compromise the system and gain access to the application’s hosting environment, the security mechanisms it uses such as credentials and storage keys, and the services and data it accesses, are exposed.</span></span> <span data-ttu-id="0162d-112">その結果、悪意のあるユーザーは、機密情報やその他のサービスに無制限にアクセスできることになります。</span><span class="sxs-lookup"><span data-stu-id="0162d-112">As a result, the malicious user can gain unrestrained access to sensitive information and other services.</span></span>

## <a name="solution"></a><span data-ttu-id="0162d-113">解決策</span><span class="sxs-lookup"><span data-stu-id="0162d-113">Solution</span></span>

<span data-ttu-id="0162d-114">クライアントが機密情報やサービスへのアクセスを取得するリスクを最小限に抑えるには、パブリック エンドポイントを公開するホストまたはタスクを、要求を処理し記憶域にアクセスするコードから切り離します。</span><span class="sxs-lookup"><span data-stu-id="0162d-114">To minimize the risk of clients gaining access to sensitive information and services, decouple hosts or tasks that expose public endpoints from the code that processes requests and accesses storage.</span></span> <span data-ttu-id="0162d-115">これを実現するには、要求を処理するホストまたはタスクに、クライアントと対話してから要求を渡す&mdash;おそらく分離インターフェイスを通じて&mdash;ファサード (専用タスク) を使用します。</span><span class="sxs-lookup"><span data-stu-id="0162d-115">You can achieve this by using a façade or a dedicated task that interacts with clients and then hands off the request&mdash;perhaps through a decoupled interface&mdash;to the hosts or tasks that'll handle the request.</span></span> <span data-ttu-id="0162d-116">図では、このパターンの大まかな概要を説明しています。</span><span class="sxs-lookup"><span data-stu-id="0162d-116">The figure provides a high-level overview of this pattern.</span></span>

![このパターンの大まかな概要](./_images/gatekeeper-diagram.png)

<span data-ttu-id="0162d-118">ゲートキーパー パターンは、単なる記憶域の保護に使用したり、あるいは、アプリケーションのすべての関数を保護するためにより包括的なファサードとして使用できます。</span><span class="sxs-lookup"><span data-stu-id="0162d-118">The gatekeeper pattern can be used to simply protect storage, or it can be used as a more comprehensive façade to protect all of the functions of the application.</span></span> <span data-ttu-id="0162d-119">重要な要因は次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="0162d-119">The important factors are:</span></span>

- <span data-ttu-id="0162d-120">**制御された検証**。</span><span class="sxs-lookup"><span data-stu-id="0162d-120">**Controlled validation**.</span></span> <span data-ttu-id="0162d-121">ゲートキーパーは、すべての要求を検証し、検証要件を満たしていないものを拒否します。</span><span class="sxs-lookup"><span data-stu-id="0162d-121">The gatekeeper validates all requests, and rejects those that don't meet validation requirements.</span></span>
- <span data-ttu-id="0162d-122">**制限付きのリスクと公開**。</span><span class="sxs-lookup"><span data-stu-id="0162d-122">**Limited risk and exposure**.</span></span> <span data-ttu-id="0162d-123">ゲートキーパーには、記憶域およびサービスへのアクセスのため信頼されたホストが使用する資格情報またはキーへのアクセスはありません。</span><span class="sxs-lookup"><span data-stu-id="0162d-123">The gatekeeper doesn't have access to the credentials or keys used by the trusted host to access storage and services.</span></span> <span data-ttu-id="0162d-124">ゲートキーパーが侵害された場合、攻撃者はこれらの資格情報またはキーへのアクセスは取得しません。</span><span class="sxs-lookup"><span data-stu-id="0162d-124">If the gatekeeper is compromised, the attacker doesn't get access to these credentials or keys.</span></span>
- <span data-ttu-id="0162d-125">**適切なセキュリティ**。</span><span class="sxs-lookup"><span data-stu-id="0162d-125">**Appropriate security**.</span></span> <span data-ttu-id="0162d-126">ゲートキーパーが限られた特権モードで実行される一方、残りのアプリケーションは、記憶域およびサービスへのアクセスに必要な完全信頼モードで実行されます。</span><span class="sxs-lookup"><span data-stu-id="0162d-126">The gatekeeper runs in a limited privilege mode, while the rest of the application runs in the full trust mode required to access storage and services.</span></span> <span data-ttu-id="0162d-127">ゲートキーパーは、侵害された場合、アプリケーション サービスまたはデータに直接アクセスできません。</span><span class="sxs-lookup"><span data-stu-id="0162d-127">If the gatekeeper is compromised, it can't directly access the application services or data.</span></span>

<span data-ttu-id="0162d-128">このパターンは、標準的なネットワーク構成におけるファイアウォールのように動作します。</span><span class="sxs-lookup"><span data-stu-id="0162d-128">This pattern acts like a firewall in a typical network topography.</span></span> <span data-ttu-id="0162d-129">これによりゲートキーパーは、要求をチェックし、必要なタスクを実行する信頼されたホスト (キーマスターと呼ばれることがあります) に要求を渡すかどうかを決定することができます。</span><span class="sxs-lookup"><span data-stu-id="0162d-129">It allows the gatekeeper to examine requests and make a decision about whether to pass the request on to the trusted host (sometimes called the keymaster) that performs the required tasks.</span></span> <span data-ttu-id="0162d-130">通常この決定には、信頼されたホストに渡す前にゲートキーパーが要求のコンテンツを検証して不要部分を削除する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0162d-130">This decision typically requires the gatekeeper to validate and sanitize the request content before passing it on to the trusted host.</span></span>

## <a name="issues-and-considerations"></a><span data-ttu-id="0162d-131">問題と注意事項</span><span class="sxs-lookup"><span data-stu-id="0162d-131">Issues and considerations</span></span>

<span data-ttu-id="0162d-132">このパターンの実装方法を決めるときには、以下の点に注意してください。</span><span class="sxs-lookup"><span data-stu-id="0162d-132">Consider the following points when deciding how to implement this pattern:</span></span>

- <span data-ttu-id="0162d-133">ゲートキーパーが要求を渡す信頼されたホストが、内部のまたは保護されたエンドポイントのみを公開し、ゲートキーパーだけに接続することを確認してください。</span><span class="sxs-lookup"><span data-stu-id="0162d-133">Ensure that the trusted hosts the gatekeeper passes requests to expose only internal or protected endpoints, and connect only to the gatekeeper.</span></span> <span data-ttu-id="0162d-134">信頼されたホストは、外部エンドポイントまたはインターフェイスを公開してはなりません。</span><span class="sxs-lookup"><span data-stu-id="0162d-134">The trusted hosts shouldn't expose any external endpoints or interfaces.</span></span>
- <span data-ttu-id="0162d-135">ゲートキーパーは、限られた特権モードで実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0162d-135">The gatekeeper must run in a limited privilege mode.</span></span> <span data-ttu-id="0162d-136">通常これは、ゲートキーパーと信頼されたホストを別々のホステッド サービスまたは仮想マシンで実行することを意味します。</span><span class="sxs-lookup"><span data-stu-id="0162d-136">Typically this means running the gatekeeper and the trusted host in separate hosted services or virtual machines.</span></span>
- <span data-ttu-id="0162d-137">ゲートキーパーは、アプリケーションやサービスに関連する処理を実行したり、データにアクセスしたりしてはいけません。</span><span class="sxs-lookup"><span data-stu-id="0162d-137">The gatekeeper shouldn't perform any processing related to the application or services, or access any data.</span></span> <span data-ttu-id="0162d-138">その機能は純粋に、要求を検証し不要部分を削除することです。</span><span class="sxs-lookup"><span data-stu-id="0162d-138">Its function is purely to validate and sanitize requests.</span></span> <span data-ttu-id="0162d-139">信頼されたホストが追加で要求の検証を実行しなければならない場合がありますが、中核となる検証はゲートキーパーが実行するものです。</span><span class="sxs-lookup"><span data-stu-id="0162d-139">The trusted hosts might need to perform additional validation of requests, but the core validation should be performed by the gatekeeper.</span></span>
- <span data-ttu-id="0162d-140">可能な場合、ゲートキーパーと信頼されたホストやタスクの間では、セキュリティで保護された通信チャネル (HTTPS、SSL または TLS) を使用します。</span><span class="sxs-lookup"><span data-stu-id="0162d-140">Use a secure communication channel (HTTPS, SSL, or TLS) between the gatekeeper and the trusted hosts or tasks where this is possible.</span></span> <span data-ttu-id="0162d-141">ただし、一部のホスティング環境は、内部エンドポイントで HTTPS をサポートしていません。</span><span class="sxs-lookup"><span data-stu-id="0162d-141">However, some hosting environments don't support HTTPS on internal endpoints.</span></span>
- <span data-ttu-id="0162d-142">ゲートキーパー パターンを実装するためにアプリケーションに追加レイヤーを加えると、必要となる追加の処理とネットワーク通信のため、パフォーマンスになんらかの影響を与える可能性があります。</span><span class="sxs-lookup"><span data-stu-id="0162d-142">Adding the extra layer to the application to implement the gatekeeper pattern is likely to have some impact on performance due to the additional processing and network communication it requires.</span></span>
- <span data-ttu-id="0162d-143">ゲートキーパー インスタンスは、単一障害点になる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="0162d-143">The gatekeeper instance could be a single point of failure.</span></span> <span data-ttu-id="0162d-144">障害の影響を最小限に抑えるには、可用性を維持する容量を確保するために、追加のインスタンスを展開して、自動スケール メカニズムを使用することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="0162d-144">To minimize the impact of a failure, consider deploying additional instances and using an autoscaling mechanism to ensure capacity to maintain availability.</span></span>

## <a name="when-to-use-this-pattern"></a><span data-ttu-id="0162d-145">このパターンを使用する状況</span><span class="sxs-lookup"><span data-stu-id="0162d-145">When to use this pattern</span></span>

<span data-ttu-id="0162d-146">このパターンは次の目的に役立ちます。</span><span class="sxs-lookup"><span data-stu-id="0162d-146">This pattern is useful for:</span></span>

- <span data-ttu-id="0162d-147">機密性の高い情報を処理するアプリケーションが、悪意のある攻撃について高度の保護が必要であるサービスを公開している、または中断してはいけないミッション クリティカルな操作を実行している。</span><span class="sxs-lookup"><span data-stu-id="0162d-147">Applications that handle sensitive information, expose services that must have a high degree of protection from malicious attacks, or perform mission-critical operations that shouldn't be disrupted.</span></span>
- <span data-ttu-id="0162d-148">分散アプリケーションで、メインのタスクとは別に要求の検証を実行する、または、メンテナンスと管理の簡略化のためにこの検証を集中管理する必要がある。</span><span class="sxs-lookup"><span data-stu-id="0162d-148">Distributed applications where it's necessary to perform request validation separately from the main tasks, or to centralize this validation to simplify maintenance and administration.</span></span>

## <a name="example"></a><span data-ttu-id="0162d-149">例</span><span class="sxs-lookup"><span data-stu-id="0162d-149">Example</span></span>

<span data-ttu-id="0162d-150">クラウド ホスト型のシナリオでは、ゲートキーパー ロールまたは仮想マシンを、アプリケーションの信頼されたロールとサービスから分離することで、このパターンを実装することができます。</span><span class="sxs-lookup"><span data-stu-id="0162d-150">In a cloud-hosted scenario, this pattern can be implemented by decoupling the gatekeeper role or virtual machine from the trusted roles and services in an application.</span></span> <span data-ttu-id="0162d-151">これを行うには、内部エンドポイント、キュー、または記憶域を中間通信メカニズムとして使用します。</span><span class="sxs-lookup"><span data-stu-id="0162d-151">Do this by using an internal endpoint, a queue, or storage as an intermediate communication mechanism.</span></span> <span data-ttu-id="0162d-152">図は、内部エンドポイントの使用を示しています。</span><span class="sxs-lookup"><span data-stu-id="0162d-152">The figure illustrates using an internal endpoint.</span></span>

![Cloud Services Web とワーカー ロールを使用したパターンの例](./_images/gatekeeper-endpoint.png)

## <a name="related-patterns"></a><span data-ttu-id="0162d-154">関連するパターン</span><span class="sxs-lookup"><span data-stu-id="0162d-154">Related patterns</span></span>

<span data-ttu-id="0162d-155">ゲートキーパー パターンを実装する場合、[バレット キー パターン](./valet-key.md)も関連する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="0162d-155">The [Valet Key pattern](./valet-key.md) might also be relevant when implementing the Gatekeeper pattern.</span></span> <span data-ttu-id="0162d-156">ゲートキーパーと信頼されたロールとの間で通信するときは、リソースへのアクセス許可を制限するキーまたはトークンを使用してセキュリティを強化することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="0162d-156">When communicating between the Gatekeeper and trusted roles it's good practice to enhance security by using keys or tokens that limit permissions for accessing resources.</span></span> <span data-ttu-id="0162d-157">特定のリソースまたはサービスへの限定的な直接アクセスをクライアントに提供するトークンまたはキーの使用方法を記述します。</span><span class="sxs-lookup"><span data-stu-id="0162d-157">Describes how to use a token or key that provides clients with restricted direct access to a specific resource or service.</span></span>
