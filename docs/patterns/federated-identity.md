---
title: フェデレーション ID パターン
titleSuffix: Cloud Design Patterns
description: 外部の ID プロバイダーに認証を委任します。
keywords: 設計パターン
author: dragon119
ms.date: 06/23/2017
ms.topic: design-pattern
ms.service: architecture-center
ms.subservice: cloud-fundamentals
ms.custom: seodec18
ms.openlocfilehash: f4e8d2dff1c653cf2b8ef0109f1cc3027e5428b9
ms.sourcegitcommit: c053e6edb429299a0ad9b327888d596c48859d4a
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/20/2019
ms.locfileid: "58242323"
---
# <a name="federated-identity-pattern"></a><span data-ttu-id="237aa-104">フェデレーション ID パターン</span><span class="sxs-lookup"><span data-stu-id="237aa-104">Federated Identity pattern</span></span>

[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="237aa-105">外部の ID プロバイダーに認証を委任します。</span><span class="sxs-lookup"><span data-stu-id="237aa-105">Delegate authentication to an external identity provider.</span></span> <span data-ttu-id="237aa-106">これにより、開発を簡略化し、ユーザー管理の要件を最小限に抑え、アプリケーションのユーザー エクスペリエンスを向上させることができます。</span><span class="sxs-lookup"><span data-stu-id="237aa-106">This can simplify development, minimize the requirement for user administration, and improve the user experience of the application.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="237aa-107">コンテキストと問題</span><span class="sxs-lookup"><span data-stu-id="237aa-107">Context and problem</span></span>

<span data-ttu-id="237aa-108">通常、ユーザーは、取引関係にあるさまざまな組織によって提供されホストされる複数のアプリケーションを操作する必要があります。</span><span class="sxs-lookup"><span data-stu-id="237aa-108">Users typically need to work with multiple applications provided and hosted by different organizations they have a business relationship with.</span></span> <span data-ttu-id="237aa-109">これらのユーザーは、アプリケーションごとに特定の (異なった) 資格情報を使用するよう求められる場合があります。</span><span class="sxs-lookup"><span data-stu-id="237aa-109">These users might be required to use specific (and different) credentials for each one.</span></span> <span data-ttu-id="237aa-110">これにより、次のことが起こる場合があります。</span><span class="sxs-lookup"><span data-stu-id="237aa-110">This can:</span></span>

- <span data-ttu-id="237aa-111">**まとまりのないユーザー エクスペリエンスの発生**。</span><span class="sxs-lookup"><span data-stu-id="237aa-111">**Cause a disjointed user experience**.</span></span> <span data-ttu-id="237aa-112">多くの異なるアプリケーションがあると、ユーザーはよくサインイン資格情報を忘れてしまいます。</span><span class="sxs-lookup"><span data-stu-id="237aa-112">Users often forget sign-in credentials when they have many different ones.</span></span>

- <span data-ttu-id="237aa-113">**セキュリティの脆弱性の露呈**。</span><span class="sxs-lookup"><span data-stu-id="237aa-113">**Expose security vulnerabilities**.</span></span> <span data-ttu-id="237aa-114">ユーザーが退職する場合、アカウントは早急にプロビジョニング解除される必要があります。</span><span class="sxs-lookup"><span data-stu-id="237aa-114">When a user leaves the company the account must immediately be deprovisioned.</span></span> <span data-ttu-id="237aa-115">大規模な組織では、これが見落とされがちになります。</span><span class="sxs-lookup"><span data-stu-id="237aa-115">It's easy to overlook this in large organizations.</span></span>

- <span data-ttu-id="237aa-116">**ユーザー管理の複雑化**。</span><span class="sxs-lookup"><span data-stu-id="237aa-116">**Complicate user management**.</span></span> <span data-ttu-id="237aa-117">管理者は、すべてのユーザーの資格情報を管理し、さらにパスワードのリマインダーの提供などの追加タスクを実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="237aa-117">Administrators must manage credentials for all of the users, and perform additional tasks such as providing password reminders.</span></span>

<span data-ttu-id="237aa-118">通常、ユーザーはこれらのアプリケーションすべてに対して同じ資格情報を使用したいと考えます。</span><span class="sxs-lookup"><span data-stu-id="237aa-118">Users typically prefer to use the same credentials for all these applications.</span></span>

## <a name="solution"></a><span data-ttu-id="237aa-119">解決策</span><span class="sxs-lookup"><span data-stu-id="237aa-119">Solution</span></span>

<span data-ttu-id="237aa-120">フェデレーション ID を使用できる認証メカニズムを実装します。</span><span class="sxs-lookup"><span data-stu-id="237aa-120">Implement an authentication mechanism that can use federated identity.</span></span> <span data-ttu-id="237aa-121">アプリケーション コードからユーザー認証を分離し、信頼できる ID プロバイダーに認証を委任します。</span><span class="sxs-lookup"><span data-stu-id="237aa-121">Separate user authentication from the application code, and delegate authentication to a trusted identity provider.</span></span> <span data-ttu-id="237aa-122">これにより開発が簡略化され、管理オーバーヘッドを最小限に抑えながらより広い範囲の ID プロバイダー (IdP) を使用して認証できます。</span><span class="sxs-lookup"><span data-stu-id="237aa-122">This can simplify development and allow users to authenticate using a wider range of identity providers (IdP) while minimizing the administrative overhead.</span></span> <span data-ttu-id="237aa-123">承認から認証を明確に分離することもできます。</span><span class="sxs-lookup"><span data-stu-id="237aa-123">It also allows you to clearly decouple authentication from authorization.</span></span>

<span data-ttu-id="237aa-124">信頼できる ID プロバイダーとしては、企業のディレクトリ、オンプレミスのフェデレーション サービス、ビジネス パートナーによって提供されるその他のセキュリティ トークン サービス (STS)、または Microsoft、Google、yahoo!、Facebook などのアカウントを持つユーザーを認証できるソーシャル ID プロバイダーなどがあります。</span><span class="sxs-lookup"><span data-stu-id="237aa-124">The trusted identity providers include corporate directories, on-premises federation services, other security token services (STS) provided by business partners, or social identity providers that can authenticate users who have, for example, a Microsoft, Google, Yahoo!, or Facebook account.</span></span>

<span data-ttu-id="237aa-125">次の図は、クライアント アプリケーションが認証を必要とするサービスにアクセスする必要がある場合のフェデレーション ID のパターンを示しています。</span><span class="sxs-lookup"><span data-stu-id="237aa-125">The figure illustrates the Federated Identity pattern when a client application needs to access a service that requires authentication.</span></span> <span data-ttu-id="237aa-126">認証は、STS と連携して動作する IdP によって実行されます。</span><span class="sxs-lookup"><span data-stu-id="237aa-126">The authentication is performed by an IdP that works in concert with an STS.</span></span> <span data-ttu-id="237aa-127">IdP は、認証されたユーザーの情報を提供するセキュリティ トークンを発行します。</span><span class="sxs-lookup"><span data-stu-id="237aa-127">The IdP issues security tokens that provide information about the authenticated user.</span></span> <span data-ttu-id="237aa-128">要求と呼ばれるこの情報にはユーザーの ID が含まれ、ロール メンバーシップ、より詳細なアクセス権などのその他の情報が含まれることもあります。</span><span class="sxs-lookup"><span data-stu-id="237aa-128">This information, referred to as claims, includes the user’s identity, and might also include other information such as role membership and more granular access rights.</span></span>

![フェデレーション認証の概要](./_images/federated-identity-overview.png)

<span data-ttu-id="237aa-130">このモデルは一般に要求ベースのアクセス制御と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="237aa-130">This model is often called claims-based access control.</span></span> <span data-ttu-id="237aa-131">アプリケーションとサービスは、トークンに含まれる要求に基づいて、機能へのアクセスを承認します。</span><span class="sxs-lookup"><span data-stu-id="237aa-131">Applications and services authorize access to features and functionality based on the claims contained in the token.</span></span> <span data-ttu-id="237aa-132">認証が必要なサービスは、IdP を信頼する必要があります。</span><span class="sxs-lookup"><span data-stu-id="237aa-132">The service that requires authentication must trust the IdP.</span></span> <span data-ttu-id="237aa-133">クライアント アプリケーションは、認証を実行する IdP と接続します。</span><span class="sxs-lookup"><span data-stu-id="237aa-133">The client application contacts the IdP that performs the authentication.</span></span> <span data-ttu-id="237aa-134">認証が成功すると、IdP はユーザーを識別する要求を含んだトークンを STS に返します (IdP と STS は同じサービスになることがあります)。</span><span class="sxs-lookup"><span data-stu-id="237aa-134">If the authentication is successful, the IdP returns a token containing the claims that identify the user to the STS (note that the IdP and STS can be the same service).</span></span> <span data-ttu-id="237aa-135">STS では、クライアントにトークンを返す前に、定義済みの規則に基づいてトークン内の要求を変換したり補強したりできます。</span><span class="sxs-lookup"><span data-stu-id="237aa-135">The STS can transform and augment the claims in the token based on predefined rules, before returning it to the client.</span></span> <span data-ttu-id="237aa-136">これで、クライアント アプリケーションは ID の証明としてこのトークンをサービスに渡すことができます。</span><span class="sxs-lookup"><span data-stu-id="237aa-136">The client application can then pass this token to the service as proof of its identity.</span></span>

> <span data-ttu-id="237aa-137">信頼チェーンに追加の STS がある場合があります。</span><span class="sxs-lookup"><span data-stu-id="237aa-137">There might be additional STSs in the chain of trust.</span></span> <span data-ttu-id="237aa-138">たとえば、後ほど説明するシナリオでは、オンプレミスの STS は、ユーザーを認証するために ID プロバイダーへのアクセスを担当する別の STS を信頼します。</span><span class="sxs-lookup"><span data-stu-id="237aa-138">For example, in the scenario described later, an on-premises STS trusts another STS that is responsible for accessing an identity provider to authenticate the user.</span></span> <span data-ttu-id="237aa-139">この方法は、オンプレミスの STS とディレクトリが存在するエンタープライズのシナリオでは一般的です。</span><span class="sxs-lookup"><span data-stu-id="237aa-139">This approach is common in enterprise scenarios where there's an on-premises STS and directory.</span></span>

<span data-ttu-id="237aa-140">フェデレーション認証は、多様なドメイン間で ID を信頼する問題に標準ベースのソリューションを提供し、シングル サインオンをサポートできます。</span><span class="sxs-lookup"><span data-stu-id="237aa-140">Federated authentication provides a standards-based solution to the issue of trusting identities across diverse domains, and can support single sign-on.</span></span> <span data-ttu-id="237aa-141">これはあらゆる種類のアプリケーション、特にクラウドでホストされるアプリケーション間でより一般的になりつつあります。これは、ID プロバイダーへの直接のネットワーク接続を必要とせずにシングル サインオンをサポートするためです。</span><span class="sxs-lookup"><span data-stu-id="237aa-141">It's becoming more common across all types of applications, especially cloud-hosted applications, because it supports single sign-on without requiring a direct network connection to identity providers.</span></span> <span data-ttu-id="237aa-142">ユーザーはすべてのアプリケーションに対して資格情報を入力する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="237aa-142">The user doesn't have to enter credentials for every application.</span></span> <span data-ttu-id="237aa-143">これにより、多数の異なるアプリケーションへのアクセスに必要な資格情報の作成が回避され、また元の ID プロバイダー以外からユーザーの資格情報が隠されるため、セキュリティが向上します。</span><span class="sxs-lookup"><span data-stu-id="237aa-143">This increases security because it prevents the creation of credentials required to access many different applications, and it also hides the user’s credentials from all but the original identity provider.</span></span> <span data-ttu-id="237aa-144">アプリケーションでは、トークン内に含まれる認証済み ID 情報だけが参照されます。</span><span class="sxs-lookup"><span data-stu-id="237aa-144">Applications see just the authenticated identity information contained within the token.</span></span>

<span data-ttu-id="237aa-145">フェデレーション ID には他にも、ID と資格情報の管理が ID プロバイダーの責任であるという大きな利点があります。</span><span class="sxs-lookup"><span data-stu-id="237aa-145">Federated identity also has the major advantage that management of the identity and credentials is the responsibility of the identity provider.</span></span> <span data-ttu-id="237aa-146">アプリケーションやサービスでは、ID 管理機能を提供する必要がありません。</span><span class="sxs-lookup"><span data-stu-id="237aa-146">The application or service doesn't need to provide identity management features.</span></span> <span data-ttu-id="237aa-147">さらに企業のシナリオでは、企業のディレクトリは、ID プロバイダーを信頼している場合、ユーザーに関する情報を必要としません。</span><span class="sxs-lookup"><span data-stu-id="237aa-147">In addition, in corporate scenarios, the corporate directory doesn't need to know about the user if it trusts the identity provider.</span></span> <span data-ttu-id="237aa-148">これにより、ディレクトリ内でユーザー ID を管理するための管理オーバーヘッドがすべてなくなります。</span><span class="sxs-lookup"><span data-stu-id="237aa-148">This removes all the administrative overhead of managing the user identity within the directory.</span></span>

## <a name="issues-and-considerations"></a><span data-ttu-id="237aa-149">問題と注意事項</span><span class="sxs-lookup"><span data-stu-id="237aa-149">Issues and considerations</span></span>

<span data-ttu-id="237aa-150">フェデレーション認証を実装するアプリケーションを設計する際には、以下の点を考慮してください。</span><span class="sxs-lookup"><span data-stu-id="237aa-150">Consider the following when designing applications that implement federated authentication:</span></span>

- <span data-ttu-id="237aa-151">認証は単一障害点になる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="237aa-151">Authentication can be a single point of failure.</span></span> <span data-ttu-id="237aa-152">複数のデータ センターにアプリケーションをデプロイする場合は、アプリケーションの信頼性と可用性を維持するために、ID 管理メカニズムを同じデータ センターにデプロイすることを検討してください。</span><span class="sxs-lookup"><span data-stu-id="237aa-152">If you deploy your application to multiple datacenters, consider deploying your identity management mechanism to the same datacenters to maintain application reliability and availability.</span></span>

- <span data-ttu-id="237aa-153">認証ツールを使用すれば、認証トークンに含まれるロール要求に基づくアクセス制御を構成できます。</span><span class="sxs-lookup"><span data-stu-id="237aa-153">Authentication tools make it possible to configure access control based on role claims contained in the authentication token.</span></span> <span data-ttu-id="237aa-154">これは一般にロールベースのアクセス制御 (RBAC) と呼ばれ、機能とリソースへのアクセスをより細かいレベルで制御できます。</span><span class="sxs-lookup"><span data-stu-id="237aa-154">This is often referred to as role-based access control (RBAC), and it can allow a more granular level of control over access to features and resources.</span></span>

- <span data-ttu-id="237aa-155">企業のディレクトリとは異なり、ソーシャル ID プロバイダーを使用する要求ベース認証は、通常、メール アドレスや名前などの他には認証されたユーザーに関する情報を提供しません。</span><span class="sxs-lookup"><span data-stu-id="237aa-155">Unlike a corporate directory, claims-based authentication using social identity providers doesn't usually provide information about the authenticated user other than an email address, and perhaps a name.</span></span> <span data-ttu-id="237aa-156">Microsoft アカウントなどの一部のソーシャル ID プロバイダーは、一意識別子のみを提供します。</span><span class="sxs-lookup"><span data-stu-id="237aa-156">Some social identity providers, such as a Microsoft account, provide only a unique identifier.</span></span> <span data-ttu-id="237aa-157">通常、アプリケーションでは、登録済みユーザーに関する情報を維持し、この情報をトークンの要求に含まれる識別子と一致させることができる必要があります。</span><span class="sxs-lookup"><span data-stu-id="237aa-157">The application usually needs to maintain some information on registered users, and be able to match this information to the identifier contained in the claims in the token.</span></span> <span data-ttu-id="237aa-158">これは一般的に、ユーザーが最初にアプリケーションにアクセスする際の登録の過程で実行され、情報は各認証の後に追加の要求としてトークンに挿入されます。</span><span class="sxs-lookup"><span data-stu-id="237aa-158">Typically this is done through registration when the user first accesses the application, and information is then injected into the token as additional claims after each authentication.</span></span>

- <span data-ttu-id="237aa-159">STS 用に構成された ID プロバイダーが複数ある場合、アプリケーションは、認証のためにユーザーがどの ID プロバイダーにリダイレクトされるのか検出する必要があります。</span><span class="sxs-lookup"><span data-stu-id="237aa-159">If there's more than one identity provider configured for the STS, it must detect which identity provider the user should be redirected to for authentication.</span></span> <span data-ttu-id="237aa-160">このプロセスはホーム領域検出と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="237aa-160">This process is called home realm discovery.</span></span> <span data-ttu-id="237aa-161">STS は、ユーザーが提供するメール アドレスやユーザー名、ユーザーがアクセスしているアプリケーションのサブドメイン、ユーザーの IP アドレスの範囲、またはユーザーのブラウザーに格納されている Cookie の内容に基づいて、自動的にこれを行うことがあります。</span><span class="sxs-lookup"><span data-stu-id="237aa-161">The STS might be able to do this automatically based on an email address or user name that the user provides, a subdomain of the application that the user is accessing, the user’s IP address scope, or on the contents of a cookie stored in the user’s browser.</span></span> <span data-ttu-id="237aa-162">たとえば、ユーザーが Microsoft ドメインで user@live.com のようなメール アドレスを入力した場合、STS はユーザーを Microsoft アカウントのサインイン ページにリダイレクトします。</span><span class="sxs-lookup"><span data-stu-id="237aa-162">For example, if the user entered an email address in the Microsoft domain, such as user@live.com, the STS will redirect the user to the Microsoft account sign-in page.</span></span> <span data-ttu-id="237aa-163">以降のアクセスでは、STS は Cookie を使用して、前回は Microsoft アカウントを使用してサインインしたことを示すことができます。</span><span class="sxs-lookup"><span data-stu-id="237aa-163">On later visits, the STS could use a cookie to indicate that the last sign in was with a Microsoft account.</span></span> <span data-ttu-id="237aa-164">自動検出がホーム領域を決定できない場合は、STS によって信頼できる ID プロバイダーを一覧表示するホーム領域検出ページが表示され、ユーザーは使用するものを選択する必要があります。</span><span class="sxs-lookup"><span data-stu-id="237aa-164">If automatic discovery can't determine the home realm, the STS will display a home realm discovery page that lists the trusted identity providers, and the user must select the one they want to use.</span></span>

## <a name="when-to-use-this-pattern"></a><span data-ttu-id="237aa-165">このパターンを使用する状況</span><span class="sxs-lookup"><span data-stu-id="237aa-165">When to use this pattern</span></span>

<span data-ttu-id="237aa-166">このパターンは、次のようなシナリオで役立ちます。</span><span class="sxs-lookup"><span data-stu-id="237aa-166">This pattern is useful for scenarios such as:</span></span>

- <span data-ttu-id="237aa-167">**エンタープライズでのシングル サインオン**。</span><span class="sxs-lookup"><span data-stu-id="237aa-167">**Single sign-on in the enterprise**.</span></span> <span data-ttu-id="237aa-168">このシナリオでは、企業のセキュリティ境界外のクラウドでホストされている企業アプリケーションのために従業員を認証し、1 つのアプリケーションにアクセスするたびにサインインを要求することがないようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="237aa-168">In this scenario you need to authenticate employees for corporate applications that are hosted in the cloud outside the corporate security boundary, without requiring them to sign in every time they visit an application.</span></span> <span data-ttu-id="237aa-169">ユーザー エクスペリエンスはオンプレミスのアプリケーションを使用するときと同様です。そこでは、ユーザーは企業ネットワークにサインインする際に認証され、それ以降は関連するすべてのアプリケーションにアクセスでき、再度サインインする必要はありません。</span><span class="sxs-lookup"><span data-stu-id="237aa-169">The user experience is the same as when using on-premises applications where they're authenticated when signing in to a corporate network, and from then on have access to all relevant applications without needing to sign in again.</span></span>

- <span data-ttu-id="237aa-170">**複数パートナーとのフェデレーション ID**。</span><span class="sxs-lookup"><span data-stu-id="237aa-170">**Federated identity with multiple partners**.</span></span> <span data-ttu-id="237aa-171">このシナリオでは、企業の従業員と、企業のディレクトリ内にアカウントを持たないビジネス パートナーの両方を認証する必要があります。</span><span class="sxs-lookup"><span data-stu-id="237aa-171">In this scenario you need to authenticate both corporate employees and business partners who don't have accounts in the corporate directory.</span></span> <span data-ttu-id="237aa-172">このような状況は、企業間アプリケーション、サードパーティのサービスと統合されるアプリケーション、および異なる IT システムを持った企業が合併またはリソースを共有している場合によく見られます。</span><span class="sxs-lookup"><span data-stu-id="237aa-172">This is common in business-to-business applications, applications that integrate with third-party services, and where companies with different IT systems have merged or shared resources.</span></span>

- <span data-ttu-id="237aa-173">**SaaS アプリケーションでのフェデレーション ID**。</span><span class="sxs-lookup"><span data-stu-id="237aa-173">**Federated identity in SaaS applications**.</span></span> <span data-ttu-id="237aa-174">このシナリオでは、独立系ソフトウェア ベンダーが、複数のクライアントまたはテナントにすぐに使用できるサービスを提供します。</span><span class="sxs-lookup"><span data-stu-id="237aa-174">In this scenario independent software vendors provide a ready-to-use service for multiple clients or tenants.</span></span> <span data-ttu-id="237aa-175">各テナントは適切な ID プロバイダーを使用して認証を行います。</span><span class="sxs-lookup"><span data-stu-id="237aa-175">Each tenant authenticates using a suitable identity provider.</span></span> <span data-ttu-id="237aa-176">たとえば、ビジネス ユーザーは企業の資格情報を使用し、テナントのコンシューマーとクライアントは自分のソーシャル ID 資格情報を使用します。</span><span class="sxs-lookup"><span data-stu-id="237aa-176">For example, business users will use their corporate credentials, while consumers and clients of the tenant will use their social identity credentials.</span></span>

<span data-ttu-id="237aa-177">このパターンは、次の状況では役に立たない場合があります。</span><span class="sxs-lookup"><span data-stu-id="237aa-177">This pattern might not be useful in the following situations:</span></span>

- <span data-ttu-id="237aa-178">アプリケーションのすべてのユーザーが 1 つの ID プロバイダーで認証でき、その他の ID プロバイダーを使用して認証する必要がない場合。</span><span class="sxs-lookup"><span data-stu-id="237aa-178">All users of the application can be authenticated by one identity provider, and there's no requirement to authenticate using any other identity provider.</span></span> <span data-ttu-id="237aa-179">これは、VPN を使用するか、(クラウドでホストされるシナリオでは) オンプレミスのディレクトリとアプリケーション間の仮想ネットワーク接続を使用することで、認証に (アプリケーション内からアクセスできる) 企業のディレクトリを使用するビジネス アプリケーションによく見られます。</span><span class="sxs-lookup"><span data-stu-id="237aa-179">This is typical in business applications that use a corporate directory (accessible within the application) for authentication, by using a VPN, or (in a cloud-hosted scenario) through a virtual network connection between the on-premises directory and the application.</span></span>

- <span data-ttu-id="237aa-180">アプリケーションが、元はカスタム ユーザー ストアなどの異なる認証メカニズムを使用して構築されたか、要求ベースのテクノロジによって使用されるネゴシエーション スタンダードを処理する機能がない場合。</span><span class="sxs-lookup"><span data-stu-id="237aa-180">The application was originally built using a different authentication mechanism, perhaps with custom user stores, or doesn't have the capability to handle the negotiation standards used by claims-based technologies.</span></span> <span data-ttu-id="237aa-181">要求ベースの認証とアクセス制御を既存のアプリケーションに改良することは複雑になる場合があり、おそらくコスト効率も良くありません。</span><span class="sxs-lookup"><span data-stu-id="237aa-181">Retrofitting claims-based authentication and access control into existing applications can be complex, and probably not cost effective.</span></span>

## <a name="example"></a><span data-ttu-id="237aa-182">例</span><span class="sxs-lookup"><span data-stu-id="237aa-182">Example</span></span>

<span data-ttu-id="237aa-183">ある組織が、Microsoft Azure でマルチテナント SaaS (サービスとしてのソフトウェア) アプリケーションをホストします。</span><span class="sxs-lookup"><span data-stu-id="237aa-183">An organization hosts a multi-tenant software as a service (SaaS) application in Microsoft Azure.</span></span> <span data-ttu-id="237aa-184">アプリケーションには、テナントが自分のユーザー用のアプリケーションの管理に使用できる Web サイトが含まれています。</span><span class="sxs-lookup"><span data-stu-id="237aa-184">The application includes a website that tenants can use to manage the application for their own users.</span></span> <span data-ttu-id="237aa-185">その組織の独自の Active Directory によってユーザーが認証されるときに Active Directory フェデレーション サービス (AD FS) によって生成されるフェデレーション ID を使用することで、アプリケーションはテナントに Web サイトへのアクセスを許可します。</span><span class="sxs-lookup"><span data-stu-id="237aa-185">The application allows tenants to access the website by using a federated identity that is generated by Active Directory Federation Services (ADFS) when a user is authenticated by that organization’s own Active Directory.</span></span>

![大規模なエンタープライズ サブスクライバーでユーザーがアプリケーションにアクセスする方法](./_images/federated-identity-multitenat.png)

<span data-ttu-id="237aa-187">図では、テナントが独自の ID プロバイダー、ここでは ADFS を使用して認証する方法が示されています (ステップ 1)。</span><span class="sxs-lookup"><span data-stu-id="237aa-187">The figure shows how tenants authenticate with their own identity provider (step 1), in this case ADFS.</span></span> <span data-ttu-id="237aa-188">テナントを正常に認証した後、ADFS がトークンを発行します。</span><span class="sxs-lookup"><span data-stu-id="237aa-188">After successfully authenticating a tenant, ADFS issues a token.</span></span> <span data-ttu-id="237aa-189">クライアントのブラウザーは、このトークンを、テナントの ADFS が発行したトークンを信頼する SaaS アプリケーションのフェデレーション プロバイダーに転送して、SaaS フェデレーション プロバイダーに有効なトークンを取り戻します (ステップ 2)。</span><span class="sxs-lookup"><span data-stu-id="237aa-189">The client browser forwards this token to the SaaS application’s federation provider, which trusts tokens issued by the tenant’s ADFS, in order to get back a token that is valid for the SaaS federation provider (step 2).</span></span> <span data-ttu-id="237aa-190">必要に応じて、SaaS フェデレーション プロバイダーは、新しいトークンをクライアントのブラウザーに返す前にトークン内の要求をアプリケーションが認識する要求に変換します (ステップ 3)。</span><span class="sxs-lookup"><span data-stu-id="237aa-190">If necessary, the SaaS federation provider performs a transformation on the claims in the token into claims that the application recognizes (step 3) before returning the new token to the client browser.</span></span> <span data-ttu-id="237aa-191">アプリケーションは SaaS フェデレーション プロバイダーによって発行されたトークンを信頼し、トークン内の要求を使用して承認規則を適用します (ステップ 4)。</span><span class="sxs-lookup"><span data-stu-id="237aa-191">The application trusts tokens issued by the SaaS federation provider and uses the claims in the token to apply authorization rules (step 4).</span></span>

<span data-ttu-id="237aa-192">テナントはアプリケーションにアクセスするために個別の資格情報を保存する必要がなく、テナントの会社の管理者は独自の ADFS 内でアプリケーションにアクセスできるユーザーの一覧を構成できます。</span><span class="sxs-lookup"><span data-stu-id="237aa-192">Tenants won't need to remember separate credentials to access the application, and an administrator at the tenant’s company can configure in its own ADFS the list of users that can access the application.</span></span>

## <a name="related-guidance"></a><span data-ttu-id="237aa-193">関連するガイダンス</span><span class="sxs-lookup"><span data-stu-id="237aa-193">Related guidance</span></span>

- [<span data-ttu-id="237aa-194">Microsoft Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="237aa-194">Microsoft Azure Active Directory</span></span>](https://azure.microsoft.com/services/active-directory/)
- [<span data-ttu-id="237aa-195">Active Directory Domain Services</span><span class="sxs-lookup"><span data-stu-id="237aa-195">Active Directory Domain Services</span></span>](https://msdn.microsoft.com/library/bb897402.aspx)
- [<span data-ttu-id="237aa-196">Active Directory フェデレーション サービス (AD FS)</span><span class="sxs-lookup"><span data-stu-id="237aa-196">Active Directory Federation Services</span></span>](https://msdn.microsoft.com/library/bb897402.aspx)
- [<span data-ttu-id="237aa-197">Microsoft Azure のマルチテナント アプリケーションの ID 管理</span><span class="sxs-lookup"><span data-stu-id="237aa-197">Identity management for multitenant applications in Microsoft Azure</span></span>](/azure/architecture/multitenant-identity)
- [<span data-ttu-id="237aa-198">Azure 上のマルチテナント アプリケーション</span><span class="sxs-lookup"><span data-stu-id="237aa-198">Multitenant Applications in Azure</span></span>](/azure/dotnet-develop-multitenant-applications)
